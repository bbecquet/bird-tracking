/*! For license information please see main.6bff78fa.js.LICENSE.txt */
(()=>{var t={97:(t,e,n)=>{var i;!function(r,s,o,a){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],u=s.createElement("div"),h=Math.round,d=Math.abs,p=Date.now;function f(t,e,n){return setTimeout(b(t,n),e)}function m(t,e,n){return!!Array.isArray(t)&&(g(t,n[e],n),!0)}function g(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==a)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function y(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=r.console&&(r.console.warn||r.console.log);return s&&s.call(r.console,i,n),t.apply(this,arguments)}}l="function"!==typeof Object.assign?function(t){if(t===a||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==a&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var _=y((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===a)&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`."),v=y((function(t,e){return _(t,e,!0)}),"merge","Use `assign`.");function x(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&l(i,n)}function b(t,e){return function(){return t.apply(e,arguments)}}function w(t,e){return"function"==typeof t?t.apply(e&&e[0]||a,e):t}function S(t,e){return t===a?e:t}function E(t,e,n){g(P(e),(function(e){t.addEventListener(e,n,!1)}))}function T(t,e,n){g(P(e),(function(e){t.removeEventListener(e,n,!1)}))}function A(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function k(t,e){return t.indexOf(e)>-1}function P(t){return t.trim().split(/\s+/g)}function I(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function C(t){return Array.prototype.slice.call(t,0)}function M(t,e,n){for(var i=[],r=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];I(r,o)<0&&i.push(t[s]),r[s]=o,s++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function z(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),s=0;s<c.length;){if((i=(n=c[s])?n+r:e)in t)return i;s++}return a}var L=1;function D(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var R="ontouchstart"in r,B=z(r,"PointerEvent")!==a,O=R&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),F="touch",V="mouse",N=24,U=["x","y"],j=["clientX","clientY"];function G(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){w(t.options.enable,[t])&&n.handler(e)},this.init()}function q(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,s=1&e&&i-r===0,o=12&e&&i-r===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=$(e));r>1&&!n.firstMultiple?n.firstMultiple=$(e):1===r&&(n.firstMultiple=!1);var s=n.firstInput,o=n.firstMultiple,l=o?o.center:s.center,c=e.center=W(i);e.timeStamp=p(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=Y(l,c),e.distance=X(l,c),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};1!==e.eventType&&4!==s.eventType||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y});e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=H(e.deltaX,e.deltaY);var u=Z(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=u.x,e.overallVelocityY=u.y,e.overallVelocity=d(u.x)>d(u.y)?u.x:u.y,e.scale=o?(h=o.pointers,f=i,X(f[0],f[1],j)/X(h[0],h[1],j)):1,e.rotation=o?function(t,e){return Y(e[1],e[0],j)+Y(t[1],t[0],j)}(o.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,s,o=t.lastInterval||e,l=e.timeStamp-o.timeStamp;if(8!=e.eventType&&(l>25||o.velocity===a)){var c=e.deltaX-o.deltaX,u=e.deltaY-o.deltaY,h=Z(l,c,u);i=h.x,r=h.y,n=d(h.x)>d(h.y)?h.x:h.y,s=H(c,u),t.lastInterval=e}else n=o.velocity,i=o.velocityX,r=o.velocityY,s=o.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=s}(n,e);var h,f;var m=t.element;A(e.srcEvent.target,m)&&(m=e.srcEvent.target);e.target=m}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function $(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:h(t.pointers[n].clientX),clientY:h(t.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:e,center:W(e),deltaX:t.deltaX,deltaY:t.deltaY}}function W(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:h(n/e),y:h(i/e)}}function Z(t,e,n){return{x:e/t||0,y:n/t||0}}function H(t,e){return t===e?1:d(t)>=d(e)?t<0?2:4:e<0?8:16}function X(t,e,n){n||(n=U);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function Y(t,e,n){n||(n=U);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}G.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(D(this.element),this.evWin,this.domHandler)}};var K={mousedown:1,mousemove:2,mouseup:4},J="mousedown",Q="mousemove mouseup";function tt(){this.evEl=J,this.evWin=Q,this.pressed=!1,G.apply(this,arguments)}x(tt,G,{handler:function(t){var e=K[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:V,srcEvent:t}))}});var et={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},nt={2:F,3:"pen",4:V,5:"kinect"},it="pointerdown",rt="pointermove pointerup pointercancel";function st(){this.evEl=it,this.evWin=rt,G.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(it="MSPointerDown",rt="MSPointerMove MSPointerUp MSPointerCancel"),x(st,G,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=et[i],s=nt[t.pointerType]||t.pointerType,o=s==F,a=I(e,t.pointerId,"pointerId");1&r&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):12&r&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),n&&e.splice(a,1))}});var ot={touchstart:1,touchmove:2,touchend:4,touchcancel:8},at="touchstart",lt="touchstart touchmove touchend touchcancel";function ct(){this.evTarget=at,this.evWin=lt,this.started=!1,G.apply(this,arguments)}function ut(t,e){var n=C(t.touches),i=C(t.changedTouches);return 12&e&&(n=M(n.concat(i),"identifier",!0)),[n,i]}x(ct,G,{handler:function(t){var e=ot[t.type];if(1===e&&(this.started=!0),this.started){var n=ut.call(this,t,e);12&e&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:F,srcEvent:t})}}});var ht={touchstart:1,touchmove:2,touchend:4,touchcancel:8},dt="touchstart touchmove touchend touchcancel";function pt(){this.evTarget=dt,this.targetIds={},G.apply(this,arguments)}function ft(t,e){var n=C(t.touches),i=this.targetIds;if(3&e&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,s,o=C(t.changedTouches),a=[],l=this.target;if(s=n.filter((function(t){return A(t.target,l)})),1===e)for(r=0;r<s.length;)i[s[r].identifier]=!0,r++;for(r=0;r<o.length;)i[o[r].identifier]&&a.push(o[r]),12&e&&delete i[o[r].identifier],r++;return a.length?[M(s.concat(a),"identifier",!0),a]:void 0}x(pt,G,{handler:function(t){var e=ht[t.type],n=ft.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:F,srcEvent:t})}});function mt(){G.apply(this,arguments);var t=b(this.handler,this);this.touch=new pt(this.manager,t),this.mouse=new tt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function gt(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,yt.call(this,e)):12&t&&yt.call(this,e)}function yt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),2500)}}function _t(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],s=Math.abs(e-r.x),o=Math.abs(n-r.y);if(s<=25&&o<=25)return!0}return!1}x(mt,G,{handler:function(t,e,n){var i=n.pointerType==F,r=n.pointerType==V;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)gt.call(this,e,n);else if(r&&_t.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var vt=z(u.style,"touchAction"),xt=vt!==a,bt="compute",wt="auto",St="manipulation",Et="none",Tt="pan-x",At="pan-y",kt=function(){if(!xt)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||r.CSS.supports("touch-action",n)})),t}();function Pt(t,e){this.manager=t,this.set(e)}Pt.prototype={set:function(t){t==bt&&(t=this.compute()),xt&&this.manager.element.style&&kt[t]&&(this.manager.element.style[vt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return g(this.manager.recognizers,(function(e){w(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(k(t,Et))return Et;var e=k(t,Tt),n=k(t,At);if(e&&n)return Et;if(e||n)return e?Tt:At;if(k(t,St))return St;return wt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=k(i,Et)&&!kt.none,s=k(i,At)&&!kt["pan-y"],o=k(i,Tt)&&!kt["pan-x"];if(r){var a=1===t.pointers.length,l=t.distance<2,c=t.deltaTime<250;if(a&&l&&c)return}if(!o||!s)return r||s&&6&n||o&&n&N?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var It=32;function Ct(t){this.options=l({},this.defaults,t||{}),this.id=L++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Mt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function zt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Lt(t,e){var n=e.manager;return n?n.get(t):t}function Dt(){Ct.apply(this,arguments)}function Rt(){Dt.apply(this,arguments),this.pX=null,this.pY=null}function Bt(){Dt.apply(this,arguments)}function Ot(){Ct.apply(this,arguments),this._timer=null,this._input=null}function Ft(){Dt.apply(this,arguments)}function Vt(){Dt.apply(this,arguments)}function Nt(){Ct.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ut(t,e){return(e=e||{}).recognizers=S(e.recognizers,Ut.defaults.preset),new jt(t,e)}Ct.prototype={defaults:{},set:function(t){return l(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(m(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Lt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return m(t,"dropRecognizeWith",this)||(t=Lt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(m(t,"requireFailure",this))return this;var e=this.requireFail;return-1===I(e,t=Lt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(m(t,"dropRequireFailure",this))return this;t=Lt(t,this);var e=I(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<8&&i(e.options.event+Mt(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=8&&i(e.options.event+Mt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=It},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=l({},t);if(!w(this.options.enable,[this,e]))return this.reset(),void(this.state=It);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},x(Dt,Ct,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,r=this.attrTest(t);return i&&(8&n||!r)?16|e:i||r?4&n?8|e:2&e?4|e:2:It}}),x(Rt,Dt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(At),t&N&&e.push(Tt),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(6&e.direction?(r=0===s?1:s<0?2:4,n=s!=this.pX,i=Math.abs(t.deltaX)):(r=0===o?1:o<0?8:16,n=o!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return Dt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=zt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),x(Bt,Dt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Et]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),x(Ot,Ct,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[wt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||12&t.eventType&&!r)this.reset();else if(1&t.eventType)this.reset(),this._timer=f((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return It},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),x(Ft,Dt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Et]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),x(Vt,Dt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Rt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:n&N&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=zt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),x(Nt,Ct,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[St]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=t.eventType)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||X(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=f((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return It},failTimeout:function(){return this._timer=f((function(){this.state=It}),this.options.interval,this),It},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ut.VERSION="2.0.7",Ut.defaults={domEvents:!1,touchAction:bt,enable:!0,inputTarget:null,inputClass:null,preset:[[Ft,{enable:!1}],[Bt,{enable:!1},["rotate"]],[Vt,{direction:6}],[Rt,{direction:6},["swipe"]],[Nt],[Nt,{event:"doubletap",taps:2},["tap"]],[Ot]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function jt(t,e){var n;this.options=l({},Ut.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(B?st:O?pt:R?mt:tt))(n,q),this.touchAction=new Pt(this,this.options.touchAction),Gt(this,!0),g(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Gt(t,e){var n,i=t.element;i.style&&(g(t.options.cssProps,(function(r,s){n=z(i.style,s),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}jt.prototype={set:function(t){return l(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&8&r.state)&&(r=e.curRecognizer=null);for(var s=0;s<i.length;)n=i[s],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&14&n.state&&(r=e.curRecognizer=n),s++}},get:function(t){if(t instanceof Ct)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(m(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(m(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=I(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==a&&e!==a){var n=this.handlers;return g(P(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==a){var n=this.handlers;return g(P(t),(function(t){e?n[t]&&n[t].splice(I(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=s.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&Gt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Ut,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:It,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:N,DIRECTION_ALL:30,Manager:jt,Input:G,TouchAction:Pt,TouchInput:pt,MouseInput:tt,PointerEventInput:st,TouchMouseInput:mt,SingleTouchInput:ct,Recognizer:Ct,AttrRecognizer:Dt,Tap:Nt,Pan:Rt,Swipe:Vt,Pinch:Bt,Rotate:Ft,Press:Ot,on:E,off:T,each:g,merge:v,extend:_,assign:l,inherit:x,bindFn:b,prefixed:z}),("undefined"!==typeof r?r:"undefined"!==typeof self?self:{}).Hammer=Ut,(i=function(){return Ut}.call(e,n,e,t))===a||(t.exports=i)}(window,document)},399:(t,e)=>{"use strict";function n(t,e,n){var i,r,s;if(0==e)i=r=s=n;else{var o=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;i=o(l,a,t+1/3),r=o(l,a,t),s=o(l,a,t-1/3)}return[Math.round(255*i),Math.round(255*r),Math.round(255*s)]}e.R=function(t,e){for(var i=e||{lum:50,sat:50},r=isNaN(i.lum)?50:i.lum,s=isNaN(i.sat)?50:i.sat,o=isNaN(t)?3:t,a=[],l=0;l<o;l++)e.rgb?a.push("rgb("+n(l/o,s/100,r/100).toString()+")"):a.push("HSL("+360*l/o+","+s+"%,"+r+"%)");return a}},463:(t,e,n)=>{"use strict";var i=n(791),r=n(296);function s(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(a[t]=e,t=0;t<e.length;t++)o.add(e[t])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(t,e,n,i,r,s,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(t){g[t]=new m(t,0,!1,t,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(t){var e=t[0];g[e]=new m(e,1,!1,t[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(t){g[t]=new m(t,2,!1,t.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(t){g[t]=new m(t,2,!1,t,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(t){g[t]=new m(t,3,!1,t.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(t){g[t]=new m(t,3,!0,t,null,!1,!1)})),["capture","download"].forEach((function(t){g[t]=new m(t,4,!1,t,null,!1,!1)})),["cols","rows","size","span"].forEach((function(t){g[t]=new m(t,6,!1,t,null,!1,!1)})),["rowSpan","start"].forEach((function(t){g[t]=new m(t,5,!1,t.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function _(t){return t[1].toUpperCase()}function v(t,e,n,i){var r=g.hasOwnProperty(e)?g[e]:null;(null!==r?0!==r.type:i||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,n,i){if(null===e||"undefined"===typeof e||function(t,e,n,i){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,r,i)&&(n=null),i||null===r?function(t){return!!h.call(f,t)||!h.call(p,t)&&(d.test(t)?f[t]=!0:(p[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=null===n?3!==r.type&&"":n:(e=r.attributeName,i=r.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(t){var e=t.replace(y,_);g[e]=new m(e,1,!1,t,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(t){var e=t.replace(y,_);g[e]=new m(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(t){var e=t.replace(y,_);g[e]=new m(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!0,!0)}));var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),k=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),z=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function R(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=D&&t[D]||t["@@iterator"])?t:null}var B,O=Object.assign;function F(t){if(void 0===B)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);B=e&&e[1]||""}return"\n"+B+t}var V=!1;function N(t,e){if(!t||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=i.stack.split("\n"),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||r[o]!==s[a]){var l="\n"+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=a);break}}}finally{V=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?F(t):""}function U(t){switch(t.tag){case 5:return F(t.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return t=N(t.type,!1);case 11:return t=N(t.type.render,!1);case 1:return t=N(t.type,!0);default:return""}}function j(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case S:return"Fragment";case w:return"Portal";case T:return"Profiler";case E:return"StrictMode";case I:return"Suspense";case C:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case k:return(t.displayName||"Context")+".Consumer";case A:return(t._context.displayName||"Context")+".Provider";case P:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case M:return null!==(e=t.displayName||null)?e:j(t.type)||"Memo";case z:e=t._payload,t=t._init;try{return j(t(e))}catch(n){}}return null}function G(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(e);case 8:return e===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function q(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function $(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function W(t){t._valueTracker||(t._valueTracker=function(t){var e=$(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(t){i=""+t,s.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(t){i=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function Z(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=$(t)?t.checked?"true":"false":t.value),(t=i)!==n&&(e.setValue(t),!0)}function H(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function X(t,e){var n=e.checked;return O({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function Y(t,e){var n=null==e.defaultValue?"":e.defaultValue,i=null!=e.checked?e.checked:e.defaultChecked;n=q(null!=e.value?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function K(t,e){null!=(e=e.checked)&&v(t,"checked",e,!1)}function J(t,e){K(t,e);var n=q(e.value),i=e.type;if(null!=n)"number"===i?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===i||"reset"===i)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,n):e.hasOwnProperty("defaultValue")&&tt(t,e.type,q(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function Q(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!("submit"!==i&&"reset"!==i||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function tt(t,e,n){"number"===e&&H(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var et=Array.isArray;function nt(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+q(n),e=null,r=0;r<t.length;r++){if(t[r].value===n)return t[r].selected=!0,void(i&&(t[r].defaultSelected=!0));null!==e||t[r].disabled||(e=t[r])}null!==e&&(e.selected=!0)}}function it(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(s(91));return O({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function rt(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(s(92));if(et(n)){if(1<n.length)throw Error(s(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:q(n)}}function st(t,e){var n=q(e.value),i=q(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=i&&(t.defaultValue=""+i)}function ot(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function at(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?at(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ct,ut,ht=(ut=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ct.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,i){MSApp.execUnsafeLocalFunction((function(){return ut(t,e)}))}:ut);function dt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var pt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ft=["Webkit","ms","Moz","O"];function mt(t,e,n){return null==e||"boolean"===typeof e||""===e?"":n||"number"!==typeof e||0===e||pt.hasOwnProperty(t)&&pt[t]?(""+e).trim():e+"px"}function gt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=mt(n,e[n],i);"float"===n&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}Object.keys(pt).forEach((function(t){ft.forEach((function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),pt[e]=pt[t]}))}));var yt=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _t(t,e){if(e){if(yt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(s(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(s(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(s(62))}}function vt(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xt=null;function bt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var wt=null,St=null,Et=null;function Tt(t){if(t=vr(t)){if("function"!==typeof wt)throw Error(s(280));var e=t.stateNode;e&&(e=br(e),wt(t.stateNode,t.type,e))}}function At(t){St?Et?Et.push(t):Et=[t]:St=t}function kt(){if(St){var t=St,e=Et;if(Et=St=null,Tt(t),e)for(t=0;t<e.length;t++)Tt(e[t])}}function Pt(t,e){return t(e)}function It(){}var Ct=!1;function Mt(t,e,n){if(Ct)return t(e,n);Ct=!0;try{return Pt(t,e,n)}finally{Ct=!1,(null!==St||null!==Et)&&(It(),kt())}}function zt(t,e){var n=t.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!i;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(s(231,e,typeof n));return n}var Lt=!1;if(u)try{var Dt={};Object.defineProperty(Dt,"passive",{get:function(){Lt=!0}}),window.addEventListener("test",Dt,Dt),window.removeEventListener("test",Dt,Dt)}catch(ut){Lt=!1}function Rt(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Bt=!1,Ot=null,Ft=!1,Vt=null,Nt={onError:function(t){Bt=!0,Ot=t}};function Ut(t,e,n,i,r,s,o,a,l){Bt=!1,Ot=null,Rt.apply(Nt,arguments)}function jt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function Gt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function qt(t){if(jt(t)!==t)throw Error(s(188))}function $t(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=jt(t)))throw Error(s(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return qt(r),t;if(o===i)return qt(r),e;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=o;break}if(l===i){a=!0,i=r,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=r;break}if(l===i){a=!0,i=o,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?t:e}(t))?Wt(t):null}function Wt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=Wt(t);if(null!==e)return e;t=t.sibling}return null}var Zt=r.unstable_scheduleCallback,Ht=r.unstable_cancelCallback,Xt=r.unstable_shouldYield,Yt=r.unstable_requestPaint,Kt=r.unstable_now,Jt=r.unstable_getCurrentPriorityLevel,Qt=r.unstable_ImmediatePriority,te=r.unstable_UserBlockingPriority,ee=r.unstable_NormalPriority,ne=r.unstable_LowPriority,ie=r.unstable_IdlePriority,re=null,se=null;var oe=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(ae(t)/le|0)|0},ae=Math.log,le=Math.LN2;var ce=64,ue=4194304;function he(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function de(t,e){var n=t.pendingLanes;if(0===n)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=268435455&n;if(0!==o){var a=o&~r;0!==a?i=he(a):0!==(s&=o)&&(i=he(s))}else 0!==(o=n&~r)?i=he(o):0!==s&&(i=he(s));if(0===i)return 0;if(0!==e&&e!==i&&0===(e&r)&&((r=i&-i)>=(s=e&-e)||16===r&&0!==(4194240&s)))return e;if(0!==(4&i)&&(i|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-oe(e)),i|=t[n],e&=~r;return i}function pe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function fe(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function me(){var t=ce;return 0===(4194240&(ce<<=1))&&(ce=64),t}function ge(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ye(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-oe(e)]=n}function _e(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-oe(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ve=0;function xe(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var be,we,Se,Ee,Te,Ae=!1,ke=[],Pe=null,Ie=null,Ce=null,Me=new Map,ze=new Map,Le=[],De="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Re(t,e){switch(t){case"focusin":case"focusout":Pe=null;break;case"dragenter":case"dragleave":Ie=null;break;case"mouseover":case"mouseout":Ce=null;break;case"pointerover":case"pointerout":Me.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ze.delete(e.pointerId)}}function Be(t,e,n,i,r,s){return null===t||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==e&&(null!==(e=vr(e))&&we(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,null!==r&&-1===e.indexOf(r)&&e.push(r),t)}function Oe(t){var e=_r(t.target);if(null!==e){var n=jt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=Gt(n)))return t.blockedOn=e,void Te(t.priority,(function(){Se(n)}))}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function Fe(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Xe(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=vr(n))&&we(e),t.blockedOn=n,!1;var i=new(n=t.nativeEvent).constructor(n.type,n);xt=i,n.target.dispatchEvent(i),xt=null,e.shift()}return!0}function Ve(t,e,n){Fe(t)&&n.delete(e)}function Ne(){Ae=!1,null!==Pe&&Fe(Pe)&&(Pe=null),null!==Ie&&Fe(Ie)&&(Ie=null),null!==Ce&&Fe(Ce)&&(Ce=null),Me.forEach(Ve),ze.forEach(Ve)}function Ue(t,e){t.blockedOn===e&&(t.blockedOn=null,Ae||(Ae=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ne)))}function je(t){function e(e){return Ue(e,t)}if(0<ke.length){Ue(ke[0],t);for(var n=1;n<ke.length;n++){var i=ke[n];i.blockedOn===t&&(i.blockedOn=null)}}for(null!==Pe&&Ue(Pe,t),null!==Ie&&Ue(Ie,t),null!==Ce&&Ue(Ce,t),Me.forEach(e),ze.forEach(e),n=0;n<Le.length;n++)(i=Le[n]).blockedOn===t&&(i.blockedOn=null);for(;0<Le.length&&null===(n=Le[0]).blockedOn;)Oe(n),null===n.blockedOn&&Le.shift()}var Ge=x.ReactCurrentBatchConfig,qe=!0;function $e(t,e,n,i){var r=ve,s=Ge.transition;Ge.transition=null;try{ve=1,Ze(t,e,n,i)}finally{ve=r,Ge.transition=s}}function We(t,e,n,i){var r=ve,s=Ge.transition;Ge.transition=null;try{ve=4,Ze(t,e,n,i)}finally{ve=r,Ge.transition=s}}function Ze(t,e,n,i){if(qe){var r=Xe(t,e,n,i);if(null===r)qi(t,e,i,He,n),Re(t,i);else if(function(t,e,n,i,r){switch(e){case"focusin":return Pe=Be(Pe,t,e,n,i,r),!0;case"dragenter":return Ie=Be(Ie,t,e,n,i,r),!0;case"mouseover":return Ce=Be(Ce,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Me.set(s,Be(Me.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ze.set(s,Be(ze.get(s)||null,t,e,n,i,r)),!0}return!1}(r,t,e,n,i))i.stopPropagation();else if(Re(t,i),4&e&&-1<De.indexOf(t)){for(;null!==r;){var s=vr(r);if(null!==s&&be(s),null===(s=Xe(t,e,n,i))&&qi(t,e,i,He,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else qi(t,e,i,null,n)}}var He=null;function Xe(t,e,n,i){if(He=null,null!==(t=_r(t=bt(i))))if(null===(e=jt(t)))t=null;else if(13===(n=e.tag)){if(null!==(t=Gt(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return He=t,null}function Ye(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Jt()){case Qt:return 1;case te:return 4;case ee:case ne:return 16;case ie:return 536870912;default:return 16}default:return 16}}var Ke=null,Je=null,Qe=null;function tn(){if(Qe)return Qe;var t,e,n=Je,i=n.length,r="value"in Ke?Ke.value:Ke.textContent,s=r.length;for(t=0;t<i&&n[t]===r[t];t++);var o=i-t;for(e=1;e<=o&&n[i-e]===r[s-e];e++);return Qe=r.slice(t,1<e?1-e:void 0)}function en(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function nn(){return!0}function rn(){return!1}function sn(t){function e(e,n,i,r,s){for(var o in this._reactName=e,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return O(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),e}var on,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),hn=O({},cn,{view:0,detail:0}),dn=sn(hn),pn=O({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ln&&(ln&&"mousemove"===t.type?(on=t.screenX-ln.screenX,an=t.screenY-ln.screenY):an=on=0,ln=t),on)},movementY:function(t){return"movementY"in t?t.movementY:an}}),fn=sn(pn),mn=sn(O({},pn,{dataTransfer:0})),gn=sn(O({},hn,{relatedTarget:0})),yn=sn(O({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),_n=O({},cn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),vn=sn(_n),xn=sn(O({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Sn[t])&&!!e[t]}function Tn(){return En}var An=O({},hn,{key:function(t){if(t.key){var e=bn[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=en(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?wn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(t){return"keypress"===t.type?en(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?en(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),kn=sn(An),Pn=sn(O({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=sn(O({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),Cn=sn(O({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Mn=O({},pn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),zn=sn(Mn),Ln=[9,13,27,32],Dn=u&&"CompositionEvent"in window,Rn=null;u&&"documentMode"in document&&(Rn=document.documentMode);var Bn=u&&"TextEvent"in window&&!Rn,On=u&&(!Dn||Rn&&8<Rn&&11>=Rn),Fn=String.fromCharCode(32),Vn=!1;function Nn(t,e){switch(t){case"keyup":return-1!==Ln.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var jn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Gn[t.type]:"textarea"===e}function $n(t,e,n,i){At(i),0<(e=Wi(e,"onChange")).length&&(n=new un("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Wn=null,Zn=null;function Hn(t){Fi(t,0)}function Xn(t){if(Z(xr(t)))return t}function Yn(t,e){if("change"===t)return e}var Kn=!1;if(u){var Jn;if(u){var Qn="oninput"in document;if(!Qn){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),Qn="function"===typeof ti.oninput}Jn=Qn}else Jn=!1;Kn=Jn&&(!document.documentMode||9<document.documentMode)}function ei(){Wn&&(Wn.detachEvent("onpropertychange",ni),Zn=Wn=null)}function ni(t){if("value"===t.propertyName&&Xn(Zn)){var e=[];$n(e,Zn,t,bt(t)),Mt(Hn,e)}}function ii(t,e,n){"focusin"===t?(ei(),Zn=n,(Wn=e).attachEvent("onpropertychange",ni)):"focusout"===t&&ei()}function ri(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Xn(Zn)}function si(t,e){if("click"===t)return Xn(e)}function oi(t,e){if("input"===t||"change"===t)return Xn(e)}var ai="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function li(t,e){if(ai(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(e,r)||!ai(t[r],e[r]))return!1}return!0}function ci(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ui(t,e){var n,i=ci(t);for(t=0;i;){if(3===i.nodeType){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=ci(i)}}function hi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?hi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function di(){for(var t=window,e=H();e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(i){n=!1}if(!n)break;e=H((t=e.contentWindow).document)}return e}function pi(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function fi(t){var e=di(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(e=i.start,void 0===(t=i.end)&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if((t=(e=n.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=ui(n,s);var o=ui(n,i);r&&o&&(1!==t.rangeCount||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&((e=e.createRange()).setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}for(e=[],t=n;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<e.length;n++)(t=e[n]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,yi=null,_i=null,vi=!1;function xi(t,e,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vi||null==gi||gi!==H(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},_i&&li(_i,i)||(_i=i,0<(i=Wi(yi,"onSelect")).length&&(e=new un("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=gi)))}function bi(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Si={},Ei={};function Ti(t){if(Si[t])return Si[t];if(!wi[t])return t;var e,n=wi[t];for(e in n)if(n.hasOwnProperty(e)&&e in Ei)return Si[t]=n[e];return t}u&&(Ei=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ai=Ti("animationend"),ki=Ti("animationiteration"),Pi=Ti("animationstart"),Ii=Ti("transitionend"),Ci=new Map,Mi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zi(t,e){Ci.set(t,e),l(e,[t])}for(var Li=0;Li<Mi.length;Li++){var Di=Mi[Li];zi(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}zi(Ai,"onAnimationEnd"),zi(ki,"onAnimationIteration"),zi(Pi,"onAnimationStart"),zi("dblclick","onDoubleClick"),zi("focusin","onFocus"),zi("focusout","onBlur"),zi(Ii,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ri="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ri));function Oi(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,i,r,o,a,l,c){if(Ut.apply(this,arguments),Bt){if(!Bt)throw Error(s(198));var u=Ot;Bt=!1,Ot=null,Ft||(Ft=!0,Vt=u)}}(i,e,void 0,t),t.currentTarget=null}function Fi(t,e){e=0!==(4&e);for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;t:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break t;Oi(r,a,c),s=l}else for(o=0;o<i.length;o++){if(l=(a=i[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break t;Oi(r,a,c),s=l}}}if(Ft)throw t=Vt,Ft=!1,Vt=null,t}function Vi(t,e){var n=e[mr];void 0===n&&(n=e[mr]=new Set);var i=t+"__bubble";n.has(i)||(Gi(e,t,2,!1),n.add(i))}function Ni(t,e,n){var i=0;e&&(i|=4),Gi(n,t,i,e)}var Ui="_reactListening"+Math.random().toString(36).slice(2);function ji(t){if(!t[Ui]){t[Ui]=!0,o.forEach((function(e){"selectionchange"!==e&&(Bi.has(e)||Ni(e,!1,t),Ni(e,!0,t))}));var e=9===t.nodeType?t:t.ownerDocument;null===e||e[Ui]||(e[Ui]=!0,Ni("selectionchange",!1,e))}}function Gi(t,e,n,i){switch(Ye(e)){case 1:var r=$e;break;case 4:r=We;break;default:r=Ze}n=r.bind(null,e,n,t),r=void 0,!Lt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(r=!0),i?void 0!==r?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):void 0!==r?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function qi(t,e,n,i,r){var s=i;if(0===(1&e)&&0===(2&e)&&null!==i)t:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==a;){if(null===(o=_r(a)))return;if(5===(l=o.tag)||6===l){i=s=o;continue t}a=a.parentNode}}i=i.return}Mt((function(){var i=s,r=bt(n),o=[];t:{var a=Ci.get(t);if(void 0!==a){var l=un,c=t;switch(t){case"keypress":if(0===en(n))break t;case"keydown":case"keyup":l=kn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ai:case ki:case Pi:l=yn;break;case Ii:l=Cn;break;case"scroll":l=dn;break;case"wheel":l=zn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Pn}var u=0!==(4&e),h=!u&&"scroll"===t,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=zt(f,d))&&u.push($i(f,m,p)))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,r),o.push({event:a,listeners:u}))}}if(0===(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(a="mouseover"===t||"pointerover"===t)||n===xt||!(c=n.relatedTarget||n.fromElement)||!_r(c)&&!c[fr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?_r(c):null)&&(c!==(h=jt(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==t&&"pointerover"!==t||(u=Pn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:xr(l),p=null==c?a:xr(c),(a=new u(m,f+"leave",l,n,r)).target=h,a.relatedTarget=p,m=null,_r(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)t:{for(d=c,f=0,p=u=l;p;p=Zi(p))f++;for(p=0,m=d;m;m=Zi(m))p++;for(;0<f-p;)u=Zi(u),f--;for(;0<p-f;)d=Zi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break t;u=Zi(u),d=Zi(d)}u=null}else u=null;null!==l&&Hi(o,a,l,u,!1),null!==c&&null!==h&&Hi(o,h,c,u,!0)}if("select"===(l=(a=i?xr(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Yn;else if(qn(a))if(Kn)g=oi;else{g=ri;var y=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=si);switch(g&&(g=g(t,i))?$n(o,g,n,r):(y&&y(t,a,i),"focusout"===t&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&tt(a,"number",a.value)),y=i?xr(i):window,t){case"focusin":(qn(y)||"true"===y.contentEditable)&&(gi=y,yi=i,_i=null);break;case"focusout":_i=yi=gi=null;break;case"mousedown":vi=!0;break;case"contextmenu":case"mouseup":case"dragend":vi=!1,xi(o,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(o,n,r)}var _;if(Dn)t:{switch(t){case"compositionstart":var v="onCompositionStart";break t;case"compositionend":v="onCompositionEnd";break t;case"compositionupdate":v="onCompositionUpdate";break t}v=void 0}else jn?Nn(t,n)&&(v="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(v="onCompositionStart");v&&(On&&"ko"!==n.locale&&(jn||"onCompositionStart"!==v?"onCompositionEnd"===v&&jn&&(_=tn()):(Je="value"in(Ke=r)?Ke.value:Ke.textContent,jn=!0)),0<(y=Wi(i,v)).length&&(v=new xn(v,t,null,n,r),o.push({event:v,listeners:y}),_?v.data=_:null!==(_=Un(n))&&(v.data=_))),(_=Bn?function(t,e){switch(t){case"compositionend":return Un(e);case"keypress":return 32!==e.which?null:(Vn=!0,Fn);case"textInput":return(t=e.data)===Fn&&Vn?null:t;default:return null}}(t,n):function(t,e){if(jn)return"compositionend"===t||!Dn&&Nn(t,e)?(t=tn(),Qe=Je=Ke=null,jn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return On&&"ko"!==e.locale?null:e.data}}(t,n))&&(0<(i=Wi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=_))}Fi(o,e)}))}function $i(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Wi(t,e){for(var n=e+"Capture",i=[];null!==t;){var r=t,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=zt(t,n))&&i.unshift($i(t,s,r)),null!=(s=zt(t,e))&&i.push($i(t,s,r))),t=t.return}return i}function Zi(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Hi(t,e,n,i,r){for(var s=e._reactName,o=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=zt(n,s))&&o.unshift($i(n,l,a)):r||null!=(l=zt(n,s))&&o.push($i(n,l,a))),n=n.return}0!==o.length&&t.push({event:e,listeners:o})}var Xi=/\r\n?/g,Yi=/\u0000|\uFFFD/g;function Ki(t){return("string"===typeof t?t:""+t).replace(Xi,"\n").replace(Yi,"")}function Ji(t,e,n){if(e=Ki(e),Ki(t)!==e&&n)throw Error(s(425))}function Qi(){}var tr=null,er=null;function nr(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(t){return sr.resolve(null).then(t).catch(ar)}:ir;function ar(t){setTimeout((function(){throw t}))}function lr(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return t.removeChild(r),void je(e);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);je(e)}function cr(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function ur(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,mr="__reactEvents$"+hr,gr="__reactListeners$"+hr,yr="__reactHandles$"+hr;function _r(t){var e=t[dr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[fr]||n[dr]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=ur(t);null!==t;){if(n=t[dr])return n;t=ur(t)}return e}n=(t=n).parentNode}return null}function vr(t){return!(t=t[dr]||t[fr])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function xr(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(s(33))}function br(t){return t[pr]||null}var wr=[],Sr=-1;function Er(t){return{current:t}}function Tr(t){0>Sr||(t.current=wr[Sr],wr[Sr]=null,Sr--)}function Ar(t,e){Sr++,wr[Sr]=t.current,t.current=e}var kr={},Pr=Er(kr),Ir=Er(!1),Cr=kr;function Mr(t,e){var n=t.type.contextTypes;if(!n)return kr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function zr(t){return null!==(t=t.childContextTypes)&&void 0!==t}function Lr(){Tr(Ir),Tr(Pr)}function Dr(t,e,n){if(Pr.current!==kr)throw Error(s(168));Ar(Pr,e),Ar(Ir,n)}function Rr(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(s(108,G(t)||"Unknown",r));return O({},n,i)}function Br(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||kr,Cr=Pr.current,Ar(Pr,t),Ar(Ir,Ir.current),!0}function Or(t,e,n){var i=t.stateNode;if(!i)throw Error(s(169));n?(t=Rr(t,e,Cr),i.__reactInternalMemoizedMergedChildContext=t,Tr(Ir),Tr(Pr),Ar(Pr,t)):Tr(Ir),Ar(Ir,n)}var Fr=null,Vr=!1,Nr=!1;function Ur(t){null===Fr?Fr=[t]:Fr.push(t)}function jr(){if(!Nr&&null!==Fr){Nr=!0;var t=0,e=ve;try{var n=Fr;for(ve=1;t<n.length;t++){var i=n[t];do{i=i(!0)}while(null!==i)}Fr=null,Vr=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(t+1)),Zt(Qt,jr),r}finally{ve=e,Nr=!1}}return null}var Gr=x.ReactCurrentBatchConfig;function qr(t,e){if(t&&t.defaultProps){for(var n in e=O({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}var $r=Er(null),Wr=null,Zr=null,Hr=null;function Xr(){Hr=Zr=Wr=null}function Yr(t){var e=$r.current;Tr($r),t._currentValue=e}function Kr(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Jr(t,e){Wr=t,Hr=Zr=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(ba=!0),t.firstContext=null)}function Qr(t){var e=t._currentValue;if(Hr!==t)if(t={context:t,memoizedValue:e,next:null},null===Zr){if(null===Wr)throw Error(s(308));Zr=t,Wr.dependencies={lanes:0,firstContext:t}}else Zr=Zr.next=t;return e}var ts=null,es=!1;function ns(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function is(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function rs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ss(t,e){var n=t.updateQueue;null!==n&&(n=n.shared,ec(t)?(null===(t=n.interleaved)?(e.next=e,null===ts?ts=[n]:ts.push(n)):(e.next=t.next,t.next=e),n.interleaved=e):(null===(t=n.pending)?e.next=e:(e.next=t.next,t.next=e),n.pending=e))}function os(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&n))){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,_e(t,n)}}function as(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?r=s=e:s=s.next=e}else r=s=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ls(t,e,n,i){var r=t.updateQueue;es=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=t.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==s){var h=r.baseState;for(o=0,u=c=l=null,a=s;;){var d=a.lane,p=a.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var f=t,m=a;switch(d=e,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break t}h=f;break t;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break t;h=O({},h,d);break t;case 2:es=!0}}null!==a.callback&&0!==a.lane&&(t.flags|=64,null===(d=r.effects)?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,o|=d;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(d=a).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(e=r.shared.interleaved)){r=e;do{o|=r.lane,r=r.next}while(r!==e)}else null===s&&(r.shared.lanes=0);Ll|=o,t.lanes=o,t.memoizedState=h}}function cs(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(s(191,r));r.call(i)}}}var us=(new i.Component).refs;function hs(t,e,n,i){n=null===(n=n(i,e=t.memoizedState))||void 0===n?e:O({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var ds={isMounted:function(t){return!!(t=t._reactInternals)&&jt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Kl(),r=Jl(t),s=rs(i,r);s.payload=e,void 0!==n&&null!==n&&(s.callback=n),ss(t,s),null!==(e=Ql(t,r,i))&&os(e,t,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Kl(),r=Jl(t),s=rs(i,r);s.tag=1,s.payload=e,void 0!==n&&null!==n&&(s.callback=n),ss(t,s),null!==(e=Ql(t,r,i))&&os(e,t,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Kl(),i=Jl(t),r=rs(n,i);r.tag=2,void 0!==e&&null!==e&&(r.callback=e),ss(t,r),null!==(e=Ql(t,i,n))&&os(e,t,i)}};function ps(t,e,n,i,r,s,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,s,o):!e.prototype||!e.prototype.isPureReactComponent||(!li(n,i)||!li(r,s))}function fs(t,e,n){var i=!1,r=kr,s=e.contextType;return"object"===typeof s&&null!==s?s=Qr(s):(r=zr(e)?Cr:Pr.current,s=(i=null!==(i=e.contextTypes)&&void 0!==i)?Mr(t,r):kr),e=new e(n,s),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=ds,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function ms(t,e,n,i){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ds.enqueueReplaceState(e,e.state,null)}function gs(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=us,ns(t);var s=e.contextType;"object"===typeof s&&null!==s?r.context=Qr(s):(s=zr(e)?Cr:Pr.current,r.context=Mr(t,s)),r.state=t.memoizedState,"function"===typeof(s=e.getDerivedStateFromProps)&&(hs(t,e,s,n),r.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(e=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&ds.enqueueReplaceState(r,r.state,null),ls(t,n,r,i),r.state=t.memoizedState),"function"===typeof r.componentDidMount&&(t.flags|=4194308)}var ys=[],_s=0,vs=null,xs=0,bs=[],ws=0,Ss=null,Es=1,Ts="";function As(t,e){ys[_s++]=xs,ys[_s++]=vs,vs=t,xs=e}function ks(t,e,n){bs[ws++]=Es,bs[ws++]=Ts,bs[ws++]=Ss,Ss=t;var i=Es;t=Ts;var r=32-oe(i)-1;i&=~(1<<r),n+=1;var s=32-oe(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Es=1<<32-oe(e)+r|n<<r|i,Ts=s+t}else Es=1<<s|n<<r|i,Ts=t}function Ps(t){null!==t.return&&(As(t,1),ks(t,1,0))}function Is(t){for(;t===vs;)vs=ys[--_s],ys[_s]=null,xs=ys[--_s],ys[_s]=null;for(;t===Ss;)Ss=bs[--ws],bs[ws]=null,Ts=bs[--ws],bs[ws]=null,Es=bs[--ws],bs[ws]=null}var Cs=null,Ms=null,zs=!1,Ls=null;function Ds(t,e){var n=Cc(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function Rs(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,Cs=t,Ms=cr(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,Cs=t,Ms=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(n=null!==Ss?{id:Es,overflow:Ts}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=Cc(18,null,null,0)).stateNode=e,n.return=t,t.child=n,Cs=t,Ms=null,!0);default:return!1}}function Bs(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function Os(t){if(zs){var e=Ms;if(e){var n=e;if(!Rs(t,e)){if(Bs(t))throw Error(s(418));e=cr(n.nextSibling);var i=Cs;e&&Rs(t,e)?Ds(i,n):(t.flags=-4097&t.flags|2,zs=!1,Cs=t)}}else{if(Bs(t))throw Error(s(418));t.flags=-4097&t.flags|2,zs=!1,Cs=t}}}function Fs(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;Cs=t}function Vs(t){if(t!==Cs)return!1;if(!zs)return Fs(t),zs=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!nr(t.type,t.memoizedProps)),e&&(e=Ms)){if(Bs(t)){for(t=Ms;t;)t=cr(t.nextSibling);throw Error(s(418))}for(;e;)Ds(t,e),e=cr(e.nextSibling)}if(Fs(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(s(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){Ms=cr(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}Ms=null}}else Ms=Cs?cr(t.stateNode.nextSibling):null;return!0}function Ns(){Ms=Cs=null,zs=!1}function Us(t){null===Ls?Ls=[t]:Ls.push(t)}function js(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,t));var r=i,o=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===o?e.ref:(e=function(t){var e=r.refs;e===us&&(e=r.refs={}),null===t?delete e[o]:e[o]=t},e._stringRef=o,e)}if("string"!==typeof t)throw Error(s(284));if(!n._owner)throw Error(s(290,t))}return t}function Gs(t,e){throw t=Object.prototype.toString.call(e),Error(s(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function qs(t){return(0,t._init)(t._payload)}function $s(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=zc(t,e)).index=0,t.sibling=null,t}function o(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=2,n):i:(e.flags|=2,n):(e.flags|=1048576,n)}function a(e){return t&&null===e.alternate&&(e.flags|=2),e}function l(t,e,n,i){return null===e||6!==e.tag?((e=Bc(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function c(t,e,n,i){var s=n.type;return s===S?h(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===z&&qs(s)===e.type)?((i=r(e,n.props)).ref=js(t,e,n),i.return=t,i):((i=Lc(n.type,n.key,n.props,null,t.mode,i)).ref=js(t,e,n),i.return=t,i)}function u(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Oc(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function h(t,e,n,i,s){return null===e||7!==e.tag?((e=Dc(n,t.mode,i,s)).return=t,e):((e=r(e,n)).return=t,e)}function d(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=Bc(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case b:return(n=Lc(e.type,e.key,e.props,null,t.mode,n)).ref=js(t,null,e),n.return=t,n;case w:return(e=Oc(e,t.mode,n)).return=t,e;case z:return d(t,(0,e._init)(e._payload),n)}if(et(e)||R(e))return(e=Dc(e,t.mode,n,null)).return=t,e;Gs(t,e)}return null}function p(t,e,n,i){var r=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(t,e,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?c(t,e,n,i):null;case w:return n.key===r?u(t,e,n,i):null;case z:return p(t,e,(r=n._init)(n._payload),i)}if(et(n)||R(n))return null!==r?null:h(t,e,n,i,null);Gs(t,n)}return null}function f(t,e,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(e,t=t.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return c(e,t=t.get(null===i.key?n:i.key)||null,i,r);case w:return u(e,t=t.get(null===i.key?n:i.key)||null,i,r);case z:return f(t,e,n,(0,i._init)(i._payload),r)}if(et(i)||R(i))return h(e,t=t.get(n)||null,i,r,null);Gs(e,i)}return null}function m(r,s,a,l){for(var c=null,u=null,h=s,m=s=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=p(r,h,a[m],l);if(null===y){null===h&&(h=g);break}t&&h&&null===y.alternate&&e(r,h),s=o(y,s,m),null===u?c=y:u.sibling=y,u=y,h=g}if(m===a.length)return n(r,h),zs&&As(r,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(r,a[m],l))&&(s=o(h,s,m),null===u?c=h:u.sibling=h,u=h);return zs&&As(r,m),c}for(h=i(r,h);m<a.length;m++)null!==(g=f(h,r,m,a[m],l))&&(t&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=o(g,s,m),null===u?c=g:u.sibling=g,u=g);return t&&h.forEach((function(t){return e(r,t)})),zs&&As(r,m),c}function g(r,a,l,c){var u=R(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,m=a,g=a=0,y=null,_=l.next();null!==m&&!_.done;g++,_=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var v=p(r,m,_.value,c);if(null===v){null===m&&(m=y);break}t&&m&&null===v.alternate&&e(r,m),a=o(v,a,g),null===h?u=v:h.sibling=v,h=v,m=y}if(_.done)return n(r,m),zs&&As(r,g),u;if(null===m){for(;!_.done;g++,_=l.next())null!==(_=d(r,_.value,c))&&(a=o(_,a,g),null===h?u=_:h.sibling=_,h=_);return zs&&As(r,g),u}for(m=i(r,m);!_.done;g++,_=l.next())null!==(_=f(m,r,g,_.value,c))&&(t&&null!==_.alternate&&m.delete(null===_.key?g:_.key),a=o(_,a,g),null===h?u=_:h.sibling=_,h=_);return t&&m.forEach((function(t){return e(r,t)})),zs&&As(r,g),u}return function t(i,s,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:t:{for(var c=o.key,u=s;null!==u;){if(u.key===c){if((c=o.type)===S){if(7===u.tag){n(i,u.sibling),(s=r(u,o.props.children)).return=i,i=s;break t}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===z&&qs(c)===u.type){n(i,u.sibling),(s=r(u,o.props)).ref=js(i,u,o),s.return=i,i=s;break t}n(i,u);break}e(i,u),u=u.sibling}o.type===S?((s=Dc(o.props.children,i.mode,l,o.key)).return=i,i=s):((l=Lc(o.type,o.key,o.props,null,i.mode,l)).ref=js(i,s,o),l.return=i,i=l)}return a(i);case w:t:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(i,s.sibling),(s=r(s,o.children||[])).return=i,i=s;break t}n(i,s);break}e(i,s),s=s.sibling}(s=Oc(o,i.mode,l)).return=i,i=s}return a(i);case z:return t(i,s,(u=o._init)(o._payload),l)}if(et(o))return m(i,s,o,l);if(R(o))return g(i,s,o,l);Gs(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,o)).return=i,i=s):(n(i,s),(s=Bc(o,i.mode,l)).return=i,i=s),a(i)):n(i,s)}}var Ws=$s(!0),Zs=$s(!1),Hs={},Xs=Er(Hs),Ys=Er(Hs),Ks=Er(Hs);function Js(t){if(t===Hs)throw Error(s(174));return t}function Qs(t,e){switch(Ar(Ks,e),Ar(Ys,t),Ar(Xs,Hs),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lt(null,"");break;default:e=lt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}Tr(Xs),Ar(Xs,e)}function to(){Tr(Xs),Tr(Ys),Tr(Ks)}function eo(t){Js(Ks.current);var e=Js(Xs.current),n=lt(e,t.type);e!==n&&(Ar(Ys,t),Ar(Xs,n))}function no(t){Ys.current===t&&(Tr(Xs),Tr(Ys))}var io=Er(0);function ro(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var so=[];function oo(){for(var t=0;t<so.length;t++)so[t]._workInProgressVersionPrimary=null;so.length=0}var ao=x.ReactCurrentDispatcher,lo=x.ReactCurrentBatchConfig,co=0,uo=null,ho=null,po=null,fo=!1,mo=!1,go=0,yo=0;function _o(){throw Error(s(321))}function vo(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ai(t[n],e[n]))return!1;return!0}function xo(t,e,n,i,r,o){if(co=o,uo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ao.current=null===t||null===t.memoizedState?ia:ra,t=n(i,r),mo){o=0;do{if(mo=!1,go=0,25<=o)throw Error(s(301));o+=1,po=ho=null,e.updateQueue=null,ao.current=sa,t=n(i,r)}while(mo)}if(ao.current=na,e=null!==ho&&null!==ho.next,co=0,po=ho=uo=null,fo=!1,e)throw Error(s(300));return t}function bo(){var t=0!==go;return go=0,t}function wo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===po?uo.memoizedState=po=t:po=po.next=t,po}function So(){if(null===ho){var t=uo.alternate;t=null!==t?t.memoizedState:null}else t=ho.next;var e=null===po?uo.memoizedState:po.next;if(null!==e)po=e,ho=t;else{if(null===t)throw Error(s(310));t={memoizedState:(ho=t).memoizedState,baseState:ho.baseState,baseQueue:ho.baseQueue,queue:ho.queue,next:null},null===po?uo.memoizedState=po=t:po=po.next=t}return po}function Eo(t,e){return"function"===typeof e?e(t):e}function To(t){var e=So(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var i=ho,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=a=null,c=null,u=o;do{var h=u.lane;if((co&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=i):c=c.next=d,uo.lanes|=h,Ll|=h}u=u.next}while(null!==u&&u!==o);null===c?a=i:c.next=l,ai(i,e.memoizedState)||(ba=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=c,n.lastRenderedState=i}if(null!==(t=n.interleaved)){r=t;do{o=r.lane,uo.lanes|=o,Ll|=o,r=r.next}while(r!==t)}else null===r&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ao(t){var e=So(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,o=e.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=t(o,a.action),a=a.next}while(a!==r);ai(o,e.memoizedState)||(ba=!0),e.memoizedState=o,null===e.baseQueue&&(e.baseState=o),n.lastRenderedState=o}return[o,i]}function ko(){}function Po(t,e){var n=uo,i=So(),r=e(),o=!ai(i.memoizedState,r);if(o&&(i.memoizedState=r,ba=!0),i=i.queue,Vo(Mo.bind(null,n,i,t),[t]),i.getSnapshot!==e||o||null!==po&&1&po.memoizedState.tag){if(n.flags|=2048,Do(9,Co.bind(null,n,i,r,e),void 0,null),null===Al)throw Error(s(349));0!==(30&co)||Io(n,e,r)}return r}function Io(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=uo.updateQueue)?(e={lastEffect:null,stores:null},uo.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Co(t,e,n,i){e.value=n,e.getSnapshot=i,zo(e)&&Ql(t,1,-1)}function Mo(t,e,n){return n((function(){zo(e)&&Ql(t,1,-1)}))}function zo(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ai(t,n)}catch(i){return!0}}function Lo(t){var e=wo();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eo,lastRenderedState:t},e.queue=t,t=t.dispatch=Ko.bind(null,uo,t),[e.memoizedState,t]}function Do(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=uo.updateQueue)?(e={lastEffect:null,stores:null},uo.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function Ro(){return So().memoizedState}function Bo(t,e,n,i){var r=wo();uo.flags|=t,r.memoizedState=Do(1|e,n,void 0,void 0===i?null:i)}function Oo(t,e,n,i){var r=So();i=void 0===i?null:i;var s=void 0;if(null!==ho){var o=ho.memoizedState;if(s=o.destroy,null!==i&&vo(i,o.deps))return void(r.memoizedState=Do(e,n,s,i))}uo.flags|=t,r.memoizedState=Do(1|e,n,s,i)}function Fo(t,e){return Bo(8390656,8,t,e)}function Vo(t,e){return Oo(2048,8,t,e)}function No(t,e){return Oo(4,2,t,e)}function Uo(t,e){return Oo(4,4,t,e)}function jo(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Go(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Oo(4,4,jo.bind(null,e,t),n)}function qo(){}function $o(t,e){var n=So();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&vo(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Wo(t,e){var n=So();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&vo(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Zo(t,e,n){return 0===(21&co)?(t.baseState&&(t.baseState=!1,ba=!0),t.memoizedState=n):(ai(n,e)||(n=me(),uo.lanes|=n,Ll|=n,t.baseState=!0),e)}function Ho(t,e){var n=ve;ve=0!==n&&4>n?n:4,t(!0);var i=lo.transition;lo.transition={};try{t(!1),e()}finally{ve=n,lo.transition=i}}function Xo(){return So().memoizedState}function Yo(t,e,n){var i=Jl(t);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Jo(t)?Qo(e,n):(ta(t,e,n),null!==(t=Ql(t,i,n=Kl()))&&ea(t,e,i))}function Ko(t,e,n){var i=Jl(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Jo(t))Qo(e,r);else{ta(t,e,r);var s=t.alternate;if(0===t.lanes&&(null===s||0===s.lanes)&&null!==(s=e.lastRenderedReducer))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,o))return}catch(l){}null!==(t=Ql(t,i,n=Kl()))&&ea(t,e,i)}}function Jo(t){var e=t.alternate;return t===uo||null!==e&&e===uo}function Qo(t,e){mo=fo=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ta(t,e,n){ec(t)?(null===(t=e.interleaved)?(n.next=n,null===ts?ts=[e]:ts.push(e)):(n.next=t.next,t.next=n),e.interleaved=n):(null===(t=e.pending)?n.next=n:(n.next=t.next,t.next=n),e.pending=n)}function ea(t,e,n){if(0!==(4194240&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,_e(t,n)}}var na={readContext:Qr,useCallback:_o,useContext:_o,useEffect:_o,useImperativeHandle:_o,useInsertionEffect:_o,useLayoutEffect:_o,useMemo:_o,useReducer:_o,useRef:_o,useState:_o,useDebugValue:_o,useDeferredValue:_o,useTransition:_o,useMutableSource:_o,useSyncExternalStore:_o,useId:_o,unstable_isNewReconciler:!1},ia={readContext:Qr,useCallback:function(t,e){return wo().memoizedState=[t,void 0===e?null:e],t},useContext:Qr,useEffect:Fo,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Bo(4194308,4,jo.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Bo(4194308,4,t,e)},useInsertionEffect:function(t,e){return Bo(4,2,t,e)},useMemo:function(t,e){var n=wo();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=wo();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Yo.bind(null,uo,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},wo().memoizedState=t},useState:Lo,useDebugValue:qo,useDeferredValue:function(t){return wo().memoizedState=t},useTransition:function(){var t=Lo(!1),e=t[0];return t=Ho.bind(null,t[1]),wo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=uo,r=wo();if(zs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=e(),null===Al)throw Error(s(349));0!==(30&co)||Io(i,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,Fo(Mo.bind(null,i,o,t),[t]),i.flags|=2048,Do(9,Co.bind(null,i,o,n,e),void 0,null),n},useId:function(){var t=wo(),e=Al.identifierPrefix;if(zs){var n=Ts;e=":"+e+"R"+(n=(Es&~(1<<32-oe(Es)-1)).toString(32)+n),0<(n=go++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=yo++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ra={readContext:Qr,useCallback:$o,useContext:Qr,useEffect:Vo,useImperativeHandle:Go,useInsertionEffect:No,useLayoutEffect:Uo,useMemo:Wo,useReducer:To,useRef:Ro,useState:function(){return To(Eo)},useDebugValue:qo,useDeferredValue:function(t){return Zo(So(),ho.memoizedState,t)},useTransition:function(){return[To(Eo)[0],So().memoizedState]},useMutableSource:ko,useSyncExternalStore:Po,useId:Xo,unstable_isNewReconciler:!1},sa={readContext:Qr,useCallback:$o,useContext:Qr,useEffect:Vo,useImperativeHandle:Go,useInsertionEffect:No,useLayoutEffect:Uo,useMemo:Wo,useReducer:Ao,useRef:Ro,useState:function(){return Ao(Eo)},useDebugValue:qo,useDeferredValue:function(t){var e=So();return null===ho?e.memoizedState=t:Zo(e,ho.memoizedState,t)},useTransition:function(){return[Ao(Eo)[0],So().memoizedState]},useMutableSource:ko,useSyncExternalStore:Po,useId:Xo,unstable_isNewReconciler:!1};function oa(t,e){try{var n="",i=e;do{n+=U(i),i=i.return}while(i);var r=n}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:t,source:e,stack:r}}function aa(t,e){try{console.error(e.value)}catch(n){setTimeout((function(){throw n}))}}var la,ca,ua,ha="function"===typeof WeakMap?WeakMap:Map;function da(t,e,n){(n=rs(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Ul||(Ul=!0,jl=i),aa(0,e)},n}function pa(t,e,n){(n=rs(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"===typeof i){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){aa(0,e)}}var s=t.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){aa(0,e),"function"!==typeof i&&(null===Gl?Gl=new Set([this]):Gl.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function fa(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new ha;var r=new Set;i.set(e,r)}else void 0===(r=i.get(e))&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Ec.bind(null,t,e,n),e.then(t,t))}function ma(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function ga(t,e,n,i,r){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=rs(-1,1)).tag=2,ss(n,e))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}function ya(t,e){if(!zs)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function _a(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function va(t,e,n){var i=e.pendingProps;switch(Is(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _a(e),null;case 1:case 17:return zr(e.type)&&Lr(),_a(e),null;case 3:return i=e.stateNode,to(),Tr(Ir),Tr(Pr),oo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(Vs(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==Ls&&(sc(Ls),Ls=null))),_a(e),null;case 5:no(e);var r=Js(Ks.current);if(n=e.type,null!==t&&null!=e.stateNode)ca(t,e,n,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(null===e.stateNode)throw Error(s(166));return _a(e),null}if(t=Js(Xs.current),Vs(e)){i=e.stateNode,n=e.type;var o=e.memoizedProps;switch(i[dr]=e,i[pr]=o,t=0!==(1&e.mode),n){case"dialog":Vi("cancel",i),Vi("close",i);break;case"iframe":case"object":case"embed":Vi("load",i);break;case"video":case"audio":for(r=0;r<Ri.length;r++)Vi(Ri[r],i);break;case"source":Vi("error",i);break;case"img":case"image":case"link":Vi("error",i),Vi("load",i);break;case"details":Vi("toggle",i);break;case"input":Y(i,o),Vi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Vi("invalid",i);break;case"textarea":rt(i,o),Vi("invalid",i)}for(var l in _t(n,o),r=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&Ji(i.textContent,c,t),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Ji(i.textContent,c,t),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Vi("scroll",i)}switch(n){case"input":W(i),Q(i,o,!0);break;case"textarea":W(i),ot(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Qi)}i=r,e.updateQueue=i,null!==i&&(e.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=at(n)),"http://www.w3.org/1999/xhtml"===t?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof i.is?t=l.createElement(n,{is:i.is}):(t=l.createElement(n),"select"===n&&(l=t,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):t=l.createElementNS(t,n),t[dr]=e,t[pr]=i,la(t,e),e.stateNode=t;t:{switch(l=vt(n,i),n){case"dialog":Vi("cancel",t),Vi("close",t),r=i;break;case"iframe":case"object":case"embed":Vi("load",t),r=i;break;case"video":case"audio":for(r=0;r<Ri.length;r++)Vi(Ri[r],t);r=i;break;case"source":Vi("error",t),r=i;break;case"img":case"image":case"link":Vi("error",t),Vi("load",t),r=i;break;case"details":Vi("toggle",t),r=i;break;case"input":Y(t,i),r=X(t,i),Vi("invalid",t);break;case"option":default:r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=O({},i,{value:void 0}),Vi("invalid",t);break;case"textarea":rt(t,i),r=it(t,i),Vi("invalid",t)}for(o in _t(n,r),c=r)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?gt(t,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&ht(t,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&dt(t,u):"number"===typeof u&&dt(t,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Vi("scroll",t):null!=u&&v(t,o,u,l))}switch(n){case"input":W(t),Q(t,i,!1);break;case"textarea":W(t),ot(t);break;case"option":null!=i.value&&t.setAttribute("value",""+q(i.value));break;case"select":t.multiple=!!i.multiple,null!=(o=i.value)?nt(t,!!i.multiple,o,!1):null!=i.defaultValue&&nt(t,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(t.onclick=Qi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return _a(e),null;case 6:if(t&&null!=e.stateNode)ua(0,e,t.memoizedProps,i);else{if("string"!==typeof i&&null===e.stateNode)throw Error(s(166));if(n=Js(Ks.current),Js(Xs.current),Vs(e)){if(i=e.stateNode,n=e.memoizedProps,i[dr]=e,(o=i.nodeValue!==n)&&null!==(t=Cs))switch(t.tag){case 3:Ji(i.nodeValue,n,0!==(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&t.mode))}o&&(e.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=e,e.stateNode=i}return _a(e),null;case 13:if(Tr(io),i=e.memoizedState,zs&&null!==Ms&&0!==(1&e.mode)&&0===(128&e.flags)){for(i=Ms;i;)i=cr(i.nextSibling);return Ns(),e.flags|=98560,e}if(null!==i&&null!==i.dehydrated){if(i=Vs(e),null===t){if(!i)throw Error(s(318));if(!(i=null!==(i=e.memoizedState)?i.dehydrated:null))throw Error(s(317));i[dr]=e}else Ns(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;return _a(e),null}return null!==Ls&&(sc(Ls),Ls=null),0!==(128&e.flags)?(e.lanes=n,e):(i=null!==i,n=!1,null===t?Vs(e):n=null!==t.memoizedState,i!==n&&i&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&io.current)?0===Ml&&(Ml=3):fc())),null!==e.updateQueue&&(e.flags|=4),_a(e),null);case 4:return to(),null===t&&ji(e.stateNode.containerInfo),_a(e),null;case 10:return Yr(e.type._context),_a(e),null;case 19:if(Tr(io),null===(o=e.memoizedState))return _a(e),null;if(i=0!==(128&e.flags),null===(l=o.rendering))if(i)ya(o,!1);else{if(0!==Ml||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(l=ro(t))){for(e.flags|=128,ya(o,!1),null!==(i=l.updateQueue)&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;null!==n;)t=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,t=l.dependencies,o.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ar(io,1&io.current|2),e.child}t=t.sibling}null!==o.tail&&Kt()>Vl&&(e.flags|=128,i=!0,ya(o,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=ro(l))){if(e.flags|=128,i=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),ya(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!zs)return _a(e),null}else 2*Kt()-o.renderingStartTime>Vl&&1073741824!==n&&(e.flags|=128,i=!0,ya(o,!1),e.lanes=4194304);o.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=o.last)?n.sibling=l:e.child=l,o.last=l)}return null!==o.tail?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Kt(),e.sibling=null,n=io.current,Ar(io,i?1&n|2:1&n),e):(_a(e),null);case 22:case 23:return uc(),i=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==i&&(e.flags|=8192),i&&0!==(1&e.mode)?0!==(1073741824&Il)&&(_a(e),6&e.subtreeFlags&&(e.flags|=8192)):_a(e),null;case 24:case 25:return null}throw Error(s(156,e.tag))}la=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ca=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Js(Xs.current);var s,o=null;switch(n){case"input":r=X(t,r),i=X(t,i),o=[];break;case"select":r=O({},r,{value:void 0}),i=O({},i,{value:void 0}),o=[];break;case"textarea":r=it(t,r),i=it(t,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(t.onclick=Qi)}for(u in _t(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Vi("scroll",t),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}},ua=function(t,e,n,i){n!==i&&(e.flags|=4)};var xa=x.ReactCurrentOwner,ba=!1;function wa(t,e,n,i){e.child=null===t?Zs(e,null,n,i):Ws(e,t.child,n,i)}function Sa(t,e,n,i,r){n=n.render;var s=e.ref;return Jr(e,r),i=xo(t,e,n,i,s,r),n=bo(),null===t||ba?(zs&&n&&Ps(e),e.flags|=1,wa(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,qa(t,e,r))}function Ea(t,e,n,i,r){if(null===t){var s=n.type;return"function"!==typeof s||Mc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Lc(n.type,null,i,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=s,Ta(t,e,s,i,r))}if(s=t.child,0===(t.lanes&r)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&t.ref===e.ref)return qa(t,e,r)}return e.flags|=1,(t=zc(s,i)).ref=e.ref,t.return=e,e.child=t}function Ta(t,e,n,i,r){if(null!==t){var s=t.memoizedProps;if(li(s,i)&&t.ref===e.ref){if(ba=!1,e.pendingProps=i=s,0===(t.lanes&r))return e.lanes=t.lanes,qa(t,e,r);0!==(131072&t.flags)&&(ba=!0)}}return Pa(t,e,n,i,r)}function Aa(t,e,n){var i=e.pendingProps,r=i.children,s=null!==t?t.memoizedState:null;if("hidden"===i.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ar(Cl,Il),Il|=n;else{if(0===(1073741824&n))return t=null!==s?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ar(Cl,Il),Il|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,Ar(Cl,Il),Il|=i}else null!==s?(i=s.baseLanes|n,e.memoizedState=null):i=n,Ar(Cl,Il),Il|=i;return wa(t,e,r,n),e.child}function ka(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Pa(t,e,n,i,r){var s=zr(n)?Cr:Pr.current;return s=Mr(e,s),Jr(e,r),n=xo(t,e,n,i,s,r),i=bo(),null===t||ba?(zs&&i&&Ps(e),e.flags|=1,wa(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,qa(t,e,r))}function Ia(t,e,n,i,r){if(zr(n)){var s=!0;Br(e)}else s=!1;if(Jr(e,r),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),fs(e,n,i),gs(e,n,i,r),i=!0;else if(null===t){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Qr(c):c=Mr(e,c=zr(n)?Cr:Pr.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==i||l!==c)&&ms(e,o,i,c),es=!1;var d=e.memoizedState;o.state=d,ls(e,i,o,r),l=e.memoizedState,a!==i||d!==l||Ir.current||es?("function"===typeof u&&(hs(e,n,u,i),l=e.memoizedState),(a=es||ps(e,n,a,i,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(e.flags|=4194308)):("function"===typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):("function"===typeof o.componentDidMount&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,is(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:qr(e.type,a),o.props=c,h=e.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Qr(l):l=Mr(e,l=zr(n)?Cr:Pr.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==h||d!==l)&&ms(e,o,i,l),es=!1,d=e.memoizedState,o.state=d,ls(e,i,o,r);var f=e.memoizedState;a!==h||d!==f||Ir.current||es?("function"===typeof p&&(hs(e,n,p,i),f=e.memoizedState),(c=es||ps(e,n,c,i,d,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(e.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return Ca(t,e,n,i,s,r)}function Ca(t,e,n,i,r,s){ka(t,e);var o=0!==(128&e.flags);if(!i&&!o)return r&&Or(e,n,!1),qa(t,e,s);i=e.stateNode,xa.current=e;var a=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&o?(e.child=Ws(e,t.child,null,s),e.child=Ws(e,null,a,s)):wa(t,e,a,s),e.memoizedState=i.state,r&&Or(e,n,!0),e.child}function Ma(t){var e=t.stateNode;e.pendingContext?Dr(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Dr(0,e.context,!1),Qs(t,e.containerInfo)}function za(t,e,n,i,r){return Ns(),Us(r),e.flags|=256,wa(t,e,n,i),e.child}var La={dehydrated:null,treeContext:null,retryLane:0};function Da(t){return{baseLanes:t,cachePool:null,transitions:null}}function Ra(t,e){return{baseLanes:t.baseLanes|e,cachePool:null,transitions:t.transitions}}function Ba(t,e,n){var i,r=e.pendingProps,o=io.current,a=!1,l=0!==(128&e.flags);if((i=l)||(i=(null===t||null!==t.memoizedState)&&0!==(2&o)),i?(a=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(o|=1),Ar(io,1&o),null===t)return Os(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=o):a=Rc(o,r,0,null),t=Dc(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Da(n),e.memoizedState=La,t):Oa(e,o));if(null!==(o=t.memoizedState)){if(null!==(i=o.dehydrated)){if(l)return 256&e.flags?(e.flags&=-257,Na(t,e,n,Error(s(422)))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(a=r.fallback,o=e.mode,r=Rc({mode:"visible",children:r.children},o,0,null),(a=Dc(a,o,n,null)).flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,0!==(1&e.mode)&&Ws(e,t.child,null,n),e.child.memoizedState=Da(n),e.memoizedState=La,a);if(0===(1&e.mode))e=Na(t,e,n,null);else if("$!"===i.data)e=Na(t,e,n,Error(s(419)));else if(r=0!==(n&t.childLanes),ba||r){if(null!==(r=Al)){switch(n&-n){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(r=0!==(a&(r.suspendedLanes|n))?0:a)&&r!==o.retryLane&&(o.retryLane=r,Ql(t,r,-1))}fc(),e=Na(t,e,n,Error(s(421)))}else"$?"===i.data?(e.flags|=128,e.child=t.child,e=Ac.bind(null,t),i._reactRetry=e,e=null):(n=o.treeContext,Ms=cr(i.nextSibling),Cs=e,zs=!0,Ls=null,null!==n&&(bs[ws++]=Es,bs[ws++]=Ts,bs[ws++]=Ss,Es=n.id,Ts=n.overflow,Ss=e),(e=Oa(e,e.pendingProps.children)).flags|=4096);return e}return a?(r=Va(t,e,r.children,r.fallback,n),a=e.child,o=t.child.memoizedState,a.memoizedState=null===o?Da(n):Ra(o,n),a.childLanes=t.childLanes&~n,e.memoizedState=La,r):(n=Fa(t,e,r.children,n),e.memoizedState=null,n)}return a?(r=Va(t,e,r.children,r.fallback,n),a=e.child,o=t.child.memoizedState,a.memoizedState=null===o?Da(n):Ra(o,n),a.childLanes=t.childLanes&~n,e.memoizedState=La,r):(n=Fa(t,e,r.children,n),e.memoizedState=null,n)}function Oa(t,e){return(e=Rc({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function Fa(t,e,n,i){var r=t.child;return t=r.sibling,n=zc(r,{mode:"visible",children:n}),0===(1&e.mode)&&(n.lanes=i),n.return=e,n.sibling=null,null!==t&&(null===(i=e.deletions)?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n}function Va(t,e,n,i,r){var s=e.mode,o=(t=t.child).sibling,a={mode:"hidden",children:n};return 0===(1&s)&&e.child!==t?((n=e.child).childLanes=0,n.pendingProps=a,e.deletions=null):(n=zc(t,a)).subtreeFlags=14680064&t.subtreeFlags,null!==o?i=zc(o,i):(i=Dc(i,s,r,null)).flags|=2,i.return=e,n.return=e,n.sibling=i,e.child=n,i}function Na(t,e,n,i){return null!==i&&Us(i),Ws(e,t.child,null,n),(t=Oa(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Ua(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),Kr(t.return,e,n)}function ja(t,e,n,i,r){var s=t.memoizedState;null===s?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Ga(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(wa(t,e,i.children,n),0!==(2&(i=io.current)))i=1&i|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Ua(t,n,e);else if(19===t.tag)Ua(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Ar(io,i),0===(1&e.mode))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===ro(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),ja(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===ro(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}ja(e,!0,n,null,s);break;case"together":ja(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function qa(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),Ll|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(s(153));if(null!==e.child){for(n=zc(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=zc(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function $a(t,e){switch(Is(e),e.tag){case 1:return zr(e.type)&&Lr(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return to(),Tr(Ir),Tr(Pr),oo(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return no(e),null;case 13:if(Tr(io),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(s(340));Ns()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return Tr(io),null;case 4:return to(),null;case 10:return Yr(e.type._context),null;case 22:case 23:return uc(),null;default:return null}}var Wa=!1,Za=!1,Ha="function"===typeof WeakSet?WeakSet:Set,Xa=null;function Ya(t,e){var n=t.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Sc(t,e,i)}else n.current=null}function Ka(t,e,n){try{n()}catch(i){Sc(t,e,i)}}var Ja=!1;function Qa(t,e,n){var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,void 0!==s&&Ka(e,n,s)}r=r.next}while(r!==i)}}function tl(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function el(t){var e=t.ref;if(null!==e){var n=t.stateNode;t.tag,t=n,"function"===typeof e?e(t):e.current=t}}function nl(t){var e=t.alternate;null!==e&&(t.alternate=null,nl(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&(delete e[dr],delete e[pr],delete e[mr],delete e[gr],delete e[yr])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function il(t){return 5===t.tag||3===t.tag||4===t.tag}function rl(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||il(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function sl(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!==(n=n._reactRootContainer)&&void 0!==n||null!==e.onclick||(e.onclick=Qi));else if(4!==i&&null!==(t=t.child))for(sl(t,e,n),t=t.sibling;null!==t;)sl(t,e,n),t=t.sibling}function ol(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==i&&null!==(t=t.child))for(ol(t,e,n),t=t.sibling;null!==t;)ol(t,e,n),t=t.sibling}var al=null,ll=!1;function cl(t,e,n){for(n=n.child;null!==n;)ul(t,e,n),n=n.sibling}function ul(t,e,n){if(se&&"function"===typeof se.onCommitFiberUnmount)try{se.onCommitFiberUnmount(re,n)}catch(a){}switch(n.tag){case 5:Za||Ya(n,e);case 6:var i=al,r=ll;al=null,cl(t,e,n),ll=r,null!==(al=i)&&(ll?(t=al,n=n.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)):al.removeChild(n.stateNode));break;case 18:null!==al&&(ll?(t=al,n=n.stateNode,8===t.nodeType?lr(t.parentNode,n):1===t.nodeType&&lr(t,n),je(t)):lr(al,n.stateNode));break;case 4:i=al,r=ll,al=n.stateNode.containerInfo,ll=!0,cl(t,e,n),al=i,ll=r;break;case 0:case 11:case 14:case 15:if(!Za&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,void 0!==o&&(0!==(2&s)||0!==(4&s))&&Ka(n,e,o),r=r.next}while(r!==i)}cl(t,e,n);break;case 1:if(!Za&&(Ya(n,e),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Sc(n,e,a)}cl(t,e,n);break;case 21:cl(t,e,n);break;case 22:1&n.mode?(Za=(i=Za)||null!==n.memoizedState,cl(t,e,n),Za=i):cl(t,e,n);break;default:cl(t,e,n)}}function hl(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new Ha),e.forEach((function(e){var i=kc.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))}))}}function dl(t,e){var n=e.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=t,a=e,l=a;t:for(;null!==l;){switch(l.tag){case 5:al=l.stateNode,ll=!1;break t;case 3:case 4:al=l.stateNode.containerInfo,ll=!0;break t}l=l.return}if(null===al)throw Error(s(160));ul(o,a,r),al=null,ll=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Sc(r,e,u)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)pl(e,t),e=e.sibling}function pl(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(dl(e,t),fl(t),4&i){try{Qa(3,t,t.return),tl(3,t)}catch(m){Sc(t,t.return,m)}try{Qa(5,t,t.return)}catch(m){Sc(t,t.return,m)}}break;case 1:dl(e,t),fl(t),512&i&&null!==n&&Ya(n,n.return);break;case 5:if(dl(e,t),fl(t),512&i&&null!==n&&Ya(n,n.return),32&t.flags){var r=t.stateNode;try{dt(r,"")}catch(m){Sc(t,t.return,m)}}if(4&i&&null!=(r=t.stateNode)){var o=t.memoizedProps,a=null!==n?n.memoizedProps:o,l=t.type,c=t.updateQueue;if(t.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&K(r,o),vt(l,a);var u=vt(l,o);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?gt(r,d):"dangerouslySetInnerHTML"===h?ht(r,d):"children"===h?dt(r,d):v(r,h,d,u)}switch(l){case"input":J(r,o);break;case"textarea":st(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?nt(r,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?nt(r,!!o.multiple,o.defaultValue,!0):nt(r,!!o.multiple,o.multiple?[]:"",!1))}r[pr]=o}catch(m){Sc(t,t.return,m)}}break;case 6:if(dl(e,t),fl(t),4&i){if(null===t.stateNode)throw Error(s(162));u=t.stateNode,h=t.memoizedProps;try{u.nodeValue=h}catch(m){Sc(t,t.return,m)}}break;case 3:if(dl(e,t),fl(t),4&i&&null!==n&&n.memoizedState.isDehydrated)try{je(e.containerInfo)}catch(m){Sc(t,t.return,m)}break;case 4:default:dl(e,t),fl(t);break;case 13:dl(e,t),fl(t),8192&(u=t.child).flags&&null!==u.memoizedState&&(null===u.alternate||null===u.alternate.memoizedState)&&(Fl=Kt()),4&i&&hl(t);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&t.mode?(Za=(h=Za)||u,dl(e,t),Za=h):dl(e,t),fl(t),8192&i){h=null!==t.memoizedState;t:for(d=null,p=t;;){if(5===p.tag){if(null===d){d=p;try{r=p.stateNode,h?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=p.stateNode,a=void 0!==(c=p.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=mt("display",a))}catch(m){Sc(t,t.return,m)}}}else if(6===p.tag){if(null===d)try{p.stateNode.nodeValue=h?"":p.memoizedProps}catch(m){Sc(t,t.return,m)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===t)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===t)break t;for(;null===p.sibling;){if(null===p.return||p.return===t)break t;d===p&&(d=null),p=p.return}d===p&&(d=null),p.sibling.return=p.return,p=p.sibling}if(h&&!u&&0!==(1&t.mode))for(Xa=t,t=t.child;null!==t;){for(u=Xa=t;null!==Xa;){switch(d=(h=Xa).child,h.tag){case 0:case 11:case 14:case 15:Qa(4,h,h.return);break;case 1:if(Ya(h,h.return),"function"===typeof(o=h.stateNode).componentWillUnmount){p=h,f=h.return;try{r=p,o.props=r.memoizedProps,o.state=r.memoizedState,o.componentWillUnmount()}catch(m){Sc(p,f,m)}}break;case 5:Ya(h,h.return);break;case 22:if(null!==h.memoizedState){_l(u);continue}}null!==d?(d.return=h,Xa=d):_l(u)}t=t.sibling}}break;case 19:dl(e,t),fl(t),4&i&&hl(t);case 21:}}function fl(t){var e=t.flags;if(2&e){try{t:{for(var n=t.return;null!==n;){if(il(n)){var i=n;break t}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(dt(r,""),i.flags&=-33),ol(t,rl(t),r);break;case 3:case 4:var o=i.stateNode.containerInfo;sl(t,rl(t),o);break;default:throw Error(s(161))}}catch(a){Sc(t,t.return,a)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function ml(t,e,n){Xa=t,gl(t,e,n)}function gl(t,e,n){for(var i=0!==(1&t.mode);null!==Xa;){var r=Xa,s=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Wa;if(!o){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Za;a=Wa;var c=Za;if(Wa=o,(Za=l)&&!c)for(Xa=r;null!==Xa;)l=(o=Xa).child,22===o.tag&&null!==o.memoizedState?vl(r):null!==l?(l.return=o,Xa=l):vl(r);for(;null!==s;)Xa=s,gl(s,e,n),s=s.sibling;Xa=r,Wa=a,Za=c}yl(t)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,Xa=s):yl(t)}}function yl(t){for(;null!==Xa;){var e=Xa;if(0!==(8772&e.flags)){var n=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:Za||tl(5,e);break;case 1:var i=e.stateNode;if(4&e.flags&&!Za)if(null===n)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:qr(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;null!==o&&cs(e,o,i);break;case 3:var a=e.updateQueue;if(null!==a){if(n=null,null!==e.child)switch(e.child.tag){case 5:case 1:n=e.child.stateNode}cs(e,a,n)}break;case 5:var l=e.stateNode;if(null===n&&4&e.flags){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(null===e.memoizedState){var u=e.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&je(d)}}}break;default:throw Error(s(163))}Za||512&e.flags&&el(e)}catch(p){Sc(e,e.return,p)}}if(e===t){Xa=null;break}if(null!==(n=e.sibling)){n.return=e.return,Xa=n;break}Xa=e.return}}function _l(t){for(;null!==Xa;){var e=Xa;if(e===t){Xa=null;break}var n=e.sibling;if(null!==n){n.return=e.return,Xa=n;break}Xa=e.return}}function vl(t){for(;null!==Xa;){var e=Xa;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{tl(4,e)}catch(l){Sc(e,n,l)}break;case 1:var i=e.stateNode;if("function"===typeof i.componentDidMount){var r=e.return;try{i.componentDidMount()}catch(l){Sc(e,r,l)}}var s=e.return;try{el(e)}catch(l){Sc(e,s,l)}break;case 5:var o=e.return;try{el(e)}catch(l){Sc(e,o,l)}}}catch(l){Sc(e,e.return,l)}if(e===t){Xa=null;break}var a=e.sibling;if(null!==a){a.return=e.return,Xa=a;break}Xa=e.return}}var xl,bl=Math.ceil,wl=x.ReactCurrentDispatcher,Sl=x.ReactCurrentOwner,El=x.ReactCurrentBatchConfig,Tl=0,Al=null,kl=null,Pl=0,Il=0,Cl=Er(0),Ml=0,zl=null,Ll=0,Dl=0,Rl=0,Bl=null,Ol=null,Fl=0,Vl=1/0,Nl=null,Ul=!1,jl=null,Gl=null,ql=!1,$l=null,Wl=0,Zl=0,Hl=null,Xl=-1,Yl=0;function Kl(){return 0!==(6&Tl)?Kt():-1!==Xl?Xl:Xl=Kt()}function Jl(t){return 0===(1&t.mode)?1:0!==(2&Tl)&&0!==Pl?Pl&-Pl:null!==Gr.transition?(0===Yl&&(Yl=me()),Yl):0!==(t=ve)?t:t=void 0===(t=window.event)?16:Ye(t.type)}function Ql(t,e,n){if(50<Zl)throw Zl=0,Hl=null,Error(s(185));var i=tc(t,e);return null===i?null:(ye(i,e,n),0!==(2&Tl)&&i===Al||(i===Al&&(0===(2&Tl)&&(Dl|=e),4===Ml&&oc(i,Pl)),nc(i,n),1===e&&0===Tl&&0===(1&t.mode)&&(Vl=Kt()+500,Vr&&jr())),i)}function tc(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}function ec(t){return(null!==Al||null!==ts)&&0!==(1&t.mode)&&0===(2&Tl)}function nc(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-oe(s),a=1<<o,l=r[o];-1===l?0!==(a&n)&&0===(a&i)||(r[o]=pe(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}(t,e);var i=de(t,t===Al?Pl:0);if(0===i)null!==n&&Ht(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(null!=n&&Ht(n),1===e)0===t.tag?function(t){Vr=!0,Ur(t)}(ac.bind(null,t)):Ur(ac.bind(null,t)),or((function(){0===Tl&&jr()})),n=null;else{switch(xe(i)){case 1:n=Qt;break;case 4:n=te;break;case 16:default:n=ee;break;case 536870912:n=ie}n=Pc(n,ic.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function ic(t,e){if(Xl=-1,Yl=0,0!==(6&Tl))throw Error(s(327));var n=t.callbackNode;if(bc()&&t.callbackNode!==n)return null;var i=de(t,t===Al?Pl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&t.expiredLanes)||e)e=mc(t,i);else{e=i;var r=Tl;Tl|=2;var o=pc();for(Al===t&&Pl===e||(Nl=null,Vl=Kt()+500,hc(t,e));;)try{yc();break}catch(l){dc(t,l)}Xr(),wl.current=o,Tl=r,null!==kl?e=0:(Al=null,Pl=0,e=Ml)}if(0!==e){if(2===e&&(0!==(r=fe(t))&&(i=r,e=rc(t,r))),1===e)throw n=zl,hc(t,0),oc(t,i),nc(t,Kt()),n;if(6===e)oc(t,i);else{if(r=t.current.alternate,0===(30&i)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!ai(s(),r))return!1}catch(a){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(r)&&(2===(e=mc(t,i))&&(0!==(o=fe(t))&&(i=o,e=rc(t,o))),1===e))throw n=zl,hc(t,0),oc(t,i),nc(t,Kt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(s(345));case 2:case 5:xc(t,Ol,Nl);break;case 3:if(oc(t,i),(130023424&i)===i&&10<(e=Fl+500-Kt())){if(0!==de(t,0))break;if(((r=t.suspendedLanes)&i)!==i){Kl(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=ir(xc.bind(null,t,Ol,Nl),e);break}xc(t,Ol,Nl);break;case 4:if(oc(t,i),(4194240&i)===i)break;for(e=t.eventTimes,r=-1;0<i;){var a=31-oe(i);o=1<<a,(a=e[a])>r&&(r=a),i&=~o}if(i=r,10<(i=(120>(i=Kt()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*bl(i/1960))-i)){t.timeoutHandle=ir(xc.bind(null,t,Ol,Nl),i);break}xc(t,Ol,Nl);break;default:throw Error(s(329))}}}return nc(t,Kt()),t.callbackNode===n?ic.bind(null,t):null}function rc(t,e){var n=Bl;return t.current.memoizedState.isDehydrated&&(hc(t,e).flags|=256),2!==(t=mc(t,e))&&(e=Ol,Ol=n,null!==e&&sc(e)),t}function sc(t){null===Ol?Ol=t:Ol.push.apply(Ol,t)}function oc(t,e){for(e&=~Rl,e&=~Dl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-oe(e),i=1<<n;t[n]=-1,e&=~i}}function ac(t){if(0!==(6&Tl))throw Error(s(327));bc();var e=de(t,0);if(0===(1&e))return nc(t,Kt()),null;var n=mc(t,e);if(0!==t.tag&&2===n){var i=fe(t);0!==i&&(e=i,n=rc(t,i))}if(1===n)throw n=zl,hc(t,0),oc(t,e),nc(t,Kt()),n;if(6===n)throw Error(s(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,xc(t,Ol,Nl),nc(t,Kt()),null}function lc(t,e){var n=Tl;Tl|=1;try{return t(e)}finally{0===(Tl=n)&&(Vl=Kt()+500,Vr&&jr())}}function cc(t){null!==$l&&0===$l.tag&&0===(6&Tl)&&bc();var e=Tl;Tl|=1;var n=El.transition,i=ve;try{if(El.transition=null,ve=1,t)return t()}finally{ve=i,El.transition=n,0===(6&(Tl=e))&&jr()}}function uc(){Il=Cl.current,Tr(Cl)}function hc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,rr(n)),null!==kl)for(n=kl.return;null!==n;){var i=n;switch(Is(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Lr();break;case 3:to(),Tr(Ir),Tr(Pr),oo();break;case 5:no(i);break;case 4:to();break;case 13:case 19:Tr(io);break;case 10:Yr(i.type._context);break;case 22:case 23:uc()}n=n.return}if(Al=t,kl=t=zc(t.current,null),Pl=Il=e,Ml=0,zl=null,Rl=Dl=Ll=0,Ol=Bl=null,null!==ts){for(e=0;e<ts.length;e++)if(null!==(i=(n=ts[e]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var o=s.next;s.next=r,i.next=o}n.pending=i}ts=null}return t}function dc(t,e){for(;;){var n=kl;try{if(Xr(),ao.current=na,fo){for(var i=uo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}fo=!1}if(co=0,po=ho=uo=null,mo=!1,go=0,Sl.current=null,null===n||null===n.return){Ml=1,zl=e,kl=null;break}t:{var o=t,a=n.return,l=n,c=e;if(e=Pl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=ma(a);if(null!==f){f.flags&=-257,ga(f,a,l,0,e),1&f.mode&&fa(o,u,e),c=u;var m=(e=f).updateQueue;if(null===m){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break t}if(0===(1&e)){fa(o,u,e),fc();break t}c=Error(s(426))}else if(zs&&1&l.mode){var y=ma(a);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),ga(y,a,l,0,e),Us(c);break t}}o=c,4!==Ml&&(Ml=2),null===Bl?Bl=[o]:Bl.push(o),c=oa(c,l),l=a;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e,as(l,da(0,c,e));break t;case 1:o=c;var _=l.type,v=l.stateNode;if(0===(128&l.flags)&&("function"===typeof _.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Gl||!Gl.has(v)))){l.flags|=65536,e&=-e,l.lanes|=e,as(l,pa(l,o,e));break t}}l=l.return}while(null!==l)}vc(n)}catch(x){e=x,kl===n&&null!==n&&(kl=n=n.return);continue}break}}function pc(){var t=wl.current;return wl.current=na,null===t?na:t}function fc(){0!==Ml&&3!==Ml&&2!==Ml||(Ml=4),null===Al||0===(268435455&Ll)&&0===(268435455&Dl)||oc(Al,Pl)}function mc(t,e){var n=Tl;Tl|=2;var i=pc();for(Al===t&&Pl===e||(Nl=null,hc(t,e));;)try{gc();break}catch(r){dc(t,r)}if(Xr(),Tl=n,wl.current=i,null!==kl)throw Error(s(261));return Al=null,Pl=0,Ml}function gc(){for(;null!==kl;)_c(kl)}function yc(){for(;null!==kl&&!Xt();)_c(kl)}function _c(t){var e=xl(t.alternate,t,Il);t.memoizedProps=t.pendingProps,null===e?vc(t):kl=e,Sl.current=null}function vc(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(n=va(n,e,Il)))return void(kl=n)}else{if(null!==(n=$a(n,e)))return n.flags&=32767,void(kl=n);if(null===t)return Ml=6,void(kl=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(kl=e);kl=e=t}while(null!==e);0===Ml&&(Ml=5)}function xc(t,e,n){var i=ve,r=El.transition;try{El.transition=null,ve=1,function(t,e,n,i){do{bc()}while(null!==$l);if(0!==(6&Tl))throw Error(s(327));n=t.finishedWork;var r=t.finishedLanes;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(s(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-oe(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}(t,o),t===Al&&(kl=Al=null,Pl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||ql||(ql=!0,Pc(ee,(function(){return bc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=El.transition,El.transition=null;var a=ve;ve=1;var l=Tl;Tl|=4,Sl.current=null,function(t,e){if(tr=qe,pi(t=di())){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var i=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(w){n=null;break t}var a=0,l=-1,c=-1,u=0,h=0,d=t,p=null;e:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=a+r),d!==o||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===t)break e;if(p===n&&++u===r&&(l=a),p===o&&++h===i&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(er={focusedElem:t,selectionRange:n},qe=!1,Xa=e;null!==Xa;)if(t=(e=Xa).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,Xa=t;else for(;null!==Xa;){e=Xa;try{var m=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,_=e.stateNode,v=_.getSnapshotBeforeUpdate(e.elementType===e.type?g:qr(e.type,g),y);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var x=e.stateNode.containerInfo;if(1===x.nodeType)x.textContent="";else if(9===x.nodeType){var b=x.body;null!=b&&(b.textContent="")}break;default:throw Error(s(163))}}catch(w){Sc(e,e.return,w)}if(null!==(t=e.sibling)){t.return=e.return,Xa=t;break}Xa=e.return}m=Ja,Ja=!1}(t,n),pl(n,t),fi(er),qe=!!tr,er=tr=null,t.current=n,ml(n,t,r),Yt(),Tl=l,ve=a,El.transition=o}else t.current=n;if(ql&&(ql=!1,$l=t,Wl=r),0===(o=t.pendingLanes)&&(Gl=null),function(t){if(se&&"function"===typeof se.onCommitFiberRoot)try{se.onCommitFiberRoot(re,t,void 0,128===(128&t.current.flags))}catch(e){}}(n.stateNode),nc(t,Kt()),null!==e)for(i=t.onRecoverableError,n=0;n<e.length;n++)i(e[n]);if(Ul)throw Ul=!1,t=jl,jl=null,t;0!==(1&Wl)&&0!==t.tag&&bc(),0!==(1&(o=t.pendingLanes))?t===Hl?Zl++:(Zl=0,Hl=t):Zl=0,jr()}(t,e,n,i)}finally{El.transition=r,ve=i}return null}function bc(){if(null!==$l){var t=xe(Wl),e=El.transition,n=ve;try{if(El.transition=null,ve=16>t?16:t,null===$l)var i=!1;else{if(t=$l,$l=null,Wl=0,0!==(6&Tl))throw Error(s(331));var r=Tl;for(Tl|=4,Xa=t.current;null!==Xa;){var o=Xa,a=o.child;if(0!==(16&Xa.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xa=u;null!==Xa;){var h=Xa;switch(h.tag){case 0:case 11:case 15:Qa(8,h,o)}var d=h.child;if(null!==d)d.return=h,Xa=d;else for(;null!==Xa;){var p=(h=Xa).sibling,f=h.return;if(nl(h),h===u){Xa=null;break}if(null!==p){p.return=f,Xa=p;break}Xa=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Xa=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,Xa=a;else t:for(;null!==Xa;){if(0!==(2048&(o=Xa).flags))switch(o.tag){case 0:case 11:case 15:Qa(9,o,o.return)}var _=o.sibling;if(null!==_){_.return=o.return,Xa=_;break t}Xa=o.return}}var v=t.current;for(Xa=v;null!==Xa;){var x=(a=Xa).child;if(0!==(2064&a.subtreeFlags)&&null!==x)x.return=a,Xa=x;else t:for(a=v;null!==Xa;){if(0!==(2048&(l=Xa).flags))try{switch(l.tag){case 0:case 11:case 15:tl(9,l)}}catch(w){Sc(l,l.return,w)}if(l===a){Xa=null;break t}var b=l.sibling;if(null!==b){b.return=l.return,Xa=b;break t}Xa=l.return}}if(Tl=r,jr(),se&&"function"===typeof se.onPostCommitFiberRoot)try{se.onPostCommitFiberRoot(re,t)}catch(w){}i=!0}return i}finally{ve=n,El.transition=e}}return!1}function wc(t,e,n){ss(t,e=da(0,e=oa(n,e),1)),e=Kl(),null!==(t=tc(t,1))&&(ye(t,1,e),nc(t,e))}function Sc(t,e,n){if(3===t.tag)wc(t,t,n);else for(;null!==e;){if(3===e.tag){wc(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Gl||!Gl.has(i))){ss(e,t=pa(e,t=oa(n,t),1)),t=Kl(),null!==(e=tc(e,1))&&(ye(e,1,t),nc(e,t));break}}e=e.return}}function Ec(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=Kl(),t.pingedLanes|=t.suspendedLanes&n,Al===t&&(Pl&n)===n&&(4===Ml||3===Ml&&(130023424&Pl)===Pl&&500>Kt()-Fl?hc(t,0):Rl|=n),nc(t,e)}function Tc(t,e){0===e&&(0===(1&t.mode)?e=1:(e=ue,0===(130023424&(ue<<=1))&&(ue=4194304)));var n=Kl();null!==(t=tc(t,e))&&(ye(t,e,n),nc(t,n))}function Ac(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Tc(t,n)}function kc(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(e),Tc(t,n)}function Pc(t,e){return Zt(t,e)}function Ic(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cc(t,e,n,i){return new Ic(t,e,n,i)}function Mc(t){return!(!(t=t.prototype)||!t.isReactComponent)}function zc(t,e){var n=t.alternate;return null===n?((n=Cc(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Lc(t,e,n,i,r,o){var a=2;if(i=t,"function"===typeof t)Mc(t)&&(a=1);else if("string"===typeof t)a=5;else t:switch(t){case S:return Dc(n.children,r,o,e);case E:a=8,r|=8;break;case T:return(t=Cc(12,n,e,2|r)).elementType=T,t.lanes=o,t;case I:return(t=Cc(13,n,e,r)).elementType=I,t.lanes=o,t;case C:return(t=Cc(19,n,e,r)).elementType=C,t.lanes=o,t;case L:return Rc(n,r,o,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case A:a=10;break t;case k:a=9;break t;case P:a=11;break t;case M:a=14;break t;case z:a=16,i=null;break t}throw Error(s(130,null==t?t:typeof t,""))}return(e=Cc(a,n,e,r)).elementType=t,e.type=i,e.lanes=o,e}function Dc(t,e,n,i){return(t=Cc(7,t,i,e)).lanes=n,t}function Rc(t,e,n,i){return(t=Cc(22,t,i,e)).elementType=L,t.lanes=n,t.stateNode={},t}function Bc(t,e,n){return(t=Cc(6,t,null,e)).lanes=n,t}function Oc(t,e,n){return(e=Cc(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Fc(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ge(0),this.expirationTimes=ge(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ge(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Vc(t,e,n,i,r,s,o,a,l){return t=new Fc(t,e,n,a,l),1===e?(e=1,!0===s&&(e|=8)):e=0,s=Cc(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ns(s),t}function Nc(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}}function Uc(t){if(!t)return kr;t:{if(jt(t=t._reactInternals)!==t||1!==t.tag)throw Error(s(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(zr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(s(171))}if(1===t.tag){var n=t.type;if(zr(n))return Rr(t,n,e)}return e}function jc(t,e,n,i,r,s,o,a,l){return(t=Vc(n,i,!0,t,0,s,0,a,l)).context=Uc(null),n=t.current,(s=rs(i=Kl(),r=Jl(n))).callback=void 0!==e&&null!==e?e:null,ss(n,s),t.current.lanes=r,ye(t,r,i),nc(t,i),t}function Gc(t,e,n,i){var r=e.current,s=Kl(),o=Jl(r);return n=Uc(n),null===e.context?e.context=n:e.pendingContext=n,(e=rs(s,o)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),ss(r,e),null!==(t=Ql(r,o,s))&&os(t,r,o),o}function qc(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function $c(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function Wc(t,e){$c(t,e),(t=t.alternate)&&$c(t,e)}xl=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||Ir.current)ba=!0;else{if(0===(t.lanes&n)&&0===(128&e.flags))return ba=!1,function(t,e,n){switch(e.tag){case 3:Ma(e),Ns();break;case 5:eo(e);break;case 1:zr(e.type)&&Br(e);break;case 4:Qs(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Ar($r,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=e.memoizedState))return null!==i.dehydrated?(Ar(io,1&io.current),e.flags|=128,null):0!==(n&e.child.childLanes)?Ba(t,e,n):(Ar(io,1&io.current),null!==(t=qa(t,e,n))?t.sibling:null);Ar(io,1&io.current);break;case 19:if(i=0!==(n&e.childLanes),0!==(128&t.flags)){if(i)return Ga(t,e,n);e.flags|=128}if(null!==(r=e.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ar(io,io.current),i)break;return null;case 22:case 23:return e.lanes=0,Aa(t,e,n)}return qa(t,e,n)}(t,e,n);ba=0!==(131072&t.flags)}else ba=!1,zs&&0!==(1048576&e.flags)&&ks(e,xs,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps;var r=Mr(e,Pr.current);Jr(e,n),r=xo(null,e,i,t,r,n);var o=bo();return e.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,zr(i)?(o=!0,Br(e)):o=!1,e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,ns(e),r.updater=ds,e.stateNode=r,r._reactInternals=e,gs(e,i,t,n),e=Ca(null,e,i,!0,o,n)):(e.tag=0,zs&&o&&Ps(e),wa(null,e,r,n),e=e.child),e;case 16:i=e.elementType;t:{switch(null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=(r=i._init)(i._payload),e.type=i,r=e.tag=function(t){if("function"===typeof t)return Mc(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===P)return 11;if(t===M)return 14}return 2}(i),t=qr(i,t),r){case 0:e=Pa(null,e,i,t,n);break t;case 1:e=Ia(null,e,i,t,n);break t;case 11:e=Sa(null,e,i,t,n);break t;case 14:e=Ea(null,e,i,qr(i.type,t),n);break t}throw Error(s(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,Pa(t,e,i,r=e.elementType===i?r:qr(i,r),n);case 1:return i=e.type,r=e.pendingProps,Ia(t,e,i,r=e.elementType===i?r:qr(i,r),n);case 3:t:{if(Ma(e),null===t)throw Error(s(387));i=e.pendingProps,r=(o=e.memoizedState).element,is(t,e),ls(e,i,null,n);var a=e.memoizedState;if(i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,256&e.flags){e=za(t,e,i,n,r=Error(s(423)));break t}if(i!==r){e=za(t,e,i,n,r=Error(s(424)));break t}for(Ms=cr(e.stateNode.containerInfo.firstChild),Cs=e,zs=!0,Ls=null,n=Zs(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Ns(),i===r){e=qa(t,e,n);break t}wa(t,e,i,n)}e=e.child}return e;case 5:return eo(e),null===t&&Os(e),i=e.type,r=e.pendingProps,o=null!==t?t.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==o&&nr(i,o)&&(e.flags|=32),ka(t,e),wa(t,e,a,n),e.child;case 6:return null===t&&Os(e),null;case 13:return Ba(t,e,n);case 4:return Qs(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=Ws(e,null,i,n):wa(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,Sa(t,e,i,r=e.elementType===i?r:qr(i,r),n);case 7:return wa(t,e,e.pendingProps,n),e.child;case 8:case 12:return wa(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(i=e.type._context,r=e.pendingProps,o=e.memoizedProps,a=r.value,Ar($r,i._currentValue),i._currentValue=a,null!==o)if(ai(o.value,a)){if(o.children===r.children&&!Ir.current){e=qa(t,e,n);break t}}else for(null!==(o=e.child)&&(o.return=e);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=rs(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Kr(o.return,n,e),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===e.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Kr(a,n,e),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===e){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}wa(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Jr(e,n),i=i(r=Qr(r)),e.flags|=1,wa(t,e,i,n),e.child;case 14:return r=qr(i=e.type,e.pendingProps),Ea(t,e,i,r=qr(i.type,r),n);case 15:return Ta(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:qr(i,r),null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,zr(i)?(t=!0,Br(e)):t=!1,Jr(e,n),fs(e,i,r),gs(e,i,r,n),Ca(null,e,i,!0,t,n);case 19:return Ga(t,e,n);case 22:return Aa(t,e,n)}throw Error(s(156,e.tag))};var Zc="function"===typeof reportError?reportError:function(t){console.error(t)};function Hc(t){this._internalRoot=t}function Xc(t){this._internalRoot=t}function Yc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function Kc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function Jc(){}function Qc(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if("function"===typeof r){var a=r;r=function(){var t=qc(o);a.call(t)}}Gc(e,o,t,r)}else o=function(t,e,n,i,r){if(r){if("function"===typeof i){var s=i;i=function(){var t=qc(o);s.call(t)}}var o=jc(e,i,t,0,null,!1,0,"",Jc);return t._reactRootContainer=o,t[fr]=o.current,ji(8===t.nodeType?t.parentNode:t),cc(),o}for(;r=t.lastChild;)t.removeChild(r);if("function"===typeof i){var a=i;i=function(){var t=qc(l);a.call(t)}}var l=Vc(t,0,!1,null,0,!1,0,"",Jc);return t._reactRootContainer=l,t[fr]=l.current,ji(8===t.nodeType?t.parentNode:t),cc((function(){Gc(e,l,n,i)})),l}(n,e,t,r,i);return qc(o)}Xc.prototype.render=Hc.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(s(409));Gc(t,e,null,null)},Xc.prototype.unmount=Hc.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;cc((function(){Gc(null,t,null,null)})),e[fr]=null}},Xc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ee();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Le.length&&0!==e&&e<Le[n].priority;n++);Le.splice(n,0,t),0===n&&Oe(t)}},be=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=he(e.pendingLanes);0!==n&&(_e(e,1|n),nc(e,Kt()),0===(6&Tl)&&(Vl=Kt()+500,jr()))}break;case 13:var i=Kl();cc((function(){return Ql(t,1,i)})),Wc(t,1)}},we=function(t){13===t.tag&&(Ql(t,134217728,Kl()),Wc(t,134217728))},Se=function(t){if(13===t.tag){var e=Kl(),n=Jl(t);Ql(t,n,e),Wc(t,n)}},Ee=function(){return ve},Te=function(t,e){var n=ve;try{return ve=t,e()}finally{ve=n}},wt=function(t,e,n){switch(e){case"input":if(J(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=br(i);if(!r)throw Error(s(90));Z(i),J(i,r)}}}break;case"textarea":st(t,n);break;case"select":null!=(e=n.value)&&nt(t,!!n.multiple,e,!1)}},Pt=lc,It=cc;var tu={usingClientEntryPoint:!1,Events:[vr,xr,br,At,kt,lc]},eu={findFiberByHostInstance:_r,bundleType:0,version:"18.1.0",rendererPackageName:"react-dom"},nu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=$t(t))?null:t.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.1.0-next-22edb9f77-20220426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{re=iu.inject(nu),se=iu}catch(ut){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(e))throw Error(s(200));return Nc(t,e,null,n)},e.createRoot=function(t,e){if(!Yc(t))throw Error(s(299));var n=!1,i="",r=Zc;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(i=e.identifierPrefix),void 0!==e.onRecoverableError&&(r=e.onRecoverableError)),e=Vc(t,1,!1,null,0,n,0,i,r),t[fr]=e.current,ji(8===t.nodeType?t.parentNode:t),new Hc(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(s(188));throw t=Object.keys(t).join(","),Error(s(268,t))}return t=null===(t=$t(e))?null:t.stateNode},e.flushSync=function(t){return cc(t)},e.hydrate=function(t,e,n){if(!Kc(e))throw Error(s(200));return Qc(null,t,e,!0,n)},e.hydrateRoot=function(t,e,n){if(!Yc(t))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",a=Zc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),e=jc(e,null,t,1,null!=n?n:null,r,0,o,a),t[fr]=e.current,ji(t),i)for(t=0;t<i.length;t++)r=(r=(n=i[t])._getVersion)(n._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Xc(e)},e.render=function(t,e,n){if(!Kc(e))throw Error(s(200));return Qc(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!Kc(t))throw Error(s(40));return!!t._reactRootContainer&&(cc((function(){Qc(null,null,t,!1,(function(){t._reactRootContainer=null,t[fr]=null}))})),!0)},e.unstable_batchedUpdates=lc,e.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Kc(n))throw Error(s(200));if(null==t||void 0===t._reactInternals)throw Error(s(38));return Qc(t,e,n,!1,i)},e.version="18.1.0-next-22edb9f77-20220426"},250:(t,e,n)=>{"use strict";var i=n(164);e.createRoot=i.createRoot,e.hydrateRoot=i.hydrateRoot},164:(t,e,n)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(463)},374:(t,e,n)=>{"use strict";var i=n(791),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(t,e,n){var i,s={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(u=e.ref),e)o.call(e,i)&&!l.hasOwnProperty(i)&&(s[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps)void 0===s[i]&&(s[i]=e[i]);return{$$typeof:r,type:t,key:c,ref:u,props:s,_owner:a.current}}e.Fragment=s,e.jsx=c,e.jsxs=c},117:(t,e)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}function _(){}function v(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},y.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},_.prototype=y.prototype;var x=v.prototype=new _;x.constructor=v,m(x,y.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function T(t,e,i){var r,s={},o=null,a=null;if(null!=e)for(r in void 0!==e.ref&&(a=e.ref),void 0!==e.key&&(o=""+e.key),e)w.call(e,r)&&!E.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:t,key:o,ref:a,props:s,_owner:S.current}}function A(t){return"object"===typeof t&&null!==t&&t.$$typeof===n}var k=/\/+/g;function P(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function I(t,e,r,s,o){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var l=!1;if(null===t)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=t),t=""===s?"."+P(l,0):s,b(o)?(r="",null!=t&&(r=t.replace(k,"$&/")+"/"),I(o,e,r,"",(function(t){return t}))):null!=o&&(A(o)&&(o=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(k,"$&/")+"/")+t)),e.push(o)),1;if(l=0,s=""===s?".":s+":",b(t))for(var c=0;c<t.length;c++){var u=s+P(a=t[c],c);l+=I(a,e,r,u,o)}else if(u=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=p&&t[p]||t["@@iterator"])?t:null}(t),"function"===typeof u)for(t=u.call(t),c=0;!(a=t.next()).done;)l+=I(a=a.value,e,r,u=s+P(a,c++),o);else if("object"===a)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function C(t,e,n){if(null==t)return t;var i=[],r=0;return I(t,i,"","",(function(t){return e.call(n,t,r++)})),i}function M(t){if(-1===t._status){var e=t._result;(e=e()).then((function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)}),(function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)})),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var z={current:null},L={transition:null},D={ReactCurrentDispatcher:z,ReactCurrentBatchConfig:L,ReactCurrentOwner:S};e.Children={map:C,forEach:function(t,e,n){C(t,(function(){e.apply(this,arguments)}),n)},count:function(t){var e=0;return C(t,(function(){e++})),e},toArray:function(t){return C(t,(function(t){return t}))||[]},only:function(t){if(!A(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=y,e.Fragment=r,e.Profiler=o,e.PureComponent=v,e.StrictMode=s,e.Suspense=u,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,e.cloneElement=function(t,e,i){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=m({},t.props),s=t.key,o=t.ref,a=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,a=S.current),void 0!==e.key&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)w.call(e,c)&&!E.hasOwnProperty(c)&&(r[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:t.type,key:s,ref:o,props:r,_owner:a}},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:t},t.Consumer=t},e.createElement=T,e.createFactory=function(t){var e=T.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=A,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:M}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=L.transition;L.transition={};try{t()}finally{L.transition=e}},e.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},e.useCallback=function(t,e){return z.current.useCallback(t,e)},e.useContext=function(t){return z.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return z.current.useDeferredValue(t)},e.useEffect=function(t,e){return z.current.useEffect(t,e)},e.useId=function(){return z.current.useId()},e.useImperativeHandle=function(t,e,n){return z.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return z.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return z.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return z.current.useMemo(t,e)},e.useReducer=function(t,e,n){return z.current.useReducer(t,e,n)},e.useRef=function(t){return z.current.useRef(t)},e.useState=function(t){return z.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return z.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return z.current.useTransition()},e.version="18.1.0"},791:(t,e,n)=>{"use strict";t.exports=n(117)},184:(t,e,n)=>{"use strict";t.exports=n(374)},813:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,r=t[i];if(!(0<s(r,e)))break t;t[i]=e,t[n]=r,n=i}}function i(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length,o=r>>>1;i<o;){var a=2*(i+1)-1,l=t[a],c=a+1,u=t[c];if(0>s(l,n))c<r&&0>s(u,l)?(t[i]=u,t[c]=n,i=c):(t[i]=l,t[a]=n,i=a);else{if(!(c<r&&0>s(u,n)))break t;t[i]=u,t[c]=n,i=c}}}return e}function s(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,_="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function x(t){for(var e=i(u);null!==e;){if(null===e.callback)r(u);else{if(!(e.startTime<=t))break;r(u),e.sortIndex=e.expirationTime,n(c,e)}e=i(u)}}function b(t){if(g=!1,x(t),!m)if(null!==i(c))m=!0,L(w);else{var e=i(u);null!==e&&D(b,e.startTime-t)}}function w(t,n){m=!1,g&&(g=!1,_(A),A=-1),f=!0;var s=p;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||t&&!I());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var a=o(d.expirationTime<=n);n=e.unstable_now(),"function"===typeof a?d.callback=a:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(b,h.startTime-n),l=!1}return l}finally{d=null,p=s,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,E=!1,T=null,A=-1,k=5,P=-1;function I(){return!(e.unstable_now()-P<k)}function C(){if(null!==T){var t=e.unstable_now();P=t;var n=!0;try{n=T(!0,t)}finally{n?S():(E=!1,T=null)}}else E=!1}if("function"===typeof v)S=function(){v(C)};else if("undefined"!==typeof MessageChannel){var M=new MessageChannel,z=M.port2;M.port1.onmessage=C,S=function(){z.postMessage(null)}}else S=function(){y(C,0)};function L(t){T=t,E||(E=!0,S())}function D(t,n){A=y((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,L(w))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return i(c)},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_scheduleCallback=function(t,r,s){var o=e.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,t){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return t={id:h++,callback:r,priorityLevel:t,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(t.sortIndex=s,n(u,t),null===i(c)&&t===i(u)&&(g?(_(A),A=-1):g=!0,D(b,s-o))):(t.sortIndex=a,n(c,t),m||f||(m=!0,L(w))),t},e.unstable_shouldYield=I,e.unstable_wrapCallback=function(t){var e=p;return function(){var n=p;p=e;try{return t.apply(this,arguments)}finally{p=n}}}},296:(t,e,n)=>{"use strict";t.exports=n(813)},521:()=>{},249:()=>{},609:()=>{!function(){"use strict";var t=e;function e(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}function n(t,e,n){return Math.min(n,Math.max(e,t))}function i(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}function r(t,e,n){const i={};for(const r in t)i[r]=e.call(n||this,t[r],r,t);return i}function s(t){return Array.isArray(t)?t.map(s):"object"==typeof t&&t?r(t,s):t}e.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=r/s}var o=0,a=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:a=n,n=.5*(a-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},new t(.25,.1,.25,1);const o={};function a(t){o[t]||("undefined"!=typeof console&&console.warn(t),o[t]=!0)}function l(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function c(t){let e=0;for(let n,i,r=0,s=t.length,o=s-1;r<s;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}function u(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}let h=null;function d(t){if(null==h){const e=t.navigator?t.navigator.userAgent:null;h=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return h}function p(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}class f{constructor(t,e,n){const i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(n=r[2]);for(let t=0;t<this.d*this.d;t++){const e=r[3+t],n=r[3+t+1];i.push(e===n?null:r.subarray(e,n))}const s=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],s),this.bboxes=r.subarray(s),this.insert=this._insertReadonly}else{this.d=e+2*n;for(let t=0;t<this.d*this.d;t++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;const r=n/e*t;this.min=-r,this.max=t+r}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,n,i,r,s){this.cells[r].push(s)}query(t,e,n,i,r){const s=this.min,o=this.max;if(t<=s&&e<=s&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);{const s=[];return this._forEachCell(t,e,n,i,this._queryCell,s,{},r),s}}_queryCell(t,e,n,i,r,s,o,a){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===o[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&n>=c[l+0]&&i>=c[l+1])?(o[h]=!0,s.push(r[h])):o[h]=!1}}}}_forEachCell(t,e,n,i,r,s,o,a){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&r.call(this,t,e,n,i,c,s,o,a))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let n=0;for(let s=0;s<this.cells.length;s++)n+=this.cells[s].length;const i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let r=e;for(let s=0;s<t.length;s++){const e=t[s];i[3+s]=r,i.set(e,r),r+=e.length}return i[3+t.length]=r,i.set(this.keys,r),r+=this.keys.length,i[3+t.length+1]=r,i.set(this.bboxes,r),r+=this.bboxes.length,i.buffer}static serialize(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}}static deserialize(t){return new f(t.buffer)}}var m,g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function y(t){return(t=Math.round(t))<0?0:t>255?255:t}function _(t){return y("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function v(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function x(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{m={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in g)return g[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var s=n.substr(0,i),o=n.substr(i+1,r-(i+1)).split(","),a=1;switch(s){case"rgba":if(4!==o.length)return null;a=v(o.pop());case"rgb":return 3!==o.length?null:[_(o[0]),_(o[1]),_(o[2]),a];case"hsla":if(4!==o.length)return null;a=v(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,c=v(o[1]),u=v(o[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[y(255*x(d,h,l+1/3)),y(255*x(d,h,l)),y(255*x(d,h,l-1/3)),a];default:return null}}return null}}catch(t){}class b{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=t,this.g=e,this.b=n,this.a=i}static parse(t){if(!t)return;if(t instanceof b)return t;if("string"!=typeof t)return;const e=m(t);return e?new b(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,n,i]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${i})`}toArray(){const{r:t,g:e,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]}}function w(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}b.black=new b(0,0,0,1),b.white=new b(1,1,1,1),b.transparent=new b(0,0,0,0),b.red=new b(1,0,0,1);class S extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class E{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(t){return new E(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const T={kind:"null"},A={kind:"number"},k={kind:"string"},P={kind:"boolean"},I={kind:"color"},C={kind:"object"},M={kind:"value"},z={kind:"collator"},L={kind:"formatted"},D={kind:"resolvedImage"};function R(t,e){return{kind:"array",itemType:t,N:e}}function B(t){if("array"===t.kind){const e=B(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const O=[T,A,k,P,I,L,C,R(M),D];function F(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!F(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of O)if(!F(t,e))return null}return`Expected ${B(t)} but found ${B(e)} instead.`}function V(t,e){return e.some((e=>e.kind===t.kind))}function N(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}class U{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class j{constructor(t,e,n,i,r){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r}}class G{constructor(t){this.sections=t}static fromString(t){return new G([new j(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof G?t:G.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}}class q{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new q({name:t,available:!1}):null}serialize(){return["image",this.name]}}function $(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function W(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof b)return!0;if(t instanceof U)return!0;if(t instanceof G)return!0;if(t instanceof q)return!0;if(Array.isArray(t)){for(const e of t)if(!W(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!W(t[e]))return!1;return!0}return!1}function Z(t){if(null===t)return T;if("string"==typeof t)return k;if("boolean"==typeof t)return P;if("number"==typeof t)return A;if(t instanceof b)return I;if(t instanceof U)return z;if(t instanceof G)return L;if(t instanceof q)return D;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=Z(i);if(n){if(n===t)continue;n=M;break}n=t}return R(n||M,e)}return C}function H(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof b||t instanceof G||t instanceof q?t.toString():JSON.stringify(t)}class X{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!W(t[1]))return e.error("invalid value");const n=t[1];let i=Z(n);const r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new X(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof b?["rgba"].concat(this.value.toArray()):this.value instanceof G?this.value.serialize():this.value}}class Y{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const K={string:k,number:A,boolean:P,object:C};class J{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,s;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in K)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=K[n],i++}else r=M;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);s=t[2],i++}n=R(r,s)}else n=K[r];const s=[];for(;i<t.length;i++){const n=e.parse(t[i],i,M);if(!n)return null;s.push(n)}return new J(n,s)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!F(this.type,Z(n)))return n;if(e===this.args.length-1)throw new Y(`Expected value to be of type ${B(this.type)}, but found ${B(Z(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map((t=>t.serialize())))}}class Q{constructor(t){this.type=L,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let s=1;s<=t.length-1;++s){const n=t[s];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,A),!t))return null;let s=null;if(n["text-font"]&&(s=e.parse(n["text-font"],1,R(k)),!s))return null;let o=null;if(n["text-color"]&&(o=e.parse(n["text-color"],1,I),!o))return null;const a=i[i.length-1];a.scale=t,a.font=s,a.textColor=o}else{const n=e.parse(t[s],1,M);if(!n)return null;const o=n.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new Q(i)}evaluate(t){return new G(this.sections.map((e=>{const n=e.content.evaluate(t);return Z(n)===D?new j("",n,null,null,null):new j(H(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}}class tt{constructor(t){this.type=D,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,k);return n?new tt(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=q.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const et={"to-boolean":P,"to-color":I,"to-number":A,"to-string":k};class nt{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=et[n],r=[];for(let s=1;s<t.length;s++){const n=e.parse(t[s],s,M);if(!n)return null;r.push(n)}return new nt(i,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof b)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:$(e[0],e[1],e[2],e[3]),!n))return new b(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Y(n||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new Y(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?G.fromString(H(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?q.fromString(H(this.args[0].evaluate(t))):H(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Q([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new tt(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}const it=["Unknown","Point","LineString","Polygon"];class rt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?it[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=b.parse(t)),e}}class st{constructor(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const n=t[0],i=st.definitions[n];if(!i)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,s=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=s.filter((e=>{let[n]=e;return!Array.isArray(n)||n.length===t.length-1}));let a=null;for(const[l,c]of o){a=new Pt(e.registry,e.path,null,e.scope);const i=[];let s=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(l)?l[e-1]:l.type,o=a.parse(n,1+i.length,r);if(!o){s=!0;break}i.push(o)}if(!s)if(Array.isArray(l)&&l.length!==i.length)a.error(`Expected ${l.length} arguments, but found ${i.length} instead.`);else{for(let t=0;t<i.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=i[t];a.concat(t+1).checkSubtype(e,n.type)}if(0===a.errors.length)return new st(n,r,c,i)}}if(1===o.length)e.errors.push(...a.errors);else{const n=(o.length?o:s).map((t=>{let[e]=t;return n=e,Array.isArray(n)?`(${n.map(B).join(", ")})`:`(${B(n.type)}...)`;var n})).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(B(n.type))}e.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(t,e){st.definitions=e;for(const n in e)t[n]=st}}class ot{constructor(t,e,n){this.type=z,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,P);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,P);if(!r)return null;let s=null;return n.locale&&(s=e.parse(n.locale,1,k),!s)?null:new ot(i,r,s)}evaluate(t){return new U(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const at=8192;function lt(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ct(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ut(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*at),Math.round(i*r*at)]}function ht(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],s=t[0]-n[0],o=t[1]-n[1];return i*o-s*r==0&&i*s<=0&&r*o<=0}function dt(t,e){let n=!1;for(let o=0,a=e.length;o<a;o++){const a=e[o];for(let e=0,o=a.length;e<o-1;e++){if(ht(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(i=t)[1]!=(s=a[e+1])[1]>i[1]&&i[0]<(s[0]-r[0])*(i[1]-r[1])/(s[1]-r[1])+r[0]&&(n=!n)}}var i,r,s;return n}function pt(t,e){for(let n=0;n<e.length;n++)if(dt(t,e[n]))return!0;return!1}function ft(t,e,n,i){const r=i[0]-n[0],s=i[1]-n[1],o=(t[0]-n[0])*s-r*(t[1]-n[1]),a=(e[0]-n[0])*s-r*(e[1]-n[1]);return o>0&&a<0||o<0&&a>0}function mt(t,e,n){for(const c of n)for(let n=0;n<c.length-1;++n)if(0!=(a=[(o=c[n+1])[0]-(s=c[n])[0],o[1]-s[1]])[0]*(l=[(r=e)[0]-(i=t)[0],r[1]-i[1]])[1]-a[1]*l[0]&&ft(i,r,s,o)&&ft(s,o,i,r))return!0;var i,r,s,o,a,l;return!1}function gt(t,e){for(let n=0;n<t.length;++n)if(!dt(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(mt(t[n],t[n+1],e))return!1;return!0}function yt(t,e){for(let n=0;n<e.length;n++)if(gt(t,e[n]))return!0;return!1}function _t(t,e,n){const i=[];for(let r=0;r<t.length;r++){const s=[];for(let i=0;i<t[r].length;i++){const o=ut(t[r][i],n);lt(e,o),s.push(o)}i.push(s)}return i}function vt(t,e,n){const i=[];for(let r=0;r<t.length;r++){const s=_t(t[r],e,n);i.push(s)}return i}function xt(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}lt(e,t)}function bt(t,e,n,i){const r=Math.pow(2,i.z)*at,s=[i.x*at,i.y*at],o=[];for(const a of t)for(const t of a){const i=[t.x+s[0],t.y+s[1]];xt(i,e,n,r),o.push(i)}return o}function wt(t,e,n,i){const r=Math.pow(2,i.z)*at,s=[i.x*at,i.y*at],o=[];for(const l of t){const t=[];for(const n of l){const i=[n.x+s[0],n.y+s[1]];lt(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of o)for(const i of t)xt(i,e,n,r)}var a;return o}class St{constructor(t,e){this.type=P,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(W(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const n=e.features[t].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new St(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new St(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new St(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const s=_t(e.coordinates,i,r),o=bt(t.geometry(),n,i,r);if(!ct(n,i))return!1;for(const t of o)if(!dt(t,s))return!1}if("MultiPolygon"===e.type){const s=vt(e.coordinates,i,r),o=bt(t.geometry(),n,i,r);if(!ct(n,i))return!1;for(const t of o)if(!pt(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const s=_t(e.coordinates,i,r),o=wt(t.geometry(),n,i,r);if(!ct(n,i))return!1;for(const t of o)if(!gt(t,s))return!1}if("MultiPolygon"===e.type){const s=vt(e.coordinates,i,r),o=wt(t.geometry(),n,i,r);if(!ct(n,i))return!1;for(const t of o)if(!yt(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Et(t){if(t instanceof st){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof St)return!1;let e=!0;return t.eachChild((t=>{e&&!Et(t)&&(e=!1)})),e}function Tt(t){if(t instanceof st&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Tt(t)&&(e=!1)})),e}function At(t,e){if(t instanceof st&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild((t=>{n&&!At(t,e)&&(n=!1)})),n}class kt{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new kt(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Pt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=i,this.errors=r,this.expectedType=n}parse(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)}_parse(t,e){function n(t,e,n){return"assert"===n?new J(e,[t]):"coerce"===n?new nt(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=t[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[i];if(r){let i=r.parse(t,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,r=i.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else i=n(i,t,e.typeAnnotation||"coerce");else i=n(i,t,e.typeAnnotation||"assert")}if(!(i instanceof X)&&"resolvedImage"!==i.type.kind&&It(i)){const e=new rt;try{i=new X(i.type,i.evaluate(e))}catch(t){return this.error(t.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new Pt(this.registry,i,e||null,r,this.errors)}error(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const r=`${this.key}${n.map((t=>`[${t}]`)).join("")}`;this.errors.push(new S(r,t))}checkSubtype(t,e){const n=F(t,e);return n&&this.error(n),n}}function It(t){if(t instanceof kt)return It(t.boundExpression);if(t instanceof st&&"error"===t.name)return!1;if(t instanceof ot)return!1;if(t instanceof St)return!1;const e=t instanceof nt||t instanceof J;let n=!0;return t.eachChild((t=>{n=e?n&&It(t):n&&t instanceof X})),!!n&&Et(t)&&At(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ct(t,e){const n=t.length-1;let i,r,s=0,o=n,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),i=t[a],r=t[a+1],i<=e){if(a===n||e<r)return a;s=a+1}else{if(!(i>e))throw new Y("Input is not a number.");o=a-1}return 0}class Mt{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,A);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let s=1;s<t.length;s+=2){const n=1===s?-1/0:t[s],o=t[s+1],a=s,l=s+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(o,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new Mt(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[Ct(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function zt(t,e,n){return t*(1-n)+e*n}var Lt=Object.freeze({__proto__:null,number:zt,color:function(t,e,n){return new b(zt(t.r,e.r,n),zt(t.g,e.g,n),zt(t.b,e.b,n),zt(t.a,e.a,n))},array:function(t,e,n){return t.map(((t,i)=>zt(t,e[i],n)))}});const Dt=.95047,Rt=1.08883,Bt=4/29,Ot=6/29,Ft=3*Ot*Ot,Vt=Math.PI/180,Nt=180/Math.PI;function Ut(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ft+Bt}function jt(t){return t>Ot?t*t*t:Ft*(t-Bt)}function Gt(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function qt(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $t(t){const e=qt(t.r),n=qt(t.g),i=qt(t.b),r=Ut((.4124564*e+.3575761*n+.1804375*i)/Dt),s=Ut((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*s-16,a:500*(r-s),b:200*(s-Ut((.0193339*e+.119192*n+.9503041*i)/Rt)),alpha:t.a}}function Wt(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*jt(e),n=Dt*jt(n),i=Rt*jt(i),new b(Gt(3.2404542*n-1.5371385*e-.4985314*i),Gt(-.969266*n+1.8760108*e+.041556*i),Gt(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function Zt(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Ht={forward:$t,reverse:Wt,interpolate:function(t,e,n){return{l:zt(t.l,e.l,n),a:zt(t.a,e.a,n),b:zt(t.b,e.b,n),alpha:zt(t.alpha,e.alpha,n)}}},Xt={forward:function(t){const{l:e,a:n,b:i}=$t(t),r=Math.atan2(i,n)*Nt;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Vt,n=t.c;return Wt({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Zt(t.h,e.h,n),c:zt(t.c,e.c,n),l:zt(t.l,e.l,n),alpha:zt(t.alpha,e.alpha,n)}}};var Yt=Object.freeze({__proto__:null,lab:Ht,hcl:Xt});class Kt{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[s,o]of r)this.labels.push(s),this.outputs.push(o)}static interpolationFactor(e,n,i,r){let s=0;if("exponential"===e.name)s=Jt(n,e.base,i,r);else if("linear"===e.name)s=Jt(n,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;s=new t(o[0],o[1],o[2],o[3]).solve(Jt(n,1,i,r))}return s}static parse(t,e){let[n,i,r,...s]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const t=i.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,A),!r)return null;const o=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=I:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let l=0;l<s.length;l+=2){const t=s[l],n=s[l+1],i=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=e.parse(n,r,a);if(!c)return null;a=a||c.type,o.push([t,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Kt(a,n,i,r,o):e.error(`Type ${B(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const s=Ct(e,i),o=Kt.interpolationFactor(this.interpolation,i,e[s],e[s+1]),a=n[s].evaluate(t),l=n[s+1].evaluate(t);return"interpolate"===this.operator?Lt[this.type.kind.toLowerCase()](a,l,o):"interpolate-hcl"===this.operator?Xt.reverse(Xt.interpolate(Xt.forward(a),Xt.forward(l),o)):Ht.reverse(Ht.interpolate(Ht.forward(a),Ht.forward(l),o))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e}}function Jt(t,e,n,i){const r=i-n,s=t-n;return 0===r?0:1===e?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}class Qt{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const o of t.slice(1)){const t=e.parse(o,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}const s=i&&r.some((t=>F(i,t.type)));return new Qt(s?M:n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(t),n&&n instanceof q&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class te{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const s=e.parse(t[r+1],r+1);if(!s)return null;n.push([i,s])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new te(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}}class ee{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,A),i=e.parse(t[2],2,R(e.expectedType||M));return n&&i?new ee(i.type.itemType,n,i):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new Y(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new Y(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new Y(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ne{constructor(t,e){this.type=P,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,M),i=e.parse(t[2],2,M);return n&&i?V(n.type,[P,k,A,T,M])?new ne(n,i):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${B(n.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!N(e,["boolean","string","number","null"]))throw new Y(`Expected first argument to be of type boolean, string, number or null, but found ${B(Z(e))} instead.`);if(!N(n,["string","array"]))throw new Y(`Expected second argument to be of type array or string, but found ${B(Z(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ie{constructor(t,e,n){this.type=A,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,M),i=e.parse(t[2],2,M);if(!n||!i)return null;if(!V(n.type,[P,k,A,T,M]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${B(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,A);return r?new ie(n,i,r):null}return new ie(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!N(e,["boolean","string","number","null"]))throw new Y(`Expected first argument to be of type boolean, string, number or null, but found ${B(Z(e))} instead.`);if(!N(n,["string","array"]))throw new Y(`Expected second argument to be of type array or string, but found ${B(Z(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(t);return n.indexOf(e,i)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class re{constructor(t,e,n,i,r,s){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=s}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},s=[];for(let l=2;l<t.length-1;l+=2){let o=t[l];const a=t[l+1];Array.isArray(o)||(o=[o]);const c=e.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Z(t)))return null}else n=Z(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=s.length}const u=e.parse(a,l,i);if(!u)return null;i=i||u.type,s.push(u)}const o=e.parse(t[1],1,M);if(!o)return null;const a=e.parse(t[t.length-1],t.length-1,i);return a?"value"!==o.type.kind&&e.concat(1).checkSubtype(n,o.type)?null:new re(n,i,o,r,s,a):null}evaluate(t){const e=this.input.evaluate(t);return(Z(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],i={};for(const s of e){const t=i[this.cases[s]];void 0===t?(i[this.cases[s]]=n.length,n.push([this.cases[s],[s]])):n[t][1].push(s)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[s,o]of n)t.push(1===o.length?r(o[0]):o.map(r)),t.push(this.outputs[s].serialize());return t.push(this.otherwise.serialize()),t}}class se{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let s=1;s<t.length-1;s+=2){const r=e.parse(t[s],s,P);if(!r)return null;const o=e.parse(t[s+1],s+1,n);if(!o)return null;i.push([r,o]),n=n||o.type}const r=e.parse(t[t.length-1],t.length-1,n);return r?new se(n,i,r):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every((t=>{let[e,n]=t;return n.outputDefined()}))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class oe{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,M),i=e.parse(t[2],2,A);if(!n||!i)return null;if(!V(n.type,[R(M),k,M]))return e.error(`Expected first argument to be of type array or string, but found ${B(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,A);return r?new oe(n.type,n,i,r):null}return new oe(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!N(e,["string","array"]))throw new Y(`Expected first argument to be of type array or string, but found ${B(Z(e))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(t);return e.slice(n,i)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ae(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function le(t,e,n,i){return 0===i.compare(e,n)}function ce(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=P,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let s=e.parse(t[1],1,M);if(!s)return null;if(!ae(n,s.type))return e.concat(1).error(`"${n}" comparisons are not supported for type '${B(s.type)}'.`);let o=e.parse(t[2],2,M);if(!o)return null;if(!ae(n,o.type))return e.concat(2).error(`"${n}" comparisons are not supported for type '${B(o.type)}'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error(`Cannot compare types '${B(s.type)}' and '${B(o.type)}'.`);i&&("value"===s.type.kind&&"value"!==o.type.kind?s=new J(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new J(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,z),!a)return null}return new r(s,o,a)}evaluate(r){const s=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=Z(s),n=Z(o);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new Y(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const t=Z(s),n=Z(o);if("string"!==t.kind||"string"!==n.kind)return e(r,s,o)}return this.collator?n(r,s,o,this.collator.evaluate(r)):e(r,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const ue=ce("==",(function(t,e,n){return e===n}),le),he=ce("!=",(function(t,e,n){return e!==n}),(function(t,e,n,i){return!le(0,e,n,i)})),de=ce("<",(function(t,e,n){return e<n}),(function(t,e,n,i){return i.compare(e,n)<0})),pe=ce(">",(function(t,e,n){return e>n}),(function(t,e,n,i){return i.compare(e,n)>0})),fe=ce("<=",(function(t,e,n){return e<=n}),(function(t,e,n,i){return i.compare(e,n)<=0})),me=ce(">=",(function(t,e,n){return e>=n}),(function(t,e,n,i){return i.compare(e,n)>=0}));class ge{constructor(t,e,n,i,r){this.type=k,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,A);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,k),!r))return null;let s=null;if(i.currency&&(s=e.parse(i.currency,1,k),!s))return null;let o=null;if(i["min-fraction-digits"]&&(o=e.parse(i["min-fraction-digits"],1,A),!o))return null;let a=null;return i["max-fraction-digits"]&&(a=e.parse(i["max-fraction-digits"],1,A),!a)?null:new ge(n,r,s,o,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class ye{constructor(t){this.type=A,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error(`Expected argument of type string or array, but found ${B(n.type)} instead.`):new ye(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Y(`Expected value to be of type string or array, but found ${B(Z(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}const _e={"==":ue,"!=":he,">":pe,"<":de,">=":me,"<=":fe,array:J,at:ee,boolean:J,case:se,coalesce:Qt,collator:ot,format:Q,image:tt,in:ne,"index-of":ie,interpolate:Kt,"interpolate-hcl":Kt,"interpolate-lab":Kt,length:ye,let:te,literal:X,match:re,number:J,"number-format":ge,object:J,slice:oe,step:Mt,string:J,"to-boolean":nt,"to-color":nt,"to-number":nt,"to-string":nt,var:kt,within:St};function ve(t,e){let[n,i,r,s]=e;n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=s?s.evaluate(t):1,a=$(n,i,r,o);if(a)throw new Y(a);return new b(n/255*o,i/255*o,r/255*o,o)}function xe(t,e){return t in e}function be(t,e){const n=e[t];return void 0===n?null:n}function we(t){return{type:t}}function Se(t){return{result:"success",value:t}}function Ee(t){return{result:"error",value:t}}function Te(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Ae(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function ke(t){return!!t.expression&&t.expression.interpolated}function Pe(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Ie(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ce(t){return t}function Me(t,e){const n="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],r=i||!(i||void 0!==t.property),s=t.type||(ke(e)?"exponential":"interval");if(n&&((t=w({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],b.parse(t[1])]))),t.default=b.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Yt[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let o,a,l;if("exponential"===s)o=Re;else if("interval"===s)o=De;else if("categorical"===s){o=Le,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);o=Be}if(i){const n={},i=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],s=r[0].zoom;void 0===n[s]&&(n[s]={zoom:s,type:t.type,property:t.property,default:t.default,stops:[]},i.push(s)),n[s].stops.push([r[0].value,r[1]])}const r=[];for(const t of i)r.push([n[t].zoom,Me(n[t],e)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:Kt.interpolationFactor.bind(void 0,s),zoomStops:r.map((t=>t[0])),evaluate:(n,i)=>{let{zoom:s}=n;return Re({stops:r,base:t.base},e,s).evaluate(s,i)}}}if(r){const n="exponential"===s?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:Kt.interpolationFactor.bind(void 0,n),zoomStops:t.stops.map((t=>t[0])),evaluate:n=>{let{zoom:i}=n;return o(t,e,i,a,l)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[t.property]:void 0;return void 0===r?ze(t.default,e.default):o(t,e,r,a,l)}}}function ze(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Le(t,e,n,i,r){return ze(typeof n===r?i[n]:void 0,t.default,e.default)}function De(t,e,n){if("number"!==Pe(n))return ze(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const r=Ct(t.stops.map((t=>t[0])),n);return t.stops[r][1]}function Re(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==Pe(n))return ze(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const s=Ct(t.stops.map((t=>t[0])),n),o=function(t,e,n,i){const r=i-n,s=t-n;return 0===r?0:1===e?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[s][0],t.stops[s+1][0]),a=t.stops[s][1],l=t.stops[s+1][1];let c=Lt[e.type]||Ce;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Yt[t.colorSpace];c=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),o))}return"function"==typeof a.evaluate?{evaluate(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=a.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==r)return c(i,r,o)}}:c(a,l,o)}function Be(t,e,n){return"color"===e.type?n=b.parse(n):"formatted"===e.type?n=G.fromString(n.toString()):"resolvedImage"===e.type?n=q.fromString(n.toString()):Pe(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),ze(n,t.default,e.default)}st.register(_e,{error:[{kind:"error"},[k],(t,e)=>{let[n]=e;throw new Y(n.evaluate(t))}],typeof:[k,[M],(t,e)=>{let[n]=e;return B(Z(n.evaluate(t)))}],"to-rgba":[R(A,4),[I],(t,e)=>{let[n]=e;return n.evaluate(t).toArray()}],rgb:[I,[A,A,A],ve],rgba:[I,[A,A,A,A],ve],has:{type:P,overloads:[[[k],(t,e)=>{let[n]=e;return xe(n.evaluate(t),t.properties())}],[[k,C],(t,e)=>{let[n,i]=e;return xe(n.evaluate(t),i.evaluate(t))}]]},get:{type:M,overloads:[[[k],(t,e)=>{let[n]=e;return be(n.evaluate(t),t.properties())}],[[k,C],(t,e)=>{let[n,i]=e;return be(n.evaluate(t),i.evaluate(t))}]]},"feature-state":[M,[k],(t,e)=>{let[n]=e;return be(n.evaluate(t),t.featureState||{})}],properties:[C,[],t=>t.properties()],"geometry-type":[k,[],t=>t.geometryType()],id:[M,[],t=>t.id()],zoom:[A,[],t=>t.globals.zoom],"heatmap-density":[A,[],t=>t.globals.heatmapDensity||0],"line-progress":[A,[],t=>t.globals.lineProgress||0],accumulated:[M,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[A,we(A),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[A,we(A),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:A,overloads:[[[A,A],(t,e)=>{let[n,i]=e;return n.evaluate(t)-i.evaluate(t)}],[[A],(t,e)=>{let[n]=e;return-n.evaluate(t)}]]},"/":[A,[A,A],(t,e)=>{let[n,i]=e;return n.evaluate(t)/i.evaluate(t)}],"%":[A,[A,A],(t,e)=>{let[n,i]=e;return n.evaluate(t)%i.evaluate(t)}],ln2:[A,[],()=>Math.LN2],pi:[A,[],()=>Math.PI],e:[A,[],()=>Math.E],"^":[A,[A,A],(t,e)=>{let[n,i]=e;return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[A,[A],(t,e)=>{let[n]=e;return Math.sqrt(n.evaluate(t))}],log10:[A,[A],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN10}],ln:[A,[A],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))}],log2:[A,[A],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN2}],sin:[A,[A],(t,e)=>{let[n]=e;return Math.sin(n.evaluate(t))}],cos:[A,[A],(t,e)=>{let[n]=e;return Math.cos(n.evaluate(t))}],tan:[A,[A],(t,e)=>{let[n]=e;return Math.tan(n.evaluate(t))}],asin:[A,[A],(t,e)=>{let[n]=e;return Math.asin(n.evaluate(t))}],acos:[A,[A],(t,e)=>{let[n]=e;return Math.acos(n.evaluate(t))}],atan:[A,[A],(t,e)=>{let[n]=e;return Math.atan(n.evaluate(t))}],min:[A,we(A),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[A,we(A),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[A,[A],(t,e)=>{let[n]=e;return Math.abs(n.evaluate(t))}],round:[A,[A],(t,e)=>{let[n]=e;const i=n.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[A,[A],(t,e)=>{let[n]=e;return Math.floor(n.evaluate(t))}],ceil:[A,[A],(t,e)=>{let[n]=e;return Math.ceil(n.evaluate(t))}],"filter-==":[P,[k,M],(t,e)=>{let[n,i]=e;return t.properties()[n.value]===i.value}],"filter-id-==":[P,[M],(t,e)=>{let[n]=e;return t.id()===n.value}],"filter-type-==":[P,[k],(t,e)=>{let[n]=e;return t.geometryType()===n.value}],"filter-<":[P,[k,M],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],s=i.value;return typeof r==typeof s&&r<s}],"filter-id-<":[P,[M],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[P,[k,M],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],s=i.value;return typeof r==typeof s&&r>s}],"filter-id->":[P,[M],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[P,[k,M],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],s=i.value;return typeof r==typeof s&&r<=s}],"filter-id-<=":[P,[M],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[P,[k,M],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],s=i.value;return typeof r==typeof s&&r>=s}],"filter-id->=":[P,[M],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[P,[M],(t,e)=>{let[n]=e;return n.value in t.properties()}],"filter-has-id":[P,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[P,[R(k)],(t,e)=>{let[n]=e;return n.value.indexOf(t.geometryType())>=0}],"filter-id-in":[P,[R(M)],(t,e)=>{let[n]=e;return n.value.indexOf(t.id())>=0}],"filter-in-small":[P,[k,R(M)],(t,e)=>{let[n,i]=e;return i.value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[P,[k,R(M)],(t,e)=>{let[n,i]=e;return function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:P,overloads:[[[P,P],(t,e)=>{let[n,i]=e;return n.evaluate(t)&&i.evaluate(t)}],[we(P),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:P,overloads:[[[P,P],(t,e)=>{let[n,i]=e;return n.evaluate(t)||i.evaluate(t)}],[we(P),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[P,[P],(t,e)=>{let[n]=e;return!n.evaluate(t)}],"is-supported-script":[P,[k],(t,e)=>{let[n]=e;const i=t.globals&&t.globals.isSupportedScript;return!i||i(n.evaluate(t))}],upcase:[k,[k],(t,e)=>{let[n]=e;return n.evaluate(t).toUpperCase()}],downcase:[k,[k],(t,e)=>{let[n]=e;return n.evaluate(t).toLowerCase()}],concat:[k,we(M),(t,e)=>e.map((e=>H(e.evaluate(t)))).join("")],"resolved-locale":[k,[z],(t,e)=>{let[n]=e;return n.evaluate(t).resolvedLocale()}]});class Oe{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new rt,this._defaultValue=e?function(t){return"color"===t.type&&Ie(t.default)?new b(0,0,0,0):"color"===t.type?b.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,s){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,i,r,s){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Y(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Fe(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in _e}function Ve(t,e){const n=new Pt(_e,[],e?function(t){const e={color:I,string:k,number:A,enum:k,boolean:P,formatted:L,resolvedImage:D};return"array"===t.type?R(e[t.value]||M,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?Se(new Oe(i,e)):Ee(n.errors)}class Ne{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Tt(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,s)}evaluate(t,e,n,i,r,s){return this._styleExpression.evaluate(t,e,n,i,r,s)}}class Ue{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Tt(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,s)}evaluate(t,e,n,i,r,s){return this._styleExpression.evaluate(t,e,n,i,r,s)}interpolationFactor(t,e,n){return this.interpolationType?Kt.interpolationFactor(this.interpolationType,t,e,n):0}}function je(t,e){const n=Ve(t,e);if("error"===n.result)return n;const i=n.value.expression,r=Et(i);if(!r&&!Te(e))return Ee([new S("","data expressions not supported")]);const s=At(i,["zoom"]);if(!s&&!Ae(e))return Ee([new S("","zoom expressions not supported")]);const o=qe(i);return o||s?o instanceof S?Ee([o]):o instanceof Kt&&!ke(e)?Ee([new S("",'"interpolate" expressions cannot be used with this property')]):Se(o?new Ue(r?"camera":"composite",n.value,o.labels,o instanceof Kt?o.interpolation:void 0):new Ne(r?"constant":"source",n.value)):Ee([new S("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ge{constructor(t,e){this._parameters=t,this._specification=e,w(this,Me(this._parameters,this._specification))}static deserialize(t){return new Ge(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function qe(t){let e=null;if(t instanceof te)e=qe(t.result);else if(t instanceof Qt){for(const n of t.args)if(e=qe(n),e)break}else(t instanceof Mt||t instanceof Kt)&&t.input instanceof st&&"zoom"===t.input.name&&(e=t);return e instanceof S||t.eachChild((t=>{const n=qe(t);n instanceof S?e=n:!e&&n?e=new S("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new S("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}const $e={};let We;function Ze(){"undefined"==typeof caches||We||(We=caches.open("mapbox-tiles"))}const He={supported:!1,testSupport:function(t){!Ke&&Ye&&(Je?Qe(t):Xe=t)}};let Xe,Ye,Ke=!1,Je=!1;function Qe(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ye),t.isContextLost())return;He.supported=!0}catch(t){}t.deleteTexture(e),Ke=!0}"undefined"!=typeof document&&(Ye=document.createElement("img"),Ye.onload=function(){Xe&&Qe(Xe),Xe=null,Je=!0},Ye.onerror=function(){Ke=!0,Xe=null},Ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),"function"==typeof Object.freeze&&Object.freeze({Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"});class tn extends Error{constructor(t,e,n,i){super(`AJAXError: ${e} (${t}): ${n}`),this.status=t,this.statusText=e,this.url=n,this.body=i}}const en=u()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function nn(t,e){const n=new AbortController,i=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:en(),signal:n.signal});let r=!1,s=!1;return"json"===t.type&&i.headers.set("Accept","application/json"),((n,o,a)=>{if(s)return;Date.now();fetch(i).then((n=>n.ok?((n,i,o)=>{("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((t=>{s||(r=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((t=>{s||e(new Error(t.message))}))})(n):n.blob().then((i=>e(new tn(n.status,n.statusText,t.url,i)))))).catch((t=>{20!==t.code&&e(new Error(t.message))}))})(),{cancel:()=>{s=!0,r||n.abort()}}}const rn=function(t,e){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){if(u()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e);if(!u()){const n=t.url.substring(0,t.url.indexOf("://"));return($e[n]||nn)(t,e)}}if(!(/^file:/.test(n=t.url)||/^file:/.test(en())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return nn(t,e);if(u()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){const n=new XMLHttpRequest;n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer");for(const i in t.headers)n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=()=>{e(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else{const i=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});e(new tn(n.status,n.statusText,t.url,i))}},n.send(t.body),{cancel:()=>n.abort()}}(t,e)},sn={};function on(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),sn[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}on("Object",Object),on("TransferableGridIndex",f),on("Color",b),on("Error",Error),on("AJAXError",tn),on("ResolvedImage",q),on("StylePropertyFunction",Ge),on("StyleExpression",Oe,{omit:["_evaluator"]}),on("ZoomDependentExpression",Ue),on("ZoomConstantExpression",Ne),on("CompoundExpression",st,{omit:["_evaluate"]});for(const bh in _e)_e[bh]._classRegistryKey||on(`Expression_${bh}`,_e[bh]);function an(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ln(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob)return t;if(an(t))return e&&e.push(t),t;if(p(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(ln(i,e));return n}if("object"==typeof t){const n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class");const r=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const n in t){if(!t.hasOwnProperty(n))continue;if(sn[i].omit.indexOf(n)>=0)continue;const s=t[n];r[n]=sn[i].shallow.indexOf(n)>=0?s:ln(s,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof t)}function cn(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||an(t)||p(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(cn);if("object"==typeof t){const e=t.$name||"Object";if(!sn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=sn[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const r of Object.keys(t)){if("$name"===r)continue;const n=t[r];i[r]=sn[e].shallow.indexOf(r)>=0?n:cn(n)}return i}throw new Error("can't deserialize object of type "+typeof t)}class un{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}class hn{constructor(t,e,n){var i;this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},i=this,["receive","process"].forEach((t=>{i[t]&&(i[t]=i[t].bind(i))})),this.invoker=new un(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=u()?t:window}send(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[s]=n);const o=d(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:ln(e,o)},o),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];const t=this.cancelCallbacks[n];delete this.cancelCallbacks[n],t&&t()}else u()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)}process(){if(!this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(cn(e.error)):n(null,cn(e.data)))}else{let n=!1;const i=d(this.globalScope)?void 0:[],r=e.hasCallback?(e,r)=>{n=!0,delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?ln(e):null,data:ln(r,i)},i)}:t=>{n=!0};let s=null;const o=cn(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,o,r);else if(this.parent.getWorkerSource){const t=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,t[0],o.source)[t[1]](o,r)}else r(new Error(`Could not find function ${e.type}`));!n&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}}var dn={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class pn{constructor(t,e,n,i){this.message=(t?`${t}: `:"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function fn(t){const e=t.value;return e?[new pn(t.key,e,"constants have been deprecated as of v8")]:[]}function mn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function gn(t){if(Array.isArray(t))return t.map(gn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=gn(t[n]);return e}return mn(t)}function yn(t){const e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},s=t.style,o=t.styleSpec;let a=[];const l=Pe(n);if("object"!==l)return[new pn(e,n,`object expected, ${l} found`)];for(const c in n){const t=c.split(".")[0],l=i[t]||i["*"];let u;if(r[t])u=r[t];else if(i[t])u=qn;else if(r["*"])u=r["*"];else{if(!i["*"]){a.push(new pn(e,n[c],`unknown property "${c}"`));continue}u=qn}a=a.concat(u({key:(e?`${e}.`:e)+c,value:n[c],valueSpec:l,style:s,styleSpec:o,object:n,objectKey:c},n))}for(const c in i)r[c]||i[c].required&&void 0===i[c].default&&void 0===n[c]&&a.push(new pn(e,n,`missing required property "${c}"`));return a}function _n(t){const e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,s=t.key,o=t.arrayElementValidator||qn;if("array"!==Pe(e))return[new pn(s,e,`array expected, ${Pe(e)} found`)];if(n.length&&e.length!==n.length)return[new pn(s,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new pn(s,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let a={type:n.value,values:n.values};r.$version<7&&(a.function=n.function),"object"===Pe(n.value)&&(a=n.value);let l=[];for(let c=0;c<e.length;c++)l=l.concat(o({array:e,arrayIndex:c,value:e[c],valueSpec:a,style:i,styleSpec:r,key:`${s}[${c}]`}));return l}function vn(t){const e=t.key,n=t.value,i=t.valueSpec;let r=Pe(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new pn(e,n,`number expected, ${r} found`)]:"minimum"in i&&n<i.minimum?[new pn(e,n,`${n} is less than the minimum value ${i.minimum}`)]:"maximum"in i&&n>i.maximum?[new pn(e,n,`${n} is greater than the maximum value ${i.maximum}`)]:[]}function xn(t){const e=t.valueSpec,n=mn(t.value.type);let i,r,s,o={};const a="categorical"!==n&&void 0===t.value.property,l=!a,c="array"===Pe(t.value.stops)&&"array"===Pe(t.value.stops[0])&&"object"===Pe(t.value.stops[0][0]),u=yn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new pn(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const i=t.value;return e=e.concat(_n({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Pe(i)&&0===i.length&&e.push(new pn(t.key,i,"array must have at least one stop")),e},default:function(t){return qn({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&a&&u.push(new pn(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||u.push(new pn(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!ke(t.valueSpec)&&u.push(new pn(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Te(t.valueSpec)?u.push(new pn(t.key,t.value,"property functions not supported")):a&&!Ae(t.valueSpec)&&u.push(new pn(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==t.value.property||u.push(new pn(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const i=t.value,a=t.key;if("array"!==Pe(i))return[new pn(a,i,`array expected, ${Pe(i)} found`)];if(2!==i.length)return[new pn(a,i,`array length 2 expected, length ${i.length} found`)];if(c){if("object"!==Pe(i[0]))return[new pn(a,i,`object expected, ${Pe(i[0])} found`)];if(void 0===i[0].zoom)return[new pn(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new pn(a,i,"object stop key must have value")];if(s&&s>mn(i[0].zoom))return[new pn(a,i[0].zoom,"stop zoom values must appear in ascending order")];mn(i[0].zoom)!==s&&(s=mn(i[0].zoom),r=void 0,o={}),n=n.concat(yn({key:`${a}[0]`,value:i[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:vn,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:i[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},i));return Fe(gn(i[1]))?n.concat([new pn(`${a}[1]`,i[1],"expressions are not allowed in function stops.")]):n.concat(qn({key:`${a}[1]`,value:i[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function d(t,s){const a=Pe(t.value),l=mn(t.value),c=null!==t.value?t.value:s;if(i){if(a!==i)return[new pn(t.key,c,`${a} stop domain type must match previous stop domain type ${i}`)]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new pn(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i=`number expected, ${a} found`;return Te(e)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pn(t.key,c,i)]}return"categorical"!==n||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&void 0!==r&&l<r?[new pn(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in o?[new pn(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new pn(t.key,c,`integer expected, found ${l}`)]}}function bn(t){const e=("property"===t.expressionContext?je:Ve)(gn(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new pn(`${t.key}${e.key}`,t.value,e.message)));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new pn(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Tt(n))return[new pn(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Tt(n))return[new pn(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!At(n,["zoom","feature-state"]))return[new pn(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Et(n))return[new pn(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wn(t){const e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(mn(n))&&r.push(new pn(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(mn(n))&&r.push(new pn(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function Sn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Sn(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const En={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tn(t){if(null==t)return{filter:()=>!0,needGeometry:!1};Sn(t)||(t=Pn(t));const e=Ve(t,En);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,n,i)=>e.value.evaluate(t,n,{},i),needGeometry:kn(t)}}function An(t,e){return t<e?-1:t>e?1:0}function kn(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(kn(t[e]))return!0;return!1}function Pn(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?In(t[1],t[2],"=="):"!="===e?zn(In(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?In(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Pn))):"all"===e?["all"].concat(t.slice(1).map(Pn)):"none"===e?["all"].concat(t.slice(1).map(Pn).map(zn)):"in"===e?Cn(t[1],t.slice(2)):"!in"===e?zn(Cn(t[1],t.slice(2))):"has"===e?Mn(t[1]):"!has"===e?zn(Mn(t[1])):"within"!==e||t;var n}function In(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Cn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(An)]]:["filter-in-small",t,["literal",e]]}}function Mn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function zn(t){return["!",t]}function Ln(t){return Sn(gn(t.value))?bn(w({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Dn(t)}function Dn(t){const e=t.value,n=t.key;if("array"!==Pe(e))return[new pn(n,e,`array expected, ${Pe(e)} found`)];const i=t.styleSpec;let r,s=[];if(e.length<1)return[new pn(n,e,"filter array must have at least 1 element")];switch(s=s.concat(wn({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),mn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===mn(e[1])&&s.push(new pn(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&s.push(new pn(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=Pe(e[1]),"string"!==r&&s.push(new pn(`${n}[1]`,e[1],`string expected, ${r} found`)));for(let o=2;o<e.length;o++)r=Pe(e[o]),"$type"===mn(e[1])?s=s.concat(wn({key:`${n}[${o}]`,value:e[o],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&s.push(new pn(`${n}[${o}]`,e[o],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let i=1;i<e.length;i++)s=s.concat(Dn({key:`${n}[${i}]`,value:e[i],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=Pe(e[1]),2!==e.length?s.push(new pn(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&s.push(new pn(`${n}[1]`,e[1],`string expected, ${r} found`));break;case"within":r=Pe(e[1]),2!==e.length?s.push(new pn(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==r&&s.push(new pn(`${n}[1]`,e[1],`object expected, ${r} found`))}return s}function Rn(t,e){const n=t.key,i=t.style,r=t.styleSpec,s=t.value,o=t.objectKey,a=r[`${e}_${t.layerType}`];if(!a)return[];const l=o.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return qn({key:n,value:s,valueSpec:r.transition,style:i,styleSpec:r});const c=t.valueSpec||a[o];if(!c)return[new pn(n,s,`unknown property "${o}"`)];let u;if("string"===Pe(s)&&Te(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(s)))return[new pn(n,s,`"${o}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new pn(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Ie(gn(s))&&"identity"===mn(s.type)&&h.push(new pn(n,s,'"text-font" does not support identity functions'))),h.concat(qn({key:t.key,value:s,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:o}))}function Bn(t){return Rn(t,"paint")}function On(t){return Rn(t,"layout")}function Fn(t){let e=[];const n=t.value,i=t.key,r=t.style,s=t.styleSpec;n.type||n.ref||e.push(new pn(i,n,'either "type" or "ref" is required'));let o=mn(n.type);const a=mn(n.ref);if(n.id){const s=mn(n.id);for(let o=0;o<t.arrayIndex;o++){const t=r.layers[o];mn(t.id)===s&&e.push(new pn(i,n.id,`duplicate layer id "${n.id}", previously used at line ${t.id.__line__}`))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in n&&e.push(new pn(i,n[t],`"${t}" is prohibited for ref layers`))})),r.layers.forEach((e=>{mn(e.id)===a&&(t=e)})),t?t.ref?e.push(new pn(i,n.ref,"ref cannot reference another ref layer")):o=mn(t.type):e.push(new pn(i,n.ref,`ref layer "${a}" not found`))}else if("background"!==o)if(n.source){const t=r.sources&&r.sources[n.source],s=t&&mn(t.type);t?"vector"===s&&"raster"===o?e.push(new pn(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===s&&"raster"!==o?e.push(new pn(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==s||n["source-layer"]?"raster-dem"===s&&"hillshade"!==o?e.push(new pn(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!n.paint||!n.paint["line-gradient"]||"geojson"===s&&t.lineMetrics||e.push(new pn(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new pn(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new pn(i,n.source,`source "${n.source}" not found`))}else e.push(new pn(i,n,'missing required property "source"'));return e=e.concat(yn({key:i,value:n,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qn({key:`${i}.type`,value:n.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:Ln,layout:t=>yn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>On(w({layerType:o},t))}}),paint:t=>yn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Bn(w({layerType:o},t))}})}})),e}function Vn(t){const e=t.value,n=t.key,i=Pe(e);return"string"!==i?[new pn(n,e,`string expected, ${i} found`)]:[]}const Nn={promoteId:function(t){let{key:e,value:n}=t;if("string"===Pe(n))return Vn({key:e,value:n});{const t=[];for(const i in n)t.push(...Vn({key:`${e}.${i}`,value:n[i]}));return t}}};function Un(t){const e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new pn(n,e,'"type" is required')];const s=mn(e.type);let o;switch(s){case"vector":case"raster":case"raster-dem":return o=yn({key:n,value:e,valueSpec:i[`source_${s.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:Nn}),o;case"geojson":if(o=yn({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:Nn}),e.cluster)for(const t in e.clusterProperties){const[i,r]=e.clusterProperties[t],s="string"==typeof i?[i,["accumulated"],["get",t]]:i;o.push(...bn({key:`${n}.${t}.map`,value:r,expressionContext:"cluster-map"})),o.push(...bn({key:`${n}.${t}.reduce`,value:s,expressionContext:"cluster-reduce"}))}return o;case"video":return yn({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return yn({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new pn(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wn({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function jn(t){const e=t.value,n=t.styleSpec,i=n.light,r=t.style;let s=[];const o=Pe(e);if(void 0===e)return s;if("object"!==o)return s=s.concat([new pn("light",e,`object expected, ${o} found`)]),s;for(const a in e){const t=a.match(/^(.*)-transition$/);s=s.concat(t&&i[t[1]]&&i[t[1]].transition?qn({key:a,value:e[a],valueSpec:n.transition,style:r,styleSpec:n}):i[a]?qn({key:a,value:e[a],valueSpec:i[a],style:r,styleSpec:n}):[new pn(a,e[a],`unknown property "${a}"`)])}return s}const Gn={"*":()=>[],array:_n,boolean:function(t){const e=t.value,n=t.key,i=Pe(e);return"boolean"!==i?[new pn(n,e,`boolean expected, ${i} found`)]:[]},number:vn,color:function(t){const e=t.key,n=t.value,i=Pe(n);return"string"!==i?[new pn(e,n,`color expected, ${i} found`)]:null===m(n)?[new pn(e,n,`color expected, "${n}" found`)]:[]},constants:fn,enum:wn,filter:Ln,function:xn,layer:Fn,object:yn,source:Un,light:jn,string:Vn,formatted:function(t){return 0===Vn(t).length?[]:bn(t)},resolvedImage:function(t){return 0===Vn(t).length?[]:bn(t)}};function qn(t){const e=t.value,n=t.valueSpec,i=t.styleSpec;return n.expression&&Ie(mn(e))?xn(t):n.expression&&Fe(gn(e))?bn(t):n.type&&Gn[n.type]?Gn[n.type](t):yn(w({},t,{valueSpec:n.type?i[n.type]:n}))}function $n(t){const e=t.value,n=t.key,i=Vn(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new pn(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new pn(n,e,'"glyphs" url must include a "{range}" token'))),i}function Wn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dn,n=[];return n=n.concat(qn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:$n,"*":()=>[]}})),t.constants&&(n=n.concat(fn({key:"constants",value:t.constants,style:t,styleSpec:e}))),Zn(n)}function Zn(t){return[].concat(t).sort(((t,e)=>t.line-e.line))}function Hn(t){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Zn(t.apply(this,n))}}function Xn(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Yn(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}Wn.source=Hn(Un),Wn.light=Hn(jn),Wn.layer=Hn(Fn),Wn.filter=Hn(Ln),Wn.paintProperty=Hn(Bn),Wn.layoutProperty=Hn(On);class Kn{constructor(t){i(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=t}}class Jn extends Kn{constructor(t){super("error",i({error:t},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}const Qn=Wn,ti=Qn.paintProperty,ei=Qn.layoutProperty;class ni{constructor(){this.first=!0}update(t,e){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const ii=t=>t>=1536&&t<=1791,ri=t=>t>=1872&&t<=1919,si=t=>t>=2208&&t<=2303,oi=t=>t>=11904&&t<=12031,ai=t=>t>=12032&&t<=12255,li=t=>t>=12272&&t<=12287,ci=t=>t>=12288&&t<=12351,ui=t=>t>=12352&&t<=12447,hi=t=>t>=12448&&t<=12543,di=t=>t>=12544&&t<=12591,pi=t=>t>=12704&&t<=12735,fi=t=>t>=12736&&t<=12783,mi=t=>t>=12784&&t<=12799,gi=t=>t>=12800&&t<=13055,yi=t=>t>=13056&&t<=13311,_i=t=>t>=13312&&t<=19903,vi=t=>t>=19968&&t<=40959,xi=t=>t>=40960&&t<=42127,bi=t=>t>=42128&&t<=42191,wi=t=>t>=63744&&t<=64255,Si=t=>t>=64336&&t<=65023,Ei=t=>t>=65040&&t<=65055,Ti=t=>t>=65072&&t<=65103,Ai=t=>t>=65104&&t<=65135,ki=t=>t>=65136&&t<=65279,Pi=t=>t>=65280&&t<=65519;function Ii(t){for(const e of t)if(zi(e.charCodeAt(0)))return!0;return!1}function Ci(t){for(const e of t)if(!Mi(e.charCodeAt(0)))return!1;return!0}function Mi(t){return!(ii(t)||ri(t)||si(t)||Si(t)||ki(t))}function zi(t){return!(746!==t&&747!==t&&(t<4352||!(pi(t)||di(t)||Ti(t)&&!(t>=65097&&t<=65103)||wi(t)||yi(t)||oi(t)||fi(t)||!(!ci(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||_i(t)||vi(t)||gi(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||(t=>t>=44032&&t<=55215)(t)||ui(t)||li(t)||(t=>t>=12688&&t<=12703)(t)||ai(t)||mi(t)||hi(t)&&12540!==t||!(!Pi(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ai(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Ei(t)||(t=>t>=19904&&t<=19967)(t)||xi(t)||bi(t))))}function Li(t){return!(zi(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ci(t)||hi(t)||(t=>t>=57344&&t<=63743)(t)||Ti(t)||Ai(t)||Pi(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Di(t){return t>=1424&&t<=2303||Si(t)||ki(t)}function Ri(t,e){return!(!e&&Di(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(t=>t>=6016&&t<=6143)(t))}function Bi(t){for(const e of t)if(Di(e.charCodeAt(0)))return!0;return!1}"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date);let Oi="unavailable",Fi=null;const Vi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>"loaded"===Oi||null!=Vi.applyArabicShaping,isLoading:()=>"loading"===Oi,setState(t){Oi=t.pluginStatus,Fi=t.pluginURL},isParsed:()=>null!=Vi.applyArabicShaping&&null!=Vi.processBidirectionalText&&null!=Vi.processStyledBidirectionalText,getPluginURL:()=>Fi};class Ni{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ni,this.transition={})}isSupportedScript(t){return function(t,e){for(const n of t)if(!Ri(n.charCodeAt(0),e))return!1;return!0}(t,Vi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}}}class Ui{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Ie(t))return new Ge(t,e);if(Fe(t)){const n=je(t,e);if("error"===n.result)throw new Error(n.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=b.parse(t)),{kind:"constant",evaluate:()=>n}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)}}class ji{constructor(t){this.property=t,this.value=new Ui(t,void 0)}transitioned(t,e){return new qi(this.property,this.value,e,i({},t.transition,this.transition),t.now)}untransitioned(){return new qi(this.property,this.value,null,{},0)}}class Gi{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return s(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ji(this._values[t].property)),this._values[t].value=new Ui(this._values[t].property,null===e?void 0:s(e))}getTransition(t){return s(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ji(this._values[t].property)),this._values[t].transition=s(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n);const i=this.getTransition(e);void 0!==i&&(t[`${e}-transition`]=i)}return t}transitioned(t,e){const n=new $i(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(t,e._values[i]);return n}untransitioned(){const t=new $i(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class qi{constructor(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(t,e,n){const i=t.now||0,r=this.value.possiblyEvaluate(t,e,n),s=this.prior;if(s){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return s.possiblyEvaluate(t,e,n);{const o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(t,e,n),r,function(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(o))}}return r}}class $i{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,n){const i=new Hi(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Wi{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return s(this._values[t].value)}setValue(t,e){this._values[t]=new Ui(this._values[t].property,null===e?void 0:s(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n)}return t}possiblyEvaluate(t,e,n){const i=new Hi(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}}class Zi{constructor(t,e,n){this.property=t,this.value=e,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,n,i){return this.property.evaluate(this.value,this.parameters,t,e,n,i)}}class Hi{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Xi{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,n){const i=Lt[this.specification.type];return i?i(t,e,n):t}}class Yi{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,n,i){return new Zi(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,i)}:t.expression,e)}interpolate(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Zi(this,{kind:"constant",value:void 0},t.parameters);const i=Lt[this.specification.type];return i?new Zi(this,{kind:"constant",value:i(t.value.value,e.value.value,n)},t.parameters):t}evaluate(t,e,n,i,r,s){return"constant"===t.kind?t.value:t.evaluate(e,n,i,r,s)}}class Ki extends Yi{possiblyEvaluate(t,e,n,i){if(void 0===t.value)return new Zi(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i),s="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(s,s,s,e);return new Zi(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){const n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Zi(this,{kind:"constant",value:n},e)}return new Zi(this,t.expression,e)}evaluate(t,e,n,i,r,s){if("source"===t.kind){const o=t.evaluate(e,n,i,r,s);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class Ji{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Ni(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Ni(Math.floor(e.zoom),e)),t.expression.evaluate(new Ni(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class Qi{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){return!!t.expression.evaluate(e,null,{},n,i)}interpolate(){return!1}}class tr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const n=t[e];n.specification.overridable&&this.overridableProperties.push(e);const i=this.defaultPropertyValues[e]=new Ui(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new ji(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}}}on("DataDrivenProperty",Yi),on("DataConstantProperty",Xi),on("CrossFadedDataDrivenProperty",Ki),on("CrossFadedProperty",Ji),on("ColorRampProperty",Qi);const er="-transition";class nr extends class{on(t,e){return this._listeners=this._listeners||{},Xn(t,e,this._listeners),this}off(t,e){return Yn(t,e,this._listeners),Yn(t,e,this._oneTimeListeners),this}once(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Xn(t,e,this._oneTimeListeners),this}fire(t,e){"string"==typeof t&&(t=new Kn(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const i of r)Yn(n,i,this._oneTimeListeners),i.call(this,t);const s=this._eventedParent;s&&(i(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),s.fire(t))}else t instanceof Jn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new Wi(e.layout)),e.paint)){this._transitionablePaint=new Gi(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hi(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=e&&this._validate(ei,`layers.${this.id}.layout.${t}`,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(er)?this._transitionablePaint.getTransition(t.slice(0,-er.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e&&this._validate(ti,`layers.${this.id}.paint.${t}`,t,e,n))return!1;if(t.endsWith(er))return this._transitionablePaint.setTransition(t.slice(0,-er.length),e||void 0),!1;{const n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),s=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const o=this._transitionablePaint._values[t].value;return o.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(t,s,o)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),function(t,e,n){const i={};for(const r in t)e.call(this,t[r],r,t)&&(i[r]=t[r]);return i}(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!r||!1!==r.validate)&&function(t,e){let n=!1;if(e&&e.length)for(const i of e)t.fire(new Jn(new Error(i.message))),n=!0;return n}(this,t.call(Qn,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:dn,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Zi&&Te(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const ir={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rr{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function or(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:t.map((t=>{const r=ir[t.type].BYTES_PER_ELEMENT,s=n=ar(n,Math.max(e,r)),o=t.components||1;return i=Math.max(i,r),n+=r*o,{name:t.name,type:t.type,components:o,offset:s}})),size:ar(n,Math.max(i,e)),alignment:e}}function ar(t,e){return Math.ceil(t/e)*e}var lr=cr;function cr(t,e){this.x=t,this.y=e}cr.prototype={clone:function(){return new cr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},cr.convert=function(t){return t instanceof cr?t:Array.isArray(t)?new cr(t[0],t[1]):t};class ur extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t}}ur.prototype.bytesPerElement=4,on("StructArrayLayout2i4",ur);class hr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const s=4*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,t}}hr.prototype.bytesPerElement=8,on("StructArrayLayout4i8",hr);class dr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,s)}emplace(t,e,n,i,r,s,o){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=s,this.int16[a+5]=o,t}}dr.prototype.bytesPerElement=12,on("StructArrayLayout2i4i12",dr);class pr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,s)}emplace(t,e,n,i,r,s,o){const a=4*t,l=8*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.uint8[l+4]=i,this.uint8[l+5]=r,this.uint8[l+6]=s,this.uint8[l+7]=o,t}}pr.prototype.bytesPerElement=8,on("StructArrayLayout2i4ub8",pr);class fr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t}}fr.prototype.bytesPerElement=8,on("StructArrayLayout2f8",fr);class mr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,s,o,a,l,c)}emplace(t,e,n,i,r,s,o,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=s,this.uint16[h+5]=o,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}mr.prototype.bytesPerElement=20,on("StructArrayLayout10ui20",mr);class gr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,n,i,r,s,o,a,l,c,u,h)}emplace(t,e,n,i,r,s,o,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=s,this.uint16[p+5]=o,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}gr.prototype.bytesPerElement=24,on("StructArrayLayout4i4ui4i24",gr);class yr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t}}yr.prototype.bytesPerElement=12,on("StructArrayLayout3f12",yr);class _r extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}_r.prototype.bytesPerElement=4,on("StructArrayLayout1ul4",_r);class vr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,i,r,s,o,a,l)}emplace(t,e,n,i,r,s,o,a,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+3]=r,this.int16[u+4]=s,this.int16[u+5]=o,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}vr.prototype.bytesPerElement=20,on("StructArrayLayout6i1ul2ui20",vr);class xr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,s)}emplace(t,e,n,i,r,s,o){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=s,this.int16[a+5]=o,t}}xr.prototype.bytesPerElement=12,on("StructArrayLayout2i2i2i12",xr);class br extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,n,i,r)}emplace(t,e,n,i,r,s){const o=4*t,a=8*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[a+6]=r,this.int16[a+7]=s,t}}br.prototype.bytesPerElement=16,on("StructArrayLayout2f1f2i16",br);class wr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const s=12*t,o=3*t;return this.uint8[s+0]=e,this.uint8[s+1]=n,this.float32[o+1]=i,this.float32[o+2]=r,t}}wr.prototype.bytesPerElement=12,on("StructArrayLayout2ub2f12",wr);class Sr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t}}Sr.prototype.bytesPerElement=6,on("StructArrayLayout3ui6",Sr);class Er extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g)}emplace(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y){const _=24*t,v=12*t,x=48*t;return this.int16[_+0]=e,this.int16[_+1]=n,this.uint16[_+2]=i,this.uint16[_+3]=r,this.uint32[v+2]=s,this.uint32[v+3]=o,this.uint32[v+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[_+22]=y,t}}Er.prototype.bytesPerElement=48,on("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Er);class Tr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T,A,k){const P=this.length;return this.resize(P+1),this.emplace(P,t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T,A,k)}emplace(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T,A,k,P){const I=34*t,C=17*t;return this.int16[I+0]=e,this.int16[I+1]=n,this.int16[I+2]=i,this.int16[I+3]=r,this.int16[I+4]=s,this.int16[I+5]=o,this.int16[I+6]=a,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=d,this.uint16[I+12]=p,this.uint16[I+13]=f,this.uint16[I+14]=m,this.uint16[I+15]=g,this.uint16[I+16]=y,this.uint16[I+17]=_,this.uint16[I+18]=v,this.uint16[I+19]=x,this.uint16[I+20]=b,this.uint16[I+21]=w,this.uint16[I+22]=S,this.uint32[C+12]=E,this.float32[C+13]=T,this.float32[C+14]=A,this.float32[C+15]=k,this.float32[C+16]=P,t}}Tr.prototype.bytesPerElement=68,on("StructArrayLayout8i15ui1ul4f68",Tr);class Ar extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Ar.prototype.bytesPerElement=4,on("StructArrayLayout1f4",Ar);class kr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t}}kr.prototype.bytesPerElement=6,on("StructArrayLayout3i6",kr);class Pr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=n,this.uint16[r+3]=i,t}}Pr.prototype.bytesPerElement=8,on("StructArrayLayout1ul2ui8",Pr);class Ir extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t}}Ir.prototype.bytesPerElement=4,on("StructArrayLayout2ui4",Ir);class Cr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Cr.prototype.bytesPerElement=2,on("StructArrayLayout1ui2",Cr);class Mr extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const s=4*t;return this.float32[s+0]=e,this.float32[s+1]=n,this.float32[s+2]=i,this.float32[s+3]=r,t}}Mr.prototype.bytesPerElement=16,on("StructArrayLayout4f16",Mr);class zr extends rr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new lr(this.anchorPointX,this.anchorPointY)}}zr.prototype.size=20;class Lr extends vr{get(t){return new zr(this,t)}}on("CollisionBoxArray",Lr);class Dr extends rr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Dr.prototype.size=48;class Rr extends Er{get(t){return new Dr(this,t)}}on("PlacedSymbolArray",Rr);class Br extends rr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Br.prototype.size=68;class Or extends Tr{get(t){return new Br(this,t)}}on("SymbolInstanceArray",Or);class Fr extends Ar{getoffsetX(t){return this.float32[1*t+0]}}on("GlyphOffsetArray",Fr);class Vr extends kr{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}on("SymbolLineVertexArray",Vr);class Nr extends rr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Nr.prototype.size=8;class Ur extends Pr{get(t){return new Nr(this,t)}}on("FeatureIndexArray",Ur);class jr extends ur{}class Gr extends ur{}class qr extends dr{}class $r extends pr{}class Wr extends fr{}class Zr extends mr{}class Hr extends gr{}class Xr extends yr{}class Yr extends _r{}class Kr extends xr{}class Jr extends wr{}class Qr extends Sr{}class ts extends Ir{}const es=or([{name:"a_pos",components:2,type:"Int16"}],4),{members:ns}=es;class is{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=t}prepareSegment(t,e,n,i){let r=this.segments[this.segments.length-1];return t>is.MAX_VERTEX_ARRAY_LENGTH&&a(`Max vertices per segment is ${is.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>is.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,n,i){return new is([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function rs(t,e){return 256*(t=n(Math.floor(t),0,255))+n(Math.floor(e),0,255)}is.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,on("SegmentVector",is);const ss=or([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var os={exports:{}},as={exports:{}};as.exports=function(t,e){var n,i,r,s,o,a,l,c;for(i=t.length-(n=3&t.length),r=e,o=3432918353,a=461845907,c=0;c<i;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(s=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0};var ls={exports:{}};ls.exports=function(t,e){for(var n,i=t.length,r=e^i,s=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++s;switch(i){case 3:r^=(255&t.charCodeAt(s+2))<<16;case 2:r^=(255&t.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};var cs=as.exports,us=ls.exports;os.exports=cs,os.exports.murmur3=cs,os.exports.murmur2=us;var hs=os.exports;class ds{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,n,i){this.ids.push(ps(t)),this.positions.push(e,n,i)}getPositions(t){const e=ps(t);let n=0,i=this.ids.length-1;for(;n<i;){const t=n+i>>1;this.ids[t]>=e?i=t:n=t+1}const r=[];for(;this.ids[n]===e;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(t,e){const n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return fs(n,i,0,n.length-1),e&&e.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(t){const e=new ds;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function ps(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:hs(String(t))}function fs(t,e,n,i){for(;n<i;){const r=t[n+i>>1];let s=n-1,o=i+1;for(;;){do{s++}while(t[s]<r);do{o--}while(t[o]>r);if(s>=o)break;ms(t,s,o),ms(e,3*s,3*o),ms(e,3*s+1,3*o+1),ms(e,3*s+2,3*o+2)}o-n<i-o?(fs(t,e,n,o),n=o+1):(fs(t,e,o+1,i),i=o)}}function ms(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}on("FeaturePositionMap",ds);class gs{constructor(t,e){this.gl=t.gl,this.location=e}}class ys extends gs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class _s extends gs{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class vs extends gs{constructor(t,e){super(t,e),this.current=b.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}function xs(t){return[rs(255*t.r,255*t.g),rs(255*t.b,255*t.a)]}class bs{constructor(t,e,n){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=n}setUniform(t,e,n){t.set(n.constantOr(this.value))}getBinding(t,e,n){return"color"===this.type?new vs(t,e):new ys(t,e)}}class ws{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,n,i){const r="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,n){return"u_pattern"===n.substr(0,9)?new _s(t,e):new ys(t,e)}}class Ss{constructor(t,e,n,i){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(t,e,n,i,r){const s=this.paintVertexArray.length,o=this.expression.evaluate(new Ni(0),e,{},i,[],r);this.paintVertexArray.resize(t),this._setPaintValue(s,t,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(t,e,r)}_setPaintValue(t,e,n){if("color"===this.type){const i=xs(n);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Es{constructor(t,e,n,i,r,s){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new s}populatePaintArray(t,e,n,i,r){const s=this.expression.evaluate(new Ni(this.zoom),e,{},i,[],r),o=this.expression.evaluate(new Ni(this.zoom+1),e,{},i,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,s,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),s=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(t,e,r,s)}_setPaintValue(t,e,n,i){if("color"===this.type){const r=xs(n),s=xs(i);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1],s[0],s[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=n(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(r)}getBinding(t,e,n){return new ys(t,e)}}class Ts{constructor(t,e,n,i,r,s){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=i,this.layerId=s,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(t,e,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],n)}updatePaintArray(t,e,n,i,r){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(t,e,n,i){if(!i||!n)return;const{min:r,mid:s,max:o}=n,a=i[r],l=i[s],c=i[o];if(a&&l&&c)for(let u=t;u<e;u++)this.zoomInPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ss.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ss.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class As{constructor(t,e,n){this.binders={},this._buffers=[];const i=[];for(const r in t.paint._values){if(!n(r))continue;const s=t.paint.get(r);if(!(s instanceof Zi&&Te(s.property.specification)))continue;const o=Ps(r,t.type),a=s.value,l=s.property.specification.type,c=s.property.useIntegerZoom,u=s.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[r]=h?new ws(a.value,o):new bs(a.value,o,l),i.push(`/u_${r}`);else if("source"===a.kind||h){const n=Is(r,l,"source");this.binders[r]=h?new Ts(a,l,c,e,n,t.id):new Ss(a,o,l,n),i.push(`/a_${r}`)}else{const t=Is(r,l,"composite");this.binders[r]=new Es(a,o,l,c,e,t),i.push(`/z_${r}`)}}this.cacheKey=i.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Ss||e instanceof Es?e.maxValue:0}populatePaintArrays(t,e,n,i,r){for(const s in this.binders){const o=this.binders[s];(o instanceof Ss||o instanceof Es||o instanceof Ts)&&o.populatePaintArray(t,e,n,i,r)}}setConstantPatternPositions(t,e){for(const n in this.binders){const i=this.binders[n];i instanceof ws&&i.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,n,i,r){let s=!1;for(const o in t){const a=e.getPositions(o);for(const e of a){const a=n.feature(e.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof Ss||l instanceof Es||l instanceof Ts)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[o],r),s=!0}}}}return s}defines(){const t=[];for(const e in this.binders){const n=this.binders[e];(n instanceof bs||n instanceof ws)&&t.push(...n.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Ss||n instanceof Es)for(let e=0;e<n.paintVertexAttributes.length;e++)t.push(n.paintVertexAttributes[e].name);else if(n instanceof Ts)for(let e=0;e<ss.members.length;e++)t.push(ss.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof bs||n instanceof ws||n instanceof Es)for(const e of n.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof bs||r instanceof ws||r instanceof Es)for(const s of r.uniformNames)if(e[s]){const o=r.getBinding(t,e[s],s);n.push({name:s,property:i,binding:o})}}return n}setUniforms(t,e,n,i){for(const{name:r,property:s,binding:o}of e)this.binders[s].setUniform(o,i,n.get(s),r)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const n=this.binders[e];if(t&&n instanceof Ts){const e=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(n instanceof Ss||n instanceof Es)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const e in this.binders){const n=this.binders[e];(n instanceof Ss||n instanceof Es||n instanceof Ts)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Ss||e instanceof Es||e instanceof Ts)&&e.destroy()}}}class ks{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new As(i,e,n);this.needsUpload=!1,this._featureMap=new ds,this._bufferOffset=0}populatePaintArrays(t,e,n,i,r,s){for(const o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,i,r,s);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,i)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ps(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}function Is(t,e,n){const i={color:{source:fr,composite:Mr},number:{source:Ar,composite:fr}},r=function(t){return{"line-pattern":{source:Zr,composite:Zr},"fill-pattern":{source:Zr,composite:Zr},"fill-extrusion-pattern":{source:Zr,composite:Zr}}[t]}(t);return r&&r[n]||i[e][n]}on("ConstantBinder",bs),on("CrossFadedConstantBinder",ws),on("SourceExpressionBinder",Ss),on("CrossFadedCompositeBinder",Ts),on("CompositeExpressionBinder",Es),on("ProgramConfiguration",As,{omit:["_buffers"]}),on("ProgramConfigurationSet",ks);var Cs=8192;const Ms=Math.pow(2,14)-1,zs=-Ms-1;function Ls(t){const e=Cs/t.extent,i=t.loadGeometry();for(let r=0;r<i.length;r++){const t=i[r];for(let i=0;i<t.length;i++){const r=t[i],s=Math.round(r.x*e),o=Math.round(r.y*e);r.x=n(s,zs,Ms),r.y=n(o,zs,Ms),(s<r.x||s>r.x+1||o<r.y||o>r.y+1)&&a("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Ds(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ls(t):[]}}function Rs(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}class Bs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new jr,this.indexArray=new Qr,this.segments=new is,this.programConfigurations=new ks(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){const i=this.layers[0],r=[];let s=null,o=!1;"circle"===i.type&&(s=i.layout.get("circle-sort-key"),o=!s.isConstant());for(const{feature:a,id:l,index:c,sourceLayerIndex:u}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Ds(a,t);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),e,n))continue;const i=o?s.evaluate(e,{},n):void 0,h={id:l,properties:a.properties,type:a.type,sourceLayerIndex:u,index:c,geometry:t?e.geometry:Ls(a),patterns:{},sortKey:i};r.push(h)}o&&r.sort(((t,e)=>t.sortKey-e.sortKey));for(const a of r){const{geometry:i,index:r,sourceLayerIndex:s}=a,o=t[r].feature;this.addFeature(a,i,r,n),e.featureIndex.insert(o,i,r,s,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ns),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i){for(const r of e)for(const e of r){const n=e.x,i=e.y;if(n<0||n>=Cs||i<0||i>=Cs)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),s=r.vertexLength;Rs(this.layoutVertexArray,n,i,-1,-1),Rs(this.layoutVertexArray,n,i,1,-1),Rs(this.layoutVertexArray,n,i,1,1),Rs(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+3,s+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},i)}}function Os(t,e){for(let n=0;n<t.length;n++)if(Ws(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ws(t,e[n]))return!0;return!!Us(t,e)}function Fs(t,e,n){return!!Ws(t,e)||!!Gs(e,t,n)}function Vs(t,e){if(1===t.length)return $s(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++)if(Ws(t,i[e]))return!0}for(let n=0;n<t.length;n++)if($s(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Us(t,e[n]))return!0;return!1}function Ns(t,e,n){if(t.length>1){if(Us(t,e))return!0;for(let i=0;i<e.length;i++)if(Gs(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Gs(t[i],e,n))return!0;return!1}function Us(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)if(js(i,r,e[t],e[t+1]))return!0}return!1}function js(t,e,n,i){return l(t,n,i)!==l(e,n,i)&&l(t,e,n)!==l(t,e,i)}function Gs(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let r=1;r<e.length;r++)if(qs(t,e[r-1],e[r])<i)return!0;return!1}function qs(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e)._mult(r)._add(e))}function $s(t,e){let n,i,r,s=!1;for(let o=0;o<t.length;o++){n=t[o];for(let t=0,o=n.length-1;t<n.length;o=t++)i=n[t],r=n[o],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(s=!s)}return s}function Ws(t,e){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const s=t[i],o=t[r];s.y>e.y!=o.y>e.y&&e.x<(o.x-s.x)*(e.y-s.y)/(o.y-s.y)+s.x&&(n=!n)}return n}function Zs(t,e,n){const i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;const s=l(t,e,n[0]);return s!==l(t,e,n[1])||s!==l(t,e,n[2])||s!==l(t,e,n[3])}function Hs(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Xs(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ys(t,e,n,i,r){if(!e[0]&&!e[1])return t;const s=lr.convert(e)._mult(r);"viewport"===n&&s._rotate(-i);const o=[];for(let a=0;a<t.length;a++)o.push(t[a].sub(s));return o}on("CircleBucket",Bs,{omit:["layers"]});const Ks=new tr({"circle-sort-key":new Yi(dn.layout_circle["circle-sort-key"])});var Js,Qs={paint:new tr({"circle-radius":new Yi(dn.paint_circle["circle-radius"]),"circle-color":new Yi(dn.paint_circle["circle-color"]),"circle-blur":new Yi(dn.paint_circle["circle-blur"]),"circle-opacity":new Yi(dn.paint_circle["circle-opacity"]),"circle-translate":new Xi(dn.paint_circle["circle-translate"]),"circle-translate-anchor":new Xi(dn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xi(dn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xi(dn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yi(dn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yi(dn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yi(dn.paint_circle["circle-stroke-opacity"])}),layout:Ks},to="undefined"!=typeof Float32Array?Float32Array:Array;function eo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function no(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}function io(t,e){const n=no([],[t.x,t.y,0,1],e);return new lr(n[0]/n[3],n[1]/n[3])}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),Js=new to(4),to!=Float32Array&&(Js[0]=0,Js[1]=0,Js[2]=0,Js[3]=0);class ro extends Bs{}on("HeatmapBucket",ro,{omit:["layers"]});var so={paint:new tr({"heatmap-radius":new Yi(dn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yi(dn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xi(dn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qi(dn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xi(dn.paint_heatmap["heatmap-opacity"])})};function oo(t,e,n,i){let{width:r,height:s}=e;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*s*n)throw new RangeError(`mismatched image size. expected: ${i.length} but got: ${r*s*n}`)}else i=new Uint8Array(r*s*n);return t.width=r,t.height=s,t.data=i,t}function ao(t,e,n){let{width:i,height:r}=e;if(i===t.width&&r===t.height)return;const s=oo({},{width:i,height:r},n);lo(t,s,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=s.data}function lo(t,e,n,i,r,s){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,a=e.data;for(let l=0;l<r.height;l++){const c=((n.y+l)*t.width+n.x)*s,u=((i.y+l)*e.width+i.x)*s;for(let t=0;t<r.width*s;t++)a[u+t]=o[c+t]}return e}class co{constructor(t,e){oo(this,t,1,e)}resize(t){ao(this,t,1)}clone(){return new co({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){lo(t,e,n,i,r,1)}}class uo{constructor(t,e){oo(this,t,4,e)}resize(t){ao(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){lo(t,e,n,i,r,4)}}on("AlphaImage",co),on("RGBAImage",uo);var ho={paint:new tr({"hillshade-illumination-direction":new Xi(dn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xi(dn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xi(dn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xi(dn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xi(dn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xi(dn.paint_hillshade["hillshade-accent-color"])})};const po=or([{name:"a_pos",components:2,type:"Int16"}],4),{members:fo}=po;var mo={exports:{}};function go(t,e,n){n=n||2;var i,r,s,o,a,l,c,u=e&&e.length,h=u?e[0]*n:t.length,d=yo(t,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,n,i){var r,s,o,a=[];for(r=0,s=e.length;r<s;r++)(o=yo(t,e[r]*i,r<s-1?e[r+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),a.push(Po(o));for(a.sort(Eo),r=0;r<a.length;r++)n=_o(n=To(a[r],n),n.next);return n}(t,e,d,n)),t.length>80*n){i=s=t[0],r=o=t[1];for(var f=n;f<h;f+=n)(a=t[f])<i&&(i=a),(l=t[f+1])<r&&(r=l),a>s&&(s=a),l>o&&(o=l);c=0!==(c=Math.max(s-i,o-r))?1/c:0}return vo(d,p,n,i,r,c),p}function yo(t,e,n,i,r){var s,o;if(r===Uo(t,e,n,i)>0)for(s=e;s<n;s+=i)o=Fo(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=Fo(s,t[s],t[s+1],o);return o&&zo(o,o.next)&&(Vo(o),o=o.next),o}function _o(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!zo(i,i.next)&&0!==Mo(i.prev,i,i.next))i=i.next;else{if(Vo(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function vo(t,e,n,i,r,s,o){if(t){!o&&s&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=ko(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(t,i,r,s);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?bo(t,i,r,s):xo(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Vo(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?vo(t=wo(_o(t),e,n),e,n,i,r,s,2):2===o&&So(t,e,n,i,r,s):vo(_o(t),e,n,i,r,s,1);break}}}function xo(t){var e=t.prev,n=t,i=t.next;if(Mo(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Io(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Mo(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function bo(t,e,n,i){var r=t.prev,s=t,o=t.next;if(Mo(r,s,o)>=0)return!1;for(var a=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,l=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,c=ko(r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,e,n,i),u=ko(a,l,e,n,i),h=t.prevZ,d=t.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==t.prev&&h!==t.next&&Io(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&Mo(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==t.prev&&d!==t.next&&Io(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Mo(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Io(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&Mo(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&Io(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Mo(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function wo(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!zo(r,s)&&Lo(r,i,i.next,s)&&Bo(r,s)&&Bo(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),Vo(i),Vo(i.next),i=t=s),i=i.next}while(i!==t);return _o(i)}function So(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Co(o,a)){var l=Oo(o,a);return o=_o(o,o.next),l=_o(l,l.next),vo(o,e,n,i,r,s),void vo(l,e,n,i,r,s)}a=a.next}o=o.next}while(o!==t)}function Eo(t,e){return t.x-e.x}function To(t,e){var n=function(t,e){var n,i=e,r=t.x,s=t.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o){if(o=a,a===r){if(s===i.y)return i;if(s===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===o)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&Io(s<h?r:o,s,u,h,s<h?o:r,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(r-i.x),Bo(i,t)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&Ao(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(t,e);if(!n)return e;var i=Oo(n,t),r=_o(n,n.next);return _o(i,i.next),e===n?r:e}function Ao(t,e){return Mo(t.prev,t,e.prev)<0&&Mo(e.next,t,t.next)<0}function ko(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Po(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Io(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function Co(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Lo(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Bo(t,e)&&Bo(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Mo(t.prev,t,e.prev)||Mo(t,e.prev,e))||zo(t,e)&&Mo(t.prev,t,t.next)>0&&Mo(e.prev,e,e.next)>0)}function Mo(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function zo(t,e){return t.x===e.x&&t.y===e.y}function Lo(t,e,n,i){var r=Ro(Mo(t,e,n)),s=Ro(Mo(t,e,i)),o=Ro(Mo(n,i,t)),a=Ro(Mo(n,i,e));return r!==s&&o!==a||!(0!==r||!Do(t,n,e))||!(0!==s||!Do(t,i,e))||!(0!==o||!Do(n,t,i))||!(0!==a||!Do(n,e,i))}function Do(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ro(t){return t>0?1:t<0?-1:0}function Bo(t,e){return Mo(t.prev,t,t.next)<0?Mo(t,e,t.next)>=0&&Mo(t,t.prev,e)>=0:Mo(t,e,t.prev)<0||Mo(t,t.next,e)<0}function Oo(t,e){var n=new No(t.i,t.x,t.y),i=new No(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Fo(t,e,n,i){var r=new No(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Vo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function No(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Uo(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}mo.exports=go,mo.exports.default=go,go.deviation=function(t,e,n,i){var r=e&&e.length,s=Math.abs(Uo(t,0,r?e[0]*n:t.length,n));if(r)for(var o=0,a=e.length;o<a;o++)s-=Math.abs(Uo(t,e[o]*n,o<a-1?e[o+1]*n:t.length,n));var l=0;for(o=0;o<i.length;o+=3){var c=i[o]*n,u=i[o+1]*n,h=i[o+2]*n;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},go.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&n.holes.push(i+=t[r-1].length)}return n};var jo=mo.exports;function Go(t,e,n,i,r){qo(t,e,n||0,i||t.length-1,r||Wo)}function qo(t,e,n,i,r){for(;i>n;){if(i-n>600){var s=i-n+1,o=e-n+1,a=Math.log(s),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);qo(t,e,Math.max(n,Math.floor(e-o*l/s+c)),Math.min(i,Math.floor(e+(s-o)*l/s+c)),r)}var u=t[e],h=n,d=i;for($o(t,n,e),r(t[i],u)>0&&$o(t,n,i);h<d;){for($o(t,h,d),h++,d--;r(t[h],u)<0;)h++;for(;r(t[d],u)>0;)d--}0===r(t[n],u)?$o(t,n,d):$o(t,++d,i),d<=e&&(n=d+1),e<=d&&(i=d-1)}}function $o(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function Wo(t,e){return t<e?-1:t>e?1:0}function Zo(t,e){const n=t.length;if(n<=1)return[t];const i=[];let r,s;for(let o=0;o<n;o++){const e=c(t[o]);0!==e&&(t[o].area=Math.abs(e),void 0===s&&(s=e<0),s===e<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}if(r&&i.push(r),e>1)for(let o=0;o<i.length;o++)i[o].length<=e||(Go(i[o],e,1,i[o].length-1,Ho),i[o]=i[o].slice(0,e));return i}function Ho(t,e){return e.area-t.area}function Xo(t,e,n){const i=n.patternDependencies;let r=!1;for(const s of e){const e=s.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const n=e.constantOr(null);n&&(r=!0,i[n.to]=!0,i[n.from]=!0)}return r}function Yo(t,e,n,i,r){const s=r.patternDependencies;for(const o of e){const e=o.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:i-1},n,{},r.availableImages),a=e.evaluate({zoom:i},n,{},r.availableImages),l=e.evaluate({zoom:i+1},n,{},r.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,s[t]=!0,s[a]=!0,s[l]=!0,n.patterns[o.id]={min:t,mid:a,max:l}}}return n}class Ko{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Gr,this.indexArray=new Qr,this.indexArray2=new ts,this.programConfigurations=new ks(t.layers,t.zoom),this.segments=new is,this.segments2=new is,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){this.hasPattern=Xo("fill",this.layers,e);const i=this.layers[0].layout.get("fill-sort-key"),r=!i.isConstant(),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Ds(o,t);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),u,n))continue;const h=r?i.evaluate(u,{},n,e.availableImages):void 0,d={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Ls(o),patterns:{},sortKey:h};s.push(d)}r&&s.sort(((t,e)=>t.sortKey-e.sortKey));for(const o of s){const{geometry:i,index:r,sourceLayerIndex:s}=o;if(this.hasPattern){const t=Yo("fill",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{});e.featureIndex.insert(t[r].feature,i,r,s,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fo),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,n,i,r){for(const s of Zo(e,500)){let t=0;for(const a of s)t+=a.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=e.vertexLength,i=[],r=[];for(const a of s){if(0===a.length)continue;a!==s[0]&&r.push(i.length/2);const t=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(e+a.length-1,e),i.push(a[0].x),i.push(a[0].y);for(let n=1;n<a.length;n++)this.layoutVertexArray.emplaceBack(a[n].x,a[n].y),this.indexArray2.emplaceBack(e+n-1,e+n),i.push(a[n].x),i.push(a[n].y);t.vertexLength+=a.length,t.primitiveLength+=a.length}const o=jo(i,r);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(n+o[s],n+o[s+1],n+o[s+2]);e.vertexLength+=t,e.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}}on("FillBucket",Ko,{omit:["layers","patternFeatures"]});const Jo=new tr({"fill-sort-key":new Yi(dn.layout_fill["fill-sort-key"])});var Qo={paint:new tr({"fill-antialias":new Xi(dn.paint_fill["fill-antialias"]),"fill-opacity":new Yi(dn.paint_fill["fill-opacity"]),"fill-color":new Yi(dn.paint_fill["fill-color"]),"fill-outline-color":new Yi(dn.paint_fill["fill-outline-color"]),"fill-translate":new Xi(dn.paint_fill["fill-translate"]),"fill-translate-anchor":new Xi(dn.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ki(dn.paint_fill["fill-pattern"])}),layout:Jo};const ta=or([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:ea}=ta;var na={},ia=lr,ra=sa;function sa(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(oa,this,e)}function oa(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function aa(t){for(var e,n,i=0,r=0,s=t.length,o=s-1;r<s;o=r++)i+=((n=t[o]).x-(e=t[r]).x)*(e.y+n.y);return i}sa.types=["Unknown","Point","LineString","Polygon"],sa.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,r=0,s=0,o=0,a=[];t.pos<n;){if(r<=0){var l=t.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)s+=t.readSVarint(),o+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new ia(s,o));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&a.push(e),a},sa.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,s=0,o=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var u=t.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<o&&(o=r),r>a&&(a=r),(s+=t.readSVarint())<l&&(l=s),s>c&&(c=s);else if(7!==n)throw new Error("unknown command "+n)}return[o,l,a,c]},sa.prototype.toGeoJSON=function(t,e,n){var i,r,s=this.extent*Math.pow(2,n),o=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=sa.types[this.type];function u(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+o)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],s=0;s<e;s++){var o=aa(t[s]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(n&&r.push(n),n=[t[s]]):n.push(t[s]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var la=ra,ca=ua;function ua(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ha,this,e),this.length=this._features.length}function ha(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}ua.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new la(this._pbf,e,this.extent,this._keys,this._values)};var da=ca;function pa(t,e,n){if(3===t){var i=new da(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}na.VectorTile=function(t,e){this.layers=t.readFields(pa,{},e)},na.VectorTileFeature=ra,na.VectorTileLayer=ca;const fa=na.VectorTileFeature.types,ma=Math.pow(2,13);function ga(t,e,n,i,r,s,o,a){t.emplaceBack(e,n,2*Math.floor(i*ma)+o,r*ma*2,s*ma*2,Math.round(a))}class ya{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new qr,this.indexArray=new Qr,this.programConfigurations=new ks(t.layers,t.zoom),this.segments=new is,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){this.features=[],this.hasPattern=Xo("fill-extrusion",this.layers,e);for(const{feature:i,id:r,index:s,sourceLayerIndex:o}of t){const t=this.layers[0]._featureFilter.needGeometry,a=Ds(i,t);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),a,n))continue;const l={id:r,sourceLayerIndex:o,index:s,geometry:t?a.geometry:Ls(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(Yo("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,s,n,{}),e.featureIndex.insert(i,l.geometry,s,o,this.index,!0)}}addFeatures(t,e,n){for(const i of this.features){const{geometry:t}=i;this.addFeature(i,t,i.index,e,n)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ea),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i,r){for(const s of Zo(e,500)){let e=0;for(const t of s)e+=t.length;let n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const t of s){if(0===t.length)continue;if(va(t))continue;let e=0;for(let i=0;i<t.length;i++){const r=t[i];if(i>=1){const s=t[i-1];if(!_a(r,s)){n.vertexLength+4>is.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=r.sub(s)._perp()._unit(),i=s.dist(r);e+i>32768&&(e=0),ga(this.layoutVertexArray,r.x,r.y,t.x,t.y,0,0,e),ga(this.layoutVertexArray,r.x,r.y,t.x,t.y,0,1,e),e+=i,ga(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,0,e),ga(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,1,e);const o=n.vertexLength;this.indexArray.emplaceBack(o,o+2,o+1),this.indexArray.emplaceBack(o+1,o+2,o+3),n.vertexLength+=4,n.primitiveLength+=2}}}}if(n.vertexLength+e>is.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==fa[t.type])continue;const i=[],r=[],o=n.vertexLength;for(const t of s)if(0!==t.length){t!==s[0]&&r.push(i.length/2);for(let e=0;e<t.length;e++){const n=t[e];ga(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),i.push(n.x),i.push(n.y)}}const a=jo(i,r);for(let t=0;t<a.length;t+=3)this.indexArray.emplaceBack(o+a[t],o+a[t+2],o+a[t+1]);n.primitiveLength+=a.length/3,n.vertexLength+=e}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}}function _a(t,e){return t.x===e.x&&(t.x<0||t.x>Cs)||t.y===e.y&&(t.y<0||t.y>Cs)}function va(t){return t.every((t=>t.x<0))||t.every((t=>t.x>Cs))||t.every((t=>t.y<0))||t.every((t=>t.y>Cs))}on("FillExtrusionBucket",ya,{omit:["layers","features"]});var xa={paint:new tr({"fill-extrusion-opacity":new Xi(dn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yi(dn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xi(dn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xi(dn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ki(dn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yi(dn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yi(dn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xi(dn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ba(t,e){return t.x*e.x+t.y*e.y}function wa(t,e){if(1===t.length){let n=0;const i=e[n++];let r;for(;!r||i.equals(r);)if(r=e[n++],!r)return 1/0;for(;n<e.length;n++){const s=e[n],o=t[0],a=r.sub(i),l=s.sub(i),c=o.sub(i),u=ba(a,a),h=ba(a,l),d=ba(l,l),p=ba(c,a),f=ba(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=i.z*(1-g-y)+r.z*g+s.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}const Sa=or([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ea}=Sa,Ta=or([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Aa}=Ta,ka=na.VectorTileFeature.types,Pa=Math.cos(Math.PI/180*37.5),Ia=Math.pow(2,14)/.5;class Ca{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new $r,this.layoutVertexArray2=new Wr,this.indexArray=new Qr,this.programConfigurations=new ks(t.layers,t.zoom),this.segments=new is,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){this.hasPattern=Xo("line",this.layers,e);const i=this.layers[0].layout.get("line-sort-key"),r=!i.isConstant(),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Ds(o,t);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),e,n))continue;const u=r?i.evaluate(e,{},n):void 0,h={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?e.geometry:Ls(o),patterns:{},sortKey:u};s.push(h)}r&&s.sort(((t,e)=>t.sortKey-e.sortKey));for(const o of s){const{geometry:i,index:r,sourceLayerIndex:s}=o;if(this.hasPattern){const t=Yo("line",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{});e.featureIndex.insert(t[r].feature,i,r,s,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Aa)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ea),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,n,i,r){const s=this.layers[0].layout,o=s.get("line-join").evaluate(t,{}),a=s.get("line-cap"),l=s.get("line-miter-limit"),c=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const u of e)this.addLine(u,t,o,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}addLine(t,e,n,i,r,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===ka[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(o?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,o&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let g=l;g<a;g++){if(p=g===a-1?o?t[l+1]:void 0:t[g+1],p&&t[g].equals(p))continue;m&&(f=m),h&&(d=h),h=t[g],m=p?p.sub(h)._unit()._perp():f,f=f||m;let e=f.add(m);0===e.x&&0===e.y||e._unit();const y=f.x*m.x+f.y*m.y,_=e.x*m.x+e.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Pa&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&g>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const S=d&&p;let E=S?n:o?"butt":i;if(S&&"round"===E&&(v<s?E="miter":v<=2&&(E="fakeround")),"miter"===E&&v>r&&(E="bevel"),"bevel"===E&&(v>2&&(E="flipbevel"),v<r&&(E="miter")),d&&this.updateDistance(d,h),"miter"===E)e._mult(v),this.addCurrentVertex(h,e,0,0,u);else if("flipbevel"===E){if(v>100)e=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,e,0,0,u),this.addCurrentVertex(h,e.mult(-1),0,0,u)}else if("bevel"===E||"fakeround"===E){const t=-Math.sqrt(v*v-1),e=w?t:0,n=w?0:t;if(d&&this.addCurrentVertex(h,f,e,n,u),"fakeround"===E){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*t*t+(.848013+y*(.215638*y-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-n,u)}else if("butt"===E)this.addCurrentVertex(h,e,0,0,u);else if("square"===E){const t=d?1:-1;this.addCurrentVertex(h,e,t,t,u)}else"round"===E&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&g<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=e.y*i-e.x,a=-e.y-e.x*i;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,s,!1,n,r),this.addHalfVertex(t,o,a,s,!0,-i,r),this.distance>Ia/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,i,r,s))}addHalfVertex(t,e,n,i,r,s,o){let{x:a,y:l}=t;const c=.5*(this.lineClips?this.scaledDistance*(Ia-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(i?1:0),(l<<1)+(r?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1)|(63&c)<<2,c>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),r?this.e2=u:this.e1=u}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}on("LineBucket",Ca,{omit:["layers","patternFeatures"]});const Ma=new tr({"line-cap":new Xi(dn.layout_line["line-cap"]),"line-join":new Yi(dn.layout_line["line-join"]),"line-miter-limit":new Xi(dn.layout_line["line-miter-limit"]),"line-round-limit":new Xi(dn.layout_line["line-round-limit"]),"line-sort-key":new Yi(dn.layout_line["line-sort-key"])});var za={paint:new tr({"line-opacity":new Yi(dn.paint_line["line-opacity"]),"line-color":new Yi(dn.paint_line["line-color"]),"line-translate":new Xi(dn.paint_line["line-translate"]),"line-translate-anchor":new Xi(dn.paint_line["line-translate-anchor"]),"line-width":new Yi(dn.paint_line["line-width"]),"line-gap-width":new Yi(dn.paint_line["line-gap-width"]),"line-offset":new Yi(dn.paint_line["line-offset"]),"line-blur":new Yi(dn.paint_line["line-blur"]),"line-dasharray":new Ji(dn.paint_line["line-dasharray"]),"line-pattern":new Ki(dn.paint_line["line-pattern"]),"line-gradient":new Qi(dn.paint_line["line-gradient"])}),layout:Ma};const La=new class extends Yi{possiblyEvaluate(t,e){return e=new Ni(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,r){return e=i({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,r)}}(za.paint.properties["line-width"].specification);function Da(t,e){return e>0?e+2*t:t}La.useIntegerZoom=!0;const Ra=or([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ba=or([{name:"a_projected_pos",components:3,type:"Float32"}],4);or([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Oa=or([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);or([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fa=or([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function Va(t,e,n){return t.sections.forEach((t=>{t.text=function(t,e,n){const i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Vi.applyArabicShaping&&(t=Vi.applyArabicShaping(t)),t}(t.text,e,n)})),t}or([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),or([{name:"triangle",components:3,type:"Uint16"}]),or([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),or([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),or([{type:"Float32",name:"offsetX"}]),or([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Na={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Ua=24,ja=$a,Ga=function(t,e,n,i,r){var s,o,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=t[e+h];for(h+=d,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),s-=c}return(p?-1:1)*o*Math.pow(2,s-i)},qa=function(t,e,n,i,r,s){var o,a,l,c=8*s-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,f=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*l-1)*Math.pow(2,r),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+p]=255&a,p+=f,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[n+p]=255&o,p+=f,o/=256,c-=8);t[n+p-f]|=128*m};function $a(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}$a.Varint=0,$a.Fixed64=1,$a.Bytes=2,$a.Fixed32=5;var Wa,Za=4294967296,Ha=1/Za,Xa="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Ya(t){return t.type===$a.Bytes?t.readVarint()+t.pos:t.pos+1}function Ka(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Ja(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function Qa(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function tl(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function el(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function nl(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function il(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function rl(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function sl(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function ol(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function al(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function ll(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function cl(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function ul(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function hl(t){let e=0,n=0;for(const o of t)e+=o.w*o.h,n=Math.max(n,o.w);t.sort(((t,e)=>e.h-t.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let r=0,s=0;for(const o of t)for(let t=i.length-1;t>=0;t--){const e=i[t];if(!(o.w>e.w||o.h>e.h)){if(o.x=e.x,o.y=e.y,s=Math.max(s,o.y+o.h),r=Math.max(r,o.x+o.w),o.w===e.w&&o.h===e.h){const e=i.pop();t<i.length&&(i[t]=e)}else o.h===e.h?(e.x+=o.w,e.w-=o.w):o.w===e.w?(e.y+=o.h,e.h-=o.h):(i.push({x:e.x+o.w,y:e.y,w:e.w-o.w,h:o.h}),e.y+=o.h,e.h-=o.h);break}}return{w:r,h:s,fill:e/(r*s)||0}}$a.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=7&i,t(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ll(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ul(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ll(this.buf,this.pos)+ll(this.buf,this.pos+4)*Za;return this.pos+=8,t},readSFixed64:function(){var t=ll(this.buf,this.pos)+ul(this.buf,this.pos+4)*Za;return this.pos+=8,t},readFloat:function(){var t=Ga(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ga(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,s=n.buf;if(i=(112&(r=s[n.pos++]))>>4,r<128)return Ka(t,i,e);if(i|=(127&(r=s[n.pos++]))<<3,r<128)return Ka(t,i,e);if(i|=(127&(r=s[n.pos++]))<<10,r<128)return Ka(t,i,e);if(i|=(127&(r=s[n.pos++]))<<17,r<128)return Ka(t,i,e);if(i|=(127&(r=s[n.pos++]))<<24,r<128)return Ka(t,i,e);if(i|=(1&(r=s[n.pos++]))<<31,r<128)return Ka(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Xa?function(t,e,n){return Xa.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var i="",r=e;r<n;){var s,o,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(s=t[r+1]))&&(c=(31&l)<<6|63&s)<=127&&(c=null):3===u?(o=t[r+2],128==(192&(s=t[r+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&s)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=t[r+2],a=t[r+3],128==(192&(s=t[r+1]))&&128==(192&o)&&128==(192&a)&&((c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==$a.Bytes)return t.push(this.readVarint(e));var n=Ya(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==$a.Bytes)return t.push(this.readSVarint());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==$a.Bytes)return t.push(this.readBoolean());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==$a.Bytes)return t.push(this.readFloat());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==$a.Bytes)return t.push(this.readDouble());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==$a.Bytes)return t.push(this.readFixed32());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==$a.Bytes)return t.push(this.readSFixed32());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==$a.Bytes)return t.push(this.readFixed64());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==$a.Bytes)return t.push(this.readSFixed64());var e=Ya(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===$a.Varint)for(;this.buf[this.pos++]>127;);else if(e===$a.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$a.Fixed32)this.pos+=4;else{if(e!==$a.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),cl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),cl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),cl(this.buf,-1&t,this.pos),cl(this.buf,Math.floor(t*Ha),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),cl(this.buf,-1&t,this.pos),cl(this.buf,Math.floor(t*Ha),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,s=0;s<e.length;s++){if((i=e.charCodeAt(s))>55295&&i<57344){if(!r){i>56319||s+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Ja(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),qa(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),qa(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&Ja(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,$a.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Qa,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,tl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,il,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,el,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,nl,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,rl,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,sl,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ol,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,al,e)},writeBytesField:function(t,e){this.writeTag(t,$a.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,$a.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,$a.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,$a.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,$a.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,$a.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,$a.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,$a.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,$a.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,$a.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class dl{constructor(t,e){let{pixelRatio:n,version:i,stretchX:r,stretchY:s,content:o}=e;this.paddedRect=t,this.pixelRatio=n,this.stretchX=r,this.stretchY=s,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class pl{constructor(t,e){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,n,r),this.addImages(e,i,r);const{w:s,h:o}=hl(r),a=new uo({width:s||1,height:o||1});for(const l in t){const e=t[l],i=n[l].paddedRect;uo.copy(e.data,a,{x:0,y:0},{x:i.x+1,y:i.y+1},e.data)}for(const l in e){const t=e[l],n=i[l].paddedRect,r=n.x+1,s=n.y+1,o=t.data.width,c=t.data.height;uo.copy(t.data,a,{x:0,y:0},{x:r,y:s},t.data),uo.copy(t.data,a,{x:0,y:c-1},{x:r,y:s-1},{width:o,height:1}),uo.copy(t.data,a,{x:0,y:0},{x:r,y:s+c},{width:o,height:1}),uo.copy(t.data,a,{x:o-1,y:0},{x:r-1,y:s},{width:1,height:c}),uo.copy(t.data,a,{x:0,y:0},{x:r+o,y:s},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(t,e,n){for(const i in t){const r=t[i],s={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(s),e[i]=new dl(s,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)}patchUpdatedImage(t,e,n){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[i,r]=t.tl;n.update(e.data,void 0,{x:i,y:r})}}on("ImagePosition",dl),on("ImageAtlas",pl),function(t){t[t.none=0]="none",t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical",t[t.horizontalOnly=3]="horizontalOnly"}(Wa||(Wa={}));const fl=-17;class ml{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const n=new ml;return n.scale=t||1,n.fontStack=e,n}static forImage(t){const e=new ml;return e.imageName=t,e}}class gl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const n=new gl;for(let i=0;i<t.sections.length;i++){const r=t.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,e)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let n=0;n<t.length;n++){const i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;e+=i&&Li(i)&&!Na[t[n+1]]||r&&Li(r)&&!Na[t[n-1]]||!Na[t[n]]?t[n]:Na[t[n]]}return e}(this.text)}trim(){let t=0;for(let n=0;n<this.text.length&&_l[this.text.charCodeAt(n)];n++)t++;let e=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&_l[this.text.charCodeAt(n)];n--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const n=new gl;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(ml.forText(t.scale,t.fontStack||e));const n=this.sections.length-1;for(let i=0;i<t.text.length;++i)this.sectionIndex.push(n)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void a("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(ml.forImage(e)),this.sectionIndex.push(this.sections.length-1)):a("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yl(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){const g=gl.fromFeature(t,r);let y;h===Wa.vertical&&g.verticalizePunctuation();const{processBidirectionalText:_,processStyledBidirectionalText:v}=Vi;if(_&&1===g.sections.length){y=[];const t=_(g.toString(),Tl(g,c,s,e,i,p,f));for(const e of t){const t=new gl;t.text=e,t.sections=g.sections;for(let n=0;n<e.length;n++)t.sectionIndex.push(0);y.push(t)}}else if(v){y=[];const t=v(g.text,g.sectionIndex,Tl(g,c,s,e,i,p,f));for(const e of t){const t=new gl;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const n=[],i=t.text;let r=0;for(const s of e)n.push(t.substring(r,s)),r=s;return r<i.length&&n.push(t.substring(r,i.length)),n}(g,Tl(g,c,s,e,i,p,f));const x=[],b={positionedLines:x,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,i,r,s,o,a,l,c,u,h){let d=0,p=fl,f=0,m=0;const g="right"===a?1:"left"===a?0:.5;let y=0;for(const w of r){w.trim();const r=w.getMaxScale(),o=(r-1)*Ua,a={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){p+=s,++y;continue}for(let s=0;s<w.length();s++){const a=w.getSection(s),f=w.getSectionIndex(s),m=w.getCharCode(s);let g=0,y=null,b=null,S=null,E=Ua;const T=!(l===Wa.horizontal||!u&&!zi(m)||u&&(_l[m]||(_=m,ii(_)||ri(_)||si(_)||Si(_)||ki(_))));if(a.imageName){const e=i[a.imageName];if(!e)continue;S=a.imageName,t.iconsInText=t.iconsInText||!0,b=e.paddedRect;const n=e.displaySize;a.scale=a.scale*Ua/h,y={width:n[0],height:n[1],left:1,top:-3,advance:T?n[1]:n[0]},g=o+(Ua-n[1]*a.scale),E=y.advance;const s=T?n[0]*a.scale-Ua*r:n[1]*a.scale-Ua*r;s>0&&s>x&&(x=s)}else{const t=n[a.fontStack],i=t&&t[m];if(i&&i.rect)b=i.rect,y=i.metrics;else{const t=e[a.fontStack],n=t&&t[m];if(!n)continue;y=n.metrics}g=(r-a.scale)*Ua}T?(t.verticalizable=!0,v.push({glyph:m,imageName:S,x:d,y:p+g,vertical:T,scale:a.scale,fontStack:a.fontStack,sectionIndex:f,metrics:y,rect:b}),d+=E*a.scale+c):(v.push({glyph:m,imageName:S,x:d,y:p+g,vertical:T,scale:a.scale,fontStack:a.fontStack,sectionIndex:f,metrics:y,rect:b}),d+=y.advance*a.scale+c)}0!==v.length&&(f=Math.max(d-c,f),kl(v,0,v.length-1,g,x)),d=0;const b=s*r+x;a.lineOffset=Math.max(x,o),p+=b,m=Math.max(b,m),++y}var _;const v=p-fl,{horizontalAlign:x,verticalAlign:b}=Al(o);(function(t,e,n,i,r,s,o,a,l){const c=(e-n)*r;let u=0;u=s!==o?-a*i-fl:(-i*l+.5)*o;for(const h of t)for(const t of h.positionedGlyphs)t.x+=c,t.y+=u})(t.positionedLines,g,x,b,f,m,s,v,r.length),t.top+=-b*v,t.bottom=t.top+v,t.left+=-x*f,t.right=t.left+f}(b,e,n,i,y,o,a,l,h,c,d,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const _l={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function xl(t,e,n,i,r,s){if(e.imageName){const t=i[e.imageName];return t?t.displaySize[0]*e.scale*Ua/s+r:0}{const i=n[e.fontStack],s=i&&i[t];return s?s.metrics.advance*e.scale+r:0}}function bl(t,e,n,i){const r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function wl(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Sl(t,e,n,i,r,s){let o=null,a=bl(e,n,r,s);for(const l of i){const t=bl(e-l.x,n,r,s)+l.badness;t<=a&&(o=l,a=t)}return{index:t,x:e,priorBreak:o,badness:a}}function El(t){return t?El(t.priorBreak).concat(t.index):[]}function Tl(t,e,n,i,r,s,o){if("point"!==s)return[];if(!t)return[];const a=[],l=function(t,e,n,i,r,s){let o=0;for(let a=0;a<t.length();a++){const n=t.getSection(a);o+=xl(t.getCharCode(a),n,i,r,e,s)}return o/Math.max(1,Math.ceil(o/n))}(t,e,n,i,r,o),c=t.text.indexOf("\u200b")>=0;let u=0;for(let d=0;d<t.length();d++){const n=t.getSection(d),s=t.getCharCode(d);if(_l[s]||(u+=xl(s,n,i,r,e,o)),d<t.length()-1){const e=!((h=s)<11904||!(pi(h)||di(h)||Ti(h)||wi(h)||yi(h)||oi(h)||fi(h)||ci(h)||_i(h)||vi(h)||gi(h)||Pi(h)||ui(h)||li(h)||ai(h)||mi(h)||hi(h)||Ei(h)||bi(h)||xi(h)));(vl[s]||e||n.imageName)&&a.push(Sl(d+1,u,l,a,wl(s,t.getCharCode(d+1),e&&c),!1))}}var h;return El(Sl(t.length(),u,l,a,0,!0))}function Al(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function kl(t,e,n,i,r){if(!i&&!r)return;const s=t[n],o=(t[n].x+s.metrics.advance*s.scale)*i;for(let a=e;a<=n;a++)t[a].x-=o,t[a].y+=r}function Pl(t,e,n){const{horizontalAlign:i,verticalAlign:r}=Al(n),s=e[0]-t.displaySize[0]*i,o=e[1]-t.displaySize[1]*r;return{image:t,top:o,bottom:o+t.displaySize[1],left:s,right:s+t.displaySize[0]}}function Il(t,e,n,i,r,s){const o=t.image;let a;if(o.content){const t=o.content,e=o.pixelRatio||1;a=[t[0]/e,t[1]/e,o.displaySize[0]-t[2]/e,o.displaySize[1]-t[3]/e]}const l=e.left*s,c=e.right*s;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-o.displaySize[0])/2,h=p+o.displaySize[0]);const f=e.top*s,m=e.bottom*s;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-o.displaySize[1])/2,d=u+o.displaySize[1]),{image:o,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const Cl=128;function Ml(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ni(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:i}=n;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let s=r;for(;s<e.length&&e[s]<t+1;)s++;s=Math.min(e.length-1,s);const o=e[r],a=e[s];return"composite"===n.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:o,maxZoom:a,minSize:n.evaluate(new Ni(o)),maxSize:n.evaluate(new Ni(a)),interpolationType:i}}}class zl extends lr{constructor(t,e,n,i){super(t,e),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new zl(this.x,this.y,this.angle,this.segment)}}function Ll(t,e,n,i,r){if(void 0===e.segment)return!0;let s=e,o=e.segment+1,a=0;for(;a>-n/2;){if(o--,o<0)return!1;a-=t[o].dist(s),s=t[o]}a+=t[o].dist(t[o+1]),o++;const l=[];let c=0;for(;a<n/2;){const e=t[o],n=t[o+1];if(!n)return!1;let s=t[o-1].angleTo(e)-e.angleTo(n);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:s}),c+=s;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;o++,a+=e.dist(n)}return!0}function Dl(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Rl(t,e,n){return t?.6*e*n:0}function Bl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Ol(t,e,n,i,r,s){const o=Rl(n,r,s),a=Bl(n,i)*s;let l=0;const c=Dl(t)/2;for(let u=0;u<t.length-1;u++){const n=t[u],i=t[u+1],r=n.dist(i);if(l+r>c){const s=(c-l)/r,h=zt(n.x,i.x,s),d=zt(n.y,i.y,s),p=new zl(h,d,i.angleTo(n),u);return p._round(),!o||Ll(t,p,a,o,e)?p:void 0}l+=r}}function Fl(t,e,n,i,r,s,o,a,l){const c=Rl(i,s,o),u=Bl(i,r),h=u*o,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Vl(t,d?e/2*a%e:(u/2+2*s)*o*a%e,e,c,n,h,d,!1,l)}function Vl(t,e,n,i,r,s,o,a,l){const c=s/2,u=Dl(t);let h=0,d=e-n,p=[];for(let f=0;f<t.length-1;f++){const e=t[f],o=t[f+1],a=e.dist(o),m=o.angleTo(e);for(;d+n<h+a;){d+=n;const g=(d-h)/a,y=zt(e.x,o.x,g),_=zt(e.y,o.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const e=new zl(y,_,m,f);e._round(),i&&!Ll(t,e,s,i,r)||p.push(e)}}h+=a}return a||p.length||o||(p=Vl(t,h/2,n,i,r,s,o,!0,l)),p}function Nl(t,e,n,i){const r=[],s=t.image,o=s.pixelRatio,a=s.paddedRect.w-2,l=s.paddedRect.h-2,c=t.right-t.left,u=t.bottom-t.top,h=s.stretchX||[[0,a]],d=s.stretchY||[[0,l]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,y=l-m;let _=0,v=f,x=0,b=m,w=0,S=g,E=0,T=y;if(s.content&&i){const t=s.content;_=Ul(h,0,t[0]),x=Ul(d,0,t[1]),v=Ul(h,t[0],t[2]),b=Ul(d,t[1],t[3]),w=t[0]-_,E=t[1]-x,S=t[2]-t[0]-v,T=t[3]-t[1]-b}const A=(i,r,a,l)=>{const h=Gl(i.stretch-_,v,c,t.left),d=ql(i.fixed-w,S,i.stretch,f),p=Gl(r.stretch-x,b,u,t.top),g=ql(r.fixed-E,T,r.stretch,m),y=Gl(a.stretch-_,v,c,t.left),A=ql(a.fixed-w,S,a.stretch,f),k=Gl(l.stretch-x,b,u,t.top),P=ql(l.fixed-E,T,l.stretch,m),I=new lr(h,p),C=new lr(y,p),M=new lr(y,k),z=new lr(h,k),L=new lr(d/o,g/o),D=new lr(A/o,P/o),R=e*Math.PI/180;if(R){const t=Math.sin(R),e=Math.cos(R),n=[e,-t,t,e];I._matMult(n),C._matMult(n),z._matMult(n),M._matMult(n)}const B=i.stretch+i.fixed,O=r.stretch+r.fixed;return{tl:I,tr:C,bl:z,br:M,tex:{x:s.paddedRect.x+1+B,y:s.paddedRect.y+1+O,w:a.stretch+a.fixed-B,h:l.stretch+l.fixed-O},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:D,minFontScaleX:S/o/c,minFontScaleY:T/o/u,isSDF:n}};if(i&&(s.stretchX||s.stretchY)){const t=jl(h,g,f),e=jl(d,y,m);for(let n=0;n<t.length-1;n++){const i=t[n],s=t[n+1];for(let t=0;t<e.length-1;t++)r.push(A(i,e[t],s,e[t+1]))}}else r.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return r}function Ul(t,e,n){let i=0;for(const r of t)i+=Math.max(e,Math.min(n,r[1]))-Math.max(e,Math.min(n,r[0]));return i}function jl(t,e,n){const i=[{fixed:-1,stretch:0}];for(const[r,s]of t){const t=i[i.length-1];i.push({fixed:r-t.stretch,stretch:t.stretch}),i.push({fixed:r-t.stretch,stretch:t.stretch+(s-r)})}return i.push({fixed:e+1,stretch:n}),i}function Gl(t,e,n,i){return t/e*n+i}function ql(t,e,n,i){return t-e*n/i}on("Anchor",zl);class $l{constructor(t,e,n,i,r,s,o,a,l,c){if(this.boxStartIndex=t.length,l){let t=s.top,e=s.bottom;const n=s.collisionPadding;n&&(t-=n[1],e+=n[3]);let i=e-t;i>0&&(i=Math.max(10,i),this.circleDiameter=i)}else{let l=s.top*o-a,u=s.bottom*o+a,h=s.left*o-a,d=s.right*o+a;const p=s.collisionPadding;if(p&&(h-=p[0]*o,l-=p[1]*o,d+=p[2]*o,u+=p[3]*o),c){const t=new lr(h,l),e=new lr(d,l),n=new lr(h,u),i=new lr(d,u),r=c*Math.PI/180;t._rotate(r),e._rotate(r),n._rotate(r),i._rotate(r),h=Math.min(t.x,e.x,n.x,i.x),d=Math.max(t.x,e.x,n.x,i.x),l=Math.min(t.y,e.y,n.y,i.y),u=Math.max(t.y,e.y,n.y,i.y)}t.emplaceBack(e.x,e.y,h,l,d,u,n,i,r)}this.boxEndIndex=t.length}}class Wl{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zl;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,s=e[r];if(n(i,s)>=0)break;e[t]=s,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1),s=e[i];const o=i+1;if(o<this.length&&n(e[o],s)<0&&(i=o,s=e[o]),n(s,r)>=0)break;e[t]=s,t=i}e[t]=r}}function Zl(t,e){return t<e?-1:t>e?1:0}function Hl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,r=1/0,s=-1/0,o=-1/0;const a=t[0];for(let p=0;p<a.length;p++){const t=a[p];(!p||t.x<i)&&(i=t.x),(!p||t.y<r)&&(r=t.y),(!p||t.x>s)&&(s=t.x),(!p||t.y>o)&&(o=t.y)}const l=Math.min(s-i,o-r);let c=l/2;const u=new Wl([],Xl);if(0===l)return new lr(i,r);for(let p=i;p<s;p+=l)for(let e=r;e<o;e+=l)u.push(new Yl(p+c,e+c,c,t));let h=function(t){let e=0,n=0,i=0;const r=t[0];for(let s=0,o=r.length,a=o-1;s<o;a=s++){const t=r[s],o=r[a],l=t.x*o.y-o.x*t.y;n+=(t.x+o.x)*l,i+=(t.y+o.y)*l,e+=3*l}return new Yl(n/e,i/e,0,t)}(t),d=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=e||(c=i.h/2,u.push(new Yl(i.p.x-c,i.p.y-c,c,t)),u.push(new Yl(i.p.x+c,i.p.y-c,c,t)),u.push(new Yl(i.p.x-c,i.p.y+c,c,t)),u.push(new Yl(i.p.x+c,i.p.y+c,c,t)),d+=4)}return n&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function Xl(t,e){return e.max-t.max}function Yl(t,e,n,i){this.p=new lr(t,e),this.h=n,this.d=function(t,e){let n=!1,i=1/0;for(let r=0;r<e.length;r++){const s=e[r];for(let e=0,r=s.length,o=r-1;e<r;o=e++){const r=s[e],a=s[o];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,qs(t,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const Kl=Number.POSITIVE_INFINITY;function Jl(t,e,n,i,r,s,o){t.createArrays(),t.tilePixelRatio=Cs/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const l=t.layers[0].layout,c=t.layers[0]._unevaluatedLayout._values,u={layoutIconSize:c["icon-size"].possiblyEvaluate(new Ni(t.zoom+1),o),layoutTextSize:c["text-size"].possiblyEvaluate(new Ni(t.zoom+1),o),textMaxSize:c["text-size"].possiblyEvaluate(new Ni(18))};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.textSizeData;u.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Ni(e),o),c["text-size"].possiblyEvaluate(new Ni(n),o)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.iconSizeData;u.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Ni(e),o),c["icon-size"].possiblyEvaluate(new Ni(n),o)]}const h=l.get("text-line-height")*Ua,d="viewport"!==l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),p=l.get("text-keep-upright"),f=l.get("text-size");for(const y of t.features){const s=l.get("text-font").evaluate(y,{},o).join(","),c=f.evaluate(y,{},o),_=u.layoutTextSize.evaluate(y,{},o),v=u.layoutIconSize.evaluate(y,{},o),x={horizontal:{},vertical:void 0},b=y.text;let w,S=[0,0];if(b){const i=b.toString(),a=l.get("text-letter-spacing").evaluate(y,{},o)*Ua,u=Ci(i)?a:0,f=l.get("text-anchor").evaluate(y,{},o),v=l.get("text-variable-anchor");if(!v){const t=l.get("text-radial-offset").evaluate(y,{},o);t?(m=f,S=(g=[t*Ua,Kl])[1]!==Kl?function(t,e,n){let i=0,r=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,r]}(m,g[0],g[1]):function(t,e){let n=0,i=0;e<0&&(e=0);const r=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}(m,g[0])):S=l.get("text-offset").evaluate(y,{},o).map((t=>t*Ua))}let w=d?"center":l.get("text-justify").evaluate(y,{},o);const E=l.get("symbol-placement"),T="point"===E?l.get("text-max-width").evaluate(y,{},o)*Ua:0,A=()=>{t.allowVerticalPlacement&&Ii(i)&&(x.vertical=yl(b,e,n,r,s,T,h,f,"left",u,S,Wa.vertical,!0,E,_,c))};if(!d&&v){const t="auto"===w?v.map((t=>Ql(t))):[w];let i=!1;for(let o=0;o<t.length;o++){const a=t[o];if(!x.horizontal[a])if(i)x.horizontal[a]=x.horizontal[0];else{const t=yl(b,e,n,r,s,T,h,"center",a,u,S,Wa.horizontal,!1,E,_,c);t&&(x.horizontal[a]=t,i=1===t.positionedLines.length)}}A()}else{"auto"===w&&(w=Ql(f));const t=yl(b,e,n,r,s,T,h,f,w,u,S,Wa.horizontal,!1,E,_,c);t&&(x.horizontal[w]=t),A(),Ii(i)&&d&&p&&(x.vertical=yl(b,e,n,r,s,T,h,f,w,u,S,Wa.vertical,!1,E,_,c))}}let E=!1;if(y.icon&&y.icon.name){const e=i[y.icon.name];e&&(w=Pl(r[y.icon.name],l.get("icon-offset").evaluate(y,{},o),l.get("icon-anchor").evaluate(y,{},o)),E=!!e.sdf,void 0===t.sdfIcons?t.sdfIcons=E:t.sdfIcons!==E&&a("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const T=ic(x.horizontal)||x.vertical;t.iconsInText=!!T&&T.iconsInText,(T||w)&&tc(t,y,x,w,i,u,_,v,S,E,o)}var m,g;s&&t.generateCollisionDebugBuffers()}function Ql(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tc(t,e,n,i,r,s,o,l,c,u,h){let d=s.textMaxSize.evaluate(e,{});void 0===d&&(d=o);const p=t.layers[0].layout,f=p.get("icon-offset").evaluate(e,{},h),m=ic(n.horizontal),g=o/24,y=t.tilePixelRatio*g,_=t.tilePixelRatio*d/24,v=t.tilePixelRatio*l,x=t.tilePixelRatio*p.get("symbol-spacing"),b=p.get("text-padding")*t.tilePixelRatio,w=p.get("icon-padding")*t.tilePixelRatio,S=p.get("text-max-angle")/180*Math.PI,E="viewport"!==p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),T="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),A=p.get("symbol-placement"),k=x/2,P=p.get("icon-text-fit");let I;i&&"none"!==P&&(t.allowVerticalPlacement&&n.vertical&&(I=Il(i,n.vertical,P,p.get("icon-text-fit-padding"),f,g)),m&&(i=Il(i,m,P,p.get("icon-text-fit-padding"),f,g)));const C=(l,d)=>{d.x<0||d.x>=Cs||d.y<0||d.y>=Cs||function(t,e,n,i,r,s,o,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T){const A=t.addToLineVertexArray(e,n);let k,P,I,C,M=0,z=0,L=0,D=0,R=-1,B=-1;const O={};let F=hs(""),V=0,N=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[V,N]=l.layout.get("text-offset").evaluate(b,{},E).map((t=>t*Ua)):(V=l.layout.get("text-radial-offset").evaluate(b,{},E)*Ua,N=Kl),t.allowVerticalPlacement&&i.vertical){const t=l.layout.get("text-rotate").evaluate(b,{},E)+90;I=new $l(c,e,u,h,d,i.vertical,p,f,m,t),o&&(C=new $l(c,e,u,h,d,o,y,_,m,t))}if(r){const n=l.layout.get("icon-rotate").evaluate(b,{}),i="none"!==l.layout.get("icon-text-fit"),s=Nl(r,n,S,i),p=o?Nl(o,n,S,i):void 0;P=new $l(c,e,u,h,d,r,y,_,!1,n),M=4*s.length;const f=t.iconSizeData;let m=null;"source"===f.kind?(m=[Cl*l.layout.get("icon-size").evaluate(b,{})],m[0]>ec&&a(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Cl*w.compositeIconSizes[0].evaluate(b,{},E),Cl*w.compositeIconSizes[1].evaluate(b,{},E)],(m[0]>ec||m[1]>ec)&&a(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,m,x,v,b,Wa.none,e,A.lineStartIndex,A.lineLength,-1,E),R=t.icon.placedSymbolArray.length-1,p&&(z=4*p.length,t.addSymbols(t.icon,p,m,x,v,b,Wa.vertical,e,A.lineStartIndex,A.lineLength,-1,E),B=t.icon.placedSymbolArray.length-1)}const U=Object.keys(i.horizontal);for(const a of U){const n=i.horizontal[a];if(!k){F=hs(n.text);const t=l.layout.get("text-rotate").evaluate(b,{},E);k=new $l(c,e,u,h,d,n,p,f,m,t)}const r=1===n.positionedLines.length;if(L+=nc(t,e,n,s,l,m,b,g,A,i.vertical?Wa.horizontal:Wa.horizontalOnly,r?U:[a],O,R,w,E),r)break}i.vertical&&(D+=nc(t,e,i.vertical,s,l,m,b,g,A,Wa.vertical,["vertical"],O,B,w,E));const j=k?k.boxStartIndex:t.collisionBoxArray.length,G=k?k.boxEndIndex:t.collisionBoxArray.length,q=I?I.boxStartIndex:t.collisionBoxArray.length,$=I?I.boxEndIndex:t.collisionBoxArray.length,W=P?P.boxStartIndex:t.collisionBoxArray.length,Z=P?P.boxEndIndex:t.collisionBoxArray.length,H=C?C.boxStartIndex:t.collisionBoxArray.length,X=C?C.boxEndIndex:t.collisionBoxArray.length;let Y=-1;const K=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;Y=K(k,Y),Y=K(I,Y),Y=K(P,Y),Y=K(C,Y);const J=Y>-1?1:0;J&&(Y*=T/Ua),t.glyphOffsetArray.length>=dc.MAX_GLYPHS&&a("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical||-1,R,B,F,j,G,q,$,W,Z,H,X,u,L,D,M,z,J,0,p,V,N,Y)}(t,d,l,n,i,r,I,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,y,b,E,c,v,w,T,f,e,s,u,h,o)};if("line"===A)for(const a of function(t,e,n,i,r){const s=[];for(let o=0;o<t.length;o++){const e=t[o];let n;for(let t=0;t<e.length-1;t++){let o=e[t],a=e[t+1];o.x<0&&a.x<0||(o.x<0?o=new lr(0,o.y+(0-o.x)/(a.x-o.x)*(a.y-o.y))._round():a.x<0&&(a=new lr(0,o.y+(0-o.x)/(a.x-o.x)*(a.y-o.y))._round()),o.y<0&&a.y<0||(o.y<0?o=new lr(o.x+(0-o.y)/(a.y-o.y)*(a.x-o.x),0)._round():a.y<0&&(a=new lr(o.x+(0-o.y)/(a.y-o.y)*(a.x-o.x),0)._round()),o.x>=i&&a.x>=i||(o.x>=i?o=new lr(i,o.y+(i-o.x)/(a.x-o.x)*(a.y-o.y))._round():a.x>=i&&(a=new lr(i,o.y+(i-o.x)/(a.x-o.x)*(a.y-o.y))._round()),o.y>=r&&a.y>=r||(o.y>=r?o=new lr(o.x+(r-o.y)/(a.y-o.y)*(a.x-o.x),r)._round():a.y>=r&&(a=new lr(o.x+(r-o.y)/(a.y-o.y)*(a.x-o.x),r)._round()),n&&o.equals(n[n.length-1])||(n=[o],s.push(n)),n.push(a)))))}}return s}(e.geometry,0,0,Cs,Cs)){const e=Fl(a,x,S,n.vertical||m,i,24,_,t.overscaling,Cs);for(const n of e){const e=m;e&&rc(t,e.text,k,n)||C(a,n)}}else if("line-center"===A){for(const a of e.geometry)if(a.length>1){const t=Ol(a,S,n.vertical||m,i,24,_);t&&C(a,t)}}else if("Polygon"===e.type)for(const a of Zo(e.geometry,0)){const t=Hl(a,16);C(a[0],new zl(t.x,t.y,0))}else if("LineString"===e.type)for(const a of e.geometry)C(a,new zl(a[0].x,a[0].y,0));else if("Point"===e.type)for(const a of e.geometry)for(const t of a)C([t],new zl(t.x,t.y,0))}const ec=32640;function nc(t,e,n,i,r,s,o,l,c,u,h,d,p,f,m){const g=function(t,e,n,i,r,s,o,a){const l=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,c=[];for(const u of e.positionedLines)for(const t of u.positionedGlyphs){if(!t.rect)continue;const i=t.rect||{};let s=4,h=!0,d=1,p=0;const f=(r||a)&&t.vertical,m=t.metrics.advance*t.scale/2;if(a&&e.verticalizable){const e=(t.scale-1)*Ua,n=(Ua-t.metrics.width*t.scale)/2;p=u.lineOffset/2-(t.imageName?-n:e)}if(t.imageName){const e=o[t.imageName];h=e.sdf,d=e.pixelRatio,s=1/d}const g=r?[t.x+m,t.y]:[0,0];let y=r?[0,0]:[t.x+m+n[0],t.y+n[1]-p],_=[0,0];f&&(_=y,y=[0,0]);const v=(t.metrics.left-s)*t.scale-m+y[0],x=(-t.metrics.top-s)*t.scale+y[1],b=v+i.w*t.scale/d,w=x+i.h*t.scale/d,S=new lr(v,x),E=new lr(b,x),T=new lr(v,w),A=new lr(b,w);if(f){const e=new lr(-m,m-fl),n=-Math.PI/2,i=12-m,r=new lr(22-i,-(t.imageName?i:0)),s=new lr(..._);S._rotateAround(n,e)._add(r)._add(s),E._rotateAround(n,e)._add(r)._add(s),T._rotateAround(n,e)._add(r)._add(s),A._rotateAround(n,e)._add(r)._add(s)}if(l){const t=Math.sin(l),e=Math.cos(l),n=[e,-t,t,e];S._matMult(n),E._matMult(n),T._matMult(n),A._matMult(n)}const k=new lr(0,0),P=new lr(0,0);c.push({tl:S,tr:E,bl:T,br:A,tex:i,writingMode:e.writingMode,glyphOffset:g,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:k,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}return c}(0,n,l,r,s,o,i,t.allowVerticalPlacement),y=t.textSizeData;let _=null;"source"===y.kind?(_=[Cl*r.layout.get("text-size").evaluate(o,{})],_[0]>ec&&a(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===y.kind&&(_=[Cl*f.compositeTextSizes[0].evaluate(o,{},m),Cl*f.compositeTextSizes[1].evaluate(o,{},m)],(_[0]>ec||_[1]>ec)&&a(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,g,_,l,s,o,u,e,c.lineStartIndex,c.lineLength,p,m);for(const a of h)d[a]=t.text.placedSymbolArray.length-1;return 4*g.length}function ic(t){for(const e in t)return t[e];return null}function rc(t,e,n,i){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<n)return!0}else r[e]=[];return r[e].push(i),!1}const sc=na.VectorTileFeature.types,oc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ac(t,e,n,i,r,s,o,a,l,c,u,h,d){const p=a?Math.min(ec,Math.round(a[0])):0,f=a?Math.min(ec,Math.round(a[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),s,o,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function lc(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function cc(t){for(const e of t.sections)if(Bi(e.text))return!0;return!1}class uc{constructor(t){this.layoutVertexArray=new Hr,this.indexArray=new Qr,this.programConfigurations=t,this.segments=new is,this.dynamicLayoutVertexArray=new Xr,this.opacityVertexArray=new Yr,this.placedSymbolArray=new Rr}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ra.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ba.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,oc,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}on("SymbolBuffers",uc);class hc{constructor(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new is,this.collisionVertexArray=new Jr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Oa.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}on("CollisionBuffers",hc);class dc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=eo([]),this.placementViewportMatrix=eo([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ml(this.zoom,e["text-size"]),this.iconSizeData=Ml(this.zoom,e["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap="never"!==yc(n,"text-overlap","text-allow-overlap")||"never"!==yc(n,"icon-overlap","icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&!i.isConstant(),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((t=>Wa[t]))),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=t.sourceID}createArrays(){this.text=new uc(new ks(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new uc(new ks(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Fr,this.lineVertexArray=new Vr,this.symbolInstances=new Or}calculateGlyphDependencies(t,e,n,i,r){for(let s=0;s<t.length;s++)if(e[t.charCodeAt(s)]=!0,(n||i)&&r){const n=Na[t.charAt(s)];n&&(e[n.charCodeAt(0)]=!0)}}populate(t,e,n){const i=this.layers[0],r=i.layout,s=r.get("text-font"),o=r.get("text-field"),a=r.get("icon-image"),l=("constant"!==o.value.kind||o.value.value instanceof G&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),c="constant"!==a.value.kind||!!a.value.value||Object.keys(a.parameters).length>0,u=r.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const h=e.iconDependencies,d=e.glyphDependencies,p=e.availableImages,f=new Ni(this.zoom);for(const{feature:m,id:g,index:y,sourceLayerIndex:_}of t){const t=i._featureFilter.needGeometry,e=Ds(m,t);if(!i._featureFilter.filter(f,e,n))continue;let o,a;if(t||(e.geometry=Ls(m)),l){const t=i.getValueAndResolveTokens("text-field",e,n,p),r=G.factory(t);cc(r)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Oi||this.hasRTLText&&Vi.isParsed())&&(o=Va(r,i,e))}if(c){const t=i.getValueAndResolveTokens("icon-image",e,n,p);a=t instanceof q?t:q.fromString(t)}if(!o&&!a)continue;const v=this.sortFeaturesByKey?u.evaluate(e,{},n):void 0;if(this.features.push({id:g,text:o,icon:a,index:y,sourceLayerIndex:_,geometry:e.geometry,properties:m.properties,type:sc[m.type],sortKey:v}),a&&(h[a.name]=!0),o){const t=s.evaluate(e,{},n).join(","),i="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wa.vertical)>=0;for(const e of o.sections)if(e.image)h[e.image.name]=!0;else{const n=Ii(o.toString()),r=e.fontStack||t,s=d[r]=d[r]||{};this.calculateGlyphDependencies(e.text,s,i,this.allowVerticalPlacement,n)}}}"line"===r.get("symbol-placement")&&(this.features=function(t){const e={},n={},i=[];let r=0;function s(e){i.push(t[e]),r++}function o(t,e,r){const s=n[t];return delete n[t],n[e]=s,i[s].geometry[0].pop(),i[s].geometry[0]=i[s].geometry[0].concat(r[0]),s}function a(t,n,r){const s=e[n];return delete e[n],e[t]=s,i[s].geometry[0].shift(),i[s].geometry[0]=r[0].concat(i[s].geometry[0]),s}function l(t,e,n){const i=n?e[0][e[0].length-1]:e[0][0];return`${t}:${i.x}:${i.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){s(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in e&&n[p]!==e[f]){const t=a(p,f,h),r=o(p,f,i[t].geometry);delete e[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[t].geometry=null}else p in n?o(p,f,h):f in e?a(p,f,h):(s(c),e[p]=r-1,n[f]=r-1)}return i.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const n=this.lineVertexArray.length;if(void 0!==t.segment){let n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]);const r={};for(let s=t.segment+1;s<e.length;s++)r[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s<e.length-1&&(n+=e[s+1].dist(e[s]));for(let s=t.segment||0;s>=0;s--)r[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,e,n,i,r,s,o,a,l,c,u,h){const d=t.indexArray,p=t.layoutVertexArray,f=t.segments.prepareSegment(4*e.length,p,d,this.canOverlap?s.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,y=this.allowVerticalPlacement&&o===Wa.vertical?Math.PI/2:0,_=s.text&&s.text.sections;for(let v=0;v<e.length;v++){const{tl:i,tr:r,bl:o,br:l,tex:c,pixelOffsetTL:u,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:S}=e[v],E=f.vertexLength,T=b[1];ac(p,a.x,a.y,i.x,T+i.y,c.x,c.y,n,w,u.x,u.y,g,x),ac(p,a.x,a.y,r.x,T+r.y,c.x+c.w,c.y,n,w,m.x,u.y,g,x),ac(p,a.x,a.y,o.x,T+o.y,c.x,c.y+c.h,n,w,u.x,m.y,g,x),ac(p,a.x,a.y,l.x,T+l.y,c.x+c.w,c.y+c.h,n,w,m.x,m.y,g,x),lc(t.dynamicLayoutVertexArray,a,y),d.emplaceBack(E,E+1,E+2),d.emplaceBack(E+1,E+2,E+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),v!==e.length-1&&S===e[v+1].sectionIndex||t.programConfigurations.populatePaintArrays(p.length,s,s.index,{},h,_&&_[S])}t.placedSymbolArray.emplaceBack(a.x,a.y,m,this.glyphOffsetArray.length-m,g,l,c,a.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],o,0,!1,0,u)}_addCollisionDebugVertex(t,e,n,i,r,s){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i,r,Math.round(s.x),Math.round(s.y))}addCollisionDebugVertices(t,e,n,i,r,s,o){const a=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=a.vertexLength,c=r.layoutVertexArray,u=r.collisionVertexArray,h=o.anchorX,d=o.anchorY;this._addCollisionDebugVertex(c,u,s,h,d,new lr(t,e)),this._addCollisionDebugVertex(c,u,s,h,d,new lr(n,e)),this._addCollisionDebugVertex(c,u,s,h,d,new lr(n,i)),this._addCollisionDebugVertex(c,u,s,h,d,new lr(t,i)),a.vertexLength+=4;const p=r.indexArray;p.emplaceBack(l,l+1),p.emplaceBack(l+1,l+2),p.emplaceBack(l+2,l+3),p.emplaceBack(l+3,l),a.primitiveLength+=4}addDebugCollisionBoxes(t,e,n,i){for(let r=t;r<e;r++){const t=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,i?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hc(Kr,Fa.members,ts),this.iconCollisionBox=new hc(Kr,Fa.members,ts);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,n,i,r,s,o,a,l){const c={};for(let u=e;u<n;u++){const e=t.get(u);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let u=i;u<r;u++){const e=t.get(u);c.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalTextFeatureIndex=e.featureIndex;break}for(let u=s;u<o;u++){const e=t.get(u);c.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.iconFeatureIndex=e.featureIndex;break}for(let u=a;u<l;u++){const e=t.get(u);c.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalIconFeatureIndex=e.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const n=t.placedSymbolArray.get(e),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)t.indexArray.emplaceBack(r,r+1,r+2),t.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),n=Math.cos(t),i=[],r=[],s=[];for(let o=0;o<this.symbolInstances.length;++o){s.push(o);const t=this.symbolInstances.get(o);i.push(0|Math.round(e*t.anchorX+n*t.anchorY)),r.push(t.featureIndex)}return s.sort(((t,e)=>i[t]-i[e]||r[e]-r[t])),s}addToSortKeyRanges(t,e){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,n)=>{t>=0&&n.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}on("SymbolBucket",dc,{omit:["layers","collisionBoxArray","features","compareText"]}),dc.MAX_GLYPHS=65535,dc.addDynamicAttributes=lc;const pc=new tr({"symbol-placement":new Xi(dn.layout_symbol["symbol-placement"]),"symbol-spacing":new Xi(dn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xi(dn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yi(dn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xi(dn.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xi(dn.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xi(dn.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xi(dn.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xi(dn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xi(dn.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yi(dn.layout_symbol["icon-size"]),"icon-text-fit":new Xi(dn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xi(dn.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yi(dn.layout_symbol["icon-image"]),"icon-rotate":new Yi(dn.layout_symbol["icon-rotate"]),"icon-padding":new Xi(dn.layout_symbol["icon-padding"]),"icon-keep-upright":new Xi(dn.layout_symbol["icon-keep-upright"]),"icon-offset":new Yi(dn.layout_symbol["icon-offset"]),"icon-anchor":new Yi(dn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xi(dn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xi(dn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xi(dn.layout_symbol["text-rotation-alignment"]),"text-field":new Yi(dn.layout_symbol["text-field"]),"text-font":new Yi(dn.layout_symbol["text-font"]),"text-size":new Yi(dn.layout_symbol["text-size"]),"text-max-width":new Yi(dn.layout_symbol["text-max-width"]),"text-line-height":new Xi(dn.layout_symbol["text-line-height"]),"text-letter-spacing":new Yi(dn.layout_symbol["text-letter-spacing"]),"text-justify":new Yi(dn.layout_symbol["text-justify"]),"text-radial-offset":new Yi(dn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xi(dn.layout_symbol["text-variable-anchor"]),"text-anchor":new Yi(dn.layout_symbol["text-anchor"]),"text-max-angle":new Xi(dn.layout_symbol["text-max-angle"]),"text-writing-mode":new Xi(dn.layout_symbol["text-writing-mode"]),"text-rotate":new Yi(dn.layout_symbol["text-rotate"]),"text-padding":new Xi(dn.layout_symbol["text-padding"]),"text-keep-upright":new Xi(dn.layout_symbol["text-keep-upright"]),"text-transform":new Yi(dn.layout_symbol["text-transform"]),"text-offset":new Yi(dn.layout_symbol["text-offset"]),"text-allow-overlap":new Xi(dn.layout_symbol["text-allow-overlap"]),"text-overlap":new Xi(dn.layout_symbol["text-overlap"]),"text-ignore-placement":new Xi(dn.layout_symbol["text-ignore-placement"]),"text-optional":new Xi(dn.layout_symbol["text-optional"])});var fc={paint:new tr({"icon-opacity":new Yi(dn.paint_symbol["icon-opacity"]),"icon-color":new Yi(dn.paint_symbol["icon-color"]),"icon-halo-color":new Yi(dn.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yi(dn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yi(dn.paint_symbol["icon-halo-blur"]),"icon-translate":new Xi(dn.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xi(dn.paint_symbol["icon-translate-anchor"]),"text-opacity":new Yi(dn.paint_symbol["text-opacity"]),"text-color":new Yi(dn.paint_symbol["text-color"],{runtimeType:I,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Yi(dn.paint_symbol["text-halo-color"]),"text-halo-width":new Yi(dn.paint_symbol["text-halo-width"]),"text-halo-blur":new Yi(dn.paint_symbol["text-halo-blur"]),"text-translate":new Xi(dn.paint_symbol["text-translate"]),"text-translate-anchor":new Xi(dn.paint_symbol["text-translate-anchor"])}),layout:pc};class mc{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:T,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}on("FormatSectionOverride",mc,{omit:["defaultValue"]});class gc extends nr{constructor(t){super(t,fc)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const n of t)e.indexOf(n)<0&&e.push(n);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,n,i){const r=this.layout.get(t).evaluate(e,{},n,i),s=this._unevaluatedLayout._values[t];return s.isDataDriven()||Fe(s.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,((e,n)=>n in t?String(t[n]):""))}(e.properties,r)}createBucket(t){return new dc(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of fc.paint.overridableProperties){if(!gc.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),n=new mc(e),i=new Oe(n,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new Ne("source",i):new Ue("composite",i,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new Zi(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven())&&gc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const n=t.get("text-field"),i=fc.paint.properties[e];let r=!1;const s=t=>{for(const e of t)if(i.overrides&&i.overrides.hasOverride(e))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof G)s(n.value.value.sections);else if("source"===n.value.kind){const t=e=>{r||(e instanceof X&&Z(e.value)===L?s(e.value.sections):e instanceof Q?s(e.sections):e.eachChild(t))},e=n.value;e._styleExpression&&t(e._styleExpression.expression)}return r}}function yc(t,e,n){let i="never";const r=t.get(e);return r?i=r:t.get(n)&&(i="always"),i}var _c={paint:new tr({"background-color":new Xi(dn.paint_background["background-color"]),"background-pattern":new Ji(dn.paint_background["background-pattern"]),"background-opacity":new Xi(dn.paint_background["background-opacity"])})},vc={paint:new tr({"raster-opacity":new Xi(dn.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xi(dn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xi(dn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xi(dn.paint_raster["raster-brightness-max"]),"raster-saturation":new Xi(dn.paint_raster["raster-saturation"]),"raster-contrast":new Xi(dn.paint_raster["raster-contrast"]),"raster-resampling":new Xi(dn.paint_raster["raster-resampling"]),"raster-fade-duration":new Xi(dn.paint_raster["raster-fade-duration"])})};class xc extends nr{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const bc={circle:class extends nr{constructor(t){super(t,Qs)}createBucket(t){return new Bs(t)}queryRadius(t){const e=t;return Hs("circle-radius",this,e)+Hs("circle-stroke-width",this,e)+Xs(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,r,s,o,a){const l=Ys(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,o),c=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((t=>io(t,e)))}(l,a),d=u?c*o:c;for(const p of i)for(const t of p){const e=u?t:io(t,a);let n=d;const i=no([],[t.x,t.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?n*=i[3]/s.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(n*=s.cameraToCenterDistance/i[3]),Fs(h,e,n))return!0}return!1}},heatmap:class extends nr{constructor(t){super(t,so),this._updateColorRamp()}createBucket(t){return new ro(t)}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=function(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,r=t.image||new uo({width:n,height:i}),s=(n,i,s)=>{e[t.evaluationKey]=s;const o=t.expression.evaluate(e);r.data[n+i+0]=Math.floor(255*o.r/o.a),r.data[n+i+1]=Math.floor(255*o.g/o.a),r.data[n+i+2]=Math.floor(255*o.b/o.a),r.data[n+i+3]=Math.floor(255*o.a)};if(t.clips)for(let o=0,a=0;o<i;++o,a+=4*n)for(let e=0,i=0;e<n;e++,i+=4){const r=e/(n-1),{start:l,end:c}=t.clips[o];s(a,i,l*(1-r)+c*r)}else for(let o=0,a=0;o<n;o++,a+=4)s(0,a,o/(n-1));return r}({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends nr{constructor(t){super(t,ho)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends nr{constructor(t){super(t,Qo)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ko(t)}queryRadius(){return Xs(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,r,s,o){return Vs(Ys(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,o),i)}isTileClipped(){return!0}},"fill-extrusion":class extends nr{constructor(t){super(t,xa)}createBucket(t){return new ya(t)}queryRadius(){return Xs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,e,n,i,r,s,o,a){const l=Ys(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,o),c=this.paint.get("fill-extrusion-height").evaluate(e,n),u=this.paint.get("fill-extrusion-base").evaluate(e,n),h=function(t,e,n,i){const r=[];for(const s of t){const t=[s.x,s.y,0,1];no(t,t,e),r.push(new lr(t[0]/t[3],t[1]/t[3]))}return r}(l,a),d=function(t,e,n,i){const r=[],s=[],o=i[8]*e,a=i[9]*e,l=i[10]*e,c=i[11]*e,u=i[8]*n,h=i[9]*n,d=i[10]*n,p=i[11]*n;for(const f of t){const t=[],e=[];for(const n of f){const r=n.x,s=n.y,f=i[0]*r+i[4]*s+i[12],m=i[1]*r+i[5]*s+i[13],g=i[2]*r+i[6]*s+i[14],y=i[3]*r+i[7]*s+i[15],_=g+l,v=y+c,x=f+u,b=m+h,w=g+d,S=y+p,E=new lr((f+o)/v,(m+a)/v);E.z=_/v,t.push(E);const T=new lr(x/S,b/S);T.z=w/S,e.push(T)}r.push(t),s.push(e)}return[r,s]}(i,u,c,a);return function(t,e,n){let i=1/0;Vs(n,e)&&(i=wa(n,e[0]));for(let r=0;r<e.length;r++){const s=e[r],o=t[r];for(let t=0;t<s.length-1;t++){const e=s[t],r=[e,s[t+1],o[t+1],o[t],e];Os(n,r)&&(i=Math.min(i,wa(n,r)))}}return i!==1/0&&i}(d[0],d[1],h)}},line:class extends nr{constructor(t){super(t,za),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Mt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=La.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ca(t)}queryRadius(t){const e=t,n=Da(Hs("line-width",this,e),Hs("line-gap-width",this,e)),i=Hs("line-offset",this,e);return n/2+Math.abs(i)+Xs(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,r,s,o){const a=Ys(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,o),l=o/2*Da(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(i=function(t,e){const n=[];for(let i=0;i<t.length;i++){const r=t[i],s=[];for(let t=0;t<r.length;t++){const n=r[t-1],i=r[t],o=r[t+1],a=0===t?new lr(0,0):i.sub(n)._unit()._perp(),l=t===r.length-1?new lr(0,0):o.sub(i)._unit()._perp(),c=a._add(l)._unit(),u=c.x*l.x+c.y*l.y;0!==u&&c._mult(1/u),s.push(c._mult(e)._add(i))}n.push(s)}return n}(i,c*o)),function(t,e,n){for(let i=0;i<e.length;i++){const r=e[i];if(t.length>=3)for(let e=0;e<r.length;e++)if(Ws(t,r[e]))return!0;if(Ns(t,r,n))return!0}return!1}(a,i,l)}isTileClipped(){return!0}},symbol:gc,background:class extends nr{constructor(t){super(t,_c)}},raster:class extends nr{constructor(t){super(t,vc)}}};function wc(t){return"custom"===t.type?new xc(t):new bc[t.type](t)}var Sc=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ec(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const n of t)e+=`${Ec(n)},`;return`${e}]`}const n=Object.keys(t).sort();let i="{";for(let r=0;r<n.length;r++)i+=`${JSON.stringify(n[r])}:${Ec(t[n[r]])},`;return`${i}}`}function Tc(t){let e="";for(const n of Sc)e+=`/${Ec(t[n])}`;return e}class Ac{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(t,e){for(const i of t){this._layerConfigs[i.id]=i;const t=this._layers[i.id]=wc(i);t._featureFilter=Tn(t.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const i of e)delete this.keyCache[i],delete this._layerConfigs[i],delete this._layers[i];this.familiesBySource={};const n=function(t,e){const n={};for(let r=0;r<t.length;r++){const i=e&&e[t[r].id]||Tc(t[r]);e&&(e[t[r].id]=i);let s=n[i];s||(s=n[i]=[]),s.push(t[r])}const i=[];for(const r in n)i.push(n[r]);return i}(Object.values(this._layerConfigs),this.keyCache);for(const i of n){const t=i.map((t=>this._layers[t.id])),e=t[0];if("none"===e.visibility)continue;const n=e.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const s=e.sourceLayer||"_geojsonTileLayer";let o=r[s];o||(o=r[s]=[]),o.push(t)}}}class kc{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Pc{constructor(t,e,n,i,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class Ic{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new f(Cs,16,0),this.grid3D=new f(Cs,16,0),this.featureIndexArray=new Ur,this.promoteId=e}insert(t,e,n,i,r,s){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);const a=s?this.grid3D:this.grid;for(let l=0;l<e.length;l++){const t=e[l],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const i=t[e];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<Cs&&n[1]<Cs&&n[2]>=0&&n[3]>=0&&a.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new na.VectorTile(new ja(this.rawTileData)).layers,this.sourceLayerCoder=new kc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,n,i){this.loadVTLayers();const r=t.params||{},s=Cs/t.tileSize/t.scale,o=Tn(r.filter),a=t.queryGeometry,l=t.queryPadding*s,c=Mc(a),u=this.grid.query(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l),h=Mc(t.cameraQueryGeometry),d=this.grid3D.query(h.minX-l,h.minY-l,h.maxX+l,h.maxY+l,((e,n,i,r)=>function(t,e,n,i,r){for(const o of t)if(e<=o.x&&n<=o.y&&i>=o.x&&r>=o.y)return!0;const s=[new lr(e,n),new lr(e,r),new lr(i,r),new lr(i,n)];if(t.length>2)for(const o of s)if(Ws(t,o))return!0;for(let o=0;o<t.length-1;o++)if(Zs(t[o],t[o+1],s))return!0;return!1}(t.cameraQueryGeometry,e-l,n-l,i+l,r+l)));for(const m of d)u.push(m);u.sort(zc);const p={};let f;for(let m=0;m<u.length;m++){const l=u[m];if(l===f)continue;f=l;const c=this.featureIndexArray.get(l);let h=null;this.loadMatchingFeature(p,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,o,r.layers,r.availableImages,e,n,i,((e,n,i)=>(h||(h=Ls(e)),n.queryIntersectsFeature(a,e,i,h,this.z,t.transform,s,t.pixelPosMatrix))))}return p}loadMatchingFeature(t,e,n,r,s,o,a,l,c,u,h){const d=this.bucketLayerIDs[e];if(o&&!function(t,e){for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,d))return;const p=this.sourceLayerCoder.decode(n),f=this.vtLayers[p].feature(r);if(s.needGeometry){const t=Ds(f,!0);if(!s.filter(new Ni(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!s.filter(new Ni(this.tileID.overscaledZ),f))return;const m=this.getId(f,p);for(let g=0;g<d.length;g++){const e=d[g];if(o&&o.indexOf(e)<0)continue;const n=l[e];if(!n)continue;let s={};m&&u&&(s=u.getState(n.sourceLayer||"_geojsonTileLayer",m));const p=i({},c[e]);p.paint=Cc(p.paint,n.paint,f,s,a),p.layout=Cc(p.layout,n.layout,f,s,a);const y=!h||h(f,n,s);if(!y)continue;const _=new Pc(f,this.z,this.x,this.y,m);_.layer=p;let v=t[e];void 0===v&&(v=t[e]=[]),v.push({featureIndex:r,feature:_,intersectionZ:y})}}lookupSymbolFeatures(t,e,n,i,r,s,o,a){const l={};this.loadVTLayers();const c=Tn(r);for(const u of t)this.loadMatchingFeature(l,n,i,u,c,s,o,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const n of e)if(t===n)return!0;return!1}getId(t,e){let n=t.id;return this.promoteId&&(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof n&&(n=Number(n))),n}}function Cc(t,e,n,i,s){return r(t,((t,r)=>{const o=e instanceof Hi?e.get(r):null;return o&&o.evaluate?o.evaluate(n,i,s):o}))}function Mc(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(const s of t)e=Math.min(e,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x),r=Math.max(r,s.y);return{minX:e,minY:n,maxX:i,maxY:r}}function zc(t,e){return e-t}on("FeatureIndex",Ic,{omit:["rawTileData","sourceLayerCoder"]});class Lc{constructor(t){const e={},n=[];for(const o in t){const i=t[o],r=e[o]={};for(const t in i){const e=i[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const s={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};n.push(s),r[t]={rect:s,metrics:e.metrics}}}const{w:i,h:r}=hl(n),s=new co({width:i||1,height:r||1});for(const o in t){const n=t[o];for(const t in n){const i=n[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const r=e[o][t].rect;co.copy(i.bitmap,s,{x:0,y:0},{x:r.x+1,y:r.y+1},i.bitmap)}}this.image=s,this.positions=e}}function Dc(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}on("GlyphAtlas",Lc);class Rc{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Oc?new Oc(t.lng,t.lat):Oc.convert(t),this}setSouthWest(t){return this._sw=t instanceof Oc?new Oc(t.lng,t.lat):Oc.convert(t),this}extend(t){const e=this._sw,n=this._ne;let i,r;if(t instanceof Oc)i=t,r=t;else{if(!(t instanceof Rc))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Rc.convert(t)):this.extend(Oc.convert(t)):this;if(i=t._sw,r=t._ne,!i||!r)return this}return e||n?(e.lng=Math.min(i.lng,e.lng),e.lat=Math.min(i.lat,e.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Oc(i.lng,i.lat),this._ne=new Oc(r.lng,r.lat)),this}getCenter(){return new Oc((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Oc(this.getWest(),this.getNorth())}getSouthEast(){return new Oc(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:n}=Oc.convert(t);let i=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(t){return t instanceof Rc?t:t?new Rc(t):t}}const Bc=6371008.8;class Oc{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oc(function(t,e,n){const i=((t-e)%360+360)%360+e;return i===e?180:i}(this.lng,-180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,n=this.lat*e,i=t.lat*e,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return Bc*Math.acos(Math.min(r,1))}toBounds(){const t=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,e=t/Math.cos(Math.PI/180*this.lat);return new Rc(new Oc(this.lng-e,this.lat-t),new Oc(this.lng+e,this.lat+t))}static convert(t){if(t instanceof Oc)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Oc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Oc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Fc=2*Math.PI*Bc;function Vc(t){return Fc*Math.cos(t*Math.PI/180)}function Nc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}class Uc{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+t,this.y=+e,this.z=+n}static fromLngLat(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Oc.convert(t);return new Uc((180+n.lng)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n.lat*Math.PI/360)))/360,function(t,e){return t/Vc(e)}(e,n.lat))}toLngLat(){return new Oc(360*this.x-180,Nc(this.y))}toAltitude(){return this.z*Vc(Nc(this.y))}meterInMercatorCoordinateUnits(){return 1/Fc*(t=Nc(this.y),1/Math.cos(t*Math.PI/180));var t}}class jc{constructor(t,e,n){this.z=t,this.x=e,this.y=n,this.key=$c(0,t,t,e,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,n){const i=(s=this.y,o=this.z,a=Dc(256*(r=this.x),256*(s=Math.pow(2,o)-s-1),o),l=Dc(256*(r+1),256*(s+1),o),a[0]+","+a[1]+","+l[0]+","+l[1]);var r,s,o,a,l;const c=function(t,e,n){let i,r="";for(let s=t;s>0;s--)i=1<<s-1,r+=(e&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,i)}getTilePoint(t){const e=Math.pow(2,this.z);return new lr((t.x*e-this.x)*Cs,(t.y*e-this.y)*Cs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gc{constructor(t,e){this.wrap=t,this.canonical=e,this.key=$c(t,e.z,e.z,e.x,e.y)}}class qc{constructor(t,e,n,i,r){this.overscaledZ=t,this.wrap=e,this.canonical=new jc(n,+i,+r),this.key=$c(e,t,n,i,r)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new qc(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qc(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){const n=this.canonical.z-t;return t>this.canonical.z?$c(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):$c(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new qc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new qc(e,this.wrap,e,n,i),new qc(e,this.wrap,e,n+1,i),new qc(e,this.wrap,e,n,i+1),new qc(e,this.wrap,e,n+1,i+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new qc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new qc(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Uc(t.x-this.wrap,t.y))}}function $c(t,e,n,i,r){(t*=2)<0&&(t=-1*t-1);const s=1<<n;return(s*s*t+s*r+i).toString(36)+n.toString(36)+e.toString(36)}on("CanonicalTileID",jc),on("OverscaledTileID",qc,{omit:["posMatrix"]});class Wc{constructor(t){this.tileID=new qc(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId}parse(t,e,n,i,s){this.status="parsing",this.data=t,this.collisionBoxArray=new Lr;const o=new kc(Object.keys(t.layers).sort()),l=new Ic(this.tileID,this.promoteId);l.bucketLayerIDs=[];const c={},u={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},h=e.familiesBySource[this.source];for(const r in h){const e=t.layers[r];if(!e)continue;1===e.version&&a(`Vector tile source "${this.source}" layer "${r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const i=o.encode(r),s=[];for(let t=0;t<e.length;t++){const n=e.feature(t),o=l.getId(n,r);s.push({feature:n,id:o,index:t,sourceLayerIndex:i})}for(const t of h[r]){const e=t[0];e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(Zc(t,this.zoom,n),(c[e.id]=e.createBucket({index:l.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:i,sourceID:this.source})).populate(s,u,this.tileID.canonical),l.bucketLayerIDs.push(t.map((t=>t.id))))}}let d,p,f,m;const g=r(u.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(g).length?i.send("getGlyphs",{uid:this.uid,stacks:g},((t,e)=>{d||(d=t,p=e,v.call(this))})):p={};const y=Object.keys(u.iconDependencies);y.length?i.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{d||(d=t,f=e,v.call(this))})):f={};const _=Object.keys(u.patternDependencies);function v(){if(d)return s(d);if(p&&f&&m){const t=new Lc(p),e=new pl(f,m);for(const i in c){const r=c[i];r instanceof dc?(Zc(r.layers,this.zoom,n),Jl(r,p,t.positions,f,e.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):r.hasPattern&&(r instanceof Ca||r instanceof Ko||r instanceof ya)&&(Zc(r.layers,this.zoom,n),r.addFeatures(u,this.tileID.canonical,e.patternPositions))}this.status="done",s(null,{buckets:Object.values(c).filter((t=>!t.isEmpty())),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:e,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?t.positions:null})}}_.length?i.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{d||(d=t,m=e,v.call(this))})):m={},v.call(this)}}function Zc(t,e,n){const i=new Ni(e);for(const r of t)r.recalculate(i,n)}var Hc;!function(t){t.create="create",t.load="load",t.fullLoad="fullLoad"}(Hc||(Hc={}));class Xc{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}}function Yc(t,e){const n=function(t,e){return rn(i(t,{type:"arrayBuffer"}),e)}(t.request,((t,n,i,r)=>{t?e(t):n&&e(null,{vectorTile:new na.VectorTile(new ja(n)),rawData:n,cacheControl:i,expires:r})}));return()=>{n.cancel(),e()}}class Kc{constructor(t,e,n,i){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=i||Yc,this.loading={},this.loaded={}}loadTile(t,e){const n=t.uid;this.loading||(this.loading={});const r=!!(t&&t.request&&t.request.collectResourceTiming)&&new Xc(t.request),s=this.loading[n]=new Wc(t);s.abort=this.loadVectorData(t,((t,o)=>{if(delete this.loading[n],t||!o)return s.status="done",this.loaded[n]=s,e(t);const a=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);const c={};if(r){const t=r.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((t,n)=>{if(t||!n)return e(t);e(null,i({rawTileData:a.slice(0)},n,l,c))})),this.loaded=this.loaded||{},this.loaded[n]=s}))}reloadTile(t,e){const n=this.loaded,i=t.uid,r=this;if(n&&n[i]){const s=n[i];s.showCollisionBoxes=t.showCollisionBoxes;const o=(t,n)=>{const i=s.reloadCallback;i&&(delete s.reloadCallback,s.parse(s.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),e(t,n)};"parsing"===s.status?s.reloadCallback=o:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(t,e){const n=this.loading,i=t.uid;n&&n[i]&&n[i].abort&&(n[i].abort(),delete n[i]),e()}removeTile(t,e){const n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}}class Jc{constructor(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return void a(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const i=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(let r=0;r<i;r++)this.data[this._idx(-1,r)]=this.data[this._idx(0,r)],this.data[this._idx(i,r)]=this.data[this._idx(i-1,r)],this.data[this._idx(r,-1)]=this.data[this._idx(r,0)],this.data[this._idx(r,i)]=this.data[this._idx(r,i-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(i,-1)]=this.data[this._idx(i-1,0)],this.data[this._idx(-1,i)]=this.data[this._idx(0,i-1)],this.data[this._idx(i,i)]=this.data[this._idx(i-1,i-1)]}get(t,e){const n=new Uint8Array(this.data.buffer),i=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[i],n[i+1],n[i+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,n){return(256*t*256+256*e+n)/10-1e4}_unpackTerrarium(t,e,n){return 256*t+e+n/256-32768}getPixels(){return new uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,r=e*this.dim+this.dim,s=n*this.dim,o=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:s=o-1;break;case 1:o=s+1}const a=-e*this.dim,l=-n*this.dim;for(let c=s;c<o;c++)for(let e=i;e<r;e++)this.data[this._idx(e,c)]=t.data[this._idx(e+a,c+l)]}}on("DEMData",Jc);class Qc{constructor(){this.loaded={}}loadTile(t,e){const{uid:n,encoding:i,rawImageData:r}=t,s=p(r)?this.getImageData(r):r,o=new Jc(n,s,i);this.loaded=this.loaded||{},this.loaded[n]=o,e(null,o)}getImageData(t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const e=this.offscreenCanvasContext.getImageData(-1,-1,t.width+2,t.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new uo({width:e.width,height:e.height},e.data)}removeTile(t){const e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]}}var tu=function t(e,n){var i,r=e&&e.type;if("FeatureCollection"===r)for(i=0;i<e.features.length;i++)t(e.features[i],n);else if("GeometryCollection"===r)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],n);else if("Feature"===r)t(e.geometry,n);else if("Polygon"===r)eu(e.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<e.coordinates.length;i++)eu(e.coordinates[i],n);return e};function eu(t,e){if(0!==t.length){nu(t[0],e);for(var n=1;n<t.length;n++)nu(t[n],!e)}}function nu(t,e){for(var n=0,i=0,r=0,s=t.length,o=s-1;r<s;o=r++){var a=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]),l=n+a;i+=Math.abs(n)>=Math.abs(a)?n-l+a:a-l+n,n=l}n+i>=0!=!!e&&t.reverse()}const iu=na.VectorTileFeature.prototype.toGeoJSON;class ru{constructor(t){this._feature=t,this.extent=Cs,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const e of this._feature.geometry)t.push([new lr(e[0],e[1])]);return t}{const t=[];for(const e of this._feature.geometry){const n=[];for(const t of e)n.push(new lr(t[0],t[1]));t.push(n)}return t}}toGeoJSON(t,e,n){return iu.call(this,t,e,n)}}class su{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Cs,this.length=t.length,this._features=t}feature(t){return new ru(this._features[t])}}var ou={exports:{}},au=lr,lu=na.VectorTileFeature,cu=uu;function uu(t,e){this.options=e||{},this.features=t,this.length=t.length}function hu(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}uu.prototype.feature=function(t){return new hu(this.features[t],this.options.extent)},hu.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var n=t[e],i=[],r=0;r<n.length;r++)i.push(new au(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},hu.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,s=0;s<t.length;s++)for(var o=t[s],a=0;a<o.length;a++){var l=o[a];e=Math.min(e,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[e,i,n,r]},hu.prototype.toGeoJSON=lu.prototype.toGeoJSON;var du=ja,pu=cu;function fu(t){var e=new du;return function(t,e){for(var n in t.layers)e.writeMessage(3,mu,t.layers[n])}(t,e),e.finish()}function mu(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)i.feature=t.feature(n),e.writeMessage(2,gu,i);var r=i.keys;for(n=0;n<r.length;n++)e.writeStringField(3,r[n]);var s=i.values;for(n=0;n<s.length;n++)e.writeMessage(4,bu,s[n])}function gu(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,yu,t),e.writeVarintField(3,n.type),e.writeMessage(4,xu,n)}function yu(t,e){var n=t.feature,i=t.keys,r=t.values,s=t.keycache,o=t.valuecache;for(var a in n.properties){var l=n.properties[a],c=s[a];if(null!==l){void 0===c&&(i.push(a),s[a]=c=i.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=o[h];void 0===d&&(r.push(l),o[h]=d=r.length-1),e.writeVarint(d)}}}function _u(t,e){return(e<<3)+(7&t)}function vu(t){return t<<1^t>>31}function xu(t,e){for(var n=t.loadGeometry(),i=t.type,r=0,s=0,o=n.length,a=0;a<o;a++){var l=n[a],c=1;1===i&&(c=l.length),e.writeVarint(_u(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&e.writeVarint(_u(2,u-1));var d=l[h].x-r,p=l[h].y-s;e.writeVarint(vu(d)),e.writeVarint(vu(p)),r+=d,s+=p}3===i&&e.writeVarint(_u(7,1))}}function bu(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}ou.exports=fu,ou.exports.fromVectorTileJs=fu,ou.exports.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var i in t)n[i]=new pu(t[i].features,e),n[i].name=i,n[i].version=e.version,n[i].extent=e.extent;return fu({layers:n})},ou.exports.GeoJSONWrapper=pu;var wu=ou.exports;function Su(t,e,n,i,r,s){if(r-i<=n)return;const o=i+r>>1;Eu(t,e,o,i,r,s%2),Su(t,e,n,i,o-1,s+1),Su(t,e,n,o+1,r,s+1)}function Eu(t,e,n,i,r,s){for(;r>i;){if(r-i>600){const o=r-i+1,a=n-i+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(a-o/2<0?-1:1);Eu(t,e,n,Math.max(i,Math.floor(n-a*c/o+u)),Math.min(r,Math.floor(n+(o-a)*c/o+u)),s)}const o=e[2*n+s];let a=i,l=r;for(Tu(t,e,i,n),e[2*r+s]>o&&Tu(t,e,i,r);a<l;){for(Tu(t,e,a,l),a++,l--;e[2*a+s]<o;)a++;for(;e[2*l+s]>o;)l--}e[2*i+s]===o?Tu(t,e,i,l):(l++,Tu(t,e,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function Tu(t,e,n,i){Au(t,n,i),Au(e,2*n,2*i),Au(e,2*n+1,2*i+1)}function Au(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function ku(t,e,n,i){const r=t-n,s=e-i;return r*r+s*s}const Pu=t=>t[0],Iu=t=>t[1];class Cu{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pu,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Iu,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Float64Array;this.nodeSize=i,this.points=t;const s=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new s(t.length),a=this.coords=new r(2*t.length);for(let l=0;l<t.length;l++)o[l]=l,a[2*l]=e(t[l]),a[2*l+1]=n(t[l]);Su(o,a,i,0,o.length-1,0)}range(t,e,n,i){return function(t,e,n,i,r,s,o){const a=[0,t.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),p=a.pop();if(d-p<=o){for(let o=p;o<=d;o++)c=e[2*o],u=e[2*o+1],c>=n&&c<=r&&u>=i&&u<=s&&l.push(t[o]);continue}const f=Math.floor((p+d)/2);c=e[2*f],u=e[2*f+1],c>=n&&c<=r&&u>=i&&u<=s&&l.push(t[f]);const m=(h+1)%2;(0===h?n<=c:i<=u)&&(a.push(p),a.push(f-1),a.push(m)),(0===h?r>=c:s>=u)&&(a.push(f+1),a.push(d),a.push(m))}return l}(this.ids,this.coords,t,e,n,i,this.nodeSize)}within(t,e,n){return function(t,e,n,i,r,s){const o=[0,t.length-1,0],a=[],l=r*r;for(;o.length;){const c=o.pop(),u=o.pop(),h=o.pop();if(u-h<=s){for(let r=h;r<=u;r++)ku(e[2*r],e[2*r+1],n,i)<=l&&a.push(t[r]);continue}const d=Math.floor((h+u)/2),p=e[2*d],f=e[2*d+1];ku(p,f,n,i)<=l&&a.push(t[d]);const m=(c+1)%2;(0===c?n-r<=p:i-r<=f)&&(o.push(h),o.push(d-1),o.push(m)),(0===c?n+r>=p:i+r>=f)&&(o.push(d+1),o.push(u),o.push(m))}return a}(this.ids,this.coords,t,e,n,this.nodeSize)}}const Mu={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},zu=Math.fround||(Lu=new Float32Array(1),t=>(Lu[0]=+t,Lu[0]));var Lu;class Du{constructor(t){this.options=ju(Object.create(Mu),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:n,maxZoom:i,nodeSize:r}=this.options;e&&console.time("total time");const s=`prepare ${t.length} points`;e&&console.time(s),this.points=t;let o=[];for(let a=0;a<t.length;a++)t[a].geometry&&o.push(Bu(t[a],a));this.trees[i+1]=new Cu(o,Gu,qu,r,Float32Array),e&&console.timeEnd(s);for(let a=i;a>=n;a--){const t=+Date.now();o=this._cluster(o,a),this.trees[a]=new Cu(o,Gu,qu,r,Float32Array),e&&console.log("z%d: %d clusters in %dms",a,o.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){const t=this.getClusters([n,i,180,s],e),o=this.getClusters([-180,i,r,s],e);return t.concat(o)}const o=this.trees[this._limitZoom(e)],a=o.range(Vu(n),Nu(s),Vu(r),Nu(i)),l=[];for(const c of a){const t=o.points[c];l.push(t.numPoints?Ou(t):this.points[t.index])}return l}getChildren(t){const e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const s=r.points[e];if(!s)throw new Error(i);const o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(s.x,s.y,o),l=[];for(const c of a){const e=r.points[c];e.parentId===t&&l.push(e.numPoints?Ou(e):this.points[e.index])}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,n){const i=[];return this._appendLeaves(i,t,e=e||10,n=n||0,0),i}getTile(t,e,n){const i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:s,radius:o}=this.options,a=o/s,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((e-a)/r,l,(e+1+a)/r,c),i.points,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.points,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.points,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,i,r){const s=this.getChildren(e);for(const o of s){const e=o.properties;if(e&&e.cluster?r+e.point_count<=i?r+=e.point_count:r=this._appendLeaves(t,e.cluster_id,n,i,r):r<i?r++:t.push(o),t.length===n)break}return r}_addTileFeatures(t,e,n,i,r,s){for(const o of t){const t=e[o],a=t.numPoints;let l,c,u;if(a)l=Fu(t),c=t.x,u=t.y;else{const e=this.points[t.index];l=e.properties,c=Vu(e.geometry.coordinates[0]),u=Nu(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;a?d=t.id:this.options.generateId?d=t.index:this.points[t.index].id&&(d=this.points[t.index].id),void 0!==d&&(h.id=d),s.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const n=[],{radius:i,extent:r,reduce:s,minPoints:o}=this.options,a=i/(r*Math.pow(2,e));for(let l=0;l<t.length;l++){const i=t[l];if(i.zoom<=e)continue;i.zoom=e;const r=this.trees[e+1],c=r.within(i.x,i.y,a),u=i.numPoints||1;let h=u;for(const t of c){const n=r.points[t];n.zoom>e&&(h+=n.numPoints||1)}if(h>u&&h>=o){let t=i.x*u,o=i.y*u,a=s&&u>1?this._map(i,!0):null;const d=(l<<5)+(e+1)+this.points.length;for(const n of c){const l=r.points[n];if(l.zoom<=e)continue;l.zoom=e;const c=l.numPoints||1;t+=l.x*c,o+=l.y*c,l.parentId=d,s&&(a||(a=this._map(i,!0)),s(a,this._map(l)))}i.parentId=d,n.push(Ru(t/h,o/h,d,h,a))}else if(n.push(i),h>1)for(const t of c){const i=r.points[t];i.zoom<=e||(i.zoom=e,n.push(i))}}return n}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?ju({},t.properties):t.properties;const n=this.points[t.index].properties,i=this.options.map(n);return e&&i===n?ju({},i):i}}function Ru(t,e,n,i,r){return{x:zu(t),y:zu(e),zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function Bu(t,e){const[n,i]=t.geometry.coordinates;return{x:zu(Vu(n)),y:zu(Nu(i)),zoom:1/0,index:e,parentId:-1}}function Ou(t){return{type:"Feature",id:t.id,properties:Fu(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),Uu(t.y)]}};var e}function Fu(t){const e=t.numPoints,n=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return ju(ju({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function Vu(t){return t/360+.5}function Nu(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function Uu(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function ju(t,e){for(const n in e)t[n]=e[n];return t}function Gu(t){return t.x}function qu(t){return t.y}function $u(t,e,n,i){for(var r,s=i,o=n-e>>1,a=n-e,l=t[e],c=t[e+1],u=t[n],h=t[n+1],d=e+3;d<n;d+=3){var p=Wu(t[d],t[d+1],l,c,u,h);if(p>s)r=d,s=p;else if(p===s){var f=Math.abs(d-o);f<a&&(r=d,a=f)}}s>i&&(r-e>3&&$u(t,e,r,i),t[r+2]=s,n-r>3&&$u(t,r,n,i))}function Wu(t,e,n,i,r,s){var o=r-n,a=s-i;if(0!==o||0!==a){var l=((t-n)*o+(e-i)*a)/(o*o+a*a);l>1?(n=r,i=s):l>0&&(n+=o*l,i+=a*l)}return(o=t-n)*o+(a=e-i)*a}function Zu(t,e,n,i){var r={id:void 0===t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)Hu(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)Hu(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++)Hu(t,e[i][r])}(r),r}function Hu(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Xu(t,e,n,i){if(e.geometry){var r=e.geometry.coordinates,s=e.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===s)Yu(r,a);else if("MultiPoint"===s)for(var c=0;c<r.length;c++)Yu(r[c],a);else if("LineString"===s)Ku(r,a,o,!1);else if("MultiLineString"===s){if(n.lineMetrics){for(c=0;c<r.length;c++)Ku(r[c],a=[],o,!1),t.push(Zu(l,"LineString",a,e.properties));return}Ju(r,a,o,!1)}else if("Polygon"===s)Ju(r,a,o,!0);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(c=0;c<e.geometry.geometries.length;c++)Xu(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];Ju(r[c],u,o,!0),a.push(u)}}t.push(Zu(l,s,a,e.properties))}}function Yu(t,e){e.push(Qu(t[0])),e.push(th(t[1])),e.push(0)}function Ku(t,e,n,i){for(var r,s,o=0,a=0;a<t.length;a++){var l=Qu(t[a][0]),c=th(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(o+=i?(r*c-l*s)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-s,2))),r=l,s=c}var u=e.length-3;e[2]=1,$u(e,0,u,n),e[u+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function Ju(t,e,n,i){for(var r=0;r<t.length;r++){var s=[];Ku(t[r],s,n,i),e.push(s)}}function Qu(t){return t/360+.5}function th(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function eh(t,e,n,i,r,s,o,a){if(i/=e,s>=(n/=e)&&o<i)return t;if(o<n||s>=i)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=n&&f<i)l.push(u);else if(!(f<n||p>=i)){var m=[];if("Point"===d||"MultiPoint"===d)nh(h,m,n,i,r);else if("LineString"===d)ih(h,m,n,i,r,!1,a.lineMetrics);else if("MultiLineString"===d)sh(h,m,n,i,r,!1);else if("Polygon"===d)sh(h,m,n,i,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];sh(h[g],y,n,i,r,!0),y.length&&m.push(y)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(Zu(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(Zu(u.id,d,m,u.tags))}}}return l.length?l:null}function nh(t,e,n,i,r){for(var s=0;s<t.length;s+=3){var o=t[s+r];o>=n&&o<=i&&(e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]))}}function ih(t,e,n,i,r,s,o){for(var a,l,c=rh(t),u=0===r?ah:lh,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],m=t[d+2],g=t[d+3],y=t[d+4],_=0===r?p:f,v=0===r?g:y,x=!1;o&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<n?v>n&&(l=u(c,p,f,g,y,n),o&&(c.start=h+a*l)):_>i?v<i&&(l=u(c,p,f,g,y,i),o&&(c.start=h+a*l)):oh(c,p,f,m),v<n&&_>=n&&(l=u(c,p,f,g,y,n),x=!0),v>i&&_<=i&&(l=u(c,p,f,g,y,i),x=!0),!s&&x&&(o&&(c.end=h+a*l),e.push(c),c=rh(t)),o&&(h+=a)}var b=t.length-3;p=t[b],f=t[b+1],m=t[b+2],(_=0===r?p:f)>=n&&_<=i&&oh(c,p,f,m),b=c.length-3,s&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&oh(c,c[0],c[1],c[2]),c.length&&e.push(c)}function rh(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function sh(t,e,n,i,r,s){for(var o=0;o<t.length;o++)ih(t[o],e,n,i,r,s,!1)}function oh(t,e,n,i){t.push(e),t.push(n),t.push(i)}function ah(t,e,n,i,r,s){var o=(s-e)/(i-e);return t.push(s),t.push(n+(r-n)*o),t.push(1),o}function lh(t,e,n,i,r,s){var o=(s-n)/(r-n);return t.push(e+(i-e)*o),t.push(s),t.push(1),o}function ch(t,e){for(var n=[],i=0;i<t.length;i++){var r,s=t[i],o=s.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=uh(s.geometry,e);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var a=0;a<s.geometry.length;a++)r.push(uh(s.geometry[a],e))}else if("MultiPolygon"===o)for(r=[],a=0;a<s.geometry.length;a++){for(var l=[],c=0;c<s.geometry[a].length;c++)l.push(uh(s.geometry[a][c],e));r.push(l)}n.push(Zu(s.id,o,r,s.tags))}return n}function uh(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function hh(t,e){if(t.transformed)return t;var n,i,r,s=1<<t.z,o=t.x,a=t.y;for(n=0;n<t.features.length;n++){var l=t.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(dh(c[i],c[i+1],e,s,o,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(dh(c[i][r],c[i][r+1],e,s,o,a));l.geometry.push(h)}}return t.transformed=!0,t}function dh(t,e,n,i,r,s){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-s))]}function ph(t,e,n,i,r){for(var s=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){o.numFeatures++,fh(o,t[a],s,r);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),u>o.maxX&&(o.maxX=u),h>o.maxY&&(o.maxY=h)}return o}function fh(t,e,n,i){var r=e.geometry,s=e.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<r.length;a+=3)o.push(r[a]),o.push(r[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===s)mh(o,r,t,n,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<r.length;a++)mh(o,r[a],t,n,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)mh(o,c[a],t,n,!0,0===a)}if(o.length){var u=e.tags||null;if("LineString"===s&&i.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function mh(t,e,n,i,r,s){var o=i*i;if(i>0&&e.size<(r?o:i))n.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>o)&&(n.numSimplified++,a.push(e[l]),a.push(e[l+1])),n.numPoints++;r&&function(t,e){for(var n=0,i=0,r=t.length,s=r-2;i<r;s=i,i+=2)n+=(t[i]-t[s])*(t[i+1]+t[s+1]);if(n>0===e)for(i=0,r=t.length;i<r/2;i+=2){var o=t[i],a=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=o,t[r-1-i]=a}}(a,s),t.push(a)}}function gh(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)Xu(n,t.features[i],e,i);else Xu(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){var n=e.buffer/e.extent,i=t,r=eh(t,1,-1-n,n,0,-1,2,e),s=eh(t,1,1-n,2+n,0,-1,2,e);return(r||s)&&(i=eh(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=ch(r,1).concat(i)),s&&(i=i.concat(ch(s,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yh(t,e,n){return 32*((1<<t)*n+e)+t}function _h(t,e){const n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return e(null,null);const r=new su(i.features);let s=wu(r);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:r,rawData:s.buffer})}gh.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gh.prototype.splitTile=function(t,e,n,i,r,s,o){for(var a=[t,e,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=yh(e,n,i),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=ph(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,r){if(e===l.maxZoom||e===r)continue;var f=1<<r-e;if(n!==Math.floor(s/f)||i!==Math.floor(o/f))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,y,_,v,x,b=.5*l.buffer/l.extent,w=.5-b,S=.5+b,E=1+b;m=g=y=_=null,v=eh(t,u,n-b,n+S,0,d.minX,d.maxX,l),x=eh(t,u,n+w,n+E,0,d.minX,d.maxX,l),t=null,v&&(m=eh(v,u,i-b,i+S,1,d.minY,d.maxY,l),g=eh(v,u,i+w,i+E,1,d.minY,d.maxY,l),v=null),x&&(y=eh(x,u,i-b,i+S,1,d.minY,d.maxY,l),_=eh(x,u,i+w,i+E,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*n,2*i),a.push(g||[],e+1,2*n,2*i+1),a.push(y||[],e+1,2*n+1,2*i),a.push(_||[],e+1,2*n+1,2*i+1)}}},gh.prototype.getTile=function(t,e,n){var i=this.options,r=i.extent,s=i.debug;if(t<0||t>24)return null;var o=1<<t,a=yh(t,e=(e%o+o)%o,n);if(this.tiles[a])return hh(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var l,c=t,u=e,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[yh(c,u,h)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",c,u,h),s>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,n),s>1&&console.timeEnd("drilling down"),this.tiles[a]?hh(this.tiles[a],r):null):null};class vh extends Kc{constructor(t,e,n,i){super(t,e,n,_h),i&&(this.loadGeoJSON=i)}loadData(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const t=this._pendingCallback,e=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const n=!!(e&&e.request&&e.request.collectResourceTiming)&&new Xc(e.request);this.loadGeoJSON(e,((i,r)=>{if(i||!r)return t(i);if("object"!=typeof r)return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{tu(r,!0);try{if(e.filter){const t=Ve(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const n=r.features.filter((e=>t.value.evaluate({zoom:0},e)));r={type:"FeatureCollection",features:n}}this._geoJSONIndex=e.cluster?new Du(function(t){let{superclusterOptions:e,clusterProperties:n}=t;if(!n||!e)return e;const i={},r={},s={accumulated:null,zoom:0},o={properties:null},a=Object.keys(n);for(const l of a){const[t,e]=n[l],s=Ve(e),o=Ve("string"==typeof t?[t,["accumulated"],["get",l]]:t);i[l]=s.value,r[l]=o.value}return e.map=t=>{o.properties=t;const e={};for(const n of a)e[n]=i[n].evaluate(s,o);return e},e.reduce=(t,e)=>{o.properties=e;for(const n of a)s.accumulated=t[n],t[n]=r[n].evaluate(s,o)},e}(e)).load(r.features):function(t,e){return new gh(t,e)}(r,e.geojsonVtOptions)}catch(i){return t(i)}this.loaded={};const s={};if(n){const t=n.finish();t&&(s.resourceTiming={},s.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}t(null,s)}}))}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(t,e){const n=this.loaded;return n&&n[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(t,e){if(t.request)!function(t,e){rn(i(t,{type:"json"}),e)}(t.request,e);else{if("string"!=typeof t.data)return e(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return e(null,JSON.parse(t.data))}catch(n){return e(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class xh{constructor(t){this.self=t,this.actor=new hn(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Kc,geojson:vh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=t=>{if(Vi.isParsed())throw new Error("RTL text plugin already registered.");Vi.applyArabicShaping=t.applyArabicShaping,Vi.processBidirectionalText=t.processBidirectionalText,Vi.processStyledBidirectionalText=t.processStyledBidirectionalText}}setReferrer(t,e){this.referrer=e}setImages(t,e,n){this.availableImages[t]=e;for(const i in this.workerSources[t]){const n=this.workerSources[t][i];for(const t in n)n[t].availableImages=e}n()}setLayers(t,e,n){this.getLayerIndex(t).replace(e),n()}updateLayers(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()}loadTile(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)}loadDEMTile(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)}reloadTile(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)}abortTile(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)}removeTile(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)}removeDEMTile(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)}removeSource(t,e,n){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,n):n()}loadWorkerSource(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}}syncRTLPluginState(t,e,n){try{Vi.setState(e);const t=Vi.getPluginURL();if(Vi.isLoaded()&&!Vi.isParsed()&&null!=t){this.self.importScripts(t);const e=Vi.isParsed();n(e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),e)}}catch(t){n(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new Ac),e}getWorkerSource(t,e,n){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][n]){const i={send:(e,n,i)=>{this.actor.send(e,n,i,t)}};this.workerSources[t][e][n]=new this.workerSourceTypes[e](i,this.getLayerIndex(t),this.getAvailableImages(t))}return this.workerSources[t][e][n]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new Qc),this.demWorkerSources[t][e]}enforceCacheSizeLimit(t,e){!function(t){Ze(),We&&We.then((e=>{e.keys().then((n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])}))}))}(e)}}"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xh(self))}()},307:function(t){t.exports=function(){"use strict";var t,e,n;function i(i,r){if(t)if(e){var s="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",o={};t(o),n=r(o),"undefined"!==typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([s],{type:"text/javascript"})))}else e=r;else t=r}return i(["exports"],(function(t){var e=n;function n(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}function i(t,n,i,r){const s=new e(t,n,i,r);return function(t){return s.solve(t)}}n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=r/s}var o=0,a=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:a=n,n=.5*(a-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};const r=i(.25,.1,.25,1);function s(t,e,n){return Math.min(n,Math.max(e,t))}function o(t,e,n){const i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function a(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}let l=1;function c(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function u(t,e,n){const i={};for(const r in t)i[r]=e.call(n||this,t[r],r,t);return i}function h(t,e,n){const i={};for(const r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i}function d(t){return Array.isArray(t)?t.map(d):"object"==typeof t&&t?u(t,d):t}const p={};function f(t){p[t]||("undefined"!=typeof console&&console.warn(t),p[t]=!0)}function m(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function g(t){let e=0;for(let n,i,r=0,s=t.length,o=s-1;r<s;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}function y(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function _(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,n,i,r)=>{const s=i||r;return e[n]=!s||s.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let v,x,b=null;function w(t){if(null==b){const e=t.navigator?t.navigator.userAgent:null;b=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return b}function S(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const E={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const n=window.document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(v||(v=document.createElement("a")),v.href=t,v.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==x&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};var T=A;function A(t,e){this.x=t,this.y=e}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(t){return t instanceof A?t:Array.isArray(t)?new A(t[0],t[1]):t};const k={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},P="mapbox-tiles";let I,C,M=500,z=50;function L(){"undefined"==typeof caches||I||(I=caches.open(P))}let D=1/0;const R={supported:!1,testSupport:function(t){!F&&O&&(V?N(t):B=t)}};let B,O,F=!1,V=!1;function N(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,O),t.isContextLost())return;R.supported=!0}catch(t){}t.deleteTexture(e),F=!0}"undefined"!=typeof document&&(O=document.createElement("img"),O.onload=function(){B&&N(B),B=null,V=!0},O.onerror=function(){F=!0,B=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const U={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(U);class j extends Error{constructor(t,e,n,i){super(`AJAXError: ${e} (${t}): ${n}`),this.status=t,this.statusText=e,this.url=n,this.body=i}}const G=y()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function q(t,e){const n=new AbortController,i=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:G(),signal:n.signal});let r=!1,s=!1;return"json"===t.type&&i.headers.set("Accept","application/json"),((n,o,a)=>{if(s)return;const l=Date.now();fetch(i).then((n=>n.ok?((n,o,a)=>{("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((t=>{s||(o&&a&&function(t,e,n){if(L(),!I)return;const i={status:e.status,statusText:e.statusText,headers:new Headers};e.headers.forEach(((t,e)=>i.headers.set(e,t)));const r=_(e.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString()),new Date(i.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===C)try{new Response(new ReadableStream),C=!0}catch(t){C=!1}C?e(t.body):t.blob().then(e)}(e,(e=>{const n=new Response(e,i);L(),I&&I.then((e=>e.put(function(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}(t.url),n))).catch((t=>f(t.message)))})))}(i,o,a),r=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((t=>{s||e(new Error(t.message))}))})(n,null,l):n.blob().then((i=>e(new j(n.status,n.statusText,t.url,i)))))).catch((t=>{20!==t.code&&e(new Error(t.message))}))})(),{cancel:()=>{s=!0,r||n.abort()}}}const $=function(t,e){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){if(y()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e);if(!y()){const n=t.url.substring(0,t.url.indexOf("://"));return(k.REGISTERED_PROTOCOLS[n]||q)(t,e)}}if(!(/^file:/.test(n=t.url)||/^file:/.test(G())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return q(t,e);if(y()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){const n=new XMLHttpRequest;n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer");for(const i in t.headers)n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=()=>{e(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else{const i=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});e(new j(n.status,n.statusText,t.url,i))}},n.send(t.body),{cancel:()=>n.abort()}}(t,e)},W=function(t,e){return $(a(t,{type:"arrayBuffer"}),e)};function Z(t){const e=window.document.createElement("a");return e.href=t,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,Y;X=[],Y=0;const K=function(t,e){if(R.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Y>=k.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(n),n}Y++;let n=!1;const i=()=>{if(!n)for(n=!0,Y--;X.length&&Y<k.MAX_PARALLEL_IMAGE_REQUESTS;){const t=X.shift(),{requestParameters:e,callback:n,cancelled:i}=t;i||(t.cancel=K(e,n).cancel)}},r=W(t,((t,n,r,s)=>{i(),t?e(t):n&&function(t,e){"function"==typeof createImageBitmap?function(t,e){const n=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(n).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(t,e):function(t,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((()=>{n.src=H}))},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?URL.createObjectURL(i):H}(t,e)}(n,((t,n)=>{null!=t?e(t):null!=n&&e(null,n,{cacheControl:r,expires:s})}))}));return{cancel:()=>{r.cancel(),i()}}};function J(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Q(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}class tt{constructor(t,e={}){a(this,e),this.type=t}}class et extends tt{constructor(t,e={}){super("error",a({error:t},e))}}class nt{on(t,e){return this._listeners=this._listeners||{},J(t,e,this._listeners),this}off(t,e){return Q(t,e,this._listeners),Q(t,e,this._oneTimeListeners),this}once(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},J(t,e,this._oneTimeListeners),this}fire(t,e){"string"==typeof t&&(t=new tt(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const s of i)Q(n,s,this._oneTimeListeners),s.call(this,t);const r=this._eventedParent;r&&(a(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof et&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var it={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class rt{constructor(t,e,n,i){this.message=(t?`${t}: `:"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function st(t){const e=t.value;return e?[new rt(t.key,e,"constants have been deprecated as of v8")]:[]}function ot(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}function at(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function lt(t){if(Array.isArray(t))return t.map(lt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=lt(t[n]);return e}return at(t)}class ct extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class ut{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(t){return new ut(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ht={kind:"null"},dt={kind:"number"},pt={kind:"string"},ft={kind:"boolean"},mt={kind:"color"},gt={kind:"object"},yt={kind:"value"},_t={kind:"collator"},vt={kind:"formatted"},xt={kind:"resolvedImage"};function bt(t,e){return{kind:"array",itemType:t,N:e}}function wt(t){if("array"===t.kind){const e=wt(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const St=[ht,dt,pt,ft,mt,vt,gt,bt(yt),xt];function Et(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Et(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of St)if(!Et(t,e))return null}return`Expected ${wt(t)} but found ${wt(e)} instead.`}function Tt(t,e){return e.some((e=>e.kind===t.kind))}function At(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}var kt,Pt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function It(t){return(t=Math.round(t))<0?0:t>255?255:t}function Ct(t){return It("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Mt(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function zt(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{kt={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Pt)return Pt[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var s=n.substr(0,i),o=n.substr(i+1,r-(i+1)).split(","),a=1;switch(s){case"rgba":if(4!==o.length)return null;a=Mt(o.pop());case"rgb":return 3!==o.length?null:[Ct(o[0]),Ct(o[1]),Ct(o[2]),a];case"hsla":if(4!==o.length)return null;a=Mt(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,c=Mt(o[1]),u=Mt(o[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[It(255*zt(d,h,l+1/3)),It(255*zt(d,h,l)),It(255*zt(d,h,l-1/3)),a];default:return null}}return null}}catch(t){}class Lt{constructor(t,e,n,i=1){this.r=t,this.g=e,this.b=n,this.a=i}static parse(t){if(!t)return;if(t instanceof Lt)return t;if("string"!=typeof t)return;const e=kt(t);return e?new Lt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,n,i]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${i})`}toArray(){const{r:t,g:e,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]}}Lt.black=new Lt(0,0,0,1),Lt.white=new Lt(1,1,1,1),Lt.transparent=new Lt(0,0,0,0),Lt.red=new Lt(1,0,0,1);class Dt{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Rt{constructor(t,e,n,i,r){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r}}class Bt{constructor(t){this.sections=t}static fromString(t){return new Bt([new Rt(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Bt?t:Bt.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}}class Ot{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ot({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Ft(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Vt(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Lt)return!0;if(t instanceof Dt)return!0;if(t instanceof Bt)return!0;if(t instanceof Ot)return!0;if(Array.isArray(t)){for(const e of t)if(!Vt(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Vt(t[e]))return!1;return!0}return!1}function Nt(t){if(null===t)return ht;if("string"==typeof t)return pt;if("boolean"==typeof t)return ft;if("number"==typeof t)return dt;if(t instanceof Lt)return mt;if(t instanceof Dt)return _t;if(t instanceof Bt)return vt;if(t instanceof Ot)return xt;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=Nt(i);if(n){if(n===t)continue;n=yt;break}n=t}return bt(n||yt,e)}return gt}function Ut(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Lt||t instanceof Bt||t instanceof Ot?t.toString():JSON.stringify(t)}class jt{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Vt(t[1]))return e.error("invalid value");const n=t[1];let i=Nt(n);const r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new jt(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Lt?["rgba"].concat(this.value.toArray()):this.value instanceof Bt?this.value.serialize():this.value}}class Gt{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const qt={string:pt,number:dt,boolean:ft,object:gt};class $t{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,s;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in qt)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=qt[n],i++}else r=yt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);s=t[2],i++}n=bt(r,s)}else n=qt[r];const s=[];for(;i<t.length;i++){const n=e.parse(t[i],i,yt);if(!n)return null;s.push(n)}return new $t(n,s)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!Et(this.type,Nt(n)))return n;if(e===this.args.length-1)throw new Gt(`Expected value to be of type ${wt(this.type)}, but found ${wt(Nt(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map((t=>t.serialize())))}}class Wt{constructor(t){this.type=vt,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let s=1;s<=t.length-1;++s){const n=t[s];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,dt),!t))return null;let s=null;if(n["text-font"]&&(s=e.parse(n["text-font"],1,bt(pt)),!s))return null;let o=null;if(n["text-color"]&&(o=e.parse(n["text-color"],1,mt),!o))return null;const a=i[i.length-1];a.scale=t,a.font=s,a.textColor=o}else{const n=e.parse(t[s],1,yt);if(!n)return null;const o=n.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new Wt(i)}evaluate(t){return new Bt(this.sections.map((e=>{const n=e.content.evaluate(t);return Nt(n)===xt?new Rt("",n,null,null,null):new Rt(Ut(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}}class Zt{constructor(t){this.type=xt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,pt);return n?new Zt(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=Ot.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ht={"to-boolean":ft,"to-color":mt,"to-number":dt,"to-string":pt};class Xt{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=Ht[n],r=[];for(let s=1;s<t.length;s++){const n=e.parse(t[s],s,yt);if(!n)return null;r.push(n)}return new Xt(i,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof Lt)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Ft(e[0],e[1],e[2],e[3]),!n))return new Lt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Gt(n||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new Gt(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?Bt.fromString(Ut(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Ot.fromString(Ut(this.args[0].evaluate(t))):Ut(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Wt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Zt(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}const Yt=["Unknown","Point","LineString","Polygon"];class Kt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Yt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Lt.parse(t)),e}}class Jt{constructor(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const n=t[0],i=Jt.definitions[n];if(!i)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,s=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=s.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[l,c]of o){a=new be(e.registry,e.path,null,e.scope);const i=[];let s=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(l)?l[e-1]:l.type,o=a.parse(n,1+i.length,r);if(!o){s=!0;break}i.push(o)}if(!s)if(Array.isArray(l)&&l.length!==i.length)a.error(`Expected ${l.length} arguments, but found ${i.length} instead.`);else{for(let t=0;t<i.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=i[t];a.concat(t+1).checkSubtype(e,n.type)}if(0===a.errors.length)return new Jt(n,r,c,i)}}if(1===o.length)e.errors.push(...a.errors);else{const n=(o.length?o:s).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(wt).join(", ")})`:`(${wt(e.type)}...)`;var e})).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(wt(n.type))}e.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(t,e){Jt.definitions=e;for(const n in e)t[n]=Jt}}class Qt{constructor(t,e,n){this.type=_t,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,ft);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,ft);if(!r)return null;let s=null;return n.locale&&(s=e.parse(n.locale,1,pt),!s)?null:new Qt(i,r,s)}evaluate(t){return new Dt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const te=8192;function ee(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ne(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ie(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*te),Math.round(i*r*te)]}function re(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],s=t[0]-n[0],o=t[1]-n[1];return i*o-s*r==0&&i*s<=0&&r*o<=0}function se(t,e){let n=!1;for(let o=0,a=e.length;o<a;o++){const a=e[o];for(let e=0,o=a.length;e<o-1;e++){if(re(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(i=t)[1]!=(s=a[e+1])[1]>i[1]&&i[0]<(s[0]-r[0])*(i[1]-r[1])/(s[1]-r[1])+r[0]&&(n=!n)}}var i,r,s;return n}function oe(t,e){for(let n=0;n<e.length;n++)if(se(t,e[n]))return!0;return!1}function ae(t,e,n,i){const r=i[0]-n[0],s=i[1]-n[1],o=(t[0]-n[0])*s-r*(t[1]-n[1]),a=(e[0]-n[0])*s-r*(e[1]-n[1]);return o>0&&a<0||o<0&&a>0}function le(t,e,n){for(const c of n)for(let n=0;n<c.length-1;++n)if(0!=(a=[(o=c[n+1])[0]-(s=c[n])[0],o[1]-s[1]])[0]*(l=[(r=e)[0]-(i=t)[0],r[1]-i[1]])[1]-a[1]*l[0]&&ae(i,r,s,o)&&ae(s,o,i,r))return!0;var i,r,s,o,a,l;return!1}function ce(t,e){for(let n=0;n<t.length;++n)if(!se(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(le(t[n],t[n+1],e))return!1;return!0}function ue(t,e){for(let n=0;n<e.length;n++)if(ce(t,e[n]))return!0;return!1}function he(t,e,n){const i=[];for(let r=0;r<t.length;r++){const s=[];for(let i=0;i<t[r].length;i++){const o=ie(t[r][i],n);ee(e,o),s.push(o)}i.push(s)}return i}function de(t,e,n){const i=[];for(let r=0;r<t.length;r++){const s=he(t[r],e,n);i.push(s)}return i}function pe(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}ee(e,t)}function fe(t,e,n,i){const r=Math.pow(2,i.z)*te,s=[i.x*te,i.y*te],o=[];for(const a of t)for(const t of a){const i=[t.x+s[0],t.y+s[1]];pe(i,e,n,r),o.push(i)}return o}function me(t,e,n,i){const r=Math.pow(2,i.z)*te,s=[i.x*te,i.y*te],o=[];for(const l of t){const t=[];for(const n of l){const i=[n.x+s[0],n.y+s[1]];ee(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of o)for(const i of t)pe(i,e,n,r)}var a;return o}class ge{constructor(t,e){this.type=ft,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Vt(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const n=e.features[t].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new ge(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new ge(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new ge(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const s=he(e.coordinates,i,r),o=fe(t.geometry(),n,i,r);if(!ne(n,i))return!1;for(const t of o)if(!se(t,s))return!1}if("MultiPolygon"===e.type){const s=de(e.coordinates,i,r),o=fe(t.geometry(),n,i,r);if(!ne(n,i))return!1;for(const t of o)if(!oe(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const s=he(e.coordinates,i,r),o=me(t.geometry(),n,i,r);if(!ne(n,i))return!1;for(const t of o)if(!ce(t,s))return!1}if("MultiPolygon"===e.type){const s=de(e.coordinates,i,r),o=me(t.geometry(),n,i,r);if(!ne(n,i))return!1;for(const t of o)if(!ue(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ye(t){if(t instanceof Jt){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof ge)return!1;let e=!0;return t.eachChild((t=>{e&&!ye(t)&&(e=!1)})),e}function _e(t){if(t instanceof Jt&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!_e(t)&&(e=!1)})),e}function ve(t,e){if(t instanceof Jt&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild((t=>{n&&!ve(t,e)&&(n=!1)})),n}class xe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new xe(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class be{constructor(t,e=[],n,i=new ut,r=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=i,this.errors=r,this.expectedType=n}parse(t,e,n,i,r={}){return e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)}_parse(t,e){function n(t,e,n){return"assert"===n?new $t(e,[t]):"coerce"===n?new Xt(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=t[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[i];if(r){let i=r.parse(t,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,r=i.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else i=n(i,t,e.typeAnnotation||"coerce");else i=n(i,t,e.typeAnnotation||"assert")}if(!(i instanceof jt)&&"resolvedImage"!==i.type.kind&&we(i)){const e=new Kt;try{i=new jt(i.type,i.evaluate(e))}catch(t){return this.error(t.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new be(this.registry,i,e||null,r,this.errors)}error(t,...e){const n=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new ct(n,t))}checkSubtype(t,e){const n=Et(t,e);return n&&this.error(n),n}}function we(t){if(t instanceof xe)return we(t.boundExpression);if(t instanceof Jt&&"error"===t.name)return!1;if(t instanceof Qt)return!1;if(t instanceof ge)return!1;const e=t instanceof Xt||t instanceof $t;let n=!0;return t.eachChild((t=>{n=e?n&&we(t):n&&t instanceof jt})),!!n&&ye(t)&&ve(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Se(t,e){const n=t.length-1;let i,r,s=0,o=n,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),i=t[a],r=t[a+1],i<=e){if(a===n||e<r)return a;s=a+1}else{if(!(i>e))throw new Gt("Input is not a number.");o=a-1}return 0}class Ee{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,dt);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let s=1;s<t.length;s+=2){const n=1===s?-1/0:t[s],o=t[s+1],a=s,l=s+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(o,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new Ee(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[Se(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function Te(t,e,n){return t*(1-n)+e*n}var Ae=Object.freeze({__proto__:null,number:Te,color:function(t,e,n){return new Lt(Te(t.r,e.r,n),Te(t.g,e.g,n),Te(t.b,e.b,n),Te(t.a,e.a,n))},array:function(t,e,n){return t.map(((t,i)=>Te(t,e[i],n)))}});const ke=.95047,Pe=1.08883,Ie=4/29,Ce=6/29,Me=3*Ce*Ce,ze=Math.PI/180,Le=180/Math.PI;function De(t){return t>.008856451679035631?Math.pow(t,1/3):t/Me+Ie}function Re(t){return t>Ce?t*t*t:Me*(t-Ie)}function Be(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Oe(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Fe(t){const e=Oe(t.r),n=Oe(t.g),i=Oe(t.b),r=De((.4124564*e+.3575761*n+.1804375*i)/ke),s=De((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*s-16,a:500*(r-s),b:200*(s-De((.0193339*e+.119192*n+.9503041*i)/Pe)),alpha:t.a}}function Ve(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*Re(e),n=ke*Re(n),i=Pe*Re(i),new Lt(Be(3.2404542*n-1.5371385*e-.4985314*i),Be(-.969266*n+1.8760108*e+.041556*i),Be(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function Ne(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Ue={forward:Fe,reverse:Ve,interpolate:function(t,e,n){return{l:Te(t.l,e.l,n),a:Te(t.a,e.a,n),b:Te(t.b,e.b,n),alpha:Te(t.alpha,e.alpha,n)}}},je={forward:function(t){const{l:e,a:n,b:i}=Fe(t),r=Math.atan2(i,n)*Le;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*ze,n=t.c;return Ve({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Ne(t.h,e.h,n),c:Te(t.c,e.c,n),l:Te(t.l,e.l,n),alpha:Te(t.alpha,e.alpha,n)}}};var Ge=Object.freeze({__proto__:null,lab:Ue,hcl:je});class qe{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[s,o]of r)this.labels.push(s),this.outputs.push(o)}static interpolationFactor(t,n,i,r){let s=0;if("exponential"===t.name)s=$e(n,t.base,i,r);else if("linear"===t.name)s=$e(n,1,i,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;s=new e(o[0],o[1],o[2],o[3]).solve($e(n,1,i,r))}return s}static parse(t,e){let[n,i,r,...s]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const t=i.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,dt),!r)return null;const o=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=mt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let l=0;l<s.length;l+=2){const t=s[l],n=s[l+1],i=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=e.parse(n,r,a);if(!c)return null;a=a||c.type,o.push([t,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new qe(a,n,i,r,o):e.error(`Type ${wt(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const s=Se(e,i),o=qe.interpolationFactor(this.interpolation,i,e[s],e[s+1]),a=n[s].evaluate(t),l=n[s+1].evaluate(t);return"interpolate"===this.operator?Ae[this.type.kind.toLowerCase()](a,l,o):"interpolate-hcl"===this.operator?je.reverse(je.interpolate(je.forward(a),je.forward(l),o)):Ue.reverse(Ue.interpolate(Ue.forward(a),Ue.forward(l),o))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e}}function $e(t,e,n,i){const r=i-n,s=t-n;return 0===r?0:1===e?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}class We{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const o of t.slice(1)){const t=e.parse(o,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}const s=i&&r.some((t=>Et(i,t.type)));return new We(s?yt:n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(t),n&&n instanceof Ot&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class Ze{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const s=e.parse(t[r+1],r+1);if(!s)return null;n.push([i,s])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new Ze(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}}class He{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,dt),i=e.parse(t[2],2,bt(e.expectedType||yt));return n&&i?new He(i.type.itemType,n,i):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new Gt(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new Gt(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new Gt(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Xe{constructor(t,e){this.type=ft,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,yt),i=e.parse(t[2],2,yt);return n&&i?Tt(n.type,[ft,pt,dt,ht,yt])?new Xe(n,i):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(n.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!At(e,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Nt(e))} instead.`);if(!At(n,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${wt(Nt(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ye{constructor(t,e,n){this.type=dt,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,yt),i=e.parse(t[2],2,yt);if(!n||!i)return null;if(!Tt(n.type,[ft,pt,dt,ht,yt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,dt);return r?new Ye(n,i,r):null}return new Ye(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!At(e,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Nt(e))} instead.`);if(!At(n,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${wt(Nt(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(t);return n.indexOf(e,i)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ke{constructor(t,e,n,i,r,s){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=s}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},s=[];for(let l=2;l<t.length-1;l+=2){let o=t[l];const a=t[l+1];Array.isArray(o)||(o=[o]);const c=e.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Nt(t)))return null}else n=Nt(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=s.length}const u=e.parse(a,l,i);if(!u)return null;i=i||u.type,s.push(u)}const o=e.parse(t[1],1,yt);if(!o)return null;const a=e.parse(t[t.length-1],t.length-1,i);return a?"value"!==o.type.kind&&e.concat(1).checkSubtype(n,o.type)?null:new Ke(n,i,o,r,s,a):null}evaluate(t){const e=this.input.evaluate(t);return(Nt(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],i={};for(const s of e){const t=i[this.cases[s]];void 0===t?(i[this.cases[s]]=n.length,n.push([this.cases[s],[s]])):n[t][1].push(s)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[s,o]of n)t.push(1===o.length?r(o[0]):o.map(r)),t.push(this.outputs[s].serialize());return t.push(this.otherwise.serialize()),t}}class Je{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let s=1;s<t.length-1;s+=2){const r=e.parse(t[s],s,ft);if(!r)return null;const o=e.parse(t[s+1],s+1,n);if(!o)return null;i.push([r,o]),n=n||o.type}const r=e.parse(t[t.length-1],t.length-1,n);return r?new Je(n,i,r):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class Qe{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,yt),i=e.parse(t[2],2,dt);if(!n||!i)return null;if(!Tt(n.type,[bt(yt),pt,yt]))return e.error(`Expected first argument to be of type array or string, but found ${wt(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,dt);return r?new Qe(n.type,n,i,r):null}return new Qe(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!At(e,["string","array"]))throw new Gt(`Expected first argument to be of type array or string, but found ${wt(Nt(e))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(t);return e.slice(n,i)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function tn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function en(t,e,n,i){return 0===i.compare(e,n)}function nn(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=ft,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let s=e.parse(t[1],1,yt);if(!s)return null;if(!tn(n,s.type))return e.concat(1).error(`"${n}" comparisons are not supported for type '${wt(s.type)}'.`);let o=e.parse(t[2],2,yt);if(!o)return null;if(!tn(n,o.type))return e.concat(2).error(`"${n}" comparisons are not supported for type '${wt(o.type)}'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error(`Cannot compare types '${wt(s.type)}' and '${wt(o.type)}'.`);i&&("value"===s.type.kind&&"value"!==o.type.kind?s=new $t(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new $t(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,_t),!a)return null}return new r(s,o,a)}evaluate(r){const s=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=Nt(s),n=Nt(o);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new Gt(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const t=Nt(s),n=Nt(o);if("string"!==t.kind||"string"!==n.kind)return e(r,s,o)}return this.collator?n(r,s,o,this.collator.evaluate(r)):e(r,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const rn=nn("==",(function(t,e,n){return e===n}),en),sn=nn("!=",(function(t,e,n){return e!==n}),(function(t,e,n,i){return!en(0,e,n,i)})),on=nn("<",(function(t,e,n){return e<n}),(function(t,e,n,i){return i.compare(e,n)<0})),an=nn(">",(function(t,e,n){return e>n}),(function(t,e,n,i){return i.compare(e,n)>0})),ln=nn("<=",(function(t,e,n){return e<=n}),(function(t,e,n,i){return i.compare(e,n)<=0})),cn=nn(">=",(function(t,e,n){return e>=n}),(function(t,e,n,i){return i.compare(e,n)>=0}));class un{constructor(t,e,n,i,r){this.type=pt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,dt);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,pt),!r))return null;let s=null;if(i.currency&&(s=e.parse(i.currency,1,pt),!s))return null;let o=null;if(i["min-fraction-digits"]&&(o=e.parse(i["min-fraction-digits"],1,dt),!o))return null;let a=null;return i["max-fraction-digits"]&&(a=e.parse(i["max-fraction-digits"],1,dt),!a)?null:new un(n,r,s,o,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class hn{constructor(t){this.type=dt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error(`Expected argument of type string or array, but found ${wt(n.type)} instead.`):new hn(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Gt(`Expected value to be of type string or array, but found ${wt(Nt(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}const dn={"==":rn,"!=":sn,">":an,"<":on,">=":cn,"<=":ln,array:$t,at:He,boolean:$t,case:Je,coalesce:We,collator:Qt,format:Wt,image:Zt,in:Xe,"index-of":Ye,interpolate:qe,"interpolate-hcl":qe,"interpolate-lab":qe,length:hn,let:Ze,literal:jt,match:Ke,number:$t,"number-format":un,object:$t,slice:Qe,step:Ee,string:$t,"to-boolean":Xt,"to-color":Xt,"to-number":Xt,"to-string":Xt,var:xe,within:ge};function pn(t,[e,n,i,r]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const s=r?r.evaluate(t):1,o=Ft(e,n,i,s);if(o)throw new Gt(o);return new Lt(e/255*s,n/255*s,i/255*s,s)}function fn(t,e){return t in e}function mn(t,e){const n=e[t];return void 0===n?null:n}function gn(t){return{type:t}}function yn(t){return{result:"success",value:t}}function _n(t){return{result:"error",value:t}}function vn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function xn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function bn(t){return!!t.expression&&t.expression.interpolated}function wn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Sn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function En(t){return t}function Tn(t,e){const n="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],r=i||!(i||void 0!==t.property),s=t.type||(bn(e)?"exponential":"interval");if(n&&((t=ot({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],Lt.parse(t[1])]))),t.default=Lt.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Ge[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let o,a,l;if("exponential"===s)o=In;else if("interval"===s)o=Pn;else if("categorical"===s){o=kn,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);o=Cn}if(i){const n={},i=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],s=r[0].zoom;void 0===n[s]&&(n[s]={zoom:s,type:t.type,property:t.property,default:t.default,stops:[]},i.push(s)),n[s].stops.push([r[0].value,r[1]])}const r=[];for(const t of i)r.push([n[t].zoom,Tn(n[t],e)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:qe.interpolationFactor.bind(void 0,s),zoomStops:r.map((t=>t[0])),evaluate:({zoom:n},i)=>In({stops:r,base:t.base},e,n).evaluate(n,i)}}if(r){const n="exponential"===s?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:qe.interpolationFactor.bind(void 0,n),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:n})=>o(t,e,n,a,l)}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[t.property]:void 0;return void 0===r?An(t.default,e.default):o(t,e,r,a,l)}}}function An(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function kn(t,e,n,i,r){return An(typeof n===r?i[n]:void 0,t.default,e.default)}function Pn(t,e,n){if("number"!==wn(n))return An(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const r=Se(t.stops.map((t=>t[0])),n);return t.stops[r][1]}function In(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==wn(n))return An(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const s=Se(t.stops.map((t=>t[0])),n),o=function(t,e,n,i){const r=i-n,s=t-n;return 0===r?0:1===e?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[s][0],t.stops[s+1][0]),a=t.stops[s][1],l=t.stops[s+1][1];let c=Ae[e.type]||En;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Ge[t.colorSpace];c=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),o))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==n)return c(e,n,o)}}:c(a,l,o)}function Cn(t,e,n){return"color"===e.type?n=Lt.parse(n):"formatted"===e.type?n=Bt.fromString(n.toString()):"resolvedImage"===e.type?n=Ot.fromString(n.toString()):wn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),An(n,t.default,e.default)}Jt.register(dn,{error:[{kind:"error"},[pt],(t,[e])=>{throw new Gt(e.evaluate(t))}],typeof:[pt,[yt],(t,[e])=>wt(Nt(e.evaluate(t)))],"to-rgba":[bt(dt,4),[mt],(t,[e])=>e.evaluate(t).toArray()],rgb:[mt,[dt,dt,dt],pn],rgba:[mt,[dt,dt,dt,dt],pn],has:{type:ft,overloads:[[[pt],(t,[e])=>fn(e.evaluate(t),t.properties())],[[pt,gt],(t,[e,n])=>fn(e.evaluate(t),n.evaluate(t))]]},get:{type:yt,overloads:[[[pt],(t,[e])=>mn(e.evaluate(t),t.properties())],[[pt,gt],(t,[e,n])=>mn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[yt,[pt],(t,[e])=>mn(e.evaluate(t),t.featureState||{})],properties:[gt,[],t=>t.properties()],"geometry-type":[pt,[],t=>t.geometryType()],id:[yt,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],accumulated:[yt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[dt,gn(dt),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[dt,gn(dt),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,gn(dt),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[dt,gn(dt),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ft,[pt,yt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[ft,[yt],(t,[e])=>t.id()===e.value],"filter-type-==":[ft,[pt],(t,[e])=>t.geometryType()===e.value],"filter-<":[ft,[pt,yt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[ft,[yt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[ft,[pt,yt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[ft,[yt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[ft,[pt,yt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[ft,[yt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[ft,[pt,yt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[ft,[yt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[ft,[yt],(t,[e])=>e.value in t.properties()],"filter-has-id":[ft,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ft,[bt(pt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ft,[bt(yt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ft,[pt,bt(yt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ft,[pt,bt(yt)],(t,[e,n])=>function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[gn(ft),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[gn(ft),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[ft,[ft],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ft,[pt],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[pt,[pt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[pt,[pt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[pt,gn(yt),(t,e)=>e.map((e=>Ut(e.evaluate(t)))).join("")],"resolved-locale":[pt,[_t],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Mn{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Kt,this._defaultValue=e?function(t){return"color"===t.type&&Sn(t.default)?new Lt(0,0,0,0):"color"===t.type?Lt.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,s){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,i,r,s){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Gt(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function zn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in dn}function Ln(t,e){const n=new be(dn,[],e?function(t){const e={color:mt,string:pt,number:dt,enum:pt,boolean:ft,formatted:vt,resolvedImage:xt};return"array"===t.type?bt(e[t.value]||yt,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?yn(new Mn(i,e)):_n(n.errors)}class Dn{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!_e(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,s)}evaluate(t,e,n,i,r,s){return this._styleExpression.evaluate(t,e,n,i,r,s)}}class Rn{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!_e(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,s)}evaluate(t,e,n,i,r,s){return this._styleExpression.evaluate(t,e,n,i,r,s)}interpolationFactor(t,e,n){return this.interpolationType?qe.interpolationFactor(this.interpolationType,t,e,n):0}}function Bn(t,e){const n=Ln(t,e);if("error"===n.result)return n;const i=n.value.expression,r=ye(i);if(!r&&!vn(e))return _n([new ct("","data expressions not supported")]);const s=ve(i,["zoom"]);if(!s&&!xn(e))return _n([new ct("","zoom expressions not supported")]);const o=Fn(i);return o||s?o instanceof ct?_n([o]):o instanceof qe&&!bn(e)?_n([new ct("",'"interpolate" expressions cannot be used with this property')]):yn(o?new Rn(r?"camera":"composite",n.value,o.labels,o instanceof qe?o.interpolation:void 0):new Dn(r?"constant":"source",n.value)):_n([new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class On{constructor(t,e){this._parameters=t,this._specification=e,ot(this,Tn(this._parameters,this._specification))}static deserialize(t){return new On(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Fn(t){let e=null;if(t instanceof Ze)e=Fn(t.result);else if(t instanceof We){for(const n of t.args)if(e=Fn(n),e)break}else(t instanceof Ee||t instanceof qe)&&t.input instanceof Jt&&"zoom"===t.input.name&&(e=t);return e instanceof ct||t.eachChild((t=>{const n=Fn(t);n instanceof ct?e=n:!e&&n?e=new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Vn(t){const e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},s=t.style,o=t.styleSpec;let a=[];const l=wn(n);if("object"!==l)return[new rt(e,n,`object expected, ${l} found`)];for(const c in n){const t=c.split(".")[0],l=i[t]||i["*"];let u;if(r[t])u=r[t];else if(i[t])u=di;else if(r["*"])u=r["*"];else{if(!i["*"]){a.push(new rt(e,n[c],`unknown property "${c}"`));continue}u=di}a=a.concat(u({key:(e?`${e}.`:e)+c,value:n[c],valueSpec:l,style:s,styleSpec:o,object:n,objectKey:c},n))}for(const c in i)r[c]||i[c].required&&void 0===i[c].default&&void 0===n[c]&&a.push(new rt(e,n,`missing required property "${c}"`));return a}function Nn(t){const e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,s=t.key,o=t.arrayElementValidator||di;if("array"!==wn(e))return[new rt(s,e,`array expected, ${wn(e)} found`)];if(n.length&&e.length!==n.length)return[new rt(s,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new rt(s,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let a={type:n.value,values:n.values};r.$version<7&&(a.function=n.function),"object"===wn(n.value)&&(a=n.value);let l=[];for(let c=0;c<e.length;c++)l=l.concat(o({array:e,arrayIndex:c,value:e[c],valueSpec:a,style:i,styleSpec:r,key:`${s}[${c}]`}));return l}function Un(t){const e=t.key,n=t.value,i=t.valueSpec;let r=wn(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new rt(e,n,`number expected, ${r} found`)]:"minimum"in i&&n<i.minimum?[new rt(e,n,`${n} is less than the minimum value ${i.minimum}`)]:"maximum"in i&&n>i.maximum?[new rt(e,n,`${n} is greater than the maximum value ${i.maximum}`)]:[]}function jn(t){const e=t.valueSpec,n=at(t.value.type);let i,r,s,o={};const a="categorical"!==n&&void 0===t.value.property,l=!a,c="array"===wn(t.value.stops)&&"array"===wn(t.value.stops[0])&&"object"===wn(t.value.stops[0][0]),u=Vn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new rt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const i=t.value;return e=e.concat(Nn({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===wn(i)&&0===i.length&&e.push(new rt(t.key,i,"array must have at least one stop")),e},default:function(t){return di({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&a&&u.push(new rt(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||u.push(new rt(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!bn(t.valueSpec)&&u.push(new rt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!vn(t.valueSpec)?u.push(new rt(t.key,t.value,"property functions not supported")):a&&!xn(t.valueSpec)&&u.push(new rt(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==t.value.property||u.push(new rt(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const i=t.value,a=t.key;if("array"!==wn(i))return[new rt(a,i,`array expected, ${wn(i)} found`)];if(2!==i.length)return[new rt(a,i,`array length 2 expected, length ${i.length} found`)];if(c){if("object"!==wn(i[0]))return[new rt(a,i,`object expected, ${wn(i[0])} found`)];if(void 0===i[0].zoom)return[new rt(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new rt(a,i,"object stop key must have value")];if(s&&s>at(i[0].zoom))return[new rt(a,i[0].zoom,"stop zoom values must appear in ascending order")];at(i[0].zoom)!==s&&(s=at(i[0].zoom),r=void 0,o={}),n=n.concat(Vn({key:`${a}[0]`,value:i[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Un,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:i[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},i));return zn(lt(i[1]))?n.concat([new rt(`${a}[1]`,i[1],"expressions are not allowed in function stops.")]):n.concat(di({key:`${a}[1]`,value:i[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function d(t,s){const a=wn(t.value),l=at(t.value),c=null!==t.value?t.value:s;if(i){if(a!==i)return[new rt(t.key,c,`${a} stop domain type must match previous stop domain type ${i}`)]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new rt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i=`number expected, ${a} found`;return vn(e)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(t.key,c,i)]}return"categorical"!==n||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&void 0!==r&&l<r?[new rt(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in o?[new rt(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new rt(t.key,c,`integer expected, found ${l}`)]}}function Gn(t){const e=("property"===t.expressionContext?Bn:Ln)(lt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new rt(`${t.key}${e.key}`,t.value,e.message)));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new rt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!_e(n))return[new rt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!_e(n))return[new rt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!ve(n,["zoom","feature-state"]))return[new rt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!ye(n))return[new rt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qn(t){const e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(at(n))&&r.push(new rt(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(at(n))&&r.push(new rt(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function $n(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!$n(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const Wn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Zn(t){if(null==t)return{filter:()=>!0,needGeometry:!1};$n(t)||(t=Yn(t));const e=Ln(t,Wn);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,n,i)=>e.value.evaluate(t,n,{},i),needGeometry:Xn(t)}}function Hn(t,e){return t<e?-1:t>e?1:0}function Xn(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Xn(t[e]))return!0;return!1}function Yn(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Kn(t[1],t[2],"=="):"!="===e?ti(Kn(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Kn(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Yn))):"all"===e?["all"].concat(t.slice(1).map(Yn)):"none"===e?["all"].concat(t.slice(1).map(Yn).map(ti)):"in"===e?Jn(t[1],t.slice(2)):"!in"===e?ti(Jn(t[1],t.slice(2))):"has"===e?Qn(t[1]):"!has"===e?ti(Qn(t[1])):"within"!==e||t;var n}function Kn(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Jn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(Hn)]]:["filter-in-small",t,["literal",e]]}}function Qn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ti(t){return["!",t]}function ei(t){return $n(lt(t.value))?Gn(ot({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ni(t)}function ni(t){const e=t.value,n=t.key;if("array"!==wn(e))return[new rt(n,e,`array expected, ${wn(e)} found`)];const i=t.styleSpec;let r,s=[];if(e.length<1)return[new rt(n,e,"filter array must have at least 1 element")];switch(s=s.concat(qn({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),at(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===at(e[1])&&s.push(new rt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&s.push(new rt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=wn(e[1]),"string"!==r&&s.push(new rt(`${n}[1]`,e[1],`string expected, ${r} found`)));for(let o=2;o<e.length;o++)r=wn(e[o]),"$type"===at(e[1])?s=s.concat(qn({key:`${n}[${o}]`,value:e[o],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&s.push(new rt(`${n}[${o}]`,e[o],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let i=1;i<e.length;i++)s=s.concat(ni({key:`${n}[${i}]`,value:e[i],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=wn(e[1]),2!==e.length?s.push(new rt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&s.push(new rt(`${n}[1]`,e[1],`string expected, ${r} found`));break;case"within":r=wn(e[1]),2!==e.length?s.push(new rt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==r&&s.push(new rt(`${n}[1]`,e[1],`object expected, ${r} found`))}return s}function ii(t,e){const n=t.key,i=t.style,r=t.styleSpec,s=t.value,o=t.objectKey,a=r[`${e}_${t.layerType}`];if(!a)return[];const l=o.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return di({key:n,value:s,valueSpec:r.transition,style:i,styleSpec:r});const c=t.valueSpec||a[o];if(!c)return[new rt(n,s,`unknown property "${o}"`)];let u;if("string"===wn(s)&&vn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(s)))return[new rt(n,s,`"${o}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new rt(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Sn(lt(s))&&"identity"===at(s.type)&&h.push(new rt(n,s,'"text-font" does not support identity functions'))),h.concat(di({key:t.key,value:s,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:o}))}function ri(t){return ii(t,"paint")}function si(t){return ii(t,"layout")}function oi(t){let e=[];const n=t.value,i=t.key,r=t.style,s=t.styleSpec;n.type||n.ref||e.push(new rt(i,n,'either "type" or "ref" is required'));let o=at(n.type);const a=at(n.ref);if(n.id){const s=at(n.id);for(let o=0;o<t.arrayIndex;o++){const t=r.layers[o];at(t.id)===s&&e.push(new rt(i,n.id,`duplicate layer id "${n.id}", previously used at line ${t.id.__line__}`))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in n&&e.push(new rt(i,n[t],`"${t}" is prohibited for ref layers`))})),r.layers.forEach((e=>{at(e.id)===a&&(t=e)})),t?t.ref?e.push(new rt(i,n.ref,"ref cannot reference another ref layer")):o=at(t.type):e.push(new rt(i,n.ref,`ref layer "${a}" not found`))}else if("background"!==o)if(n.source){const t=r.sources&&r.sources[n.source],s=t&&at(t.type);t?"vector"===s&&"raster"===o?e.push(new rt(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===s&&"raster"!==o?e.push(new rt(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==s||n["source-layer"]?"raster-dem"===s&&"hillshade"!==o?e.push(new rt(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!n.paint||!n.paint["line-gradient"]||"geojson"===s&&t.lineMetrics||e.push(new rt(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new rt(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new rt(i,n.source,`source "${n.source}" not found`))}else e.push(new rt(i,n,'missing required property "source"'));return e=e.concat(Vn({key:i,value:n,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>di({key:`${i}.type`,value:n.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:ei,layout:t=>Vn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>si(ot({layerType:o},t))}}),paint:t=>Vn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>ri(ot({layerType:o},t))}})}})),e}function ai(t){const e=t.value,n=t.key,i=wn(e);return"string"!==i?[new rt(n,e,`string expected, ${i} found`)]:[]}const li={promoteId:function({key:t,value:e}){if("string"===wn(e))return ai({key:t,value:e});{const n=[];for(const i in e)n.push(...ai({key:`${t}.${i}`,value:e[i]}));return n}}};function ci(t){const e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new rt(n,e,'"type" is required')];const s=at(e.type);let o;switch(s){case"vector":case"raster":case"raster-dem":return o=Vn({key:n,value:e,valueSpec:i[`source_${s.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:li}),o;case"geojson":if(o=Vn({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:li}),e.cluster)for(const t in e.clusterProperties){const[i,r]=e.clusterProperties[t],s="string"==typeof i?[i,["accumulated"],["get",t]]:i;o.push(...Gn({key:`${n}.${t}.map`,value:r,expressionContext:"cluster-map"})),o.push(...Gn({key:`${n}.${t}.reduce`,value:s,expressionContext:"cluster-reduce"}))}return o;case"video":return Vn({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return Vn({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new rt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qn({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function ui(t){const e=t.value,n=t.styleSpec,i=n.light,r=t.style;let s=[];const o=wn(e);if(void 0===e)return s;if("object"!==o)return s=s.concat([new rt("light",e,`object expected, ${o} found`)]),s;for(const a in e){const t=a.match(/^(.*)-transition$/);s=s.concat(t&&i[t[1]]&&i[t[1]].transition?di({key:a,value:e[a],valueSpec:n.transition,style:r,styleSpec:n}):i[a]?di({key:a,value:e[a],valueSpec:i[a],style:r,styleSpec:n}):[new rt(a,e[a],`unknown property "${a}"`)])}return s}const hi={"*":()=>[],array:Nn,boolean:function(t){const e=t.value,n=t.key,i=wn(e);return"boolean"!==i?[new rt(n,e,`boolean expected, ${i} found`)]:[]},number:Un,color:function(t){const e=t.key,n=t.value,i=wn(n);return"string"!==i?[new rt(e,n,`color expected, ${i} found`)]:null===kt(n)?[new rt(e,n,`color expected, "${n}" found`)]:[]},constants:st,enum:qn,filter:ei,function:jn,layer:oi,object:Vn,source:ci,light:ui,string:ai,formatted:function(t){return 0===ai(t).length?[]:Gn(t)},resolvedImage:function(t){return 0===ai(t).length?[]:Gn(t)}};function di(t){const e=t.value,n=t.valueSpec,i=t.styleSpec;return n.expression&&Sn(at(e))?jn(t):n.expression&&zn(lt(e))?Gn(t):n.type&&hi[n.type]?hi[n.type](t):Vn(ot({},t,{valueSpec:n.type?i[n.type]:n}))}function pi(t){const e=t.value,n=t.key,i=ai(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new rt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new rt(n,e,'"glyphs" url must include a "{range}" token'))),i}function fi(t,e=it){let n=[];return n=n.concat(di({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:pi,"*":()=>[]}})),t.constants&&(n=n.concat(st({key:"constants",value:t.constants,style:t,styleSpec:e}))),mi(n)}function mi(t){return[].concat(t).sort(((t,e)=>t.line-e.line))}function gi(t){return function(...e){return mi(t.apply(this,e))}}fi.source=gi(ci),fi.light=gi(ui),fi.layer=gi(oi),fi.filter=gi(ei),fi.paintProperty=gi(ri),fi.layoutProperty=gi(si);const yi=fi,_i=yi.light,vi=yi.paintProperty,xi=yi.layoutProperty;function bi(t,e){let n=!1;if(e&&e.length)for(const i of e)t.fire(new et(new Error(i.message))),n=!0;return n}class wi{constructor(t,e,n){const i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(n=r[2]);for(let t=0;t<this.d*this.d;t++){const e=r[3+t],n=r[3+t+1];i.push(e===n?null:r.subarray(e,n))}const s=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],s),this.bboxes=r.subarray(s),this.insert=this._insertReadonly}else{this.d=e+2*n;for(let t=0;t<this.d*this.d;t++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;const r=n/e*t;this.min=-r,this.max=t+r}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,n,i,r,s){this.cells[r].push(s)}query(t,e,n,i,r){const s=this.min,o=this.max;if(t<=s&&e<=s&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);{const s=[];return this._forEachCell(t,e,n,i,this._queryCell,s,{},r),s}}_queryCell(t,e,n,i,r,s,o,a){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===o[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&n>=c[l+0]&&i>=c[l+1])?(o[h]=!0,s.push(r[h])):o[h]=!1}}}}_forEachCell(t,e,n,i,r,s,o,a){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&r.call(this,t,e,n,i,c,s,o,a))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let n=0;for(let s=0;s<this.cells.length;s++)n+=this.cells[s].length;const i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let r=e;for(let s=0;s<t.length;s++){const e=t[s];i[3+s]=r,i.set(e,r),r+=e.length}return i[3+t.length]=r,i.set(this.keys,r),r+=this.keys.length,i[3+t.length+1]=r,i.set(this.bboxes,r),r+=this.bboxes.length,i.buffer}static serialize(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}}static deserialize(t){return new wi(t.buffer)}}const Si={};function Ei(t,e,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Si[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Ei("Object",Object),Ei("TransferableGridIndex",wi),Ei("Color",Lt),Ei("Error",Error),Ei("AJAXError",j),Ei("ResolvedImage",Ot),Ei("StylePropertyFunction",On),Ei("StyleExpression",Mn,{omit:["_evaluator"]}),Ei("ZoomDependentExpression",Rn),Ei("ZoomConstantExpression",Dn),Ei("CompoundExpression",Jt,{omit:["_evaluate"]});for(const pu in dn)dn[pu]._classRegistryKey||Ei(`Expression_${pu}`,dn[pu]);function Ti(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Ai(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob)return t;if(Ti(t))return e&&e.push(t),t;if(S(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(Ai(i,e));return n}if("object"==typeof t){const n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class");const r=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const n in t){if(!t.hasOwnProperty(n))continue;if(Si[i].omit.indexOf(n)>=0)continue;const s=t[n];r[n]=Si[i].shallow.indexOf(n)>=0?s:Ai(s,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof t)}function ki(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||Ti(t)||S(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(ki);if("object"==typeof t){const e=t.$name||"Object";if(!Si[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Si[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const r of Object.keys(t)){if("$name"===r)continue;const n=t[r];i[r]=Si[e].shallow.indexOf(r)>=0?n:ki(n)}return i}throw new Error("can't deserialize object of type "+typeof t)}class Pi{constructor(){this.first=!0}update(t,e){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const Ii={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Ci(t){for(const e of t)if(Li(e.charCodeAt(0)))return!0;return!1}function Mi(t){for(const e of t)if(!zi(e.charCodeAt(0)))return!1;return!0}function zi(t){return!(Ii.Arabic(t)||Ii["Arabic Supplement"](t)||Ii["Arabic Extended-A"](t)||Ii["Arabic Presentation Forms-A"](t)||Ii["Arabic Presentation Forms-B"](t))}function Li(t){return!(746!==t&&747!==t&&(t<4352||!(Ii["Bopomofo Extended"](t)||Ii.Bopomofo(t)||Ii["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ii["CJK Compatibility Ideographs"](t)||Ii["CJK Compatibility"](t)||Ii["CJK Radicals Supplement"](t)||Ii["CJK Strokes"](t)||!(!Ii["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ii["CJK Unified Ideographs Extension A"](t)||Ii["CJK Unified Ideographs"](t)||Ii["Enclosed CJK Letters and Months"](t)||Ii["Hangul Compatibility Jamo"](t)||Ii["Hangul Jamo Extended-A"](t)||Ii["Hangul Jamo Extended-B"](t)||Ii["Hangul Jamo"](t)||Ii["Hangul Syllables"](t)||Ii.Hiragana(t)||Ii["Ideographic Description Characters"](t)||Ii.Kanbun(t)||Ii["Kangxi Radicals"](t)||Ii["Katakana Phonetic Extensions"](t)||Ii.Katakana(t)&&12540!==t||!(!Ii["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ii["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ii["Unified Canadian Aboriginal Syllabics"](t)||Ii["Unified Canadian Aboriginal Syllabics Extended"](t)||Ii["Vertical Forms"](t)||Ii["Yijing Hexagram Symbols"](t)||Ii["Yi Syllables"](t)||Ii["Yi Radicals"](t))))}function Di(t){return!(Li(t)||function(t){return!!(Ii["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ii["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ii["Letterlike Symbols"](t)||Ii["Number Forms"](t)||Ii["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ii["Control Pictures"](t)&&9251!==t||Ii["Optical Character Recognition"](t)||Ii["Enclosed Alphanumerics"](t)||Ii["Geometric Shapes"](t)||Ii["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ii["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ii["CJK Symbols and Punctuation"](t)||Ii.Katakana(t)||Ii["Private Use Area"](t)||Ii["CJK Compatibility Forms"](t)||Ii["Small Form Variants"](t)||Ii["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Ri(t){return t>=1424&&t<=2303||Ii["Arabic Presentation Forms-A"](t)||Ii["Arabic Presentation Forms-B"](t)}function Bi(t,e){return!(!e&&Ri(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ii.Khmer(t))}function Oi(t){for(const e of t)if(Ri(e.charCodeAt(0)))return!0;return!1}const Fi="deferred",Vi="loading",Ni="loaded";let Ui=null,ji="unavailable",Gi=null;const qi=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(ji="error"),Ui&&Ui(t)};function $i(){Wi.fire(new tt("pluginStateChange",{pluginStatus:ji,pluginURL:Gi}))}const Wi=new nt,Zi=function(){return ji},Hi=function(){if(ji!==Fi||!Gi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ji=Vi,$i(),Gi&&W({url:Gi},(t=>{t?qi(t):(ji=Ni,$i())}))},Xi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ji===Ni||null!=Xi.applyArabicShaping,isLoading:()=>ji===Vi,setState(t){ji=t.pluginStatus,Gi=t.pluginURL},isParsed:()=>null!=Xi.applyArabicShaping&&null!=Xi.processBidirectionalText&&null!=Xi.processStyledBidirectionalText,getPluginURL:()=>Gi};class Yi{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pi,this.transition={})}isSupportedScript(t){return function(t,e){for(const n of t)if(!Bi(n.charCodeAt(0),e))return!1;return!0}(t,Xi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}}}class Ki{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Sn(t))return new On(t,e);if(zn(t)){const n=Bn(t,e);if("error"===n.result)throw new Error(n.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=Lt.parse(t)),{kind:"constant",evaluate:()=>n}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)}}class Ji{constructor(t){this.property=t,this.value=new Ki(t,void 0)}transitioned(t,e){return new tr(this.property,this.value,e,a({},t.transition,this.transition),t.now)}untransitioned(){return new tr(this.property,this.value,null,{},0)}}class Qi{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return d(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ji(this._values[t].property)),this._values[t].value=new Ki(this._values[t].property,null===e?void 0:d(e))}getTransition(t){return d(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ji(this._values[t].property)),this._values[t].transition=d(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n);const i=this.getTransition(e);void 0!==i&&(t[`${e}-transition`]=i)}return t}transitioned(t,e){const n=new er(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(t,e._values[i]);return n}untransitioned(){const t=new er(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class tr{constructor(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(t,e,n){const i=t.now||0,r=this.value.possiblyEvaluate(t,e,n),s=this.prior;if(s){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return s.possiblyEvaluate(t,e,n);{const o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(t,e,n),r,function(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(o))}}return r}}class er{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,n){const i=new rr(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class nr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return d(this._values[t].value)}setValue(t,e){this._values[t]=new Ki(this._values[t].property,null===e?void 0:d(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n)}return t}possiblyEvaluate(t,e,n){const i=new rr(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}}class ir{constructor(t,e,n){this.property=t,this.value=e,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,n,i){return this.property.evaluate(this.value,this.parameters,t,e,n,i)}}class rr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class sr{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,n){const i=Ae[this.specification.type];return i?i(t,e,n):t}}class or{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,n,i){return new ir(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,i)}:t.expression,e)}interpolate(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new ir(this,{kind:"constant",value:void 0},t.parameters);const i=Ae[this.specification.type];return i?new ir(this,{kind:"constant",value:i(t.value.value,e.value.value,n)},t.parameters):t}evaluate(t,e,n,i,r,s){return"constant"===t.kind?t.value:t.evaluate(e,n,i,r,s)}}class ar extends or{possiblyEvaluate(t,e,n,i){if(void 0===t.value)return new ir(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i),s="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(s,s,s,e);return new ir(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){const n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new ir(this,{kind:"constant",value:n},e)}return new ir(this,t.expression,e)}evaluate(t,e,n,i,r,s){if("source"===t.kind){const o=t.evaluate(e,n,i,r,s);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class lr{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Yi(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Yi(Math.floor(e.zoom),e)),t.expression.evaluate(new Yi(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class cr{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){return!!t.expression.evaluate(e,null,{},n,i)}interpolate(){return!1}}class ur{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const n=t[e];n.specification.overridable&&this.overridableProperties.push(e);const i=this.defaultPropertyValues[e]=new Ki(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new Ji(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}}}Ei("DataDrivenProperty",or),Ei("DataConstantProperty",sr),Ei("CrossFadedDataDrivenProperty",ar),Ei("CrossFadedProperty",lr),Ei("ColorRampProperty",cr);const hr="-transition";class dr extends nt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new nr(e.layout)),e.paint)){this._transitionablePaint=new Qi(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rr(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,n={}){null!=e&&this._validate(xi,`layers.${this.id}.layout.${t}`,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(hr)?this._transitionablePaint.getTransition(t.slice(0,-hr.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,n={}){if(null!=e&&this._validate(vi,`layers.${this.id}.paint.${t}`,t,e,n))return!1;if(t.endsWith(hr))return this._transitionablePaint.setTransition(t.slice(0,-hr.length),e||void 0),!1;{const n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),s=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const o=this._transitionablePaint._values[t].value;return o.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(t,s,o)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),h(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,n,i,r={}){return(!r||!1!==r.validate)&&bi(this,t.call(yi,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:it,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof ir&&vn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const pr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fr{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function gr(t,e=1){let n=0,i=0;return{members:t.map((t=>{const r=pr[t.type].BYTES_PER_ELEMENT,s=n=yr(n,Math.max(e,r)),o=t.components||1;return i=Math.max(i,r),n+=r*o,{name:t.name,type:t.type,components:o,offset:s}})),size:yr(n,Math.max(i,e)),alignment:e}}function yr(t,e){return Math.ceil(t/e)*e}class _r extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t}}_r.prototype.bytesPerElement=4,Ei("StructArrayLayout2i4",_r);class vr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const s=4*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,t}}vr.prototype.bytesPerElement=8,Ei("StructArrayLayout4i8",vr);class xr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,s)}emplace(t,e,n,i,r,s,o){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=s,this.int16[a+5]=o,t}}xr.prototype.bytesPerElement=12,Ei("StructArrayLayout2i4i12",xr);class br extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,s)}emplace(t,e,n,i,r,s,o){const a=4*t,l=8*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.uint8[l+4]=i,this.uint8[l+5]=r,this.uint8[l+6]=s,this.uint8[l+7]=o,t}}br.prototype.bytesPerElement=8,Ei("StructArrayLayout2i4ub8",br);class wr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t}}wr.prototype.bytesPerElement=8,Ei("StructArrayLayout2f8",wr);class Sr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,s,o,a,l,c)}emplace(t,e,n,i,r,s,o,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=s,this.uint16[h+5]=o,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}Sr.prototype.bytesPerElement=20,Ei("StructArrayLayout10ui20",Sr);class Er extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,n,i,r,s,o,a,l,c,u,h)}emplace(t,e,n,i,r,s,o,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=s,this.uint16[p+5]=o,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}Er.prototype.bytesPerElement=24,Ei("StructArrayLayout4i4ui4i24",Er);class Tr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t}}Tr.prototype.bytesPerElement=12,Ei("StructArrayLayout3f12",Tr);class Ar extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Ar.prototype.bytesPerElement=4,Ei("StructArrayLayout1ul4",Ar);class kr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,i,r,s,o,a,l)}emplace(t,e,n,i,r,s,o,a,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+3]=r,this.int16[u+4]=s,this.int16[u+5]=o,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}kr.prototype.bytesPerElement=20,Ei("StructArrayLayout6i1ul2ui20",kr);class Pr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,s)}emplace(t,e,n,i,r,s,o){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=s,this.int16[a+5]=o,t}}Pr.prototype.bytesPerElement=12,Ei("StructArrayLayout2i2i2i12",Pr);class Ir extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,n,i,r)}emplace(t,e,n,i,r,s){const o=4*t,a=8*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[a+6]=r,this.int16[a+7]=s,t}}Ir.prototype.bytesPerElement=16,Ei("StructArrayLayout2f1f2i16",Ir);class Cr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const s=12*t,o=3*t;return this.uint8[s+0]=e,this.uint8[s+1]=n,this.float32[o+1]=i,this.float32[o+2]=r,t}}Cr.prototype.bytesPerElement=12,Ei("StructArrayLayout2ub2f12",Cr);class Mr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t}}Mr.prototype.bytesPerElement=6,Ei("StructArrayLayout3ui6",Mr);class zr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g)}emplace(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y){const _=24*t,v=12*t,x=48*t;return this.int16[_+0]=e,this.int16[_+1]=n,this.uint16[_+2]=i,this.uint16[_+3]=r,this.uint32[v+2]=s,this.uint32[v+3]=o,this.uint32[v+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[_+22]=y,t}}zr.prototype.bytesPerElement=48,Ei("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",zr);class Lr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T,A,k){const P=this.length;return this.resize(P+1),this.emplace(P,t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T,A,k)}emplace(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T,A,k,P){const I=34*t,C=17*t;return this.int16[I+0]=e,this.int16[I+1]=n,this.int16[I+2]=i,this.int16[I+3]=r,this.int16[I+4]=s,this.int16[I+5]=o,this.int16[I+6]=a,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=d,this.uint16[I+12]=p,this.uint16[I+13]=f,this.uint16[I+14]=m,this.uint16[I+15]=g,this.uint16[I+16]=y,this.uint16[I+17]=_,this.uint16[I+18]=v,this.uint16[I+19]=x,this.uint16[I+20]=b,this.uint16[I+21]=w,this.uint16[I+22]=S,this.uint32[C+12]=E,this.float32[C+13]=T,this.float32[C+14]=A,this.float32[C+15]=k,this.float32[C+16]=P,t}}Lr.prototype.bytesPerElement=68,Ei("StructArrayLayout8i15ui1ul4f68",Lr);class Dr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Dr.prototype.bytesPerElement=4,Ei("StructArrayLayout1f4",Dr);class Rr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t}}Rr.prototype.bytesPerElement=6,Ei("StructArrayLayout3i6",Rr);class Br extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=n,this.uint16[r+3]=i,t}}Br.prototype.bytesPerElement=8,Ei("StructArrayLayout1ul2ui8",Br);class Or extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t}}Or.prototype.bytesPerElement=4,Ei("StructArrayLayout2ui4",Or);class Fr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Fr.prototype.bytesPerElement=2,Ei("StructArrayLayout1ui2",Fr);class Vr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const s=4*t;return this.float32[s+0]=e,this.float32[s+1]=n,this.float32[s+2]=i,this.float32[s+3]=r,t}}Vr.prototype.bytesPerElement=16,Ei("StructArrayLayout4f16",Vr);class Nr extends fr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}Nr.prototype.size=20;class Ur extends kr{get(t){return new Nr(this,t)}}Ei("CollisionBoxArray",Ur);class jr extends fr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}jr.prototype.size=48;class Gr extends zr{get(t){return new jr(this,t)}}Ei("PlacedSymbolArray",Gr);class qr extends fr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}qr.prototype.size=68;class $r extends Lr{get(t){return new qr(this,t)}}Ei("SymbolInstanceArray",$r);class Wr extends Dr{getoffsetX(t){return this.float32[1*t+0]}}Ei("GlyphOffsetArray",Wr);class Zr extends Rr{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ei("SymbolLineVertexArray",Zr);class Hr extends fr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Hr.prototype.size=8;class Xr extends Br{get(t){return new Hr(this,t)}}Ei("FeatureIndexArray",Xr);class Yr extends _r{}class Kr extends _r{}class Jr extends xr{}class Qr extends br{}class ts extends wr{}class es extends Sr{}class ns extends Er{}class is extends Tr{}class rs extends Ar{}class ss extends Pr{}class os extends Cr{}class as extends Mr{}class ls extends Or{}const cs=gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:us}=cs;class hs{constructor(t=[]){this.segments=t}prepareSegment(t,e,n,i){let r=this.segments[this.segments.length-1];return t>hs.MAX_VERTEX_ARRAY_LENGTH&&f(`Max vertices per segment is ${hs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>hs.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,n,i){return new hs([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function ds(t,e){return 256*(t=s(Math.floor(t),0,255))+s(Math.floor(e),0,255)}hs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ei("SegmentVector",hs);const ps=gr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fs={exports:{}},ms={exports:{}};ms.exports=function(t,e){var n,i,r,s,o,a,l,c;for(i=t.length-(n=3&t.length),r=e,o=3432918353,a=461845907,c=0;c<i;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(s=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0};var gs={exports:{}};gs.exports=function(t,e){for(var n,i=t.length,r=e^i,s=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++s;switch(i){case 3:r^=(255&t.charCodeAt(s+2))<<16;case 2:r^=(255&t.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};var ys=ms.exports,_s=gs.exports;fs.exports=ys,fs.exports.murmur3=ys,fs.exports.murmur2=_s;var vs=fs.exports;class xs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,n,i){this.ids.push(bs(t)),this.positions.push(e,n,i)}getPositions(t){const e=bs(t);let n=0,i=this.ids.length-1;for(;n<i;){const t=n+i>>1;this.ids[t]>=e?i=t:n=t+1}const r=[];for(;this.ids[n]===e;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(t,e){const n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return ws(n,i,0,n.length-1),e&&e.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(t){const e=new xs;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function bs(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:vs(String(t))}function ws(t,e,n,i){for(;n<i;){const r=t[n+i>>1];let s=n-1,o=i+1;for(;;){do{s++}while(t[s]<r);do{o--}while(t[o]>r);if(s>=o)break;Ss(t,s,o),Ss(e,3*s,3*o),Ss(e,3*s+1,3*o+1),Ss(e,3*s+2,3*o+2)}o-n<i-o?(ws(t,e,n,o),n=o+1):(ws(t,e,o+1,i),i=o)}}function Ss(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}Ei("FeaturePositionMap",xs);class Es{constructor(t,e){this.gl=t.gl,this.location=e}}class Ts extends Es{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class As extends Es{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ks extends Es{constructor(t,e){super(t,e),this.current=Lt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ps=new Float32Array(16);function Is(t){return[ds(255*t.r,255*t.g),ds(255*t.b,255*t.a)]}class Cs{constructor(t,e,n){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=n}setUniform(t,e,n){t.set(n.constantOr(this.value))}getBinding(t,e,n){return"color"===this.type?new ks(t,e):new Ts(t,e)}}class Ms{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,n,i){const r="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,n){return"u_pattern"===n.substr(0,9)?new As(t,e):new Ts(t,e)}}class zs{constructor(t,e,n,i){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(t,e,n,i,r){const s=this.paintVertexArray.length,o=this.expression.evaluate(new Yi(0),e,{},i,[],r);this.paintVertexArray.resize(t),this._setPaintValue(s,t,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(t,e,r)}_setPaintValue(t,e,n){if("color"===this.type){const i=Is(n);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ls{constructor(t,e,n,i,r,s){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new s}populatePaintArray(t,e,n,i,r){const s=this.expression.evaluate(new Yi(this.zoom),e,{},i,[],r),o=this.expression.evaluate(new Yi(this.zoom+1),e,{},i,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,s,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),s=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(t,e,r,s)}_setPaintValue(t,e,n,i){if("color"===this.type){const r=Is(n),s=Is(i);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1],s[0],s[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,i=s(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(i)}getBinding(t,e,n){return new Ts(t,e)}}class Ds{constructor(t,e,n,i,r,s){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=i,this.layerId=s,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(t,e,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],n)}updatePaintArray(t,e,n,i,r){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(t,e,n,i){if(!i||!n)return;const{min:r,mid:s,max:o}=n,a=i[r],l=i[s],c=i[o];if(a&&l&&c)for(let u=t;u<e;u++)this.zoomInPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ps.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ps.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Rs{constructor(t,e,n){this.binders={},this._buffers=[];const i=[];for(const r in t.paint._values){if(!n(r))continue;const s=t.paint.get(r);if(!(s instanceof ir&&vn(s.property.specification)))continue;const o=Os(r,t.type),a=s.value,l=s.property.specification.type,c=s.property.useIntegerZoom,u=s.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[r]=h?new Ms(a.value,o):new Cs(a.value,o,l),i.push(`/u_${r}`);else if("source"===a.kind||h){const n=Fs(r,l,"source");this.binders[r]=h?new Ds(a,l,c,e,n,t.id):new zs(a,o,l,n),i.push(`/a_${r}`)}else{const t=Fs(r,l,"composite");this.binders[r]=new Ls(a,o,l,c,e,t),i.push(`/z_${r}`)}}this.cacheKey=i.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof zs||e instanceof Ls?e.maxValue:0}populatePaintArrays(t,e,n,i,r){for(const s in this.binders){const o=this.binders[s];(o instanceof zs||o instanceof Ls||o instanceof Ds)&&o.populatePaintArray(t,e,n,i,r)}}setConstantPatternPositions(t,e){for(const n in this.binders){const i=this.binders[n];i instanceof Ms&&i.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,n,i,r){let s=!1;for(const o in t){const a=e.getPositions(o);for(const e of a){const a=n.feature(e.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof zs||l instanceof Ls||l instanceof Ds)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[o],r),s=!0}}}}return s}defines(){const t=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Cs||n instanceof Ms)&&t.push(...n.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof zs||n instanceof Ls)for(let e=0;e<n.paintVertexAttributes.length;e++)t.push(n.paintVertexAttributes[e].name);else if(n instanceof Ds)for(let e=0;e<ps.members.length;e++)t.push(ps.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Cs||n instanceof Ms||n instanceof Ls)for(const e of n.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Cs||r instanceof Ms||r instanceof Ls)for(const s of r.uniformNames)if(e[s]){const o=r.getBinding(t,e[s],s);n.push({name:s,property:i,binding:o})}}return n}setUniforms(t,e,n,i){for(const{name:r,property:s,binding:o}of e)this.binders[s].setUniform(o,i,n.get(s),r)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const n=this.binders[e];if(t&&n instanceof Ds){const e=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(n instanceof zs||n instanceof Ls)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const e in this.binders){const n=this.binders[e];(n instanceof zs||n instanceof Ls||n instanceof Ds)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof zs||e instanceof Ls||e instanceof Ds)&&e.destroy()}}}class Bs{constructor(t,e,n=(()=>!0)){this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new Rs(i,e,n);this.needsUpload=!1,this._featureMap=new xs,this._bufferOffset=0}populatePaintArrays(t,e,n,i,r,s){for(const o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,i,r,s);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,i)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Os(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}function Fs(t,e,n){const i={color:{source:wr,composite:Vr},number:{source:Dr,composite:wr}},r=function(t){return{"line-pattern":{source:es,composite:es},"fill-pattern":{source:es,composite:es},"fill-extrusion-pattern":{source:es,composite:es}}[t]}(t);return r&&r[n]||i[e][n]}Ei("ConstantBinder",Cs),Ei("CrossFadedConstantBinder",Ms),Ei("SourceExpressionBinder",zs),Ei("CrossFadedCompositeBinder",Ds),Ei("CompositeExpressionBinder",Ls),Ei("ProgramConfiguration",Rs,{omit:["_buffers"]}),Ei("ProgramConfigurationSet",Bs);var Vs=8192;const Ns=Math.pow(2,14)-1,Us=-Ns-1;function js(t){const e=Vs/t.extent,n=t.loadGeometry();for(let i=0;i<n.length;i++){const t=n[i];for(let n=0;n<t.length;n++){const i=t[n],r=Math.round(i.x*e),o=Math.round(i.y*e);i.x=s(r,Us,Ns),i.y=s(o,Us,Ns),(r<i.x||r>i.x+1||o<i.y||o>i.y+1)&&f("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Gs(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?js(t):[]}}function qs(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}class $s{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Yr,this.indexArray=new as,this.segments=new hs,this.programConfigurations=new Bs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){const i=this.layers[0],r=[];let s=null,o=!1;"circle"===i.type&&(s=i.layout.get("circle-sort-key"),o=!s.isConstant());for(const{feature:a,id:l,index:c,sourceLayerIndex:u}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Gs(a,t);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),e,n))continue;const i=o?s.evaluate(e,{},n):void 0,h={id:l,properties:a.properties,type:a.type,sourceLayerIndex:u,index:c,geometry:t?e.geometry:js(a),patterns:{},sortKey:i};r.push(h)}o&&r.sort(((t,e)=>t.sortKey-e.sortKey));for(const a of r){const{geometry:i,index:r,sourceLayerIndex:s}=a,o=t[r].feature;this.addFeature(a,i,r,n),e.featureIndex.insert(o,i,r,s,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,us),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i){for(const r of e)for(const e of r){const n=e.x,i=e.y;if(n<0||n>=Vs||i<0||i>=Vs)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),s=r.vertexLength;qs(this.layoutVertexArray,n,i,-1,-1),qs(this.layoutVertexArray,n,i,1,-1),qs(this.layoutVertexArray,n,i,1,1),qs(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+3,s+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},i)}}function Ws(t,e){for(let n=0;n<t.length;n++)if(eo(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(eo(t,e[n]))return!0;return!!Ys(t,e)}function Zs(t,e,n){return!!eo(t,e)||!!Js(e,t,n)}function Hs(t,e){if(1===t.length)return to(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++)if(eo(t,i[e]))return!0}for(let n=0;n<t.length;n++)if(to(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ys(t,e[n]))return!0;return!1}function Xs(t,e,n){if(t.length>1){if(Ys(t,e))return!0;for(let i=0;i<e.length;i++)if(Js(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Js(t[i],e,n))return!0;return!1}function Ys(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)if(Ks(i,r,e[t],e[t+1]))return!0}return!1}function Ks(t,e,n,i){return m(t,n,i)!==m(e,n,i)&&m(t,e,n)!==m(t,e,i)}function Js(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let r=1;r<e.length;r++)if(Qs(t,e[r-1],e[r])<i)return!0;return!1}function Qs(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e)._mult(r)._add(e))}function to(t,e){let n,i,r,s=!1;for(let o=0;o<t.length;o++){n=t[o];for(let t=0,o=n.length-1;t<n.length;o=t++)i=n[t],r=n[o],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(s=!s)}return s}function eo(t,e){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const s=t[i],o=t[r];s.y>e.y!=o.y>e.y&&e.x<(o.x-s.x)*(e.y-s.y)/(o.y-s.y)+s.x&&(n=!n)}return n}function no(t,e,n){const i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;const s=m(t,e,n[0]);return s!==m(t,e,n[1])||s!==m(t,e,n[2])||s!==m(t,e,n[3])}function io(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function ro(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function so(t,e,n,i,r){if(!e[0]&&!e[1])return t;const s=T.convert(e)._mult(r);"viewport"===n&&s._rotate(-i);const o=[];for(let a=0;a<t.length;a++)o.push(t[a].sub(s));return o}Ei("CircleBucket",$s,{omit:["layers"]});const oo=new ur({"circle-sort-key":new or(it.layout_circle["circle-sort-key"])});var ao={paint:new ur({"circle-radius":new or(it.paint_circle["circle-radius"]),"circle-color":new or(it.paint_circle["circle-color"]),"circle-blur":new or(it.paint_circle["circle-blur"]),"circle-opacity":new or(it.paint_circle["circle-opacity"]),"circle-translate":new sr(it.paint_circle["circle-translate"]),"circle-translate-anchor":new sr(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new sr(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new sr(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new or(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new or(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new or(it.paint_circle["circle-stroke-opacity"])}),layout:oo},lo="undefined"!=typeof Float32Array?Float32Array:Array;function co(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uo(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=n[0],x=n[1],b=n[2],w=n[3];return t[0]=v*i+x*a+b*h+w*m,t[1]=v*r+x*l+b*d+w*g,t[2]=v*s+x*c+b*p+w*y,t[3]=v*o+x*u+b*f+w*_,t[4]=(v=n[4])*i+(x=n[5])*a+(b=n[6])*h+(w=n[7])*m,t[5]=v*r+x*l+b*d+w*g,t[6]=v*s+x*c+b*p+w*y,t[7]=v*o+x*u+b*f+w*_,t[8]=(v=n[8])*i+(x=n[9])*a+(b=n[10])*h+(w=n[11])*m,t[9]=v*r+x*l+b*d+w*g,t[10]=v*s+x*c+b*p+w*y,t[11]=v*o+x*u+b*f+w*_,t[12]=(v=n[12])*i+(x=n[13])*a+(b=n[14])*h+(w=n[15])*m,t[13]=v*r+x*l+b*d+w*g,t[14]=v*s+x*c+b*p+w*y,t[15]=v*o+x*u+b*f+w*_,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ho,po=uo;function fo(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}function mo(t,e){const n=fo([],[t.x,t.y,0,1],e);return new T(n[0]/n[3],n[1]/n[3])}ho=new lo(4),lo!=Float32Array&&(ho[0]=0,ho[1]=0,ho[2]=0,ho[3]=0);class go extends $s{}Ei("HeatmapBucket",go,{omit:["layers"]});var yo={paint:new ur({"heatmap-radius":new or(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new or(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new sr(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cr(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new sr(it.paint_heatmap["heatmap-opacity"])})};function _o(t,{width:e,height:n},i,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*n*i)throw new RangeError(`mismatched image size. expected: ${r.length} but got: ${e*n*i}`)}else r=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=r,t}function vo(t,{width:e,height:n},i){if(e===t.width&&n===t.height)return;const r=_o({},{width:e,height:n},i);xo(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,n)},i),t.width=e,t.height=n,t.data=r.data}function xo(t,e,n,i,r,s){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,a=e.data;for(let l=0;l<r.height;l++){const c=((n.y+l)*t.width+n.x)*s,u=((i.y+l)*e.width+i.x)*s;for(let t=0;t<r.width*s;t++)a[u+t]=o[c+t]}return e}class bo{constructor(t,e){_o(this,t,1,e)}resize(t){vo(this,t,1)}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){xo(t,e,n,i,r,1)}}class wo{constructor(t,e){_o(this,t,4,e)}resize(t){vo(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){xo(t,e,n,i,r,4)}}function So(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,r=t.image||new wo({width:n,height:i}),s=(n,i,s)=>{e[t.evaluationKey]=s;const o=t.expression.evaluate(e);r.data[n+i+0]=Math.floor(255*o.r/o.a),r.data[n+i+1]=Math.floor(255*o.g/o.a),r.data[n+i+2]=Math.floor(255*o.b/o.a),r.data[n+i+3]=Math.floor(255*o.a)};if(t.clips)for(let o=0,a=0;o<i;++o,a+=4*n)for(let e=0,i=0;e<n;e++,i+=4){const r=e/(n-1),{start:l,end:c}=t.clips[o];s(a,i,l*(1-r)+c*r)}else for(let o=0,a=0;o<n;o++,a+=4)s(0,a,o/(n-1));return r}Ei("AlphaImage",bo),Ei("RGBAImage",wo);var Eo={paint:new ur({"hillshade-illumination-direction":new sr(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new sr(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new sr(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new sr(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new sr(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new sr(it.paint_hillshade["hillshade-accent-color"])})};const To=gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ao}=To;var ko={exports:{}};function Po(t,e,n){n=n||2;var i,r,s,o,a,l,c,u=e&&e.length,h=u?e[0]*n:t.length,d=Io(t,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,n,i){var r,s,o,a=[];for(r=0,s=e.length;r<s;r++)(o=Io(t,e[r]*i,r<s-1?e[r+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),a.push(No(o));for(a.sort(Bo),r=0;r<a.length;r++)n=Co(n=Oo(a[r],n),n.next);return n}(t,e,d,n)),t.length>80*n){i=s=t[0],r=o=t[1];for(var f=n;f<h;f+=n)(a=t[f])<i&&(i=a),(l=t[f+1])<r&&(r=l),a>s&&(s=a),l>o&&(o=l);c=0!==(c=Math.max(s-i,o-r))?1/c:0}return Mo(d,p,n,i,r,c),p}function Io(t,e,n,i,r){var s,o;if(r===Qo(t,e,n,i)>0)for(s=e;s<n;s+=i)o=Yo(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=Yo(s,t[s],t[s+1],o);return o&&qo(o,o.next)&&(Ko(o),o=o.next),o}function Co(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!qo(i,i.next)&&0!==Go(i.prev,i,i.next))i=i.next;else{if(Ko(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Mo(t,e,n,i,r,s,o){if(t){!o&&s&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=Vo(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(t,i,r,s);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?Lo(t,i,r,s):zo(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Ko(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?Mo(t=Do(Co(t),e,n),e,n,i,r,s,2):2===o&&Ro(t,e,n,i,r,s):Mo(Co(t),e,n,i,r,s,1);break}}}function zo(t){var e=t.prev,n=t,i=t.next;if(Go(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Uo(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Go(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Lo(t,e,n,i){var r=t.prev,s=t,o=t.next;if(Go(r,s,o)>=0)return!1;for(var a=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,l=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,c=Vo(r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,e,n,i),u=Vo(a,l,e,n,i),h=t.prevZ,d=t.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==t.prev&&h!==t.next&&Uo(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&Go(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==t.prev&&d!==t.next&&Uo(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Go(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Uo(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&Go(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&Uo(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Go(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Do(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!qo(r,s)&&$o(r,i,i.next,s)&&Ho(r,s)&&Ho(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),Ko(i),Ko(i.next),i=t=s),i=i.next}while(i!==t);return Co(i)}function Ro(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&jo(o,a)){var l=Xo(o,a);return o=Co(o,o.next),l=Co(l,l.next),Mo(o,e,n,i,r,s),void Mo(l,e,n,i,r,s)}a=a.next}o=o.next}while(o!==t)}function Bo(t,e){return t.x-e.x}function Oo(t,e){var n=function(t,e){var n,i=e,r=t.x,s=t.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o){if(o=a,a===r){if(s===i.y)return i;if(s===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===o)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&Uo(s<h?r:o,s,u,h,s<h?o:r,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(r-i.x),Ho(i,t)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&Fo(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(t,e);if(!n)return e;var i=Xo(n,t),r=Co(n,n.next);return Co(i,i.next),e===n?r:e}function Fo(t,e){return Go(t.prev,t,e.prev)<0&&Go(e.next,t,t.next)<0}function Vo(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function No(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Uo(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function jo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&$o(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ho(t,e)&&Ho(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Go(t.prev,t,e.prev)||Go(t,e.prev,e))||qo(t,e)&&Go(t.prev,t,t.next)>0&&Go(e.prev,e,e.next)>0)}function Go(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function qo(t,e){return t.x===e.x&&t.y===e.y}function $o(t,e,n,i){var r=Zo(Go(t,e,n)),s=Zo(Go(t,e,i)),o=Zo(Go(n,i,t)),a=Zo(Go(n,i,e));return r!==s&&o!==a||!(0!==r||!Wo(t,n,e))||!(0!==s||!Wo(t,i,e))||!(0!==o||!Wo(n,t,i))||!(0!==a||!Wo(n,e,i))}function Wo(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Zo(t){return t>0?1:t<0?-1:0}function Ho(t,e){return Go(t.prev,t,t.next)<0?Go(t,e,t.next)>=0&&Go(t,t.prev,e)>=0:Go(t,e,t.prev)<0||Go(t,t.next,e)<0}function Xo(t,e){var n=new Jo(t.i,t.x,t.y),i=new Jo(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Yo(t,e,n,i){var r=new Jo(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ko(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Jo(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qo(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}ko.exports=Po,ko.exports.default=Po,Po.deviation=function(t,e,n,i){var r=e&&e.length,s=Math.abs(Qo(t,0,r?e[0]*n:t.length,n));if(r)for(var o=0,a=e.length;o<a;o++)s-=Math.abs(Qo(t,e[o]*n,o<a-1?e[o+1]*n:t.length,n));var l=0;for(o=0;o<i.length;o+=3){var c=i[o]*n,u=i[o+1]*n,h=i[o+2]*n;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},Po.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&n.holes.push(i+=t[r-1].length)}return n};var ta=ko.exports;function ea(t,e,n,i,r){na(t,e,n||0,i||t.length-1,r||ra)}function na(t,e,n,i,r){for(;i>n;){if(i-n>600){var s=i-n+1,o=e-n+1,a=Math.log(s),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);na(t,e,Math.max(n,Math.floor(e-o*l/s+c)),Math.min(i,Math.floor(e+(s-o)*l/s+c)),r)}var u=t[e],h=n,d=i;for(ia(t,n,e),r(t[i],u)>0&&ia(t,n,i);h<d;){for(ia(t,h,d),h++,d--;r(t[h],u)<0;)h++;for(;r(t[d],u)>0;)d--}0===r(t[n],u)?ia(t,n,d):ia(t,++d,i),d<=e&&(n=d+1),e<=d&&(i=d-1)}}function ia(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function ra(t,e){return t<e?-1:t>e?1:0}function sa(t,e){const n=t.length;if(n<=1)return[t];const i=[];let r,s;for(let o=0;o<n;o++){const e=g(t[o]);0!==e&&(t[o].area=Math.abs(e),void 0===s&&(s=e<0),s===e<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}if(r&&i.push(r),e>1)for(let o=0;o<i.length;o++)i[o].length<=e||(ea(i[o],e,1,i[o].length-1,oa),i[o]=i[o].slice(0,e));return i}function oa(t,e){return e.area-t.area}function aa(t,e,n){const i=n.patternDependencies;let r=!1;for(const s of e){const e=s.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const n=e.constantOr(null);n&&(r=!0,i[n.to]=!0,i[n.from]=!0)}return r}function la(t,e,n,i,r){const s=r.patternDependencies;for(const o of e){const e=o.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:i-1},n,{},r.availableImages),a=e.evaluate({zoom:i},n,{},r.availableImages),l=e.evaluate({zoom:i+1},n,{},r.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,s[t]=!0,s[a]=!0,s[l]=!0,n.patterns[o.id]={min:t,mid:a,max:l}}}return n}class ca{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kr,this.indexArray=new as,this.indexArray2=new ls,this.programConfigurations=new Bs(t.layers,t.zoom),this.segments=new hs,this.segments2=new hs,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){this.hasPattern=aa("fill",this.layers,e);const i=this.layers[0].layout.get("fill-sort-key"),r=!i.isConstant(),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Gs(o,t);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),u,n))continue;const h=r?i.evaluate(u,{},n,e.availableImages):void 0,d={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:js(o),patterns:{},sortKey:h};s.push(d)}r&&s.sort(((t,e)=>t.sortKey-e.sortKey));for(const o of s){const{geometry:i,index:r,sourceLayerIndex:s}=o;if(this.hasPattern){const t=la("fill",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{});e.featureIndex.insert(t[r].feature,i,r,s,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ao),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,n,i,r){for(const s of sa(e,500)){let t=0;for(const a of s)t+=a.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=e.vertexLength,i=[],r=[];for(const a of s){if(0===a.length)continue;a!==s[0]&&r.push(i.length/2);const t=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(e+a.length-1,e),i.push(a[0].x),i.push(a[0].y);for(let n=1;n<a.length;n++)this.layoutVertexArray.emplaceBack(a[n].x,a[n].y),this.indexArray2.emplaceBack(e+n-1,e+n),i.push(a[n].x),i.push(a[n].y);t.vertexLength+=a.length,t.primitiveLength+=a.length}const o=ta(i,r);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(n+o[s],n+o[s+1],n+o[s+2]);e.vertexLength+=t,e.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}}Ei("FillBucket",ca,{omit:["layers","patternFeatures"]});const ua=new ur({"fill-sort-key":new or(it.layout_fill["fill-sort-key"])});var ha={paint:new ur({"fill-antialias":new sr(it.paint_fill["fill-antialias"]),"fill-opacity":new or(it.paint_fill["fill-opacity"]),"fill-color":new or(it.paint_fill["fill-color"]),"fill-outline-color":new or(it.paint_fill["fill-outline-color"]),"fill-translate":new sr(it.paint_fill["fill-translate"]),"fill-translate-anchor":new sr(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new ar(it.paint_fill["fill-pattern"])}),layout:ua};const da=gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:pa}=da;var fa={},ma=T,ga=ya;function ya(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(_a,this,e)}function _a(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function va(t){for(var e,n,i=0,r=0,s=t.length,o=s-1;r<s;o=r++)i+=((n=t[o]).x-(e=t[r]).x)*(e.y+n.y);return i}ya.types=["Unknown","Point","LineString","Polygon"],ya.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,r=0,s=0,o=0,a=[];t.pos<n;){if(r<=0){var l=t.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)s+=t.readSVarint(),o+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new ma(s,o));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&a.push(e),a},ya.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,s=0,o=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var u=t.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<o&&(o=r),r>a&&(a=r),(s+=t.readSVarint())<l&&(l=s),s>c&&(c=s);else if(7!==n)throw new Error("unknown command "+n)}return[o,l,a,c]},ya.prototype.toGeoJSON=function(t,e,n){var i,r,s=this.extent*Math.pow(2,n),o=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=ya.types[this.type];function u(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+o)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],s=0;s<e;s++){var o=va(t[s]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(n&&r.push(n),n=[t[s]]):n.push(t[s]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var xa=ga,ba=wa;function wa(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Sa,this,e),this.length=this._features.length}function Sa(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}wa.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new xa(this._pbf,e,this.extent,this._keys,this._values)};var Ea=ba;function Ta(t,e,n){if(3===t){var i=new Ea(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}fa.VectorTile=function(t,e){this.layers=t.readFields(Ta,{},e)},fa.VectorTileFeature=ga,fa.VectorTileLayer=ba;const Aa=fa.VectorTileFeature.types,ka=Math.pow(2,13);function Pa(t,e,n,i,r,s,o,a){t.emplaceBack(e,n,2*Math.floor(i*ka)+o,r*ka*2,s*ka*2,Math.round(a))}class Ia{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Jr,this.indexArray=new as,this.programConfigurations=new Bs(t.layers,t.zoom),this.segments=new hs,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){this.features=[],this.hasPattern=aa("fill-extrusion",this.layers,e);for(const{feature:i,id:r,index:s,sourceLayerIndex:o}of t){const t=this.layers[0]._featureFilter.needGeometry,a=Gs(i,t);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),a,n))continue;const l={id:r,sourceLayerIndex:o,index:s,geometry:t?a.geometry:js(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(la("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,s,n,{}),e.featureIndex.insert(i,l.geometry,s,o,this.index,!0)}}addFeatures(t,e,n){for(const i of this.features){const{geometry:t}=i;this.addFeature(i,t,i.index,e,n)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pa),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i,r){for(const s of sa(e,500)){let e=0;for(const t of s)e+=t.length;let n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const t of s){if(0===t.length)continue;if(Ma(t))continue;let e=0;for(let i=0;i<t.length;i++){const r=t[i];if(i>=1){const s=t[i-1];if(!Ca(r,s)){n.vertexLength+4>hs.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=r.sub(s)._perp()._unit(),i=s.dist(r);e+i>32768&&(e=0),Pa(this.layoutVertexArray,r.x,r.y,t.x,t.y,0,0,e),Pa(this.layoutVertexArray,r.x,r.y,t.x,t.y,0,1,e),e+=i,Pa(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,0,e),Pa(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,1,e);const o=n.vertexLength;this.indexArray.emplaceBack(o,o+2,o+1),this.indexArray.emplaceBack(o+1,o+2,o+3),n.vertexLength+=4,n.primitiveLength+=2}}}}if(n.vertexLength+e>hs.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==Aa[t.type])continue;const i=[],r=[],o=n.vertexLength;for(const t of s)if(0!==t.length){t!==s[0]&&r.push(i.length/2);for(let e=0;e<t.length;e++){const n=t[e];Pa(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),i.push(n.x),i.push(n.y)}}const a=ta(i,r);for(let t=0;t<a.length;t+=3)this.indexArray.emplaceBack(o+a[t],o+a[t+2],o+a[t+1]);n.primitiveLength+=a.length/3,n.vertexLength+=e}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}}function Ca(t,e){return t.x===e.x&&(t.x<0||t.x>Vs)||t.y===e.y&&(t.y<0||t.y>Vs)}function Ma(t){return t.every((t=>t.x<0))||t.every((t=>t.x>Vs))||t.every((t=>t.y<0))||t.every((t=>t.y>Vs))}Ei("FillExtrusionBucket",Ia,{omit:["layers","features"]});var za={paint:new ur({"fill-extrusion-opacity":new sr(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new or(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new sr(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new sr(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ar(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new or(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new or(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new sr(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function La(t,e){return t.x*e.x+t.y*e.y}function Da(t,e){if(1===t.length){let n=0;const i=e[n++];let r;for(;!r||i.equals(r);)if(r=e[n++],!r)return 1/0;for(;n<e.length;n++){const s=e[n],o=t[0],a=r.sub(i),l=s.sub(i),c=o.sub(i),u=La(a,a),h=La(a,l),d=La(l,l),p=La(c,a),f=La(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=i.z*(1-g-y)+r.z*g+s.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}const Ra=gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ba}=Ra,Oa=gr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Fa}=Oa,Va=fa.VectorTileFeature.types,Na=Math.cos(Math.PI/180*37.5),Ua=Math.pow(2,14)/.5;class ja{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new Qr,this.layoutVertexArray2=new ts,this.indexArray=new as,this.programConfigurations=new Bs(t.layers,t.zoom),this.segments=new hs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,n){this.hasPattern=aa("line",this.layers,e);const i=this.layers[0].layout.get("line-sort-key"),r=!i.isConstant(),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Gs(o,t);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),e,n))continue;const u=r?i.evaluate(e,{},n):void 0,h={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?e.geometry:js(o),patterns:{},sortKey:u};s.push(h)}r&&s.sort(((t,e)=>t.sortKey-e.sortKey));for(const o of s){const{geometry:i,index:r,sourceLayerIndex:s}=o;if(this.hasPattern){const t=la("line",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{});e.featureIndex.insert(t[r].feature,i,r,s,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Fa)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ba),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,n,i,r){const s=this.layers[0].layout,o=s.get("line-join").evaluate(t,{}),a=s.get("line-cap"),l=s.get("line-miter-limit"),c=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const u of e)this.addLine(u,t,o,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}addLine(t,e,n,i,r,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===Va[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(o?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,o&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let g=l;g<a;g++){if(p=g===a-1?o?t[l+1]:void 0:t[g+1],p&&t[g].equals(p))continue;m&&(f=m),h&&(d=h),h=t[g],m=p?p.sub(h)._unit()._perp():f,f=f||m;let e=f.add(m);0===e.x&&0===e.y||e._unit();const y=f.x*m.x+f.y*m.y,_=e.x*m.x+e.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Na&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&g>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const S=d&&p;let E=S?n:o?"butt":i;if(S&&"round"===E&&(v<s?E="miter":v<=2&&(E="fakeround")),"miter"===E&&v>r&&(E="bevel"),"bevel"===E&&(v>2&&(E="flipbevel"),v<r&&(E="miter")),d&&this.updateDistance(d,h),"miter"===E)e._mult(v),this.addCurrentVertex(h,e,0,0,u);else if("flipbevel"===E){if(v>100)e=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,e,0,0,u),this.addCurrentVertex(h,e.mult(-1),0,0,u)}else if("bevel"===E||"fakeround"===E){const t=-Math.sqrt(v*v-1),e=w?t:0,n=w?0:t;if(d&&this.addCurrentVertex(h,f,e,n,u),"fakeround"===E){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*t*t+(.848013+y*(.215638*y-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-n,u)}else if("butt"===E)this.addCurrentVertex(h,e,0,0,u);else if("square"===E){const t=d?1:-1;this.addCurrentVertex(h,e,t,t,u)}else"round"===E&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&g<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,n,i,r,s=!1){const o=e.y*i-e.x,a=-e.y-e.x*i;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,s,!1,n,r),this.addHalfVertex(t,o,a,s,!0,-i,r),this.distance>Ua/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,i,r,s))}addHalfVertex({x:t,y:e},n,i,r,s,o,a){const l=.5*(this.lineClips?this.scaledDistance*(Ua-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(s?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(0===o?0:o<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),s?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}Ei("LineBucket",ja,{omit:["layers","patternFeatures"]});const Ga=new ur({"line-cap":new sr(it.layout_line["line-cap"]),"line-join":new or(it.layout_line["line-join"]),"line-miter-limit":new sr(it.layout_line["line-miter-limit"]),"line-round-limit":new sr(it.layout_line["line-round-limit"]),"line-sort-key":new or(it.layout_line["line-sort-key"])});var qa={paint:new ur({"line-opacity":new or(it.paint_line["line-opacity"]),"line-color":new or(it.paint_line["line-color"]),"line-translate":new sr(it.paint_line["line-translate"]),"line-translate-anchor":new sr(it.paint_line["line-translate-anchor"]),"line-width":new or(it.paint_line["line-width"]),"line-gap-width":new or(it.paint_line["line-gap-width"]),"line-offset":new or(it.paint_line["line-offset"]),"line-blur":new or(it.paint_line["line-blur"]),"line-dasharray":new lr(it.paint_line["line-dasharray"]),"line-pattern":new ar(it.paint_line["line-pattern"]),"line-gradient":new cr(it.paint_line["line-gradient"])}),layout:Ga};const $a=new class extends or{possiblyEvaluate(t,e){return e=new Yi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=a({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}(qa.paint.properties["line-width"].specification);function Wa(t,e){return e>0?e+2*t:t}$a.useIntegerZoom=!0;const Za=gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ha=gr([{name:"a_projected_pos",components:3,type:"Float32"}],4);gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xa=gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);gr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ya=gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ka=gr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ja(t,e,n){return t.sections.forEach((t=>{t.text=function(t,e,n){const i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Xi.applyArabicShaping&&(t=Xi.applyArabicShaping(t)),t}(t.text,e,n)})),t}gr([{name:"triangle",components:3,type:"Uint16"}]),gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),gr([{type:"Float32",name:"offsetX"}]),gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Qa={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var tl=24,el=rl,nl=function(t,e,n,i,r){var s,o,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=t[e+h];for(h+=d,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),s-=c}return(p?-1:1)*o*Math.pow(2,s-i)},il=function(t,e,n,i,r,s){var o,a,l,c=8*s-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,f=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*l-1)*Math.pow(2,r),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+p]=255&a,p+=f,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[n+p]=255&o,p+=f,o/=256,c-=8);t[n+p-f]|=128*m};function rl(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}rl.Varint=0,rl.Fixed64=1,rl.Bytes=2,rl.Fixed32=5;var sl,ol=4294967296,al=1/ol,ll="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function cl(t){return t.type===rl.Bytes?t.readVarint()+t.pos:t.pos+1}function ul(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function hl(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function dl(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function pl(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function fl(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function ml(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function gl(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function yl(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function _l(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function vl(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function xl(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function bl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function wl(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Sl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function El(t,e,n){1===t&&n.readMessage(Tl,e)}function Tl(t,e,n){if(3===t){const{id:t,bitmap:i,width:r,height:s,left:o,top:a,advance:l}=n.readMessage(Al,{});e.push({id:t,bitmap:new bo({width:r+6,height:s+6},i),metrics:{width:r,height:s,left:o,top:a,advance:l}})}}function Al(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function kl(t){let e=0,n=0;for(const o of t)e+=o.w*o.h,n=Math.max(n,o.w);t.sort(((t,e)=>e.h-t.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let r=0,s=0;for(const o of t)for(let t=i.length-1;t>=0;t--){const e=i[t];if(!(o.w>e.w||o.h>e.h)){if(o.x=e.x,o.y=e.y,s=Math.max(s,o.y+o.h),r=Math.max(r,o.x+o.w),o.w===e.w&&o.h===e.h){const e=i.pop();t<i.length&&(i[t]=e)}else o.h===e.h?(e.x+=o.w,e.w-=o.w):o.w===e.w?(e.y+=o.h,e.h-=o.h):(i.push({x:e.x+o.w,y:e.y,w:e.w-o.w,h:o.h}),e.y+=o.h,e.h-=o.h);break}}return{w:r,h:s,fill:e/(r*s)||0}}rl.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=7&i,t(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=bl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Sl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=bl(this.buf,this.pos)+bl(this.buf,this.pos+4)*ol;return this.pos+=8,t},readSFixed64:function(){var t=bl(this.buf,this.pos)+Sl(this.buf,this.pos+4)*ol;return this.pos+=8,t},readFloat:function(){var t=nl(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=nl(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,s=n.buf;if(i=(112&(r=s[n.pos++]))>>4,r<128)return ul(t,i,e);if(i|=(127&(r=s[n.pos++]))<<3,r<128)return ul(t,i,e);if(i|=(127&(r=s[n.pos++]))<<10,r<128)return ul(t,i,e);if(i|=(127&(r=s[n.pos++]))<<17,r<128)return ul(t,i,e);if(i|=(127&(r=s[n.pos++]))<<24,r<128)return ul(t,i,e);if(i|=(1&(r=s[n.pos++]))<<31,r<128)return ul(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&ll?function(t,e,n){return ll.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var i="",r=e;r<n;){var s,o,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(s=t[r+1]))&&(c=(31&l)<<6|63&s)<=127&&(c=null):3===u?(o=t[r+2],128==(192&(s=t[r+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&s)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=t[r+2],a=t[r+3],128==(192&(s=t[r+1]))&&128==(192&o)&&128==(192&a)&&((c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==rl.Bytes)return t.push(this.readVarint(e));var n=cl(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==rl.Bytes)return t.push(this.readSVarint());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==rl.Bytes)return t.push(this.readBoolean());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==rl.Bytes)return t.push(this.readFloat());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==rl.Bytes)return t.push(this.readDouble());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==rl.Bytes)return t.push(this.readFixed32());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==rl.Bytes)return t.push(this.readSFixed32());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==rl.Bytes)return t.push(this.readFixed64());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==rl.Bytes)return t.push(this.readSFixed64());var e=cl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===rl.Varint)for(;this.buf[this.pos++]>127;);else if(e===rl.Bytes)this.pos=this.readVarint()+this.pos;else if(e===rl.Fixed32)this.pos+=4;else{if(e!==rl.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),wl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),wl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),wl(this.buf,-1&t,this.pos),wl(this.buf,Math.floor(t*al),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),wl(this.buf,-1&t,this.pos),wl(this.buf,Math.floor(t*al),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,s=0;s<e.length;s++){if((i=e.charCodeAt(s))>55295&&i<57344){if(!r){i>56319||s+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&hl(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),il(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),il(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&hl(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,rl.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,dl,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,pl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,gl,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,fl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ml,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,yl,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,_l,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,vl,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,xl,e)},writeBytesField:function(t,e){this.writeTag(t,rl.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,rl.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,rl.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,rl.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,rl.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,rl.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,rl.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,rl.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,rl.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,rl.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Pl{constructor(t,{pixelRatio:e,version:n,stretchX:i,stretchY:r,content:s}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=i,this.stretchY=r,this.content=s,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Il{constructor(t,e){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,n,r),this.addImages(e,i,r);const{w:s,h:o}=kl(r),a=new wo({width:s||1,height:o||1});for(const l in t){const e=t[l],i=n[l].paddedRect;wo.copy(e.data,a,{x:0,y:0},{x:i.x+1,y:i.y+1},e.data)}for(const l in e){const t=e[l],n=i[l].paddedRect,r=n.x+1,s=n.y+1,o=t.data.width,c=t.data.height;wo.copy(t.data,a,{x:0,y:0},{x:r,y:s},t.data),wo.copy(t.data,a,{x:0,y:c-1},{x:r,y:s-1},{width:o,height:1}),wo.copy(t.data,a,{x:0,y:0},{x:r,y:s+c},{width:o,height:1}),wo.copy(t.data,a,{x:o-1,y:0},{x:r-1,y:s},{width:1,height:c}),wo.copy(t.data,a,{x:0,y:0},{x:r+o,y:s},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(t,e,n){for(const i in t){const r=t[i],s={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(s),e[i]=new Pl(s,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)}patchUpdatedImage(t,e,n){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[i,r]=t.tl;n.update(e.data,void 0,{x:i,y:r})}}Ei("ImagePosition",Pl),Ei("ImageAtlas",Il),t.WritingMode=void 0,(sl=t.WritingMode||(t.WritingMode={}))[sl.none=0]="none",sl[sl.horizontal=1]="horizontal",sl[sl.vertical=2]="vertical",sl[sl.horizontalOnly=3]="horizontalOnly";const Cl=-17;class Ml{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const n=new Ml;return n.scale=t||1,n.fontStack=e,n}static forImage(t){const e=new Ml;return e.imageName=t,e}}class zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const n=new zl;for(let i=0;i<t.sections.length;i++){const r=t.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,e)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let n=0;n<t.length;n++){const i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;e+=i&&Di(i)&&!Qa[t[n+1]]||r&&Di(r)&&!Qa[t[n-1]]||!Qa[t[n]]?t[n]:Qa[t[n]]}return e}(this.text)}trim(){let t=0;for(let n=0;n<this.text.length&&Dl[this.text.charCodeAt(n)];n++)t++;let e=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&Dl[this.text.charCodeAt(n)];n--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const n=new zl;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Ml.forText(t.scale,t.fontStack||e));const n=this.sections.length-1;for(let i=0;i<t.text.length;++i)this.sectionIndex.push(n)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void f("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Ml.forImage(e)),this.sectionIndex.push(this.sections.length-1)):f("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ll(e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g){const y=zl.fromFeature(e,s);let _;d===t.WritingMode.vertical&&y.verticalizePunctuation();const{processBidirectionalText:v,processStyledBidirectionalText:x}=Xi;if(v&&1===y.sections.length){_=[];const t=v(y.toString(),Ul(y,u,o,n,r,f,m));for(const e of t){const t=new zl;t.text=e,t.sections=y.sections;for(let n=0;n<e.length;n++)t.sectionIndex.push(0);_.push(t)}}else if(x){_=[];const t=x(y.text,y.sectionIndex,Ul(y,u,o,n,r,f,m));for(const e of t){const t=new zl;t.text=e[0],t.sectionIndex=e[1],t.sections=y.sections,_.push(t)}}else _=function(t,e){const n=[],i=t.text;let r=0;for(const s of e)n.push(t.substring(r,s)),r=s;return r<i.length&&n.push(t.substring(r,i.length)),n}(y,Ul(y,u,o,n,r,f,m));const b=[],w={positionedLines:b,text:y.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,n,i,r,s,o,a,l,c,u,h,d){let p=0,f=Cl,m=0,g=0;const y="right"===l?1:"left"===l?0:.5;let _=0;for(const S of s){S.trim();const s=S.getMaxScale(),a=(s-1)*tl,l={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=l;const x=l.positionedGlyphs;let b=0;if(!S.length()){f+=o,++_;continue}for(let o=0;o<S.length();o++){const l=S.getSection(o),m=S.getSectionIndex(o),g=S.getCharCode(o);let y=0,_=null,w=null,E=null,T=tl;const A=!(c===t.WritingMode.horizontal||!h&&!Li(g)||h&&(Dl[g]||(v=g,Ii.Arabic(v)||Ii["Arabic Supplement"](v)||Ii["Arabic Extended-A"](v)||Ii["Arabic Presentation Forms-A"](v)||Ii["Arabic Presentation Forms-B"](v))));if(l.imageName){const t=r[l.imageName];if(!t)continue;E=l.imageName,e.iconsInText=e.iconsInText||!0,w=t.paddedRect;const n=t.displaySize;l.scale=l.scale*tl/d,_={width:n[0],height:n[1],left:1,top:-3,advance:A?n[1]:n[0]},y=a+(tl-n[1]*l.scale),T=_.advance;const i=A?n[0]*l.scale-tl*s:n[1]*l.scale-tl*s;i>0&&i>b&&(b=i)}else{const t=i[l.fontStack],e=t&&t[g];if(e&&e.rect)w=e.rect,_=e.metrics;else{const t=n[l.fontStack],e=t&&t[g];if(!e)continue;_=e.metrics}y=(s-l.scale)*tl}A?(e.verticalizable=!0,x.push({glyph:g,imageName:E,x:p,y:f+y,vertical:A,scale:l.scale,fontStack:l.fontStack,sectionIndex:m,metrics:_,rect:w}),p+=T*l.scale+u):(x.push({glyph:g,imageName:E,x:p,y:f+y,vertical:A,scale:l.scale,fontStack:l.fontStack,sectionIndex:m,metrics:_,rect:w}),p+=_.advance*l.scale+u)}0!==x.length&&(m=Math.max(p-u,m),Gl(x,0,x.length-1,y,b)),p=0;const w=o*s+b;l.lineOffset=Math.max(b,a),f+=w,g=Math.max(w,g),++_}var v;const x=f-Cl,{horizontalAlign:b,verticalAlign:w}=jl(a);(function(t,e,n,i,r,s,o,a,l){const c=(e-n)*r;let u=0;u=s!==o?-a*i-Cl:(-i*l+.5)*o;for(const h of t)for(const t of h.positionedGlyphs)t.x+=c,t.y+=u})(e.positionedLines,y,b,w,m,g,o,x,s.length),e.top+=-w*x,e.bottom=e.top+x,e.left+=-b*m,e.right=e.left+m}(w,n,i,r,_,a,l,c,d,u,p,g),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(b)&&w}const Dl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Bl(t,e,n,i,r,s){if(e.imageName){const t=i[e.imageName];return t?t.displaySize[0]*e.scale*tl/s+r:0}{const i=n[e.fontStack],s=i&&i[t];return s?s.metrics.advance*e.scale+r:0}}function Ol(t,e,n,i){const r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function Fl(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Vl(t,e,n,i,r,s){let o=null,a=Ol(e,n,r,s);for(const l of i){const t=Ol(e-l.x,n,r,s)+l.badness;t<=a&&(o=l,a=t)}return{index:t,x:e,priorBreak:o,badness:a}}function Nl(t){return t?Nl(t.priorBreak).concat(t.index):[]}function Ul(t,e,n,i,r,s,o){if("point"!==s)return[];if(!t)return[];const a=[],l=function(t,e,n,i,r,s){let o=0;for(let a=0;a<t.length();a++){const n=t.getSection(a);o+=Bl(t.getCharCode(a),n,i,r,e,s)}return o/Math.max(1,Math.ceil(o/n))}(t,e,n,i,r,o),c=t.text.indexOf("\u200b")>=0;let u=0;for(let d=0;d<t.length();d++){const n=t.getSection(d),s=t.getCharCode(d);if(Dl[s]||(u+=Bl(s,n,i,r,e,o)),d<t.length()-1){const e=!((h=s)<11904||!(Ii["Bopomofo Extended"](h)||Ii.Bopomofo(h)||Ii["CJK Compatibility Forms"](h)||Ii["CJK Compatibility Ideographs"](h)||Ii["CJK Compatibility"](h)||Ii["CJK Radicals Supplement"](h)||Ii["CJK Strokes"](h)||Ii["CJK Symbols and Punctuation"](h)||Ii["CJK Unified Ideographs Extension A"](h)||Ii["CJK Unified Ideographs"](h)||Ii["Enclosed CJK Letters and Months"](h)||Ii["Halfwidth and Fullwidth Forms"](h)||Ii.Hiragana(h)||Ii["Ideographic Description Characters"](h)||Ii["Kangxi Radicals"](h)||Ii["Katakana Phonetic Extensions"](h)||Ii.Katakana(h)||Ii["Vertical Forms"](h)||Ii["Yi Radicals"](h)||Ii["Yi Syllables"](h)));(Rl[s]||e||n.imageName)&&a.push(Vl(d+1,u,l,a,Fl(s,t.getCharCode(d+1),e&&c),!1))}}var h;return Nl(Vl(t.length(),u,l,a,0,!0))}function jl(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Gl(t,e,n,i,r){if(!i&&!r)return;const s=t[n],o=(t[n].x+s.metrics.advance*s.scale)*i;for(let a=e;a<=n;a++)t[a].x-=o,t[a].y+=r}function ql(t,e,n){const{horizontalAlign:i,verticalAlign:r}=jl(n),s=e[0]-t.displaySize[0]*i,o=e[1]-t.displaySize[1]*r;return{image:t,top:o,bottom:o+t.displaySize[1],left:s,right:s+t.displaySize[0]}}function $l(t,e,n,i,r,s){const o=t.image;let a;if(o.content){const t=o.content,e=o.pixelRatio||1;a=[t[0]/e,t[1]/e,o.displaySize[0]-t[2]/e,o.displaySize[1]-t[3]/e]}const l=e.left*s,c=e.right*s;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-o.displaySize[0])/2,h=p+o.displaySize[0]);const f=e.top*s,m=e.bottom*s;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-o.displaySize[1])/2,d=u+o.displaySize[1]),{image:o,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const Wl=128;function Zl(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Yi(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:i}=n;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let s=r;for(;s<e.length&&e[s]<t+1;)s++;s=Math.min(e.length-1,s);const o=e[r],a=e[s];return"composite"===n.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:o,maxZoom:a,minSize:n.evaluate(new Yi(o)),maxSize:n.evaluate(new Yi(a)),interpolationType:i}}}class Hl extends T{constructor(t,e,n,i){super(t,e),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new Hl(this.x,this.y,this.angle,this.segment)}}function Xl(t,e,n,i,r){if(void 0===e.segment)return!0;let s=e,o=e.segment+1,a=0;for(;a>-n/2;){if(o--,o<0)return!1;a-=t[o].dist(s),s=t[o]}a+=t[o].dist(t[o+1]),o++;const l=[];let c=0;for(;a<n/2;){const e=t[o],n=t[o+1];if(!n)return!1;let s=t[o-1].angleTo(e)-e.angleTo(n);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:s}),c+=s;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;o++,a+=e.dist(n)}return!0}function Yl(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Kl(t,e,n){return t?.6*e*n:0}function Jl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Ql(t,e,n,i,r,s){const o=Kl(n,r,s),a=Jl(n,i)*s;let l=0;const c=Yl(t)/2;for(let u=0;u<t.length-1;u++){const n=t[u],i=t[u+1],r=n.dist(i);if(l+r>c){const s=(c-l)/r,h=Te(n.x,i.x,s),d=Te(n.y,i.y,s),p=new Hl(h,d,i.angleTo(n),u);return p._round(),!o||Xl(t,p,a,o,e)?p:void 0}l+=r}}function tc(t,e,n,i,r,s,o,a,l){const c=Kl(i,s,o),u=Jl(i,r),h=u*o,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),ec(t,d?e/2*a%e:(u/2+2*s)*o*a%e,e,c,n,h,d,!1,l)}function ec(t,e,n,i,r,s,o,a,l){const c=s/2,u=Yl(t);let h=0,d=e-n,p=[];for(let f=0;f<t.length-1;f++){const e=t[f],o=t[f+1],a=e.dist(o),m=o.angleTo(e);for(;d+n<h+a;){d+=n;const g=(d-h)/a,y=Te(e.x,o.x,g),_=Te(e.y,o.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const e=new Hl(y,_,m,f);e._round(),i&&!Xl(t,e,s,i,r)||p.push(e)}}h+=a}return a||p.length||o||(p=ec(t,h/2,n,i,r,s,o,!0,l)),p}function nc(t,e,n,i,r){const s=[];for(let o=0;o<t.length;o++){const a=t[o];let l;for(let t=0;t<a.length-1;t++){let o=a[t],c=a[t+1];o.x<e&&c.x<e||(o.x<e?o=new T(e,o.y+(e-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x<e&&(c=new T(e,o.y+(e-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y<n&&c.y<n||(o.y<n?o=new T(o.x+(n-o.y)/(c.y-o.y)*(c.x-o.x),n)._round():c.y<n&&(c=new T(o.x+(n-o.y)/(c.y-o.y)*(c.x-o.x),n)._round()),o.x>=i&&c.x>=i||(o.x>=i?o=new T(i,o.y+(i-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x>=i&&(c=new T(i,o.y+(i-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y>=r&&c.y>=r||(o.y>=r?o=new T(o.x+(r-o.y)/(c.y-o.y)*(c.x-o.x),r)._round():c.y>=r&&(c=new T(o.x+(r-o.y)/(c.y-o.y)*(c.x-o.x),r)._round()),l&&o.equals(l[l.length-1])||(l=[o],s.push(l)),l.push(c)))))}}return s}function ic(t,e,n,i){const r=[],s=t.image,o=s.pixelRatio,a=s.paddedRect.w-2,l=s.paddedRect.h-2,c=t.right-t.left,u=t.bottom-t.top,h=s.stretchX||[[0,a]],d=s.stretchY||[[0,l]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,y=l-m;let _=0,v=f,x=0,b=m,w=0,S=g,E=0,A=y;if(s.content&&i){const t=s.content;_=rc(h,0,t[0]),x=rc(d,0,t[1]),v=rc(h,t[0],t[2]),b=rc(d,t[1],t[3]),w=t[0]-_,E=t[1]-x,S=t[2]-t[0]-v,A=t[3]-t[1]-b}const k=(i,r,a,l)=>{const h=oc(i.stretch-_,v,c,t.left),d=ac(i.fixed-w,S,i.stretch,f),p=oc(r.stretch-x,b,u,t.top),g=ac(r.fixed-E,A,r.stretch,m),y=oc(a.stretch-_,v,c,t.left),k=ac(a.fixed-w,S,a.stretch,f),P=oc(l.stretch-x,b,u,t.top),I=ac(l.fixed-E,A,l.stretch,m),C=new T(h,p),M=new T(y,p),z=new T(y,P),L=new T(h,P),D=new T(d/o,g/o),R=new T(k/o,I/o),B=e*Math.PI/180;if(B){const t=Math.sin(B),e=Math.cos(B),n=[e,-t,t,e];C._matMult(n),M._matMult(n),L._matMult(n),z._matMult(n)}const O=i.stretch+i.fixed,F=r.stretch+r.fixed;return{tl:C,tr:M,bl:L,br:z,tex:{x:s.paddedRect.x+1+O,y:s.paddedRect.y+1+F,w:a.stretch+a.fixed-O,h:l.stretch+l.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:R,minFontScaleX:S/o/c,minFontScaleY:A/o/u,isSDF:n}};if(i&&(s.stretchX||s.stretchY)){const t=sc(h,g,f),e=sc(d,y,m);for(let n=0;n<t.length-1;n++){const i=t[n],s=t[n+1];for(let t=0;t<e.length-1;t++)r.push(k(i,e[t],s,e[t+1]))}}else r.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return r}function rc(t,e,n){let i=0;for(const r of t)i+=Math.max(e,Math.min(n,r[1]))-Math.max(e,Math.min(n,r[0]));return i}function sc(t,e,n){const i=[{fixed:-1,stretch:0}];for(const[r,s]of t){const t=i[i.length-1];i.push({fixed:r-t.stretch,stretch:t.stretch}),i.push({fixed:r-t.stretch,stretch:t.stretch+(s-r)})}return i.push({fixed:e+1,stretch:n}),i}function oc(t,e,n,i){return t/e*n+i}function ac(t,e,n,i){return t-e*n/i}Ei("Anchor",Hl);class lc{constructor(t,e,n,i,r,s,o,a,l,c){if(this.boxStartIndex=t.length,l){let t=s.top,e=s.bottom;const n=s.collisionPadding;n&&(t-=n[1],e+=n[3]);let i=e-t;i>0&&(i=Math.max(10,i),this.circleDiameter=i)}else{let l=s.top*o-a,u=s.bottom*o+a,h=s.left*o-a,d=s.right*o+a;const p=s.collisionPadding;if(p&&(h-=p[0]*o,l-=p[1]*o,d+=p[2]*o,u+=p[3]*o),c){const t=new T(h,l),e=new T(d,l),n=new T(h,u),i=new T(d,u),r=c*Math.PI/180;t._rotate(r),e._rotate(r),n._rotate(r),i._rotate(r),h=Math.min(t.x,e.x,n.x,i.x),d=Math.max(t.x,e.x,n.x,i.x),l=Math.min(t.y,e.y,n.y,i.y),u=Math.max(t.y,e.y,n.y,i.y)}t.emplaceBack(e.x,e.y,h,l,d,u,n,i,r)}this.boxEndIndex=t.length}}class cc{constructor(t=[],e=uc){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,s=e[r];if(n(i,s)>=0)break;e[t]=s,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1),s=e[i];const o=i+1;if(o<this.length&&n(e[o],s)<0&&(i=o,s=e[o]),n(s,r)>=0)break;e[t]=s,t=i}e[t]=r}}function uc(t,e){return t<e?-1:t>e?1:0}function hc(t,e=1,n=!1){let i=1/0,r=1/0,s=-1/0,o=-1/0;const a=t[0];for(let p=0;p<a.length;p++){const t=a[p];(!p||t.x<i)&&(i=t.x),(!p||t.y<r)&&(r=t.y),(!p||t.x>s)&&(s=t.x),(!p||t.y>o)&&(o=t.y)}const l=Math.min(s-i,o-r);let c=l/2;const u=new cc([],dc);if(0===l)return new T(i,r);for(let p=i;p<s;p+=l)for(let e=r;e<o;e+=l)u.push(new pc(p+c,e+c,c,t));let h=function(t){let e=0,n=0,i=0;const r=t[0];for(let s=0,o=r.length,a=o-1;s<o;a=s++){const t=r[s],o=r[a],l=t.x*o.y-o.x*t.y;n+=(t.x+o.x)*l,i+=(t.y+o.y)*l,e+=3*l}return new pc(n/e,i/e,0,t)}(t),d=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=e||(c=i.h/2,u.push(new pc(i.p.x-c,i.p.y-c,c,t)),u.push(new pc(i.p.x+c,i.p.y-c,c,t)),u.push(new pc(i.p.x-c,i.p.y+c,c,t)),u.push(new pc(i.p.x+c,i.p.y+c,c,t)),d+=4)}return n&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function dc(t,e){return e.max-t.max}function pc(t,e,n,i){this.p=new T(t,e),this.h=n,this.d=function(t,e){let n=!1,i=1/0;for(let r=0;r<e.length;r++){const s=e[r];for(let e=0,r=s.length,o=r-1;e<r;o=e++){const r=s[e],a=s[o];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,Qs(t,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const fc=Number.POSITIVE_INFINITY;function mc(t,e){return e[1]!==fc?function(t,e,n){let i=0,r=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,r]}(t,e[0],e[1]):function(t,e){let n=0,i=0;e<0&&(e=0);const r=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}(t,e[0])}function gc(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yc(e,n,i,r,s,o,a,l,c,u,h){let d=o.textMaxSize.evaluate(n,{});void 0===d&&(d=a);const p=e.layers[0].layout,m=p.get("icon-offset").evaluate(n,{},h),g=xc(i.horizontal),y=a/24,_=e.tilePixelRatio*y,v=e.tilePixelRatio*d/24,x=e.tilePixelRatio*l,b=e.tilePixelRatio*p.get("symbol-spacing"),w=p.get("text-padding")*e.tilePixelRatio,S=p.get("icon-padding")*e.tilePixelRatio,E=p.get("text-max-angle")/180*Math.PI,T="viewport"!==p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),A="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),k=p.get("symbol-placement"),P=b/2,I=p.get("icon-text-fit");let C;r&&"none"!==I&&(e.allowVerticalPlacement&&i.vertical&&(C=$l(r,i.vertical,I,p.get("icon-text-fit-padding"),m,y)),g&&(r=$l(r,g,I,p.get("icon-text-fit-padding"),m,y)));const M=(l,d)=>{d.x<0||d.x>=Vs||d.y<0||d.y>=Vs||function(e,n,i,r,s,o,a,l,c,u,h,d,p,m,g,y,_,v,x,b,w,S,E,T,A){const k=e.addToLineVertexArray(n,i);let P,I,C,M,z=0,L=0,D=0,R=0,B=-1,O=-1;const F={};let V=vs(""),N=0,U=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[N,U]=l.layout.get("text-offset").evaluate(w,{},T).map((t=>t*tl)):(N=l.layout.get("text-radial-offset").evaluate(w,{},T)*tl,U=fc),e.allowVerticalPlacement&&r.vertical){const t=l.layout.get("text-rotate").evaluate(w,{},T)+90;C=new lc(c,n,u,h,d,r.vertical,p,m,g,t),a&&(M=new lc(c,n,u,h,d,a,_,v,g,t))}if(s){const i=l.layout.get("icon-rotate").evaluate(w,{}),r="none"!==l.layout.get("icon-text-fit"),o=ic(s,i,E,r),p=a?ic(a,i,E,r):void 0;I=new lc(c,n,u,h,d,s,_,v,!1,i),z=4*o.length;const m=e.iconSizeData;let g=null;"source"===m.kind?(g=[Wl*l.layout.get("icon-size").evaluate(w,{})],g[0]>_c&&f(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===m.kind&&(g=[Wl*S.compositeIconSizes[0].evaluate(w,{},T),Wl*S.compositeIconSizes[1].evaluate(w,{},T)],(g[0]>_c||g[1]>_c)&&f(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,o,g,b,x,w,t.WritingMode.none,n,k.lineStartIndex,k.lineLength,-1,T),B=e.icon.placedSymbolArray.length-1,p&&(L=4*p.length,e.addSymbols(e.icon,p,g,b,x,w,t.WritingMode.vertical,n,k.lineStartIndex,k.lineLength,-1,T),O=e.icon.placedSymbolArray.length-1)}const j=Object.keys(r.horizontal);for(const f of j){const i=r.horizontal[f];if(!P){V=vs(i.text);const t=l.layout.get("text-rotate").evaluate(w,{},T);P=new lc(c,n,u,h,d,i,p,m,g,t)}const s=1===i.positionedLines.length;if(D+=vc(e,n,i,o,l,g,w,y,k,r.vertical?t.WritingMode.horizontal:t.WritingMode.horizontalOnly,s?j:[f],F,B,S,T),s)break}r.vertical&&(R+=vc(e,n,r.vertical,o,l,g,w,y,k,t.WritingMode.vertical,["vertical"],F,O,S,T));const G=P?P.boxStartIndex:e.collisionBoxArray.length,q=P?P.boxEndIndex:e.collisionBoxArray.length,$=C?C.boxStartIndex:e.collisionBoxArray.length,W=C?C.boxEndIndex:e.collisionBoxArray.length,Z=I?I.boxStartIndex:e.collisionBoxArray.length,H=I?I.boxEndIndex:e.collisionBoxArray.length,X=M?M.boxStartIndex:e.collisionBoxArray.length,Y=M?M.boxEndIndex:e.collisionBoxArray.length;let K=-1;const J=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;K=J(P,K),K=J(C,K),K=J(I,K),K=J(M,K);const Q=K>-1?1:0;Q&&(K*=A/tl),e.glyphOffsetArray.length>=Ic.MAX_GLYPHS&&f("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==w.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,w.sortKey),e.symbolInstances.emplaceBack(n.x,n.y,F.right>=0?F.right:-1,F.center>=0?F.center:-1,F.left>=0?F.left:-1,F.vertical||-1,B,O,V,G,q,$,W,Z,H,X,Y,u,D,R,z,L,Q,0,p,N,U,K)}(e,d,l,i,r,s,C,e.layers[0],e.collisionBoxArray,n.index,n.sourceLayerIndex,e.index,_,w,T,c,x,S,A,m,n,o,u,h,a)};if("line"===k)for(const t of nc(n.geometry,0,0,Vs,Vs)){const n=tc(t,b,E,i.vertical||g,r,24,v,e.overscaling,Vs);for(const i of n){const n=g;n&&bc(e,n.text,P,i)||M(t,i)}}else if("line-center"===k){for(const t of n.geometry)if(t.length>1){const e=Ql(t,E,i.vertical||g,r,24,v);e&&M(t,e)}}else if("Polygon"===n.type)for(const t of sa(n.geometry,0)){const e=hc(t,16);M(t[0],new Hl(e.x,e.y,0))}else if("LineString"===n.type)for(const t of n.geometry)M(t,new Hl(t[0].x,t[0].y,0));else if("Point"===n.type)for(const t of n.geometry)for(const e of t)M([e],new Hl(e.x,e.y,0))}const _c=32640;function vc(t,e,n,i,r,s,o,a,l,c,u,h,d,p,m){const g=function(t,e,n,i,r,s,o,a){const l=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,c=[];for(const u of e.positionedLines)for(const t of u.positionedGlyphs){if(!t.rect)continue;const i=t.rect||{};let s=4,h=!0,d=1,p=0;const f=(r||a)&&t.vertical,m=t.metrics.advance*t.scale/2;if(a&&e.verticalizable){const e=(t.scale-1)*tl,n=(tl-t.metrics.width*t.scale)/2;p=u.lineOffset/2-(t.imageName?-n:e)}if(t.imageName){const e=o[t.imageName];h=e.sdf,d=e.pixelRatio,s=1/d}const g=r?[t.x+m,t.y]:[0,0];let y=r?[0,0]:[t.x+m+n[0],t.y+n[1]-p],_=[0,0];f&&(_=y,y=[0,0]);const v=(t.metrics.left-s)*t.scale-m+y[0],x=(-t.metrics.top-s)*t.scale+y[1],b=v+i.w*t.scale/d,w=x+i.h*t.scale/d,S=new T(v,x),E=new T(b,x),A=new T(v,w),k=new T(b,w);if(f){const e=new T(-m,m-Cl),n=-Math.PI/2,i=12-m,r=new T(22-i,-(t.imageName?i:0)),s=new T(..._);S._rotateAround(n,e)._add(r)._add(s),E._rotateAround(n,e)._add(r)._add(s),A._rotateAround(n,e)._add(r)._add(s),k._rotateAround(n,e)._add(r)._add(s)}if(l){const t=Math.sin(l),e=Math.cos(l),n=[e,-t,t,e];S._matMult(n),E._matMult(n),A._matMult(n),k._matMult(n)}const P=new T(0,0),I=new T(0,0);c.push({tl:S,tr:E,bl:A,br:k,tex:i,writingMode:e.writingMode,glyphOffset:g,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}return c}(0,n,a,r,s,o,i,t.allowVerticalPlacement),y=t.textSizeData;let _=null;"source"===y.kind?(_=[Wl*r.layout.get("text-size").evaluate(o,{})],_[0]>_c&&f(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===y.kind&&(_=[Wl*p.compositeTextSizes[0].evaluate(o,{},m),Wl*p.compositeTextSizes[1].evaluate(o,{},m)],(_[0]>_c||_[1]>_c)&&f(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,g,_,a,s,o,c,e,l.lineStartIndex,l.lineLength,d,m);for(const f of u)h[f]=t.text.placedSymbolArray.length-1;return 4*g.length}function xc(t){for(const e in t)return t[e];return null}function bc(t,e,n,i){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<n)return!0}else r[e]=[];return r[e].push(i),!1}const wc=fa.VectorTileFeature.types,Sc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ec(t,e,n,i,r,s,o,a,l,c,u,h,d){const p=a?Math.min(_c,Math.round(a[0])):0,f=a?Math.min(_c,Math.round(a[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),s,o,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Tc(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function Ac(t){for(const e of t.sections)if(Oi(e.text))return!0;return!1}class kc{constructor(t){this.layoutVertexArray=new ns,this.indexArray=new as,this.programConfigurations=t,this.segments=new hs,this.dynamicLayoutVertexArray=new is,this.opacityVertexArray=new rs,this.placedSymbolArray=new Gr}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Za.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ha.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Sc,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ei("SymbolBuffers",kc);class Pc{constructor(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new hs,this.collisionVertexArray=new os}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Xa.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ei("CollisionBuffers",Pc);class Ic{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=co([]),this.placementViewportMatrix=co([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zl(this.zoom,n["text-size"]),this.iconSizeData=Zl(this.zoom,n["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),s=i.get("symbol-z-order");this.canOverlap="never"!==Dc(i,"text-overlap","text-allow-overlap")||"never"!==Dc(i,"icon-overlap","icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==s&&!r.isConstant(),this.sortFeaturesByY=("viewport-y"===s||"auto"===s&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map((e=>t.WritingMode[e]))),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID}createArrays(){this.text=new kc(new Bs(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new kc(new Bs(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Wr,this.lineVertexArray=new Zr,this.symbolInstances=new $r}calculateGlyphDependencies(t,e,n,i,r){for(let s=0;s<t.length;s++)if(e[t.charCodeAt(s)]=!0,(n||i)&&r){const n=Qa[t.charAt(s)];n&&(e[n.charCodeAt(0)]=!0)}}populate(e,n,i){const r=this.layers[0],s=r.layout,o=s.get("text-font"),a=s.get("text-field"),l=s.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Bt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=s.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=n.iconDependencies,p=n.glyphDependencies,f=n.availableImages,m=new Yi(this.zoom);for(const{feature:g,id:y,index:_,sourceLayerIndex:v}of e){const e=r._featureFilter.needGeometry,n=Gs(g,e);if(!r._featureFilter.filter(m,n,i))continue;let a,l;if(e||(n.geometry=js(g)),c){const t=r.getValueAndResolveTokens("text-field",n,i,f),e=Bt.factory(t);Ac(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Zi()||this.hasRTLText&&Xi.isParsed())&&(a=Ja(e,r,n))}if(u){const t=r.getValueAndResolveTokens("icon-image",n,i,f);l=t instanceof Ot?t:Ot.fromString(t)}if(!a&&!l)continue;const x=this.sortFeaturesByKey?h.evaluate(n,{},i):void 0;if(this.features.push({id:y,text:a,icon:l,index:_,sourceLayerIndex:v,geometry:n.geometry,properties:g.properties,type:wc[g.type],sortKey:x}),l&&(d[l.name]=!0),a){const e=o.evaluate(n,{},i).join(","),r="viewport"!==s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.WritingMode.vertical)>=0;for(const t of a.sections)if(t.image)d[t.image.name]=!0;else{const n=Ci(a.toString()),i=t.fontStack||e,s=p[i]=p[i]||{};this.calculateGlyphDependencies(t.text,s,r,this.allowVerticalPlacement,n)}}}"line"===s.get("symbol-placement")&&(this.features=function(t){const e={},n={},i=[];let r=0;function s(e){i.push(t[e]),r++}function o(t,e,r){const s=n[t];return delete n[t],n[e]=s,i[s].geometry[0].pop(),i[s].geometry[0]=i[s].geometry[0].concat(r[0]),s}function a(t,n,r){const s=e[n];return delete e[n],e[t]=s,i[s].geometry[0].shift(),i[s].geometry[0]=r[0].concat(i[s].geometry[0]),s}function l(t,e,n){const i=n?e[0][e[0].length-1]:e[0][0];return`${t}:${i.x}:${i.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){s(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in e&&n[p]!==e[f]){const t=a(p,f,h),r=o(p,f,i[t].geometry);delete e[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[t].geometry=null}else p in n?o(p,f,h):f in e?a(p,f,h):(s(c),e[p]=r-1,n[f]=r-1)}return i.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const n=this.lineVertexArray.length;if(void 0!==t.segment){let n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]);const r={};for(let s=t.segment+1;s<e.length;s++)r[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s<e.length-1&&(n+=e[s+1].dist(e[s]));for(let s=t.segment||0;s>=0;s--)r[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,n,i,r,s,o,a,l,c,u,h,d){const p=e.indexArray,f=e.layoutVertexArray,m=e.segments.prepareSegment(4*n.length,f,p,this.canOverlap?o.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,_=this.allowVerticalPlacement&&a===t.WritingMode.vertical?Math.PI/2:0,v=o.text&&o.text.sections;for(let t=0;t<n.length;t++){const{tl:r,tr:s,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:S}=n[t],E=m.vertexLength,T=b[1];Ec(f,l.x,l.y,r.x,T+r.y,u.x,u.y,i,w,h.x,h.y,y,x),Ec(f,l.x,l.y,s.x,T+s.y,u.x+u.w,u.y,i,w,g.x,h.y,y,x),Ec(f,l.x,l.y,a.x,T+a.y,u.x,u.y+u.h,i,w,h.x,g.y,y,x),Ec(f,l.x,l.y,c.x,T+c.y,u.x+u.w,u.y+u.h,i,w,g.x,g.y,y,x),Tc(e.dynamicLayoutVertexArray,l,_),p.emplaceBack(E,E+1,E+2),p.emplaceBack(E+1,E+2,E+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),t!==n.length-1&&S===n[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,o,o.index,{},d,v&&v[S])}e.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],a,0,!1,0,h)}_addCollisionDebugVertex(t,e,n,i,r,s){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i,r,Math.round(s.x),Math.round(s.y))}addCollisionDebugVertices(t,e,n,i,r,s,o){const a=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=a.vertexLength,c=r.layoutVertexArray,u=r.collisionVertexArray,h=o.anchorX,d=o.anchorY;this._addCollisionDebugVertex(c,u,s,h,d,new T(t,e)),this._addCollisionDebugVertex(c,u,s,h,d,new T(n,e)),this._addCollisionDebugVertex(c,u,s,h,d,new T(n,i)),this._addCollisionDebugVertex(c,u,s,h,d,new T(t,i)),a.vertexLength+=4;const p=r.indexArray;p.emplaceBack(l,l+1),p.emplaceBack(l+1,l+2),p.emplaceBack(l+2,l+3),p.emplaceBack(l+3,l),a.primitiveLength+=4}addDebugCollisionBoxes(t,e,n,i){for(let r=t;r<e;r++){const t=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,i?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pc(ss,Ya.members,ls),this.iconCollisionBox=new Pc(ss,Ya.members,ls);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,n,i,r,s,o,a,l){const c={};for(let u=e;u<n;u++){const e=t.get(u);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let u=i;u<r;u++){const e=t.get(u);c.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalTextFeatureIndex=e.featureIndex;break}for(let u=s;u<o;u++){const e=t.get(u);c.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.iconFeatureIndex=e.featureIndex;break}for(let u=a;u<l;u++){const e=t.get(u);c.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalIconFeatureIndex=e.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const n=t.placedSymbolArray.get(e),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)t.indexArray.emplaceBack(r,r+1,r+2),t.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),n=Math.cos(t),i=[],r=[],s=[];for(let o=0;o<this.symbolInstances.length;++o){s.push(o);const t=this.symbolInstances.get(o);i.push(0|Math.round(e*t.anchorX+n*t.anchorY)),r.push(t.featureIndex)}return s.sort(((t,e)=>i[t]-i[e]||r[e]-r[t])),s}addToSortKeyRanges(t,e){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,n)=>{t>=0&&n.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ei("SymbolBucket",Ic,{omit:["layers","collisionBoxArray","features","compareText"]}),Ic.MAX_GLYPHS=65535,Ic.addDynamicAttributes=Tc;const Cc=new ur({"symbol-placement":new sr(it.layout_symbol["symbol-placement"]),"symbol-spacing":new sr(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new sr(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new or(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new sr(it.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new sr(it.layout_symbol["icon-allow-overlap"]),"icon-overlap":new sr(it.layout_symbol["icon-overlap"]),"icon-ignore-placement":new sr(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new sr(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new sr(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new or(it.layout_symbol["icon-size"]),"icon-text-fit":new sr(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sr(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new or(it.layout_symbol["icon-image"]),"icon-rotate":new or(it.layout_symbol["icon-rotate"]),"icon-padding":new sr(it.layout_symbol["icon-padding"]),"icon-keep-upright":new sr(it.layout_symbol["icon-keep-upright"]),"icon-offset":new or(it.layout_symbol["icon-offset"]),"icon-anchor":new or(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new sr(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new sr(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new sr(it.layout_symbol["text-rotation-alignment"]),"text-field":new or(it.layout_symbol["text-field"]),"text-font":new or(it.layout_symbol["text-font"]),"text-size":new or(it.layout_symbol["text-size"]),"text-max-width":new or(it.layout_symbol["text-max-width"]),"text-line-height":new sr(it.layout_symbol["text-line-height"]),"text-letter-spacing":new or(it.layout_symbol["text-letter-spacing"]),"text-justify":new or(it.layout_symbol["text-justify"]),"text-radial-offset":new or(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new sr(it.layout_symbol["text-variable-anchor"]),"text-anchor":new or(it.layout_symbol["text-anchor"]),"text-max-angle":new sr(it.layout_symbol["text-max-angle"]),"text-writing-mode":new sr(it.layout_symbol["text-writing-mode"]),"text-rotate":new or(it.layout_symbol["text-rotate"]),"text-padding":new sr(it.layout_symbol["text-padding"]),"text-keep-upright":new sr(it.layout_symbol["text-keep-upright"]),"text-transform":new or(it.layout_symbol["text-transform"]),"text-offset":new or(it.layout_symbol["text-offset"]),"text-allow-overlap":new sr(it.layout_symbol["text-allow-overlap"]),"text-overlap":new sr(it.layout_symbol["text-overlap"]),"text-ignore-placement":new sr(it.layout_symbol["text-ignore-placement"]),"text-optional":new sr(it.layout_symbol["text-optional"])});var Mc={paint:new ur({"icon-opacity":new or(it.paint_symbol["icon-opacity"]),"icon-color":new or(it.paint_symbol["icon-color"]),"icon-halo-color":new or(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new or(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new or(it.paint_symbol["icon-halo-blur"]),"icon-translate":new sr(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new sr(it.paint_symbol["icon-translate-anchor"]),"text-opacity":new or(it.paint_symbol["text-opacity"]),"text-color":new or(it.paint_symbol["text-color"],{runtimeType:mt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new or(it.paint_symbol["text-halo-color"]),"text-halo-width":new or(it.paint_symbol["text-halo-width"]),"text-halo-blur":new or(it.paint_symbol["text-halo-blur"]),"text-translate":new sr(it.paint_symbol["text-translate"]),"text-translate-anchor":new sr(it.paint_symbol["text-translate-anchor"])}),layout:Cc};class zc{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ht,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ei("FormatSectionOverride",zc,{omit:["defaultValue"]});class Lc extends dr{constructor(t){super(t,Mc)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const n of t)e.indexOf(n)<0&&e.push(n);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,n,i){const r=this.layout.get(t).evaluate(e,{},n,i),s=this._unevaluatedLayout._values[t];return s.isDataDriven()||zn(s.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,((e,n)=>n in t?String(t[n]):""))}(e.properties,r)}createBucket(t){return new Ic(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Mc.paint.overridableProperties){if(!Lc.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),n=new zc(e),i=new Mn(n,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new Dn("source",i):new Rn("composite",i,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new ir(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven())&&Lc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const n=t.get("text-field"),i=Mc.paint.properties[e];let r=!1;const s=t=>{for(const e of t)if(i.overrides&&i.overrides.hasOverride(e))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof Bt)s(n.value.value.sections);else if("source"===n.value.kind){const t=e=>{r||(e instanceof jt&&Nt(e.value)===vt?s(e.value.sections):e instanceof Wt?s(e.sections):e.eachChild(t))},e=n.value;e._styleExpression&&t(e._styleExpression.expression)}return r}}function Dc(t,e,n){let i="never";const r=t.get(e);return r?i=r:t.get(n)&&(i="always"),i}var Rc={paint:new ur({"background-color":new sr(it.paint_background["background-color"]),"background-pattern":new lr(it.paint_background["background-pattern"]),"background-opacity":new sr(it.paint_background["background-opacity"])})},Bc={paint:new ur({"raster-opacity":new sr(it.paint_raster["raster-opacity"]),"raster-hue-rotate":new sr(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new sr(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new sr(it.paint_raster["raster-brightness-max"]),"raster-saturation":new sr(it.paint_raster["raster-saturation"]),"raster-contrast":new sr(it.paint_raster["raster-contrast"]),"raster-resampling":new sr(it.paint_raster["raster-resampling"]),"raster-fade-duration":new sr(it.paint_raster["raster-fade-duration"])})};class Oc extends dr{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const Fc={circle:class extends dr{constructor(t){super(t,ao)}createBucket(t){return new $s(t)}queryRadius(t){const e=t;return io("circle-radius",this,e)+io("circle-stroke-width",this,e)+ro(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,r,s,o,a){const l=so(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,o),c=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((t=>mo(t,e)))}(l,a),d=u?c*o:c;for(const p of i)for(const t of p){const e=u?t:mo(t,a);let n=d;const i=fo([],[t.x,t.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?n*=i[3]/s.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(n*=s.cameraToCenterDistance/i[3]),Zs(h,e,n))return!0}return!1}},heatmap:class extends dr{constructor(t){super(t,yo),this._updateColorRamp()}createBucket(t){return new go(t)}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=So({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends dr{constructor(t){super(t,Eo)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends dr{constructor(t){super(t,ha)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ca(t)}queryRadius(){return ro(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,r,s,o){return Hs(so(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,o),i)}isTileClipped(){return!0}},"fill-extrusion":class extends dr{constructor(t){super(t,za)}createBucket(t){return new Ia(t)}queryRadius(){return ro(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,e,n,i,r,s,o,a){const l=so(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,o),c=this.paint.get("fill-extrusion-height").evaluate(e,n),u=this.paint.get("fill-extrusion-base").evaluate(e,n),h=function(t,e,n,i){const r=[];for(const s of t){const t=[s.x,s.y,0,1];fo(t,t,e),r.push(new T(t[0]/t[3],t[1]/t[3]))}return r}(l,a),d=function(t,e,n,i){const r=[],s=[],o=i[8]*e,a=i[9]*e,l=i[10]*e,c=i[11]*e,u=i[8]*n,h=i[9]*n,d=i[10]*n,p=i[11]*n;for(const f of t){const t=[],e=[];for(const n of f){const r=n.x,s=n.y,f=i[0]*r+i[4]*s+i[12],m=i[1]*r+i[5]*s+i[13],g=i[2]*r+i[6]*s+i[14],y=i[3]*r+i[7]*s+i[15],_=g+l,v=y+c,x=f+u,b=m+h,w=g+d,S=y+p,E=new T((f+o)/v,(m+a)/v);E.z=_/v,t.push(E);const A=new T(x/S,b/S);A.z=w/S,e.push(A)}r.push(t),s.push(e)}return[r,s]}(i,u,c,a);return function(t,e,n){let i=1/0;Hs(n,e)&&(i=Da(n,e[0]));for(let r=0;r<e.length;r++){const s=e[r],o=t[r];for(let t=0;t<s.length-1;t++){const e=s[t],r=[e,s[t+1],o[t+1],o[t],e];Ws(n,r)&&(i=Math.min(i,Da(n,r)))}}return i!==1/0&&i}(d[0],d[1],h)}},line:class extends dr{constructor(t){super(t,qa),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ee,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=$a.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ja(t)}queryRadius(t){const e=t,n=Wa(io("line-width",this,e),io("line-gap-width",this,e)),i=io("line-offset",this,e);return n/2+Math.abs(i)+ro(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,r,s,o){const a=so(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,o),l=o/2*Wa(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(i=function(t,e){const n=[];for(let i=0;i<t.length;i++){const r=t[i],s=[];for(let t=0;t<r.length;t++){const n=r[t-1],i=r[t],o=r[t+1],a=0===t?new T(0,0):i.sub(n)._unit()._perp(),l=t===r.length-1?new T(0,0):o.sub(i)._unit()._perp(),c=a._add(l)._unit(),u=c.x*l.x+c.y*l.y;0!==u&&c._mult(1/u),s.push(c._mult(e)._add(i))}n.push(s)}return n}(i,c*o)),function(t,e,n){for(let i=0;i<e.length;i++){const r=e[i];if(t.length>=3)for(let e=0;e<r.length;e++)if(eo(t,r[e]))return!0;if(Xs(t,r,n))return!0}return!1}(a,i,l)}isTileClipped(){return!0}},symbol:Lc,background:class extends dr{constructor(t){super(t,Rc)}},raster:class extends dr{constructor(t){super(t,Bc)}}};class Vc{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}const Nc=6371008.8;class Uc{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Uc(o(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,n=this.lat*e,i=t.lat*e,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return Nc*Math.acos(Math.min(r,1))}toBounds(t=0){const e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new jc(new Uc(this.lng-n,this.lat-e),new Uc(this.lng+n,this.lat+e))}static convert(t){if(t instanceof Uc)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Uc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Uc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class jc{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Uc?new Uc(t.lng,t.lat):Uc.convert(t),this}setSouthWest(t){return this._sw=t instanceof Uc?new Uc(t.lng,t.lat):Uc.convert(t),this}extend(t){const e=this._sw,n=this._ne;let i,r;if(t instanceof Uc)i=t,r=t;else{if(!(t instanceof jc))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(jc.convert(t)):this.extend(Uc.convert(t)):this;if(i=t._sw,r=t._ne,!i||!r)return this}return e||n?(e.lng=Math.min(i.lng,e.lng),e.lat=Math.min(i.lat,e.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Uc(i.lng,i.lat),this._ne=new Uc(r.lng,r.lat)),this}getCenter(){return new Uc((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Uc(this.getWest(),this.getNorth())}getSouthEast(){return new Uc(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:n}=Uc.convert(t);let i=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(t){return t instanceof jc?t:t?new jc(t):t}}const Gc=2*Math.PI*Nc;function qc(t){return Gc*Math.cos(t*Math.PI/180)}function $c(t){return(180+t)/360}function Wc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Zc(t,e){return t/qc(e)}function Hc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}class Xc{constructor(t,e,n=0){this.x=+t,this.y=+e,this.z=+n}static fromLngLat(t,e=0){const n=Uc.convert(t);return new Xc($c(n.lng),Wc(n.lat),Zc(e,n.lat))}toLngLat(){return new Uc(360*this.x-180,Hc(this.y))}toAltitude(){return this.z*qc(Hc(this.y))}meterInMercatorCoordinateUnits(){return 1/Gc*(t=Hc(this.y),1/Math.cos(t*Math.PI/180));var t}}function Yc(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}class Kc{constructor(t,e,n){this.z=t,this.x=e,this.y=n,this.key=tu(0,t,t,e,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,n){const i=(s=this.y,o=this.z,a=Yc(256*(r=this.x),256*(s=Math.pow(2,o)-s-1),o),l=Yc(256*(r+1),256*(s+1),o),a[0]+","+a[1]+","+l[0]+","+l[1]);var r,s,o,a,l;const c=function(t,e,n){let i,r="";for(let s=t;s>0;s--)i=1<<s-1,r+=(e&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,i)}getTilePoint(t){const e=Math.pow(2,this.z);return new T((t.x*e-this.x)*Vs,(t.y*e-this.y)*Vs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Jc{constructor(t,e){this.wrap=t,this.canonical=e,this.key=tu(t,e.z,e.z,e.x,e.y)}}class Qc{constructor(t,e,n,i,r){this.overscaledZ=t,this.wrap=e,this.canonical=new Kc(n,+i,+r),this.key=tu(e,t,n,i,r)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new Qc(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qc(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){const n=this.canonical.z-t;return t>this.canonical.z?tu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):tu(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Qc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Qc(e,this.wrap,e,n,i),new Qc(e,this.wrap,e,n+1,i),new Qc(e,this.wrap,e,n,i+1),new Qc(e,this.wrap,e,n+1,i+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Qc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Qc(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Xc(t.x-this.wrap,t.y))}}function tu(t,e,n,i,r){(t*=2)<0&&(t=-1*t-1);const s=1<<n;return(s*s*t+s*r+i).toString(36)+n.toString(36)+e.toString(36)}Ei("CanonicalTileID",Kc),Ei("OverscaledTileID",Qc,{omit:["posMatrix"]});class eu{constructor(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return void f(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const i=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(let r=0;r<i;r++)this.data[this._idx(-1,r)]=this.data[this._idx(0,r)],this.data[this._idx(i,r)]=this.data[this._idx(i-1,r)],this.data[this._idx(r,-1)]=this.data[this._idx(r,0)],this.data[this._idx(r,i)]=this.data[this._idx(r,i-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(i,-1)]=this.data[this._idx(i-1,0)],this.data[this._idx(-1,i)]=this.data[this._idx(0,i-1)],this.data[this._idx(i,i)]=this.data[this._idx(i-1,i-1)]}get(t,e){const n=new Uint8Array(this.data.buffer),i=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[i],n[i+1],n[i+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,n){return(256*t*256+256*e+n)/10-1e4}_unpackTerrarium(t,e,n){return 256*t+e+n/256-32768}getPixels(){return new wo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,r=e*this.dim+this.dim,s=n*this.dim,o=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:s=o-1;break;case 1:o=s+1}const a=-e*this.dim,l=-n*this.dim;for(let c=s;c<o;c++)for(let e=i;e<r;e++)this.data[this._idx(e,c)]=t.data[this._idx(e+a,c+l)]}}Ei("DEMData",eu);class nu{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class iu{constructor(t,e,n,i,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class ru{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new wi(Vs,16,0),this.grid3D=new wi(Vs,16,0),this.featureIndexArray=new Xr,this.promoteId=e}insert(t,e,n,i,r,s){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);const a=s?this.grid3D:this.grid;for(let l=0;l<e.length;l++){const t=e[l],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const i=t[e];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<Vs&&n[1]<Vs&&n[2]>=0&&n[3]>=0&&a.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fa.VectorTile(new el(this.rawTileData)).layers,this.sourceLayerCoder=new nu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,n,i){this.loadVTLayers();const r=t.params||{},s=Vs/t.tileSize/t.scale,o=Zn(r.filter),a=t.queryGeometry,l=t.queryPadding*s,c=ou(a),u=this.grid.query(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l),h=ou(t.cameraQueryGeometry),d=this.grid3D.query(h.minX-l,h.minY-l,h.maxX+l,h.maxY+l,((e,n,i,r)=>function(t,e,n,i,r){for(const o of t)if(e<=o.x&&n<=o.y&&i>=o.x&&r>=o.y)return!0;const s=[new T(e,n),new T(e,r),new T(i,r),new T(i,n)];if(t.length>2)for(const o of s)if(eo(t,o))return!0;for(let o=0;o<t.length-1;o++)if(no(t[o],t[o+1],s))return!0;return!1}(t.cameraQueryGeometry,e-l,n-l,i+l,r+l)));for(const m of d)u.push(m);u.sort(au);const p={};let f;for(let m=0;m<u.length;m++){const l=u[m];if(l===f)continue;f=l;const c=this.featureIndexArray.get(l);let h=null;this.loadMatchingFeature(p,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,o,r.layers,r.availableImages,e,n,i,((e,n,i)=>(h||(h=js(e)),n.queryIntersectsFeature(a,e,i,h,this.z,t.transform,s,t.pixelPosMatrix))))}return p}loadMatchingFeature(t,e,n,i,r,s,o,l,c,u,h){const d=this.bucketLayerIDs[e];if(s&&!function(t,e){for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(s,d))return;const p=this.sourceLayerCoder.decode(n),f=this.vtLayers[p].feature(i);if(r.needGeometry){const t=Gs(f,!0);if(!r.filter(new Yi(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new Yi(this.tileID.overscaledZ),f))return;const m=this.getId(f,p);for(let g=0;g<d.length;g++){const e=d[g];if(s&&s.indexOf(e)<0)continue;const n=l[e];if(!n)continue;let r={};m&&u&&(r=u.getState(n.sourceLayer||"_geojsonTileLayer",m));const p=a({},c[e]);p.paint=su(p.paint,n.paint,f,r,o),p.layout=su(p.layout,n.layout,f,r,o);const y=!h||h(f,n,r);if(!y)continue;const _=new iu(f,this.z,this.x,this.y,m);_.layer=p;let v=t[e];void 0===v&&(v=t[e]=[]),v.push({featureIndex:i,feature:_,intersectionZ:y})}}lookupSymbolFeatures(t,e,n,i,r,s,o,a){const l={};this.loadVTLayers();const c=Zn(r);for(const u of t)this.loadMatchingFeature(l,n,i,u,c,s,o,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const n of e)if(t===n)return!0;return!1}getId(t,e){let n=t.id;return this.promoteId&&(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof n&&(n=Number(n))),n}}function su(t,e,n,i,r){return u(t,((t,s)=>{const o=e instanceof rr?e.get(s):null;return o&&o.evaluate?o.evaluate(n,i,r):o}))}function ou(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(const s of t)e=Math.min(e,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x),r=Math.max(r,s.y);return{minX:e,minY:n,maxX:i,maxY:r}}function au(t,e){return e-t}var lu;Ei("FeatureIndex",ru,{omit:["rawTileData","sourceLayerCoder"]}),t.PerformanceMarkers=void 0,(lu=t.PerformanceMarkers||(t.PerformanceMarkers={})).create="create",lu.load="load",lu.fullLoad="fullLoad";let cu=null,uu=[];const hu=1e3/30,du={mark(t){performance.mark(t)},frame(t){const e=t;null!=cu&&uu.push(e-cu),cu=e},clearMetrics(){cu=null,uu=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const e in t.PerformanceMarkers)performance.clearMarks(t.PerformanceMarkers[e])},getPerformanceMetrics(){performance.measure("loadTime",t.PerformanceMarkers.create,t.PerformanceMarkers.load),performance.measure("fullLoadTime",t.PerformanceMarkers.create,t.PerformanceMarkers.fullLoad);const e=performance.getEntriesByName("loadTime")[0].duration,n=performance.getEntriesByName("fullLoadTime")[0].duration,i=uu.length,r=1/(uu.reduce(((t,e)=>t+e),0)/i/1e3),s=uu.filter((t=>t>hu)).reduce(((t,e)=>t+(e-hu)/hu),0);return{loadTime:e,fullLoadTime:n,fps:r,percentDroppedFrames:s/(i+s)*100}}};t.AJAXError=j,t.ARRAY_TYPE=lo,t.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},c(["receive","process"],this),this.invoker=new Vc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=y()?t:window}send(t,e,n,i,r=!1){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[s]=n);const o=w(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:Ai(e,o)},o),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];const t=this.cancelCallbacks[n];delete this.cancelCallbacks[n],t&&t()}else y()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)}process(){if(!this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(ki(e.error)):n(null,ki(e.data)))}else{let n=!1;const i=w(this.globalScope)?void 0:[],r=e.hasCallback?(e,r)=>{n=!0,delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Ai(e):null,data:Ai(r,i)},i)}:t=>{n=!0};let s=null;const o=ki(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,o,r);else if(this.parent.getWorkerSource){const t=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,t[0],o.source)[t[1]](o,r)}else r(new Error(`Could not find function ${e.type}`));!n&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.AlphaImage=bo,t.CanonicalTileID=Kc,t.CollisionBoxArray=Ur,t.CollisionCircleLayoutArray=class extends Ir{},t.Color=Lt,t.DEMData=eu,t.DataConstantProperty=sr,t.DictionaryCoder=nu,t.EXTENT=Vs,t.ErrorEvent=et,t.EvaluationParameters=Yi,t.Event=tt,t.Evented=nt,t.FeatureIndex=ru,t.FillBucket=ca,t.FillExtrusionBucket=Ia,t.GeoJSONFeature=iu,t.ImageAtlas=Il,t.ImagePosition=Pl,t.LineBucket=ja,t.LineStripIndexArray=class extends Fr{},t.LngLat=Uc,t.LngLatBounds=jc,t.MercatorCoordinate=Xc,t.ONE_EM=tl,t.OverscaledTileID=Qc,t.PerformanceUtils=du,t.PosArray=class extends _r{},t.Properties=ur,t.QuadTriangleArray=class extends Mr{},t.RGBAImage=wo,t.RasterBoundsArray=class extends vr{},t.RequestPerformance=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.ResourceType=U,t.SegmentVector=hs,t.SymbolBucket=Ic,t.Transitionable=Qi,t.TriangleIndexArray=as,t.Uniform1f=Ts,t.Uniform1i=class extends Es{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends Es{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends Es{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=As,t.UniformColor=ks,t.UniformMatrix4f=class extends Es{constructor(t,e){super(t,e),this.current=Ps}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.UnwrappedTileID=Jc,t.ValidationError=rt,t.ZoomHistory=Pi,t.addDynamicAttributes=Tc,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);let i=t.length;const r=new Array(t.length);let s=null;t.forEach(((t,o)=>{e(t,((t,e)=>{t&&(s=t),r[o]=e,0==--i&&n(s,r)}))}))},t.bezier=i,t.bindAll=c,t.cacheEntryPossiblyAdded=function(t){D++,D>z&&(t.getActor().send("enforceCacheSizeLimit",M),D=0)},t.clamp=s,t.clearTileCache=function(t){const e=caches.delete(P);t&&e.catch(t).then((()=>t()))},t.clipLine=nc,t.clone=function(t){var e=new lo(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=d,t.collisionCircleLayout=Ka,t.config=k,t.create=function(){var t=new lo(16);return lo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.createExpression=Ln,t.createFilter=Zn,t.createLayout=gr,t.createStyleLayer=function(t){return"custom"===t.type?new Oc(t):new Fc[t.type](t)},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=r,t.emitValidationErrors=bi,t.enforceCacheSizeLimit=function(t){L(),I&&I.then((e=>{e.keys().then((n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])}))}))},t.evaluateSizeForFeature=function(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:r}){return"source"===t.kind?i/Wl:"composite"===t.kind?Te(i/Wl,r/Wl,n):e},t.evaluateSizeForZoom=function(t,e){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:o,maxZoom:a}=t,l=r?s(qe.interpolationFactor(r,e,o,a),0,1):0;"camera"===t.kind?i=Te(t.minSize,t.maxSize,l):n=l}return{uSizeT:n,uSize:i}},t.evaluateVariableOffset=mc,t.evented=Wi,t.exported=E,t.exported$1=R,t.extend=a,t.filterObject=h,t.getAnchorAlignment=jl,t.getAnchorJustification=gc,t.getArrayBuffer=W,t.getImage=K,t.getJSON=function(t,e){return $(a(t,{type:"json"}),e)},t.getOverlapMode=Dc,t.getRTLTextPluginStatus=Zi,t.getReferrer=G,t.getVideo=function(t,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let i=0;i<t.length;i++){const e=window.document.createElement("source");Z(t[i])||(n.crossOrigin="Anonymous"),e.src=t[i],n.appendChild(e)}return{cancel:()=>{}}},t.identity=co,t.invert=function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=n*a-i*o,v=n*l-r*o,x=n*c-s*o,b=i*l-r*a,w=i*c-s*a,S=r*c-s*l,E=u*m-h*f,T=u*g-d*f,A=u*y-p*f,k=h*g-d*m,P=h*y-p*m,I=d*y-p*g,C=_*I-v*P+x*k+b*A-w*T+S*E;return C?(t[0]=(a*I-l*P+c*k)*(C=1/C),t[1]=(r*P-i*I-s*k)*C,t[2]=(m*S-g*w+y*b)*C,t[3]=(d*w-h*S-p*b)*C,t[4]=(l*A-o*I-c*T)*C,t[5]=(n*I-r*A+s*T)*C,t[6]=(g*x-f*S-y*v)*C,t[7]=(u*S-d*x+p*v)*C,t[8]=(o*P-a*A+c*E)*C,t[9]=(i*A-n*P-s*E)*C,t[10]=(f*w-m*x+y*_)*C,t[11]=(h*x-u*w-p*_)*C,t[12]=(a*T-o*k-l*E)*C,t[13]=(n*k-i*T+r*E)*C,t[14]=(m*v-f*b-g*_)*C,t[15]=(u*b-h*v+d*_)*C,t):null},t.isImageBitmap=S,t.isSafari=w,t.keysDifference=function(t,e){const n=[];for(const i in t)i in e||n.push(i);return n},t.lazyLoadRTLTextPlugin=function(){Xi.isLoading()||Xi.isLoaded()||"deferred"!==Zi()||Hi()},t.makeRequest=$,t.mapObject=u,t.mercatorXfromLng=$c,t.mercatorYfromLat=Wc,t.mercatorZfromAltitude=Zc,t.mul=po,t.multiply=uo,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.number=Te,t.ortho=function(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t},t.parseCacheControl=_,t.parseGlyphPBF=function(t){return new el(t).readFields(El,[])},t.pbf=el,t.performSymbolLayout=function(e,n,i,r,s,o,a){e.createArrays(),e.tilePixelRatio=Vs/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const l=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,u={layoutIconSize:c["icon-size"].possiblyEvaluate(new Yi(e.zoom+1),a),layoutTextSize:c["text-size"].possiblyEvaluate(new Yi(e.zoom+1),a),textMaxSize:c["text-size"].possiblyEvaluate(new Yi(18))};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;u.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Yi(t),a),c["text-size"].possiblyEvaluate(new Yi(n),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;u.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Yi(t),a),c["icon-size"].possiblyEvaluate(new Yi(n),a)]}const h=l.get("text-line-height")*tl,d="viewport"!==l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),p=l.get("text-keep-upright"),m=l.get("text-size");for(const g of e.features){const o=l.get("text-font").evaluate(g,{},a).join(","),c=m.evaluate(g,{},a),y=u.layoutTextSize.evaluate(g,{},a),_=u.layoutIconSize.evaluate(g,{},a),v={horizontal:{},vertical:void 0},x=g.text;let b,w=[0,0];if(x){const r=x.toString(),u=l.get("text-letter-spacing").evaluate(g,{},a)*tl,f=Mi(r)?u:0,m=l.get("text-anchor").evaluate(g,{},a),_=l.get("text-variable-anchor");if(!_){const t=l.get("text-radial-offset").evaluate(g,{},a);w=t?mc(m,[t*tl,fc]):l.get("text-offset").evaluate(g,{},a).map((t=>t*tl))}let b=d?"center":l.get("text-justify").evaluate(g,{},a);const S=l.get("symbol-placement"),E="point"===S?l.get("text-max-width").evaluate(g,{},a)*tl:0,T=()=>{e.allowVerticalPlacement&&Ci(r)&&(v.vertical=Ll(x,n,i,s,o,E,h,m,"left",f,w,t.WritingMode.vertical,!0,S,y,c))};if(!d&&_){const e="auto"===b?_.map((t=>gc(t))):[b];let r=!1;for(let a=0;a<e.length;a++){const l=e[a];if(!v.horizontal[l])if(r)v.horizontal[l]=v.horizontal[0];else{const e=Ll(x,n,i,s,o,E,h,"center",l,f,w,t.WritingMode.horizontal,!1,S,y,c);e&&(v.horizontal[l]=e,r=1===e.positionedLines.length)}}T()}else{"auto"===b&&(b=gc(m));const e=Ll(x,n,i,s,o,E,h,m,b,f,w,t.WritingMode.horizontal,!1,S,y,c);e&&(v.horizontal[b]=e),T(),Ci(r)&&d&&p&&(v.vertical=Ll(x,n,i,s,o,E,h,m,b,f,w,t.WritingMode.vertical,!1,S,y,c))}}let S=!1;if(g.icon&&g.icon.name){const t=r[g.icon.name];t&&(b=ql(s[g.icon.name],l.get("icon-offset").evaluate(g,{},a),l.get("icon-anchor").evaluate(g,{},a)),S=!!t.sdf,void 0===e.sdfIcons?e.sdfIcons=S:e.sdfIcons!==S&&f("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const E=xc(v.horizontal)||v.vertical;e.iconsInText=!!E&&E.iconsInText,(E||b)&&yc(e,g,v,b,r,u,y,_,w,S,a)}o&&e.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,i,r){var s,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+i)*(s=1/(i-r)),t[14]=2*r*i*s):(t[10]=-1,t[14]=-2*i),t},t.pick=function(t,e){const n={};for(let i=0;i<e.length;i++){const r=e[i];r in t&&(n[r]=t[r])}return n},t.plugin=Xi,t.pointGeometry=T,t.polygonIntersectsPolygon=Ws,t.potpack=kl,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Ei,t.registerForPluginStateChange=function(t){return t({pluginStatus:ji,pluginURL:Gi}),Wi.on("pluginStateChange",t),t},t.renderColorRamp=So,t.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+h*i,t[7]=l*r+d*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=h*r-a*i,t[11]=d*r-l*i,t},t.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+h*i,t[3]=l*r+d*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=h*r-a*i,t[7]=d*r-l*i,t},t.scale=function(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.setCacheLimits=function(t,e){M=t,z=e},t.setRTLTextPlugin=function(t,e,n=!1){if(ji===Fi||ji===Vi||ji===Ni)throw new Error("setRTLTextPlugin cannot be called multiple times.");Gi=E.resolveURL(t),ji=Fi,Ui=e,$i(),n||Hi()},t.spec=it,t.sphericalToCartesian=function([t,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:t*Math.cos(e)*Math.sin(n),y:t*Math.sin(e)*Math.sin(n),z:t*Math.cos(n)}},t.toEvaluationFeature=Gs,t.transformMat4=fo,t.translate=function(t,e,n){var i,r,s,o,a,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=i=e[0],t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=i*m+a*g+h*y+e[12],t[13]=r*m+l*g+d*y+e[13],t[14]=s*m+c*g+p*y+e[14],t[15]=o*m+u*g+f*y+e[15]),t},t.triggerPluginCompletionEvent=qi,t.unicodeBlockLookup=Ii,t.uniqueId=function(){return l++},t.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateLight=_i,t.validateStyle=yi,t.vectorTile=fa,t.warnOnce=f,t.wrap=o})),i(["./shared"],(function(t){function e(t){const n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){let n="[";for(const i of t)n+=`${e(i)},`;return`${n}]`}const i=Object.keys(t).sort();let r="{";for(let s=0;s<i.length;s++)r+=`${JSON.stringify(i[s])}:${e(t[i[s]])},`;return`${r}}`}function n(n){let i="";for(const r of t.refProperties)i+=`/${e(n[r])}`;return i}class i{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,i){for(const n of e){this._layerConfigs[n.id]=n;const e=this._layers[n.id]=t.createStyleLayer(n);e._featureFilter=t.createFilter(e.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=function(t,e){const i={};for(let s=0;s<t.length;s++){const r=e&&e[t[s].id]||n(t[s]);e&&(e[t[s].id]=r);let o=i[r];o||(o=i[r]=[]),o.push(t[s])}const r=[];for(const n in i)r.push(i[n]);return r}(Object.values(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map((t=>this._layers[t.id])),n=e[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const s=n.sourceLayer||"_geojsonTileLayer";let o=r[s];o||(o=r[s]=[]),o.push(e)}}}class r{constructor(e){const n={},i=[];for(const t in e){const r=e[t],s=n[t]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const n={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};i.push(n),s[t]={rect:n,metrics:e.metrics}}}const{w:r,h:s}=t.potpack(i),o=new t.AlphaImage({width:r||1,height:s||1});for(const a in e){const i=e[a];for(const e in i){const r=i[+e];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const s=n[a][e].rect;t.AlphaImage.copy(r.bitmap,o,{x:0,y:0},{x:s.x+1,y:s.y+1},r.bitmap)}}this.image=o,this.positions=n}}t.register("GlyphAtlas",r);class s{constructor(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId}parse(e,n,i,s,a){this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;const l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:i},d=n.familiesBySource[this.source];for(const r in d){const n=e.layers[r];if(!n)continue;1===n.version&&t.warnOnce(`Vector tile source "${this.source}" layer "${r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(r),a=[];for(let t=0;t<n.length;t++){const e=n.feature(t),i=c.getId(e,r);a.push({feature:e,id:i,index:t,sourceLayerIndex:s})}for(const t of d[r]){const e=t[0];e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(o(t,this.zoom,i),(u[e.id]=e.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(a,h,this.tileID.canonical),c.bucketLayerIDs.push(t.map((t=>t.id))))}}let p,f,m,g;const y=t.mapObject(h.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(y).length?s.send("getGlyphs",{uid:this.uid,stacks:y},((t,e)=>{p||(p=t,f=e,x.call(this))})):f={};const _=Object.keys(h.iconDependencies);_.length?s.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{p||(p=t,m=e,x.call(this))})):m={};const v=Object.keys(h.patternDependencies);function x(){if(p)return a(p);if(f&&m&&g){const e=new r(f),n=new t.ImageAtlas(m,g);for(const r in u){const s=u[r];s instanceof t.SymbolBucket?(o(s.layers,this.zoom,i),t.performSymbolLayout(s,f,e.positions,m,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):s.hasPattern&&(s instanceof t.LineBucket||s instanceof t.FillBucket||s instanceof t.FillExtrusionBucket)&&(o(s.layers,this.zoom,i),s.addFeatures(h,this.tileID.canonical,n.patternPositions))}this.status="done",a(null,{buckets:Object.values(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?m:null,glyphPositions:this.returnDependencies?e.positions:null})}}v.length?s.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{p||(p=t,g=e,x.call(this))})):g={},x.call(this)}}function o(e,n,i){const r=new t.EvaluationParameters(n);for(const t of e)t.recalculate(r,i)}function a(e,n){const i=t.getArrayBuffer(e.request,((e,i,r,s)=>{e?n(e):i&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(i)),rawData:i,cacheControl:r,expires:s})}));return()=>{i.cancel(),n()}}class l{constructor(t,e,n,i){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=i||a,this.loading={},this.loaded={}}loadTile(e,n){const i=e.uid;this.loading||(this.loading={});const r=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),o=this.loading[i]=new s(e);o.abort=this.loadVectorData(e,((e,s)=>{if(delete this.loading[i],e||!s)return o.status="done",this.loaded[i]=o,n(e);const a=s.rawData,l={};s.expires&&(l.expires=s.expires),s.cacheControl&&(l.cacheControl=s.cacheControl);const c={};if(r){const t=r.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}o.vectorTile=s.vectorTile,o.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return n(e);n(null,t.extend({rawTileData:a.slice(0)},i,l,c))})),this.loaded=this.loaded||{},this.loaded[i]=o}))}reloadTile(t,e){const n=this.loaded,i=t.uid,r=this;if(n&&n[i]){const s=n[i];s.showCollisionBoxes=t.showCollisionBoxes;const o=(t,n)=>{const i=s.reloadCallback;i&&(delete s.reloadCallback,s.parse(s.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),e(t,n)};"parsing"===s.status?s.reloadCallback=o:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(t,e){const n=this.loading,i=t.uid;n&&n[i]&&n[i].abort&&(n[i].abort(),delete n[i]),e()}removeTile(t,e){const n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}}class c{constructor(){this.loaded={}}loadTile(e,n){const{uid:i,encoding:r,rawImageData:s}=e,o=t.isImageBitmap(s)?this.getImageData(s):s,a=new t.DEMData(i,o,r);this.loaded=this.loaded||{},this.loaded[i]=a,n(null,a)}getImageData(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)}removeTile(t){const e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]}}var u=function t(e,n){var i,r=e&&e.type;if("FeatureCollection"===r)for(i=0;i<e.features.length;i++)t(e.features[i],n);else if("GeometryCollection"===r)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],n);else if("Feature"===r)t(e.geometry,n);else if("Polygon"===r)h(e.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<e.coordinates.length;i++)h(e.coordinates[i],n);return e};function h(t,e){if(0!==t.length){d(t[0],e);for(var n=1;n<t.length;n++)d(t[n],!e)}}function d(t,e){for(var n=0,i=0,r=0,s=t.length,o=s-1;r<s;o=r++){var a=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]),l=n+a;i+=Math.abs(n)>=Math.abs(a)?n-l+a:a-l+n,n=l}n+i>=0!=!!e&&t.reverse()}const p=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class f{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const n of this._feature.geometry)e.push([new t.pointGeometry(n[0],n[1])]);return e}{const e=[];for(const n of this._feature.geometry){const i=[];for(const e of n)i.push(new t.pointGeometry(e[0],e[1]));e.push(i)}return e}}toGeoJSON(t,e,n){return p.call(this,t,e,n)}}class m{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(t){return new f(this._features[t])}}var g={exports:{}},y=t.pointGeometry,_=t.vectorTile.VectorTileFeature,v=x;function x(t,e){this.options=e||{},this.features=t,this.length=t.length}function b(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}x.prototype.feature=function(t){return new b(this.features[t],this.options.extent)},b.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var n=t[e],i=[],r=0;r<n.length;r++)i.push(new y(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},b.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,s=0;s<t.length;s++)for(var o=t[s],a=0;a<o.length;a++){var l=o[a];e=Math.min(e,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[e,i,n,r]},b.prototype.toGeoJSON=_.prototype.toGeoJSON;var w=t.pbf,S=v;function E(t){var e=new w;return function(t,e){for(var n in t.layers)e.writeMessage(3,T,t.layers[n])}(t,e),e.finish()}function T(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)i.feature=t.feature(n),e.writeMessage(2,A,i);var r=i.keys;for(n=0;n<r.length;n++)e.writeStringField(3,r[n]);var s=i.values;for(n=0;n<s.length;n++)e.writeMessage(4,M,s[n])}function A(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,k,t),e.writeVarintField(3,n.type),e.writeMessage(4,C,n)}function k(t,e){var n=t.feature,i=t.keys,r=t.values,s=t.keycache,o=t.valuecache;for(var a in n.properties){var l=n.properties[a],c=s[a];if(null!==l){void 0===c&&(i.push(a),s[a]=c=i.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=o[h];void 0===d&&(r.push(l),o[h]=d=r.length-1),e.writeVarint(d)}}}function P(t,e){return(e<<3)+(7&t)}function I(t){return t<<1^t>>31}function C(t,e){for(var n=t.loadGeometry(),i=t.type,r=0,s=0,o=n.length,a=0;a<o;a++){var l=n[a],c=1;1===i&&(c=l.length),e.writeVarint(P(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&e.writeVarint(P(2,u-1));var d=l[h].x-r,p=l[h].y-s;e.writeVarint(I(d)),e.writeVarint(I(p)),r+=d,s+=p}3===i&&e.writeVarint(P(7,1))}}function M(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}g.exports=E,g.exports.fromVectorTileJs=E,g.exports.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var i in t)n[i]=new S(t[i].features,e),n[i].name=i,n[i].version=e.version,n[i].extent=e.extent;return E({layers:n})},g.exports.GeoJSONWrapper=S;var z=g.exports;function L(t,e,n,i,r,s){if(r-i<=n)return;const o=i+r>>1;D(t,e,o,i,r,s%2),L(t,e,n,i,o-1,s+1),L(t,e,n,o+1,r,s+1)}function D(t,e,n,i,r,s){for(;r>i;){if(r-i>600){const o=r-i+1,a=n-i+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(a-o/2<0?-1:1);D(t,e,n,Math.max(i,Math.floor(n-a*c/o+u)),Math.min(r,Math.floor(n+(o-a)*c/o+u)),s)}const o=e[2*n+s];let a=i,l=r;for(R(t,e,i,n),e[2*r+s]>o&&R(t,e,i,r);a<l;){for(R(t,e,a,l),a++,l--;e[2*a+s]<o;)a++;for(;e[2*l+s]>o;)l--}e[2*i+s]===o?R(t,e,i,l):(l++,R(t,e,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function R(t,e,n,i){B(t,n,i),B(e,2*n,2*i),B(e,2*n+1,2*i+1)}function B(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function O(t,e,n,i){const r=t-n,s=e-i;return r*r+s*s}const F=t=>t[0],V=t=>t[1];class N{constructor(t,e=F,n=V,i=64,r=Float64Array){this.nodeSize=i,this.points=t;const s=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new s(t.length),a=this.coords=new r(2*t.length);for(let l=0;l<t.length;l++)o[l]=l,a[2*l]=e(t[l]),a[2*l+1]=n(t[l]);L(o,a,i,0,o.length-1,0)}range(t,e,n,i){return function(t,e,n,i,r,s,o){const a=[0,t.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),p=a.pop();if(d-p<=o){for(let o=p;o<=d;o++)c=e[2*o],u=e[2*o+1],c>=n&&c<=r&&u>=i&&u<=s&&l.push(t[o]);continue}const f=Math.floor((p+d)/2);c=e[2*f],u=e[2*f+1],c>=n&&c<=r&&u>=i&&u<=s&&l.push(t[f]);const m=(h+1)%2;(0===h?n<=c:i<=u)&&(a.push(p),a.push(f-1),a.push(m)),(0===h?r>=c:s>=u)&&(a.push(f+1),a.push(d),a.push(m))}return l}(this.ids,this.coords,t,e,n,i,this.nodeSize)}within(t,e,n){return function(t,e,n,i,r,s){const o=[0,t.length-1,0],a=[],l=r*r;for(;o.length;){const c=o.pop(),u=o.pop(),h=o.pop();if(u-h<=s){for(let r=h;r<=u;r++)O(e[2*r],e[2*r+1],n,i)<=l&&a.push(t[r]);continue}const d=Math.floor((h+u)/2),p=e[2*d],f=e[2*d+1];O(p,f,n,i)<=l&&a.push(t[d]);const m=(c+1)%2;(0===c?n-r<=p:i-r<=f)&&(o.push(h),o.push(d-1),o.push(m)),(0===c?n+r>=p:i+r>=f)&&(o.push(d+1),o.push(u),o.push(m))}return a}(this.ids,this.coords,t,e,n,this.nodeSize)}}const U={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},j=Math.fround||(G=new Float32Array(1),t=>(G[0]=+t,G[0]));var G;class q{constructor(t){this.options=J(Object.create(U),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:n,maxZoom:i,nodeSize:r}=this.options;e&&console.time("total time");const s=`prepare ${t.length} points`;e&&console.time(s),this.points=t;let o=[];for(let a=0;a<t.length;a++)t[a].geometry&&o.push(W(t[a],a));this.trees[i+1]=new N(o,Q,tt,r,Float32Array),e&&console.timeEnd(s);for(let a=i;a>=n;a--){const t=+Date.now();o=this._cluster(o,a),this.trees[a]=new N(o,Q,tt,r,Float32Array),e&&console.log("z%d: %d clusters in %dms",a,o.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){const t=this.getClusters([n,i,180,s],e),o=this.getClusters([-180,i,r,s],e);return t.concat(o)}const o=this.trees[this._limitZoom(e)],a=o.range(X(n),Y(s),X(r),Y(i)),l=[];for(const c of a){const t=o.points[c];l.push(t.numPoints?Z(t):this.points[t.index])}return l}getChildren(t){const e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const s=r.points[e];if(!s)throw new Error(i);const o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(s.x,s.y,o),l=[];for(const c of a){const e=r.points[c];e.parentId===t&&l.push(e.numPoints?Z(e):this.points[e.index])}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,n){const i=[];return this._appendLeaves(i,t,e=e||10,n=n||0,0),i}getTile(t,e,n){const i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:s,radius:o}=this.options,a=o/s,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((e-a)/r,l,(e+1+a)/r,c),i.points,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.points,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.points,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,i,r){const s=this.getChildren(e);for(const o of s){const e=o.properties;if(e&&e.cluster?r+e.point_count<=i?r+=e.point_count:r=this._appendLeaves(t,e.cluster_id,n,i,r):r<i?r++:t.push(o),t.length===n)break}return r}_addTileFeatures(t,e,n,i,r,s){for(const o of t){const t=e[o],a=t.numPoints;let l,c,u;if(a)l=H(t),c=t.x,u=t.y;else{const e=this.points[t.index];l=e.properties,c=X(e.geometry.coordinates[0]),u=Y(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;a?d=t.id:this.options.generateId?d=t.index:this.points[t.index].id&&(d=this.points[t.index].id),void 0!==d&&(h.id=d),s.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const n=[],{radius:i,extent:r,reduce:s,minPoints:o}=this.options,a=i/(r*Math.pow(2,e));for(let l=0;l<t.length;l++){const i=t[l];if(i.zoom<=e)continue;i.zoom=e;const r=this.trees[e+1],c=r.within(i.x,i.y,a),u=i.numPoints||1;let h=u;for(const t of c){const n=r.points[t];n.zoom>e&&(h+=n.numPoints||1)}if(h>u&&h>=o){let t=i.x*u,o=i.y*u,a=s&&u>1?this._map(i,!0):null;const d=(l<<5)+(e+1)+this.points.length;for(const n of c){const l=r.points[n];if(l.zoom<=e)continue;l.zoom=e;const c=l.numPoints||1;t+=l.x*c,o+=l.y*c,l.parentId=d,s&&(a||(a=this._map(i,!0)),s(a,this._map(l)))}i.parentId=d,n.push($(t/h,o/h,d,h,a))}else if(n.push(i),h>1)for(const t of c){const i=r.points[t];i.zoom<=e||(i.zoom=e,n.push(i))}}return n}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?J({},t.properties):t.properties;const n=this.points[t.index].properties,i=this.options.map(n);return e&&i===n?J({},i):i}}function $(t,e,n,i,r){return{x:j(t),y:j(e),zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function W(t,e){const[n,i]=t.geometry.coordinates;return{x:j(X(n)),y:j(Y(i)),zoom:1/0,index:e,parentId:-1}}function Z(t){return{type:"Feature",id:t.id,properties:H(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),K(t.y)]}};var e}function H(t){const e=t.numPoints,n=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return J(J({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function X(t){return t/360+.5}function Y(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function K(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function J(t,e){for(const n in e)t[n]=e[n];return t}function Q(t){return t.x}function tt(t){return t.y}function et(t,e,n,i){for(var r,s=i,o=n-e>>1,a=n-e,l=t[e],c=t[e+1],u=t[n],h=t[n+1],d=e+3;d<n;d+=3){var p=nt(t[d],t[d+1],l,c,u,h);if(p>s)r=d,s=p;else if(p===s){var f=Math.abs(d-o);f<a&&(r=d,a=f)}}s>i&&(r-e>3&&et(t,e,r,i),t[r+2]=s,n-r>3&&et(t,r,n,i))}function nt(t,e,n,i,r,s){var o=r-n,a=s-i;if(0!==o||0!==a){var l=((t-n)*o+(e-i)*a)/(o*o+a*a);l>1?(n=r,i=s):l>0&&(n+=o*l,i+=a*l)}return(o=t-n)*o+(a=e-i)*a}function it(t,e,n,i){var r={id:void 0===t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)rt(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)rt(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++)rt(t,e[i][r])}(r),r}function rt(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function st(t,e,n,i){if(e.geometry){var r=e.geometry.coordinates,s=e.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===s)ot(r,a);else if("MultiPoint"===s)for(var c=0;c<r.length;c++)ot(r[c],a);else if("LineString"===s)at(r,a,o,!1);else if("MultiLineString"===s){if(n.lineMetrics){for(c=0;c<r.length;c++)at(r[c],a=[],o,!1),t.push(it(l,"LineString",a,e.properties));return}lt(r,a,o,!1)}else if("Polygon"===s)lt(r,a,o,!0);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(c=0;c<e.geometry.geometries.length;c++)st(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];lt(r[c],u,o,!0),a.push(u)}}t.push(it(l,s,a,e.properties))}}function ot(t,e){e.push(ct(t[0])),e.push(ut(t[1])),e.push(0)}function at(t,e,n,i){for(var r,s,o=0,a=0;a<t.length;a++){var l=ct(t[a][0]),c=ut(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(o+=i?(r*c-l*s)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-s,2))),r=l,s=c}var u=e.length-3;e[2]=1,et(e,0,u,n),e[u+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function lt(t,e,n,i){for(var r=0;r<t.length;r++){var s=[];at(t[r],s,n,i),e.push(s)}}function ct(t){return t/360+.5}function ut(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function ht(t,e,n,i,r,s,o,a){if(i/=e,s>=(n/=e)&&o<i)return t;if(o<n||s>=i)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=n&&f<i)l.push(u);else if(!(f<n||p>=i)){var m=[];if("Point"===d||"MultiPoint"===d)dt(h,m,n,i,r);else if("LineString"===d)pt(h,m,n,i,r,!1,a.lineMetrics);else if("MultiLineString"===d)mt(h,m,n,i,r,!1);else if("Polygon"===d)mt(h,m,n,i,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];mt(h[g],y,n,i,r,!0),y.length&&m.push(y)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(it(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(it(u.id,d,m,u.tags))}}}return l.length?l:null}function dt(t,e,n,i,r){for(var s=0;s<t.length;s+=3){var o=t[s+r];o>=n&&o<=i&&(e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]))}}function pt(t,e,n,i,r,s,o){for(var a,l,c=ft(t),u=0===r?yt:_t,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],m=t[d+2],g=t[d+3],y=t[d+4],_=0===r?p:f,v=0===r?g:y,x=!1;o&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<n?v>n&&(l=u(c,p,f,g,y,n),o&&(c.start=h+a*l)):_>i?v<i&&(l=u(c,p,f,g,y,i),o&&(c.start=h+a*l)):gt(c,p,f,m),v<n&&_>=n&&(l=u(c,p,f,g,y,n),x=!0),v>i&&_<=i&&(l=u(c,p,f,g,y,i),x=!0),!s&&x&&(o&&(c.end=h+a*l),e.push(c),c=ft(t)),o&&(h+=a)}var b=t.length-3;p=t[b],f=t[b+1],m=t[b+2],(_=0===r?p:f)>=n&&_<=i&&gt(c,p,f,m),b=c.length-3,s&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&gt(c,c[0],c[1],c[2]),c.length&&e.push(c)}function ft(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function mt(t,e,n,i,r,s){for(var o=0;o<t.length;o++)pt(t[o],e,n,i,r,s,!1)}function gt(t,e,n,i){t.push(e),t.push(n),t.push(i)}function yt(t,e,n,i,r,s){var o=(s-e)/(i-e);return t.push(s),t.push(n+(r-n)*o),t.push(1),o}function _t(t,e,n,i,r,s){var o=(s-n)/(r-n);return t.push(e+(i-e)*o),t.push(s),t.push(1),o}function vt(t,e){for(var n=[],i=0;i<t.length;i++){var r,s=t[i],o=s.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=xt(s.geometry,e);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var a=0;a<s.geometry.length;a++)r.push(xt(s.geometry[a],e))}else if("MultiPolygon"===o)for(r=[],a=0;a<s.geometry.length;a++){for(var l=[],c=0;c<s.geometry[a].length;c++)l.push(xt(s.geometry[a][c],e));r.push(l)}n.push(it(s.id,o,r,s.tags))}return n}function xt(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function bt(t,e){if(t.transformed)return t;var n,i,r,s=1<<t.z,o=t.x,a=t.y;for(n=0;n<t.features.length;n++){var l=t.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(wt(c[i],c[i+1],e,s,o,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(wt(c[i][r],c[i][r+1],e,s,o,a));l.geometry.push(h)}}return t.transformed=!0,t}function wt(t,e,n,i,r,s){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-s))]}function St(t,e,n,i,r){for(var s=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){o.numFeatures++,Et(o,t[a],s,r);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),u>o.maxX&&(o.maxX=u),h>o.maxY&&(o.maxY=h)}return o}function Et(t,e,n,i){var r=e.geometry,s=e.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<r.length;a+=3)o.push(r[a]),o.push(r[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===s)Tt(o,r,t,n,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<r.length;a++)Tt(o,r[a],t,n,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)Tt(o,c[a],t,n,!0,0===a)}if(o.length){var u=e.tags||null;if("LineString"===s&&i.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function Tt(t,e,n,i,r,s){var o=i*i;if(i>0&&e.size<(r?o:i))n.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>o)&&(n.numSimplified++,a.push(e[l]),a.push(e[l+1])),n.numPoints++;r&&function(t,e){for(var n=0,i=0,r=t.length,s=r-2;i<r;s=i,i+=2)n+=(t[i]-t[s])*(t[i+1]+t[s+1]);if(n>0===e)for(i=0,r=t.length;i<r/2;i+=2){var o=t[i],a=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=o,t[r-1-i]=a}}(a,s),t.push(a)}}function At(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)st(n,t.features[i],e,i);else st(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){var n=e.buffer/e.extent,i=t,r=ht(t,1,-1-n,n,0,-1,2,e),s=ht(t,1,1-n,2+n,0,-1,2,e);return(r||s)&&(i=ht(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=vt(r,1).concat(i)),s&&(i=i.concat(vt(s,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function kt(t,e,n){return 32*((1<<t)*n+e)+t}function Pt(t,e){const n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return e(null,null);const r=new m(i.features);let s=z(r);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:r,rawData:s.buffer})}At.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},At.prototype.splitTile=function(t,e,n,i,r,s,o){for(var a=[t,e,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=kt(e,n,i),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=St(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,r){if(e===l.maxZoom||e===r)continue;var f=1<<r-e;if(n!==Math.floor(s/f)||i!==Math.floor(o/f))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,y,_,v,x,b=.5*l.buffer/l.extent,w=.5-b,S=.5+b,E=1+b;m=g=y=_=null,v=ht(t,u,n-b,n+S,0,d.minX,d.maxX,l),x=ht(t,u,n+w,n+E,0,d.minX,d.maxX,l),t=null,v&&(m=ht(v,u,i-b,i+S,1,d.minY,d.maxY,l),g=ht(v,u,i+w,i+E,1,d.minY,d.maxY,l),v=null),x&&(y=ht(x,u,i-b,i+S,1,d.minY,d.maxY,l),_=ht(x,u,i+w,i+E,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*n,2*i),a.push(g||[],e+1,2*n,2*i+1),a.push(y||[],e+1,2*n+1,2*i),a.push(_||[],e+1,2*n+1,2*i+1)}}},At.prototype.getTile=function(t,e,n){var i=this.options,r=i.extent,s=i.debug;if(t<0||t>24)return null;var o=1<<t,a=kt(t,e=(e%o+o)%o,n);if(this.tiles[a])return bt(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var l,c=t,u=e,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[kt(c,u,h)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",c,u,h),s>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,n),s>1&&console.timeEnd("drilling down"),this.tiles[a]?bt(this.tiles[a],r):null):null};class It extends l{constructor(t,e,n,i){super(t,e,n,Pt),i&&(this.loadGeoJSON=i)}loadData(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const e=this._pendingCallback,n=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const i=!!(n&&n.request&&n.request.collectResourceTiming)&&new t.RequestPerformance(n.request);this.loadGeoJSON(n,((r,s)=>{if(r||!s)return e(r);if("object"!=typeof s)return e(new Error(`Input data given to '${n.source}' is not a valid GeoJSON object.`));{u(s,!0);try{if(n.filter){const e=t.createExpression(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const i=s.features.filter((t=>e.value.evaluate({zoom:0},t)));s={type:"FeatureCollection",features:i}}this._geoJSONIndex=n.cluster?new q(function({superclusterOptions:e,clusterProperties:n}){if(!n||!e)return e;const i={},r={},s={accumulated:null,zoom:0},o={properties:null},a=Object.keys(n);for(const l of a){const[e,s]=n[l],o=t.createExpression(s),a=t.createExpression("string"==typeof e?[e,["accumulated"],["get",l]]:e);i[l]=o.value,r[l]=a.value}return e.map=t=>{o.properties=t;const e={};for(const n of a)e[n]=i[n].evaluate(s,o);return e},e.reduce=(t,e)=>{o.properties=e;for(const n of a)s.accumulated=t[n],t[n]=r[n].evaluate(s,o)},e}(n)).load(s.features):function(t,e){return new At(t,e)}(s,n.geojsonVtOptions)}catch(r){return e(r)}this.loaded={};const o={};if(i){const t=i.finish();t&&(o.resourceTiming={},o.resourceTiming[n.source]=JSON.parse(JSON.stringify(t)))}e(null,o)}}))}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(t,e){const n=this.loaded;return n&&n[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class Ct{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:It},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}setReferrer(t,e){this.referrer=e}setImages(t,e,n){this.availableImages[t]=e;for(const i in this.workerSources[t]){const n=this.workerSources[t][i];for(const t in n)n[t].availableImages=e}n()}setLayers(t,e,n){this.getLayerIndex(t).replace(e),n()}updateLayers(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()}loadTile(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)}loadDEMTile(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)}reloadTile(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)}abortTile(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)}removeTile(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)}removeDEMTile(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)}removeSource(t,e,n){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,n):n()}loadWorkerSource(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}}syncRTLPluginState(e,n,i){try{t.plugin.setState(n);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const n=t.plugin.isParsed();i(n?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),n)}}catch(t){i(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e}getWorkerSource(t,e,n){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][n]){const i={send:(e,n,i)=>{this.actor.send(e,n,i,t)}};this.workerSources[t][e][n]=new this.workerSourceTypes[e](i,this.getLayerIndex(t),this.getAvailableImages(t))}return this.workerSources[t][e][n]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,n){t.enforceCacheSizeLimit(n)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Ct(self)),Ct})),i(["./shared"],(function(t){var e=n;function n(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===i[e=t&&t.failIfMajorPerformanceCaveat]&&(i[e]=function(t){var e,i=function(t){var e=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}(t);if(!i)return!1;try{e=i.createShader(i.VERTEX_SHADER)}catch(t){return!1}return!(!e||i.isContextLost())&&(i.shaderSource(e,"void main() {}"),i.compileShader(e),!0===i.getShaderParameter(e,i.COMPILE_STATUS))}(e)),i[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var i={};function r(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!r(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!r(t[n],e[n]))return!1;return!0}return t===e}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class s{static testProp(t){if(!s.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in s.docStyle)return t[e];return t[0]}static create(t,e,n){const i=window.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){s.docStyle&&s.selectProp&&(s.userSelect=s.docStyle[s.selectProp],s.docStyle[s.selectProp]="none")}static enableDrag(){s.docStyle&&s.selectProp&&(s.docStyle[s.selectProp]=s.userSelect)}static setTransform(t,e){t.style[s.transformProp]=e}static addEventListener(t,e,n,i={}){t.addEventListener(e,n,"passive"in i?i:i.capture)}static removeEventListener(t,e,n,i={}){t.removeEventListener(e,n,"passive"in i?i:i.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",s.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",s.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",s.suppressClickInternal,!0)}),0)}static mousePos(e,n){const i=e.getBoundingClientRect();return new t.pointGeometry(n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop)}static touchPos(e,n){const i=e.getBoundingClientRect(),r=[];for(let s=0;s<n.length;s++)r.push(new t.pointGeometry(n[s].clientX-i.left-e.clientLeft,n[s].clientY-i.top-e.clientTop));return r}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}s.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,s.selectProp=s.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),s.transformProp=s.testProp(["transform","WebkitTransform"]);class o{constructor(t){this._transformRequestFn=t}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeSpriteURL(t,e,n){const i=function(t){const e=t.match(a);if(!e)throw new Error(`Unable to parse URL "${t}"`);return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}(t);return i.path+=`${e}${n}`,function(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}(i)}setTransformRequest(t){this._transformRequestFn=t}}const a=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function l(e){var n=new t.ARRAY_TYPE(3);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}var c,u=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t};c=new t.ARRAY_TYPE(3),t.ARRAY_TYPE!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0);var h=function(t){var e=t[0],n=t[1];return e*e+n*n};!function(){var e=new t.ARRAY_TYPE(2);t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0)}();class d{constructor(t,e,n,i){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)}update(e,n,i){const{width:r,height:s}=e,o=!(this.size&&this.size[0]===r&&this.size[1]===s||i),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(n&&n.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!n||!1!==n.premultiply)),o)this.size=[r,s],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.isImageBitmap(e)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,this.format,r,s,0,this.format,l.UNSIGNED_BYTE,e.data);else{const{x:n,y:o}=i||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.isImageBitmap(e)?l.texSubImage2D(l.TEXTURE_2D,0,n,o,l.RGBA,l.UNSIGNED_BYTE,e):l.texSubImage2D(l.TEXTURE_2D,0,n,o,r,s,l.RGBA,l.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(t,e,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function p(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class f extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(t,e){if(!t)return!0;let n=0;for(const i of t){if(i[0]<n||i[1]<i[0]||e<i[1])return!1;n=i[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let n=!0;if(!this.isLoaded())for(const i of t)this.images[i]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,n){const i={};for(const r of e){this.images[r]||this.fire(new t.Event("styleimagemissing",{id:r}));const e=this.images[r];e?i[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,i)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const n=this.patterns[e],i=this.getImage(e);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new t.ImagePosition(n,i);this.patterns[e]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[e].position}bind(t){const e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:i}=t.potpack(e),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const s in this.patterns){const{bin:e}=this.patterns[s],n=e.x+1,i=e.y+1,o=this.images[s].data,a=o.width,l=o.height;t.RGBAImage.copy(o,r,{x:0,y:0},{x:n,y:i},{width:a,height:l}),t.RGBAImage.copy(o,r,{x:0,y:l-1},{x:n,y:i-1},{width:a,height:1}),t.RGBAImage.copy(o,r,{x:0,y:0},{x:n,y:i+l},{width:a,height:1}),t.RGBAImage.copy(o,r,{x:a-1,y:0},{x:n-1,y:i},{width:1,height:l}),t.RGBAImage.copy(o,r,{x:0,y:0},{x:n+a,y:i},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];p(t)&&this.updateImage(e,t)}}}const m=1e20;function g(t,e,n,i,r,s,o,a,l){for(let c=e;c<e+i;c++)y(t,n*s+c,s,r,o,a,l);for(let c=n;c<n+r;c++)y(t,c*s+e,1,i,o,a,l)}function y(t,e,n,i,r,s,o){s[0]=0,o[0]=-m,o[1]=m,r[0]=t[e];for(let a=1,l=0,c=0;a<i;a++){r[a]=t[e+a*n];const i=a*a;do{const t=s[l];c=(r[a]-r[t]+i-t*t)/(a-t)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=m}for(let a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;const i=s[l],c=a-i;t[e+a*n]=r[i]+c*c}}class _{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(e,n){const i=[];for(const t in e)for(const n of e[t])i.push({stack:t,id:n});t.asyncAll(i,(({stack:t,id:e},n)=>{let i=this.entries[t];i||(i=this.entries[t]={glyphs:{},requests:{},ranges:{}});let r=i.glyphs[e];if(void 0!==r)return void n(null,{stack:t,id:e,glyph:r});if(r=this._tinySDF(i,t,e),r)return i.glyphs[e]=r,void n(null,{stack:t,id:e,glyph:r});const s=Math.floor(e/256);if(256*s>65535)return void n(new Error("glyphs > 65535 not supported"));if(i.ranges[s])return void n(null,{stack:t,id:e,glyph:r});let o=i.requests[s];o||(o=i.requests[s]=[],_.loadGlyphRange(t,s,this.url,this.requestManager,((t,e)=>{if(e){for(const t in e)this._doesCharSupportLocalGlyph(+t)||(i.glyphs[+t]=e[+t]);i.ranges[s]=!0}for(const n of o)n(t,e);delete i.requests[s]}))),o.push(((i,r)=>{i?n(i):r&&n(null,{stack:t,id:e,glyph:r[e]||null})}))}),((t,e)=>{if(t)n(t);else if(e){const t={};for(const{stack:n,id:i,glyph:r}of e)(t[n]||(t[n]={}))[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};n(null,t)}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(t.unicodeBlockLookup["CJK Unified Ideographs"](e)||t.unicodeBlockLookup["Hangul Syllables"](e)||t.unicodeBlockLookup.Hiragana(e)||t.unicodeBlockLookup.Katakana(e))}_tinySDF(e,n,i){const r=this.localIdeographFontFamily;if(!r)return;if(!this._doesCharSupportLocalGlyph(i))return;let s=e.tinySDF;if(!s){let t="400";/bold/i.test(n)?t="900":/medium/i.test(n)?t="500":/light/i.test(n)&&(t="200"),s=e.tinySDF=new _.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:r,fontWeight:t})}const o=s.draw(String.fromCharCode(i));return{id:i,bitmap:new t.AlphaImage({width:o.width||30,height:o.height||30},o.data),metrics:{width:o.glyphWidth||24,height:o.glyphHeight||24,left:o.glyphLeft||0,top:o.glyphTop-27||-8,advance:o.glyphAdvance||24}}}}_.loadGlyphRange=function(e,n,i,r,s){const o=256*n,a=o+255,l=r.transformRequest(i.replace("{fontstack}",e).replace("{range}",`${o}-${a}`),t.ResourceType.Glyphs);t.getArrayBuffer(l,((e,n)=>{if(e)s(e);else if(n){const e={};for(const i of t.parseGlyphPBF(n))e[i.id]=i;s(null,e)}}))},_.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:s="normal",fontStyle:o="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${o} ${s} ${t}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:s}=this.ctx.measureText(t),o=Math.ceil(n),a=Math.min(this.size-this.buffer,Math.ceil(s-r)),l=Math.min(this.size-this.buffer,o+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return p;const{ctx:f,buffer:y,gridInner:_,gridOuter:v}=this;f.clearRect(y,y,a,l),f.fillText(t,y,y+o);const x=f.getImageData(y,y,a,l);v.fill(m,0,h),_.fill(0,0,h);for(let g=0;g<l;g++)for(let t=0;t<a;t++){const e=x.data[4*(g*a+t)+3]/255;if(0===e)continue;const n=(g+y)*c+t+y;if(1===e)v[n]=0,_[n]=m;else{const t=.5-e;v[n]=t>0?t*t:0,_[n]=t<0?t*t:0}}g(v,0,0,c,u,c,this.f,this.v,this.z),g(_,y,y,a,l,c,this.f,this.v,this.z);for(let m=0;m<h;m++){const t=Math.sqrt(v[m])-Math.sqrt(_[m]);d[m]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};const v=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))}interpolate(e,n,i){return{x:t.number(e.x,n.x,i),y:t.number(e.y,n.y,i),z:t.number(e.z,n.z,i)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)}),x="-transition";class b extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(v),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(t.validateLight,e,n))for(const t in e){const n=e[t];t.endsWith(x)?this._transitionable.setTransition(t.slice(0,-x.length),n):this._transitionable.setValue(t,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,n,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class w{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]}getDashRanges(t,e,n){const i=[];let r=t.length%2==1?-t[t.length-1]*n:0,s=t[0]*n,o=!0;i.push({left:r,right:s,isDash:o,zeroLength:0===t[0]});let a=t[0];for(let l=1;l<t.length;l++){o=!o;const e=t[l];r=a*n,a+=e,s=a*n,i.push({left:r,right:s,isDash:o,zeroLength:0===e})}return i}addRoundDash(t,e,n){const i=e/2;for(let r=-n;r<=n;r++){const e=this.width*(this.nextRow+n+r);let s=0,o=t[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=t[++s]);const l=Math.abs(a-o.left),c=Math.abs(a-o.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(o.isDash){const t=i-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=i-Math.sqrt(u*u+d*d);this.data[e+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let o=t.length-1;o>=0;--o){const e=t[o],n=t[o+1];e.zeroLength?t.splice(o,1):n&&n.isDash===e.isDash&&(n.left=e.left,t.splice(o,1))}const e=t[0],n=t[t.length-1];e.isDash===n.isDash&&(e.left=n.left-this.width,n.right=e.right+this.width);const i=this.width*this.nextRow;let r=0,s=t[r];for(let o=0;o<this.width;o++){o/s.right>1&&(s=t[++r]);const e=Math.abs(o-s.left),n=Math.abs(o-s.right),a=Math.min(e,n);this.data[i+o]=Math.max(0,Math.min(255,(s.isDash?a:-a)+128))}}addDash(e,n){const i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return t.warnOnce("LineAtlas out of space"),null;let s=0;for(let t=0;t<e.length;t++)s+=e[t];if(0!==s){const t=this.width/s,r=this.getDashRanges(e,this.width,t);n?this.addRoundDash(r,t,i):this.addRegularDash(r)}const o={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:s};return this.nextRow+=r,this.dirty=!0,o}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}class S{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const i=this.workerPool.acquire(this.id);for(let t=0;t<i.length;t++){const e=new S.Actor(i[t],n,this.id);e.name=`Worker ${t}`,this.actors.push(e)}}broadcast(e,n,i){t.asyncAll(this.actors,((t,i)=>{t.send(e,n,i)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}function E(e,n,i){const r=function(n,r){if(n)return i(n);if(r){const n=t.pick(t.extend(r,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((t=>t.id))),i(null,n)}};return e.url?t.getJSON(n.transformRequest(e.url,t.ResourceType.Source),r):t.exported.frame((()=>r(null,e)))}S.Actor=t.Actor;class T{constructor(e,n,i){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),i=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),s=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),o=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=i&&e.x<s&&e.y>=r&&e.y<o}}class A extends t.Evented{constructor(e,n,i,r){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=E(this._options,this.map._requestManager,((e,n)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new T(n.bounds,this.minzoom,this.maxzoom)),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(e,n){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r={request:this.map._requestManager.transformRequest(i,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function s(i,r){return delete e.request,e.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",r,s.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,s.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class k extends t.Evented{constructor(e,n,i,r){super(),this.id=e,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=E(this._options,this.map._requestManager,((e,n)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new T(n.bounds,this.minzoom,this.maxzoom)),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,n){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),((i,r,s)=>{if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(r){this.map._refreshExpiredTiles&&e.setExpiryData(s);const i=this.map.painter.context,o=i.gl;e.texture=this.map.painter.getTileTexture(r.width),e.texture?e.texture.update(r,{useMipmap:!0}):(e.texture=new d(i,r,o.RGBA,{useMipmap:!0}),e.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),n(null)}}))}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}let P;class I extends k{constructor(e,n,i,r){super(e,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(e,n){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function r(t,i){t&&(e.state="errored",n(t)),i&&(e.dem=i,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,s){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(s){this.map._refreshExpiredTiles&&e.setExpiryData(s),delete s.cacheControl,delete s.expires;const n=t.isImageBitmap(s)&&(null==P&&(P="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),P)?s:t.exported.getImageData(s,1),i={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:n,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",i,r.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)}_getNeighboringTiles(e){const n=e.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,s=0===n.x?e.wrap-1:e.wrap,o=(n.x+1+i)%i,a=n.x+1===i?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,s,n.z,r,n.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,s,n.z,r,n.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new t.OverscaledTileID(e.overscaledZ,s,n.z,r,n.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,n.z,o,n.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class C extends t.Evented{constructor(e,n,i,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const s=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*s,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*s,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.EXTENT,radius:(n.clusterRadius||50)*s,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},i),this}_updateWorkerData(e){const n=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(t.exported.resolveURL(i),t.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(i),this._pendingLoads++,this.fire(new t.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,((i,r)=>{if(this._pendingLoads--,this._removed||r&&r.abandoned)return;let s=null;if(r&&r.resourceTiming&&r.resourceTiming[this.id]&&(s=r.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:n.source},null),i)return void this.fire(new t.ErrorEvent(i));const o={dataType:"source",sourceDataType:e};this._collectResourceTiming&&s&&s.length>0&&t.extend(o,{resourceTiming:s}),this.fire(new t.Event("data",o))}))}loaded(){return 0===this._pendingLoads}loadTile(t,e){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const i={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(n,i,((i,r)=>(delete t.request,t.unloadVectorData(),t.aborted?e(null):i?e(i):(t.loadVectorData(r,this.map.painter,"reloadTile"===n),e(null)))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var M=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class z extends t.Evented{constructor(t,e,n,i){super(),this.id=t,this.dispatcher=n,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=e}load(e,n){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),((i,r)=>{this._loaded=!0,i?this.fire(new t.ErrorEvent(i)):r&&(this.image=r,e&&(this.coordinates=e),n&&n(),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(e){this.coordinates=e;const n=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){let n=1/0,i=1/0,r=-1/0,s=-1/0;for(const t of e)n=Math.min(n,t.x),i=Math.min(i,t.y),r=Math.max(r,t.x),s=Math.max(s,t.y);const o=Math.max(r-n,s-i),a=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),l=Math.pow(2,a);return new t.CanonicalTileID(a,Math.floor((n+r)/2*l),Math.floor((i+s)/2*l))}(n),this.minzoom=this.maxzoom=this.tileID.z;const i=n.map((t=>this.tileID.getTilePoint(t)._round()));return this._boundsArray=new t.RasterBoundsArray,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class L extends z{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,t.ResourceType.Source).url);t.getVideo(this.urls,((e,n)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new d(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class D extends z{constructor(e,n,i,r){super(e,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d(n,this.canvas,i.RGBA,{premultiply:!0});for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const R={vector:A,raster:k,"raster-dem":I,geojson:C,video:L,image:z,canvas:D};function B(e,n){const i=t.create();return t.translate(i,i,[1,1,0]),t.scale(i,i,[.5*e.width,.5*e.height,1]),t.multiply(i,i,e.calculatePosMatrix(n.toUnwrapped()))}function O(t,e,n,i,r,s){const o=function(t,e,n){if(t)for(const i of t){const t=e[i];if(t&&t.source===n&&"fill-extrusion"===t.type)return!0}else for(const i in e){const t=e[i];if(t.source===n&&"fill-extrusion"===t.type)return!0}return!1}(r&&r.layers,e,t.id),a=s.maxPitchScaleFactor(),l=t.tilesIn(i,a,o);l.sort(F);const c=[];for(const h of l)c.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,n,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,r,s,a,B(t.transform,h.tileID))});const u=function(t){const e={},n={};for(const i of t){const t=i.queryResults,r=i.wrappedTileID,s=n[r]=n[r]||{};for(const n in t){const i=t[n],r=s[n]=s[n]||{},o=e[n]=e[n]||[];for(const t of i)r[t.featureIndex]||(r[t.featureIndex]=!0,o.push(t))}}return e}(c);for(const h in u)u[h].forEach((e=>{const n=e.feature,i=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}));return u}function F(t,e){const n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class V{constructor(e,n){this.tileID=e,this.uid=t.uniqueId(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<t.exported.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(e,n,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(t,e){const n={};if(!e)return n;for(const i of t){const t=i.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){i.layers=t,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)n[e.id]=i}}return n}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.SymbolBucket){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.SymbolBucket&&n.hasRTLText){this.hasRTLText=!0,t.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(t).queryRadius(e))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const n in this.buckets){const e=this.buckets[n];e.uploadPending()&&e.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,n,i,r,s,o,a,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:s,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:o,queryPadding:this.queryPadding*l},t,e,n):{}}querySourceFeatures(e,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),s=n?n.sourceLayer:"",o=r._geojsonTileLayer||r[s];if(!o)return;const a=t.createFilter(n&&n.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<o.length;d++){const n=o.feature(d);if(a.needGeometry){const e=t.toEvaluationFeature(n,!0);if(!a.filter(new t.EvaluationParameters(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.EvaluationParameters(this.tileID.overscaledZ),n))continue;const r=i.getId(n,s),p=new t.GeoJSONFeature(n,l,c,u,r);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const n=t.parseCacheControl(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(n)if(this.expirationTime<n)e=!0;else{const i=this.expirationTime-n;i?this.expirationTime=t+Math.max(i,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!e.style.hasLayer(i))continue;const r=this.buckets[i],s=r.layers[0].sourceLayer||"_geojsonTileLayer",o=n[s],a=t[s];if(!o||!a||0===Object.keys(a).length)continue;r.update(a,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=t.exported.now()+e}setDependencies(t,e){const n={};for(const i of e)n[i]=!0;this.dependencies[t]=n}hasDependency(t,e){for(const n of t){const t=this.dependencies[n];if(t)for(const n of e)if(t[n])return!0}return!1}}class N{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,n){const i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:e,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout((()=>{this.remove(t,r)}),n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const n=t.wrapped().key,i=void 0===e?0:this.data[n].indexOf(e),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const n in this.data)for(const i of this.data[n])t(i.value)||e.push(i);for(const n of e)this.remove(n.value.tileID,n)}}class U{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){const r=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},t.extend(this.stateChanges[e][r],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])i[t]||(this.deletedStates[e][r][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][t]&&delete this.deletedStates[e][r][t]}removeFeatureState(t,e,n){if(null===this.deletedStates[t])return;const i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(n in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][n]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}getState(e,n){const i=String(n),r=t.extend({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][n];if(null===t)return{};for(const e in t)delete r[e]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(e,n){const i={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const e={};for(const n in this.stateChanges[r])this.state[r][n]||(this.state[r][n]={}),t.extend(this.state[r][n],this.stateChanges[r][n]),e[n]=this.state[r][n];i[r]=e}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const e={};if(null===this.deletedStates[r])for(const t in this.state[r])e[t]={},this.state[r][t]={};else for(const t in this.deletedStates[r]){if(null===this.deletedStates[r][t])this.state[r][t]={};else for(const e of Object.keys(this.deletedStates[r][t]))delete this.state[r][t][e];e[t]=this.state[r][t]}i[r]=i[r]||{},t.extend(i[r],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const t in e)e[t].setFeatureState(i,n)}}class j extends t.Evented{constructor(e,n,i){super(),this.id=e,this.dispatcher=i,this.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=function(e,n,i,r){const s=new R[n.type](e,n,i,r);if(s.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${s.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],s),s}(e,n,i,this),this._tiles={},this._cache=new N(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new U}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,(()=>{}))}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,(()=>{})),this._source.fire(new t.Event("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(G).map((t=>t.key))}getRenderableIds(e){const n=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&n.push(this._tiles[t]);return e?n.sort(((e,n)=>{const i=e.tileID,r=n.tileID,s=new t.pointGeometry(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),o=new t.pointGeometry(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||o.y-s.y||o.x-s.x})).map((t=>t.tileID.key)):n.map((t=>t.tileID)).sort(G).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")}}_reloadTile(t,e){const n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))}_tileLoaded(e,n,i,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new t.ErrorEvent(r,{tile:e})):this.update(this.transform));e.timeAdded=t.exported.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let i=0;i<e.length;i++){const r=e[i];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);n(t,e),n(e,t)}}function n(t,e){t.needsHillshadePrepare=!0;let n=e.tileID.canonical.x-t.tileID.canonical.x;const i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),s=e.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[s]&&(t.neighboringTiles[s].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,n,i){for(const r in this._tiles){let s=this._tiles[r];if(i[r]||!s.hasData()||s.tileID.overscaledZ<=e||s.tileID.overscaledZ>n)continue;let o=s.tileID;for(;s&&s.tileID.overscaledZ>e+1;){const t=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[t.key],s&&s.hasData()&&(o=t)}let a=o;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){i[o.key]=o;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(let n=t.overscaledZ-1;n>=e;n--){const e=t.scaledTo(n),i=this._getLoadedTile(e);if(i)return i}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const e=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,i=Math.floor(e*n*5),r="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(r)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),t[i.tileID.key]=i}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}update(e){if(this.transform=e,!this._sourceLoaded||this._paused)return;let n;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter((t=>this._source.hasTile(t))))):n=[];const i=e.coveringZoomLevel(this._source),r=Math.max(i-j.maxOverzooming,this._source.minzoom),s=Math.max(i+j.maxUnderzooming,this._source.minzoom),o=this._updateRetainedTiles(n,i);if(q(this._source.type)){const e={},n={},a=Object.keys(o);for(const i of a){const s=o[i],a=this._tiles[i];if(!a||a.fadeEndTime&&a.fadeEndTime<=t.exported.now())continue;const l=this.findLoadedParent(s,r);l&&(this._addTile(l.tileID),e[l.tileID.key]=l.tileID),n[i]=s}this._retainLoadedChildren(n,i,s,o);for(const t in e)o[t]||(this._coveredTiles[t]=!0,o[t]=e[t])}for(const t in o)this._tiles[t].clearFadeHold();const a=t.keysDifference(this._tiles,o);for(const t of a){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(t)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){const n={},i={},r=Math.max(e-j.maxOverzooming,this._source.minzoom),s=Math.max(e+j.maxUnderzooming,this._source.minzoom),o={};for(const a of t){const t=this._addTile(a);n[a.key]=a,t.hasData()||e<this._source.maxzoom&&(o[a.key]=a)}this._retainLoadedChildren(o,e,s,n);for(const a of t){let t=this._tiles[a.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=a.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){n[t.key]=t;continue}}else{const t=a.children(this._source.maxzoom);if(n[t[0].key]&&n[t[1].key]&&n[t[2].key]&&n[t[3].key])continue}let s=t.wasRequested();for(let e=a.overscaledZ-1;e>=r;--e){const r=a.scaledTo(e);if(i[r.key])break;if(i[r.key]=!0,t=this.getTile(r),!t&&s&&(t=this._addTile(r)),t&&(n[r.key]=r,s=t.wasRequested(),t.hasData()))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let n,i=this._tiles[t].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}e.push(i.key);const t=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(t),n)break;i=t}for(const t of e)this._loadedParentTiles[t]=n}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const i=n;return n||(n=new V(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n.uses++,this._tiles[e.key]=n,i||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),n))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(e,n,i){const r=[],s=this.transform;if(!s)return r;const o=i?s.getCameraQueryGeometry(e):e,a=e.map((t=>s.pointCoordinate(t))),l=o.map((t=>s.pointCoordinate(t))),c=this.getIds();let u=1/0,h=1/0,d=-1/0,p=-1/0;for(const t of l)u=Math.min(u,t.x),h=Math.min(h,t.y),d=Math.max(d,t.x),p=Math.max(p,t.y);for(let f=0;f<c.length;f++){const e=this._tiles[c[f]];if(e.holdingForFade())continue;const i=e.tileID,o=Math.pow(2,s.zoom-e.tileID.overscaledZ),m=n*e.queryPadding*t.EXTENT/e.tileSize/o,g=[i.getTilePoint(new t.MercatorCoordinate(u,h)),i.getTilePoint(new t.MercatorCoordinate(d,p))];if(g[0].x-m<t.EXTENT&&g[0].y-m<t.EXTENT&&g[1].x+m>=0&&g[1].y+m>=0){const t=a.map((t=>i.getTilePoint(t))),n=l.map((t=>i.getTilePoint(t)));r.push({tile:e,tileID:i,queryGeometry:t,cameraQueryGeometry:n,scale:o})}}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));for(const n of e)n.posMatrix=this.transform.calculatePosMatrix(n.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(q(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.exported.now())return!0}return!1}setFeatureState(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)}removeFeatureState(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,n){const i=this._tiles[t];i&&i.setDependencies(e,n)}reloadTilesForDependencies(t,e){for(const n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((n=>!n.hasDependency(t,e)))}}function G(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function q(t){return"raster"===t||"image"===t||"video"===t}j.maxOverzooming=10,j.maxUnderzooming=3;const $="mapboxgl_preloaded_worker_pool";class W{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<W.workerCount;)this.workers.push(new Worker(vr.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[$]}numActive(){return Object.keys(this.active).length}}const Z=Math.floor(t.exported.hardwareConcurrency/2);let H;function X(){return H||(H=new W),H}function Y(e,n){const i={};for(const t in e)"ref"!==t&&(i[t]=e[t]);return t.refProperties.forEach((t=>{t in n&&(i[t]=n[t])})),i}function K(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Y(t[n],e[t[n].ref]));return t}W.workerCount=Math.max(Math.min(Z,6),1);const J={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Q(t,e,n){n.push({command:J.addSource,args:[t,e[t]]})}function tt(t,e,n){e.push({command:J.removeSource,args:[t]}),n[t]=!0}function et(t,e,n,i){tt(t,n,i),Q(t,e,n)}function nt(t,e,n){let i;for(i in t[n])if(Object.prototype.hasOwnProperty.call(t[n],i)&&"data"!==i&&!r(t[n][i],e[n][i]))return!1;for(i in e[n])if(Object.prototype.hasOwnProperty.call(e[n],i)&&"data"!==i&&!r(t[n][i],e[n][i]))return!1;return!0}function it(t,e,n,i,s,o){let a;for(a in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,a)&&(r(t[a],e[a])||n.push({command:o,args:[i,a,e[a],s]}));for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&!Object.prototype.hasOwnProperty.call(t,a)&&(r(t[a],e[a])||n.push({command:o,args:[i,a,e[a],s]}))}function rt(t){return t.id}function st(t,e){return t[e.id]=e,t}class ot{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let n=1,i=this._distances[n];const r=e*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const s=n-1,o=this._distances[s],a=i-o,l=a>0?(r-o)/a:0;return this.points[s].mult(1-l).add(this.points[n].mult(l))}}function at(t,e){let n=!0;return"always"===t||"never"!==t&&"never"!==e||(n=!1),n}class lt{constructor(t,e,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(let s=0;s<this.xCellCount*this.yCellCount;s++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)}_insertBoxCell(t,e,n,i,r,s){this.boxCells[r].push(s)}_insertCircleCell(t,e,n,i,r,s){this.circleCells[r].push(s)}_query(t,e,n,i,r,s,o){if(n<0||t>this.width||i<0||e>this.height)return[];const a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return[{key:null,x1:t,y1:e,x2:n,y2:i}];for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],n=this.circles[3*t+1],i=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-i,y1:n-i,x2:e+i,y2:n+i})}}else this._forEachCell(t,e,n,i,this._queryCell,a,{hitTest:r,overlapMode:s,seenUids:{box:{},circle:{}}},o);return a}query(t,e,n,i){return this._query(t,e,n,i,!1,null)}hitTest(t,e,n,i,r,s){return this._query(t,e,n,i,!0,r,s).length>0}hitTestCircle(t,e,n,i,r){const s=t-n,o=t+n,a=e-n,l=e+n;if(o<0||s>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(s,a,o,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},r),c.length>0}_queryCell(t,e,n,i,r,s,o,a){const{seenUids:l,hitTest:c,overlapMode:u}=o,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const o of h)if(!l.box[o]){l.box[o]=!0;const h=4*o,d=this.boxKeys[o];if(t<=r[h+2]&&e<=r[h+3]&&n>=r[h+0]&&i>=r[h+1]&&(!a||a(d))&&(!c||!at(u,d.overlapMode))&&(s.push({key:d,x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]}),c))return!0}}const d=this.circleCells[r];if(null!==d){const r=this.circles;for(const o of d)if(!l.circle[o]){l.circle[o]=!0;const h=3*o,d=this.circleKeys[o];if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],t,e,n,i)&&(!a||a(d))&&(!c||!at(u,d.overlapMode))){const t=r[h],e=r[h+1],n=r[h+2];if(s.push({key:d,x1:t-n,y1:e-n,x2:t+n,y2:e+n}),c)return!0}}}return!1}_queryCellCircle(t,e,n,i,r,s,o,a){const{circle:l,seenUids:c,overlapMode:u}=o,h=this.boxCells[r];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const n=4*e,i=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[n+0],t[n+1],t[n+2],t[n+3])&&(!a||a(i))&&!at(u,i.overlapMode))return s.push(!0),!0}}const d=this.circleCells[r];if(null!==d){const t=this.circles;for(const e of d)if(!c.circle[e]){c.circle[e]=!0;const n=3*e,i=this.circleKeys[e];if(this._circlesCollide(t[n],t[n+1],t[n+2],l.x,l.y,l.radius)&&(!a||a(i))&&!at(u,i.overlapMode))return s.push(!0),!0}}}_forEachCell(t,e,n,i,r,s,o,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,t,e,n,i,this.xCellCount*l+d,s,o,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,n,i,r,s){const o=i-t,a=r-e,l=n+s;return l*l>o*o+a*a}_circleAndRectCollide(t,e,n,i,r,s,o){const a=(s-i)/2,l=Math.abs(t-(i+a));if(l>a+n)return!1;const c=(o-r)/2,u=Math.abs(e-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}function ct(e,n,i,r,s){const o=t.create();return n?(t.scale(o,o,[1/s,1/s,1]),i||t.rotateZ(o,o,r.angle)):t.multiply(o,r.labelPlaneMatrix,e),o}function ut(e,n,i,r,s){if(n){const n=t.clone(e);return t.scale(n,n,[s,s,1]),i||t.rotateZ(n,n,-r.angle),n}return r.glCoordMatrix}function ht(e,n){const i=[e.x,e.y,0,1];wt(i,i,n);const r=i[3];return{point:new t.pointGeometry(i[0]/r,i[1]/r),signedDistanceFromCamera:r}}function dt(t,e){return.5+t/e*.5}function pt(t,e){const n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function ft(e,n,i,r,s,o,a,l,c){const u=r?e.textSizeData:e.iconSizeData,h=t.evaluateSizeForZoom(u,i.transform.zoom),d=[256/i.width*2+1,256/i.height*2+1],p=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();const f=e.lineVertexArray,m=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,g=i.transform.width/i.transform.height;let y=!1;for(let _=0;_<m.length;_++){const r=m.get(_);if(r.hidden||r.writingMode===t.WritingMode.vertical&&!y){bt(r.numGlyphs,p);continue}y=!1;const v=[r.anchorX,r.anchorY,0,1];if(t.transformMat4(v,v,n),!pt(v,d)){bt(r.numGlyphs,p);continue}const x=dt(i.transform.cameraToCenterDistance,v[3]),b=t.evaluateSizeForFeature(u,h,r),w=a?b/x:b*x,S=new t.pointGeometry(r.anchorX,r.anchorY),E=ht(S,s).point,T={},A=yt(r,w,!1,l,n,s,o,e.glyphOffsetArray,f,p,E,S,T,g,c);y=A.useVertical,(A.notEnoughRoom||y||A.needsFlipping&&yt(r,w,!0,l,n,s,o,e.glyphOffsetArray,f,p,E,S,T,g,c).notEnoughRoom)&&bt(r.numGlyphs,p)}r?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function mt(t,e,n,i,r,s,o,a,l,c,u,h){const d=a.glyphStartIndex+a.numGlyphs,p=a.lineStartIndex,f=a.lineStartIndex+a.lineLength,m=e.getoffsetX(a.glyphStartIndex),g=e.getoffsetX(d-1),y=vt(t*m,n,i,r,s,o,a.segment,p,f,l,c,u,h);if(!y)return null;const _=vt(t*g,n,i,r,s,o,a.segment,p,f,l,c,u,h);return _?{first:y,last:_}:null}function gt(e,n,i,r){return e===t.WritingMode.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function yt(e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){const g=n/24,y=e.lineOffsetX*g,_=e.lineOffsetY*g;let v;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,n=e.lineStartIndex,s=e.lineStartIndex+e.lineLength,u=mt(g,l,y,_,i,h,d,e,c,o,p,m);if(!u)return{notEnoughRoom:!0};const x=ht(u.first.point,a).point,b=ht(u.last.point,a).point;if(r&&!i){const t=gt(e.writingMode,x,b,f);if(t)return t}v=[u.first];for(let r=e.glyphStartIndex+1;r<t-1;r++)v.push(vt(g*l.getoffsetX(r),y,_,i,h,d,e.segment,n,s,c,o,p,m));v.push(u.last)}else{if(r&&!i){const n=ht(d,s).point,i=e.lineStartIndex+e.segment+1,r=new t.pointGeometry(c.getx(i),c.gety(i)),o=ht(r,s),a=o.signedDistanceFromCamera>0?o.point:_t(d,r,n,1,s),l=gt(e.writingMode,n,a,f);if(l)return l}const n=vt(g*l.getoffsetX(e.glyphStartIndex),y,_,i,h,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,o,p,m);if(!n)return{notEnoughRoom:!0};v=[n]}for(const x of v)t.addDynamicAttributes(u,x.point,x.angle);return{}}function _t(t,e,n,i,r){const s=ht(t.add(t.sub(e)._unit()),r).point,o=n.sub(s);return n.add(o._mult(i/o.mag()))}function vt(e,n,i,r,s,o,a,l,c,u,h,d,p){const f=r?e-n:e+n;let m=f>0?1:-1,g=0;r&&(m*=-1,g=Math.PI),m<0&&(g+=Math.PI);let y=m>0?l+a:l+a+1,_=s,v=s,x=0,b=0;const w=Math.abs(f),S=[];for(;x+b<=w;){if(y+=m,y<l||y>=c)return null;if(v=_,S.push(_),_=d[y],void 0===_){const e=new t.pointGeometry(u.getx(y),u.gety(y)),n=ht(e,h);if(n.signedDistanceFromCamera>0)_=d[y]=n.point;else{const n=y-m;_=_t(0===x?o:new t.pointGeometry(u.getx(n),u.gety(n)),e,v,w-x+1,h)}}x+=b,b=v.dist(_)}const E=(w-x)/b,T=_.sub(v),A=T.mult(E)._add(v);A._add(T._unit()._perp()._mult(i*m));const k=g+Math.atan2(_.y-v.y,_.x-v.x);return S.push(A),{point:A,angle:p?k:0,path:S}}const xt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function bt(t,e){for(let n=0;n<t;n++){const t=e.length;e.resize(t+4),e.float32.set(xt,3*t)}}function wt(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}const St=100;class Et{constructor(t,e=new lt(t.width+200,t.height+200,25),n=new lt(t.width+200,t.height+200,25)){this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+St,this.screenBottomBoundary=t.height+St,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200}placeCollisionBox(t,e,n,i,r){const s=this.projectAndGetPerspectiveRatio(i,t.anchorPointX,t.anchorPointY),o=n*s.perspectiveRatio,a=t.x1*o+s.point.x,l=t.y1*o+s.point.y,c=t.x2*o+s.point.x,u=t.y2*o+s.point.y;return!this.isInsideGrid(a,l,c,u)||"always"!==e&&this.grid.hitTest(a,l,c,u,e,r)?{box:[],offscreen:!1}:{box:[a,l,c,u],offscreen:this.isOffscreen(a,l,c,u)}}placeCollisionCircles(e,n,i,r,s,o,a,l,c,u,h,d,p){const f=[],m=new t.pointGeometry(n.anchorX,n.anchorY),g=ht(m,o),y=dt(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),_=(u?s/y:s*y)/t.ONE_EM,v=ht(m,a).point,x=mt(_,r,n.lineOffsetX*_,n.lineOffsetY*_,!1,v,m,n,i,a,{},!1);let b=!1,w=!1,S=!0;if(x){const n=.5*d*y+p,i=new t.pointGeometry(-100,-100),r=new t.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),s=new ot,o=x.first,a=x.last;let u=[];for(let t=o.path.length-1;t>=1;t--)u.push(o.path[t]);for(let t=1;t<a.path.length;t++)u.push(a.path[t]);const m=2.5*n;if(l){const t=u.map((t=>ht(t,l)));u=t.some((t=>t.signedDistanceFromCamera<=0))?[]:t.map((t=>t.point))}let g=[];if(u.length>0){const e=u[0].clone(),n=u[0].clone();for(let t=1;t<u.length;t++)e.x=Math.min(e.x,u[t].x),e.y=Math.min(e.y,u[t].y),n.x=Math.max(n.x,u[t].x),n.y=Math.max(n.y,u[t].y);g=e.x>=i.x&&n.x<=r.x&&e.y>=i.y&&n.y<=r.y?[u]:n.x<i.x||e.x>r.x||n.y<i.y||e.y>r.y?[]:t.clipLine([u],i.x,i.y,r.x,r.y)}for(const t of g){s.reset(t,.25*n);let i=0;i=s.length<=.5*n?1:Math.ceil(s.paddedLength/m)+1;for(let t=0;t<i;t++){const r=t/Math.max(i-1,1),o=s.lerp(r),a=o.x+St,l=o.y+St;f.push(a,l,n,0);const u=a-n,d=l-n,p=a+n,m=l+n;if(S=S&&this.isOffscreen(u,d,p,m),w=w||this.isInsideGrid(u,d,p,m),"always"!==e&&this.grid.hitTestCircle(a,l,n,e,h)&&(b=!0,!c))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!c&&b||!w?[]:f,offscreen:S,collisionDetected:b}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,s=-1/0,o=-1/0;for(const u of e){const e=new t.pointGeometry(u.x+St,u.y+St);i=Math.min(i,e.x),r=Math.min(r,e.y),s=Math.max(s,e.x),o=Math.max(o,e.y),n.push(e)}const a=this.grid.query(i,r,s,o).concat(this.ignoredGrid.query(i,r,s,o)),l={},c={};for(const u of a){const e=u.key;if(void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]={}),l[e.bucketInstanceId][e.featureIndex])continue;const i=[new t.pointGeometry(u.x1,u.y1),new t.pointGeometry(u.x2,u.y1),new t.pointGeometry(u.x2,u.y2),new t.pointGeometry(u.x1,u.y2)];t.polygonIntersectsPolygon(n,i)&&(l[e.bucketInstanceId][e.featureIndex]=!0,void 0===c[e.bucketInstanceId]&&(c[e.bucketInstanceId]=[]),c[e.bucketInstanceId].push(e.featureIndex))}return c}insertCollisionBox(t,e,n,i,r,s){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:s,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,n,i,r,s){const o=n?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:r,collisionGroupID:s,overlapMode:e};for(let l=0;l<t.length;l+=4)o.insertCircle(a,t[l],t[l+1],t[l+2])}projectAndGetPerspectiveRatio(e,n,i){const r=[n,i,0,1];return wt(r,r,e),{point:new t.pointGeometry((r[0]/r[3]+1)/2*this.transform.width+St,(-r[1]/r[3]+1)/2*this.transform.height+St),perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5}}isOffscreen(t,e,n,i){return n<St||t>=this.screenRightBoundary||i<St||e>this.screenBottomBoundary}isInsideGrid(t,e,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}function Tt(e,n,i){return n*(t.EXTENT/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}class At{constructor(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class kt{constructor(t,e,n,i,r){this.text=new At(t?t.text:null,e,n,r),this.icon=new At(t?t.icon:null,e,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pt{constructor(t,e,n){this.text=t,this.icon=e,this.skipFade=n}}class It{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class Ct{constructor(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class Mt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function zt(e,n,i,r,s){const{horizontalAlign:o,verticalAlign:a}=t.getAnchorAlignment(e),l=-(o-.5)*n,c=-(a-.5)*i,u=t.evaluateVariableOffset(e,r);return new t.pointGeometry(l+u[0]*s,c+u[1]*s)}function Lt(e,n,i,r,s,o){const{x1:a,x2:l,y1:c,y2:u,anchorPointX:h,anchorPointY:d}=e,p=new t.pointGeometry(n,i);return r&&p._rotate(s?o:-o),{x1:a+p.x,y1:c+p.y,x2:l+p.x,y2:u+p.y,anchorPointX:h,anchorPointY:d}}class Dt{constructor(t,e,n,i){this.transform=t.clone(),this.collisionIndex=new Et(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new Mt(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,i,r){const s=i.getBucket(n),o=i.latestFeatureIndex;if(!s||!o||n.id!==s.layerIds[0])return;const a=i.collisionBoxArray,l=s.layers[0].layout,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),f=Tt(i,1,this.transform.zoom),m=ct(h,d,p,this.transform,f);let g=null;if(d){const e=ut(h,d,p,this.transform,f);g=t.multiply([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[s.bucketInstanceId]=new Ct(s.bucketInstanceId,o,s.sourceLayerIndex,s.index,i.tileID);const y={bucket:s,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(s.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(s.sourceID)};if(r)for(const t of s.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=t;e.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:y})}attemptAnchorPlacement(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f){const m=[h.textOffset0,h.textOffset1],g=zt(t,n,i,m,r),y=this.collisionIndex.placeCollisionBox(Lt(e,g.x,g.y,s,o,this.transform.angle),u,a,l,c.predicate);if((!f||0!==this.collisionIndex.placeCollisionBox(Lt(f,g.x,g.y,s,o,this.transform.angle),u,a,l,c.predicate).box.length)&&y.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(e=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:n,height:i,anchor:t,textBoxScale:r,prevAnchor:e},this.markUsedJustification(d,t,h,p),d.allowVerticalPlacement&&(this.markUsedOrientation(d,p,h),this.placedOrientations[h.crossTileID]=p),{shift:g,placedGlyphBoxes:y}}}placeLayerBucketPart(e,n,i){const{bucket:r,layout:s,posMatrix:o,textLabelPlaneMatrix:a,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:u,collisionBoxArray:h,partiallyEvaluatedTextSize:d,collisionGroup:p}=e.parameters,f=s.get("text-optional"),m=s.get("icon-optional"),g=t.getOverlapMode(s,"text-overlap","text-allow-overlap"),y="always"===g,_=t.getOverlapMode(s,"icon-overlap","icon-allow-overlap"),v="always"===_,x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order"),E=y&&(v||!r.hasIconData()||m),T=v&&(y||!r.hasTextData()||f);!r.collisionArrays&&h&&r.deserializeCollisionBoxes(h);const A=(e,h)=>{if(n[e.crossTileID])return;if(u)return void(this.placements[e.crossTileID]=new Pt(!1,!1,!1));let v=!1,S=!1,A=!0,k=null,P={box:null,offscreen:null},I={box:null,offscreen:null},C=null,M=null,z=null,L=0,D=0,R=0;h.textFeatureIndex?L=h.textFeatureIndex:e.useRuntimeCollisionCircles&&(L=e.featureIndex),h.verticalTextFeatureIndex&&(D=h.verticalTextFeatureIndex);const B=h.textBox;if(B){const n=n=>{let i=t.WritingMode.horizontal;if(r.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,i=t,this.markUsedOrientation(r,i,e))}return i},i=(n,i)=>{if(r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&h.verticalTextBox){for(const e of r.writingModes)if(e===t.WritingMode.vertical?(P=i(),I=P):P=n(),P&&P.box&&P.box.length)break}else P=n()};if(s.get("text-variable-anchor")){let a=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[e.crossTileID]){const t=this.prevPlacement.variableOffsets[e.crossTileID];a.indexOf(t.anchor)>0&&(a=a.filter((e=>e!==t.anchor)),a.unshift(t.anchor))}const l=(t,n,i)=>{const s=t.x2-t.x1,l=t.y2-t.y1,u=e.textBoxScale,h=w&&"never"===_?n:null;let d={box:[],offscreen:!1};const f="never"!==g?2*a.length:a.length;for(let m=0;m<f;++m){const n=this.attemptAnchorPlacement(a[m%a.length],t,s,l,u,x,b,c,o,p,m>=a.length?g:"never",e,r,i,h);if(n&&(d=n.placedGlyphBoxes,d&&d.box&&d.box.length)){v=!0,k=n.shift;break}}return d};i((()=>l(B,h.iconBox,t.WritingMode.horizontal)),(()=>{const n=h.verticalTextBox;return r.allowVerticalPlacement&&!(P&&P.box&&P.box.length)&&e.numVerticalGlyphVertices>0&&n?l(n,h.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),P&&(v=P.box,A=P.offscreen);const u=n(P&&P.box);if(!v&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(r,t.anchor,e,u))}}else{const s=(t,n)=>{const i=this.collisionIndex.placeCollisionBox(t,g,c,o,p.predicate);return i&&i.box&&i.box.length&&(this.markUsedOrientation(r,n,e),this.placedOrientations[e.crossTileID]=n),i};i((()=>s(B,t.WritingMode.horizontal)),(()=>{const n=h.verticalTextBox;return r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?s(n,t.WritingMode.vertical):{box:null,offscreen:null}})),n(P&&P.box&&P.box.length)}}if(C=P,v=C&&C.box&&C.box.length>0,A=C&&C.offscreen,e.useRuntimeCollisionCircles){const n=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),c=t.evaluateSizeForFeature(r.textSizeData,d,n),u=s.get("text-padding");M=this.collisionIndex.placeCollisionCircles(g,n,r.lineVertexArray,r.glyphOffsetArray,c,o,a,l,i,b,p.predicate,e.collisionCircleDiameter,u),v=y||M.circles.length>0&&!M.collisionDetected,A=A&&M.offscreen}if(h.iconFeatureIndex&&(R=h.iconFeatureIndex),h.iconBox){const t=t=>{const e=w&&k?Lt(t,k.x,k.y,x,b,this.transform.angle):t;return this.collisionIndex.placeCollisionBox(e,_,c,o,p.predicate)};I&&I.box&&I.box.length&&h.verticalIconBox?(z=t(h.verticalIconBox),S=z.box.length>0):(z=t(h.iconBox),S=z.box.length>0),A=A&&z.offscreen}const O=f||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,F=m||0===e.numIconVertices;if(O||F?F?O||(S=S&&v):v=S&&v:S=v=S&&v,v&&C&&C.box&&this.collisionIndex.insertCollisionBox(C.box,g,s.get("text-ignore-placement"),r.bucketInstanceId,I&&I.box&&D?D:L,p.ID),S&&z&&this.collisionIndex.insertCollisionBox(z.box,_,s.get("icon-ignore-placement"),r.bucketInstanceId,R,p.ID),M&&(v&&this.collisionIndex.insertCollisionCircles(M.circles,g,s.get("text-ignore-placement"),r.bucketInstanceId,L,p.ID),i)){const t=r.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new It);for(let n=0;n<M.circles.length;n+=4)e.circles.push(M.circles[n+0]),e.circles.push(M.circles[n+1]),e.circles.push(M.circles[n+2]),e.circles.push(M.collisionDetected?1:0)}this.placements[e.crossTileID]=new Pt(v||E,S||T,A||r.justReloaded),n[e.crossTileID]=!0};if(S){const t=r.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];A(r.symbolInstances.get(n),r.collisionArrays[n])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)A(r.symbolInstances.get(t),r.collisionArrays[t]);if(i&&r.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[r.bucketInstanceId];t.invert(e.invProjMatrix,o),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}markUsedJustification(e,n,i,r){let s;s=r===t.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];const o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const t of o)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=s>=0&&t!==s?0:i.crossTileID)}markUsedOrientation(e,n,i){const r=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,s=n===t.WritingMode.vertical?n:0,o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const t of o)e.text.placedSymbolArray.get(t).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=s)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const i=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},s=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(const a in this.placements){const t=this.placements[a],e=r[a];e?(this.opacities[a]=new kt(e,i,t.text,t.icon),n=n||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[a]=new kt(null,i,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const a in r){const t=r[a];if(!this.opacities[a]){const e=new kt(t,i,!1,!1);e.isHidden()||(this.opacities[a]=e,n=n||t.text.placed||t.icon.placed)}}for(const a in s)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=s[a]);for(const a in o)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=o[a]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const n={};for(const i of e){const e=i.getBucket(t);e&&i.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,n,i.collisionBoxArray)}}updateBucketOpacities(e,n,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const r=e.layers[0].layout,s=new kt(null,0,!1,!1,!0),o=r.get("text-allow-overlap"),a=r.get("icon-allow-overlap"),l=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),u="map"===r.get("text-pitch-alignment"),h="none"!==r.get("icon-text-fit"),d=new kt(null,0,o&&(a||!e.hasIconData()||r.get("icon-optional")),a&&(o||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const p=(t,e,n)=>{for(let i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(n)};for(let f=0;f<e.symbolInstances.length;f++){const i=e.symbolInstances.get(f),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:o,crossTileID:a}=i;let m=this.opacities[a];n[a]?m=s:m||(m=d,this.opacities[a]=m),n[a]=!0;const g=i.numIconVertices>0,y=this.placedOrientations[i.crossTileID],_=y===t.WritingMode.vertical,v=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(r>0||o>0){const t=Gt(m.text);p(e.text,r,_?qt:t),p(e.text,o,v?qt:t);const n=m.text.isHidden();[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=n||_?1:0)})),i.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).hidden=n||v?1:0);const s=this.variableOffsets[i.crossTileID];s&&this.markUsedJustification(e,s.anchor,i,y);const a=this.placedOrientations[i.crossTileID];a&&(this.markUsedJustification(e,"left",i,a),this.markUsedOrientation(e,a,i))}if(g){const t=Gt(m.icon),n=!(h&&i.verticalPlacedIconSymbolIndex&&_);i.placedIconSymbolIndex>=0&&(p(e.icon,i.numIconVertices,n?t:qt),e.icon.placedSymbolArray.get(i.placedIconSymbolIndex).hidden=m.icon.isHidden()),i.verticalPlacedIconSymbolIndex>=0&&(p(e.icon,i.numVerticalIconVertices,n?qt:t),e.icon.placedSymbolArray.get(i.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const n=e.collisionArrays[f];if(n){let i=new t.pointGeometry(0,0);if(n.textBox||n.verticalTextBox){let t=!0;if(l){const e=this.variableOffsets[a];e?(i=zt(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),c&&i._rotate(u?this.transform.angle:-this.transform.angle)):t=!1}n.textBox&&Rt(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||_,i.x,i.y),n.verticalTextBox&&Rt(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||v,i.x,i.y)}const r=Boolean(!v&&n.verticalIconBox);n.iconBox&&Rt(e.iconCollisionBox.collisionVertexArray,m.icon.placed,r,h?i.x:0,h?i.y:0),n.verticalIconBox&&Rt(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!r,h?i.x:0,h?i.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t}setStale(){this.stale=!0}}function Rt(t,e,n,i,r){t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0)}const Bt=Math.pow(2,25),Ot=Math.pow(2,24),Ft=Math.pow(2,17),Vt=Math.pow(2,16),Nt=Math.pow(2,9),Ut=Math.pow(2,8),jt=Math.pow(2,1);function Gt(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Bt+e*Ot+n*Ft+e*Vt+n*Nt+e*Ut+n*jt+e}const qt=0;class $t{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,n,i,r){const s=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(s,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<s.length;)if(e.placeLayerBucketPart(s[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1}}class Wt{constructor(t,e,n,i,r,s,o){this.placement=new Dt(t,r,s,o),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,n,i){const r=t.exported.now(),s=()=>{const e=t.exported.now()-r;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=n[e[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=r)&&(!t.maxzoom||t.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new $t(t)),this._inProgressLayer.continuePlacement(i[t.source],this.placement,this._showCollisionBoxes,t,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Zt=512/t.EXTENT/2;class Ht{constructor(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(let i=0;i<e.length;i++){const n=e.get(i),r=n.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}}getScaledCoordinates(e,n){const i=Zt/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*i),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*i)}}findMatches(t,e,n){const i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const s=t.get(r);if(s.crossTileID)continue;const o=this.indexedSymbolInstances[s.key];if(!o)continue;const a=this.getScaledCoordinates(s,e);for(const t of o)if(Math.abs(t.coord.x-a.x)<=i&&Math.abs(t.coord.y-a.y)<=i&&!n[t.crossTileID]){n[t.crossTileID]=!0,s.crossTileID=t.crossTileID;break}}}}class Xt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const n in this.indexes){const t=this.indexes[n],i={};for(const n in t){const r=t[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=t}addBucket(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const i=this.usedCrossTileIDs[t.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>t.overscaledZ)for(const r in n){const s=n[r];s.tileID.isChildOf(t)&&s.findMatches(e.symbolInstances,t,i)}else{const s=n[t.scaledTo(Number(r)).key];s&&s.findMatches(e.symbolInstances,t,i)}}for(let r=0;r<e.symbolInstances.length;r++){const t=e.symbolInstances.get(r);t.crossTileID||(t.crossTileID=n.generate(),i[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ht(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const n in e.indexedSymbolInstances)for(const i of e.indexedSymbolInstances[n])delete this.usedCrossTileIDs[t][i.crossTileID]}removeStaleBuckets(t){let e=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e}}class Kt{constructor(){this.layerIndexes={},this.crossTileIDs=new Xt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,n){let i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Yt);let r=!1;const s={};i.handleWrapJump(n);for(const o of e){const e=o.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(o.tileID,e,this.crossTileIDs)&&(r=!0),s[e.bucketInstanceId]=!0)}return i.removeStaleBuckets(s)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const n in this.layerIndexes)e[n]||delete this.layerIndexes[n]}}const Jt=(e,n)=>t.emitValidationErrors(e,n&&n.filter((t=>"source.canvas"!==t.identifier))),Qt=t.pick(J,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),te=t.pick(J,["setCenter","setZoom","setBearing","setPitch"]),ee=function(){const e={},n=t.spec.$version;for(const i in t.spec.$root){const r=t.spec.$root[i];if(r.required){let t=null;t="version"===i?n:"array"===r.type?[]:{},null!=t&&(e[i]=t)}}return e}();class ne extends t.Evented{constructor(e,n={}){super(),this.map=e,this.dispatcher=new S(X(),this),this.imageManager=new f,this.imageManager.setEventedParent(this),this.glyphManager=new _(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new w(256,512),this.crossTileSymbolIndex=new Kt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const i=this;this._rtlTextPluginCallback=ne.registerForPluginStateChange((e=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,n)=>{if(t.triggerPluginCompletionEvent(e),n&&n.every((t=>t)))for(const t in i.sourceCaches)i.sourceCaches[t].reload()}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const n=e.getSource();if(n&&n.vectorLayerIds)for(const i in this._layers){const t=this._layers[i];t.source===n.id&&this._validateLayer(t)}}))}loadURL(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const i="boolean"!=typeof n.validate||n.validate,r=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(r,((e,n)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):n&&this._load(n,i)}))}loadJSON(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame((()=>{this._request=null,this._load(e,!1!==n.validate)}))}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(ee,!1)}_load(e,n){if(n&&Jt(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e;for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);const i=K(this.stylesheet.layers);this._order=i.map((t=>t.id)),this._layers={},this._serializedLayers={};for(let r of i)r=t.createStyleLayer(r),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new b(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}_loadSprite(e){this._spriteRequest=function(e,n,i,r){let s,o,a;const l=i>1?"@2x":"";let c=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,l,".json"),t.ResourceType.SpriteJSON),((t,e)=>{c=null,a||(a=t,s=e,h())})),u=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,l,".png"),t.ResourceType.SpriteImage),((t,e)=>{u=null,a||(a=t,o=e,h())}));function h(){if(a)r(a);else if(s&&o){const e=t.exported.getImageData(o),n={};for(const i in s){const{width:r,height:o,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=s[i],f=new t.RGBAImage({width:r,height:o});t.RGBAImage.copy(e,f,{x:a,y:l},{x:0,y:0},{width:r,height:o}),n[i]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}r(null,n)}}return{cancel(){c&&(c.cancel(),c=null),u&&(u.cancel(),u=null)}}}(e,this.map._requestManager,this.map.getPixelRatio(),((e,n)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(n)for(const t in n)this.imageManager.addImage(t,n[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const i=e.sourceLayer;if(!i)return;const r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${i}" does not exist on source "${r.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const n of t){const t=this._layers[n];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const i in this._updatedPaintProps)this._layers[i].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const i={};for(const t in this.sourceCaches){const e=this.sourceCaches[t];i[t]=e.used,e.used=!1}for(const t of this._order){const n=this._layers[t];n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)&&n.source&&(this.sourceCaches[n.source].used=!0)}for(const r in i){const e=this.sourceCaches[r];i[r]!==e.used&&e.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:r}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),Jt(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=K(e.layers);const n=function(t,e){if(!t)return[{command:J.setStyle,args:[e]}];let n=[];try{if(!r(t.version,e.version))return[{command:J.setStyle,args:[e]}];r(t.center,e.center)||n.push({command:J.setCenter,args:[e.center]}),r(t.zoom,e.zoom)||n.push({command:J.setZoom,args:[e.zoom]}),r(t.bearing,e.bearing)||n.push({command:J.setBearing,args:[e.bearing]}),r(t.pitch,e.pitch)||n.push({command:J.setPitch,args:[e.pitch]}),r(t.sprite,e.sprite)||n.push({command:J.setSprite,args:[e.sprite]}),r(t.glyphs,e.glyphs)||n.push({command:J.setGlyphs,args:[e.glyphs]}),r(t.transition,e.transition)||n.push({command:J.setTransition,args:[e.transition]}),r(t.light,e.light)||n.push({command:J.setLight,args:[e.light]});const i={},s=[];!function(t,e,n,i){let s;for(s in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,s)&&(Object.prototype.hasOwnProperty.call(e,s)||tt(s,n,i));for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(Object.prototype.hasOwnProperty.call(t,s)?r(t[s],e[s])||("geojson"===t[s].type&&"geojson"===e[s].type&&nt(t,e,s)?n.push({command:J.setGeoJSONSourceData,args:[s,e[s].data]}):et(s,e,n,i)):Q(s,e,n))}(t.sources,e.sources,s,i);const o=[];t.layers&&t.layers.forEach((t=>{i[t.source]?n.push({command:J.removeLayer,args:[t.id]}):o.push(t)})),n=n.concat(s),function(t,e,n){e=e||[];const i=(t=t||[]).map(rt),s=e.map(rt),o=t.reduce(st,{}),a=e.reduce(st,{}),l=i.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<i.length;u++)d=i[u],Object.prototype.hasOwnProperty.call(a,d)?h++:(n.push({command:J.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<s.length;u++)d=s[s.length-1-u],l[l.length-1-u]!==d&&(Object.prototype.hasOwnProperty.call(o,d)?(n.push({command:J.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:J.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<s.length;u++)if(d=s[u],p=o[d],f=a[d],!c[d]&&!r(p,f))if(r(p.source,f.source)&&r(p["source-layer"],f["source-layer"])&&r(p.type,f.type)){for(g in it(p.layout,f.layout,n,d,null,J.setLayoutProperty),it(p.paint,f.paint,n,d,null,J.setPaintProperty),r(p.filter,f.filter)||n.push({command:J.setFilter,args:[d,f.filter]}),r(p.minzoom,f.minzoom)&&r(p.maxzoom,f.maxzoom)||n.push({command:J.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)Object.prototype.hasOwnProperty.call(p,g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?it(p[g],f[g],n,d,g.slice(6),J.setPaintProperty):r(p[g],f[g])||n.push({command:J.setLayerProperty,args:[d,g,f[g]]}));for(g in f)Object.prototype.hasOwnProperty.call(f,g)&&!Object.prototype.hasOwnProperty.call(p,g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?it(p[g],f[g],n,d,g.slice(6),J.setPaintProperty):r(p[g],f[g])||n.push({command:J.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:J.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:J.addLayer,args:[f,m]})}(o,e.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:J.setStyle,args:[e]}]}return n}(this.serialize(),e).filter((t=>!(t.command in te)));if(0===n.length)return!1;const i=n.filter((t=>!(t.command in Qt)));if(i.length>0)throw new Error(`Unimplemented: ${i.map((t=>t.command)).join(", ")}.`);return n.forEach((t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)})),this.stylesheet=e,!0}addImage(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,i={}){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=this.sourceCaches[e]=new j(e,n,this.dispatcher);r.style=this,r.setEventedParent(this,(()=>({isSourceLoaded:this.loaded(),source:r.serialize(),sourceId:e}))),r.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(e,n,i={}){this._checkLoaded();const r=e.id;if(this.getLayer(r))return void this.fire(new t.ErrorEvent(new Error(`Layer "${r}" already exists on this map.`)));let s;if("custom"===e.type){if(Jt(this,t.validateCustomStyleLayer(e)))return;s=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,`layers.${r}`,e,{arrayIndex:-1},i))return;s=t.createStyleLayer(e),this._validateLayer(s),s.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[s.id]=s.serialize()}const o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)this.fire(new t.ErrorEvent(new Error(`Cannot add layer "${r}" before non-existing layer "${n}".`)));else{if(this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=s,this._removedLayers[r]&&s.source&&"custom"!==s.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==s.type?this._updatedSources[s.source]="clear":(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const i=this._order.indexOf(e);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new t.ErrorEvent(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.ErrorEvent(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(e,n,i){this._checkLoaded();const r=this.getLayer(e);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,i={}){this._checkLoaded();const s=this.getLayer(e);if(s){if(!r(s.filter,n))return null==n?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(t.validateStyle.filter,`layers.${s.id}.filter`,n,null,i)||(s.filter=t.clone$1(n),this._updateLayer(s)))}else this.fire(new t.ErrorEvent(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,n,i,s={}){this._checkLoaded();const o=this.getLayer(e);o?r(o.getLayoutProperty(n),i)||(o.setLayoutProperty(n,i,s),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const i=this.getLayer(e);if(i)return i.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,i,s={}){this._checkLoaded();const o=this.getLayer(e);o?r(o.getPaintProperty(n),i)||(o.setPaintProperty(n,i,s)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(e,n){this._checkLoaded();const i=e.source,r=e.sourceLayer,s=this.sourceCaches[i];if(void 0===s)return void this.fire(new t.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const o=s.getSource().type;"geojson"===o&&r?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||r?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),s.setFeatureState(r,e.id,n)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const i=e.source,r=this.sourceCaches[i];if(void 0===r)return void this.fire(new t.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const s=r.getSource().type,o="vector"===s?e.sourceLayer:void 0;"vector"!==s||o?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(o,e.id,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,i=e.sourceLayer,r=this.sourceCaches[n];if(void 0!==r)return"vector"!==r.getSource().type||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),r.getFeatureState(i,e.id)):void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(t=>t.serialize())),layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,n={},i=[];for(let s=this._order.length-1;s>=0;s--){const r=this._order[s];if(e(r)){n[r]=s;for(const e of t){const t=e[r];if(t)for(const e of t)i.push(e)}}}i.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const r=[];for(let s=this._order.length-1;s>=0;s--){const o=this._order[s];if(e(o))for(let t=i.length-1;t>=0;t--){const e=i[t].feature;if(n[e.layer.id]<s)break;r.push(e),i.pop()}else for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[n.source]=!0}}const s=[];n.availableImages=this._availableImages;for(const t in this.sourceCaches)n.layers&&!r[t]||s.push(O(this.sourceCaches[t],this._layers,this._serializedLayers,e,n,i));return this.placement&&s.push(function(t,e,n,i,r,s,o){const a={},l=s.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(o[u]);c.sort(F);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],e,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],i=n[t];i.sort(((t,e)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of i)e.push(t)}}for(const u in a)a[u].forEach((e=>{const i=e.feature,r=n[t[u].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return a}(this._layers,this._serializedLayers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(s)}querySourceFeatures(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this.sourceCaches[e];return i?function(t,e){const n=t.getRenderableIds().map((e=>t.getTileByID(e))),i=[],r={};for(let s=0;s<n.length;s++){const t=n[s],o=t.tileID.canonical.key;r[o]||(r[o]=!0,t.querySourceFeatures(i,e))}return i}(i,n):[]}addSourceType(t,e,n){return ne.getSourceType(t)?n(new Error(`A source type called "${t}" already exists.`)):(ne.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const i=this.light.getLight();let s=!1;for(const t in e)if(!r(e[t],i[t])){s=!0;break}if(!s)return;const o={now:t.exported.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(o)}_validate(e,n,i,r,s={}){return(!s||!1!==s.validate)&&Jt(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:i,styleSpec:t.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const e=this.sourceCaches[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(e,n,i,r,s=!1){let o=!1,a=!1;const l={};for(const t of this._order){const n=this._layers[t];if("symbol"!==n.type)continue;if(!l[n.source]){const t=this.sourceCaches[n.source];l[n.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const i=this.crossTileSymbolIndex.addLayer(n,l[n.source],e.center.lng);o=o||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((s=s||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),e.zoom))&&(this.pauseablePlacement=new Wt(e,this._order,s,n,i,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();const i=this.sourceCaches[e.source];i&&i.setDependencies(e.tileID.key,e.type,e.icons)}getGlyphs(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)}getResource(e,n,i){return t.makeRequest(n,i)}}ne.getSourceType=function(t){return R[t]},ne.setSourceType=function(t,e){R[t]=e},ne.registerForPluginStateChange=t.registerForPluginStateChange;var ie=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),re={prelude:se("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),background:se("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:se("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:se("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:se("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:se("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:se("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:se("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:se("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:se("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:se("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:se("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:se("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:se("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:se("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:se("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:se("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:se("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:se("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),lineGradient:se("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),linePattern:se("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:se("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:se("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:se("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),symbolSDF:se("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:se("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}")};function se(t,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=e.match(/attribute ([\w]+) ([\w]+)/g),r=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=s?s.concat(r):r,a={};return{fragmentSource:t=t.replace(n,((t,e,n,i,r)=>(a[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = u_${r};\n#endif\n`))),vertexSource:e=e.replace(n,((t,e,n,i,r)=>{const s="float"===i?"vec2":"vec4",o=r.match(/color/)?"color":s;return a[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${s} a_${r};\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${o}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${s} a_${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = unpack_mix_${o}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`})),staticAttributes:i,staticUniforms:o}}class oe{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,n,i,r,s,o,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==i.length;for(let c=0;!l&&c<i.length;c++)this.boundPaintVertexBuffers[c]!==i[c]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===s&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===a?(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind()):this.freshBind(e,n,i,r,s,o,a)}freshBind(t,e,n,i,r,s,o){let a;const l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=s,this.boundDynamicVertexBuffer2=o;else{a=c.currentNumAttributes||0;for(let t=l;t<a;t++)u.disableVertexAttribArray(t)}e.enableAttributes(u,t);for(const h of n)h.enableAttributes(u,t);s&&s.enableAttributes(u,t),o&&o.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(const h of n)h.bind(),h.setVertexAttribPointers(u,t,r);s&&(s.bind(),s.setVertexAttribPointers(u,t,r)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ae(t){const e=[];for(let n=0;n<t.length;n++){if(null===t[n])continue;const i=t[n].split(" ");e.push(i.pop())}return e}class le{constructor(t,e,n,i,r,s){const o=t.gl;this.program=o.createProgram();const a=ae(n.staticAttributes),l=i?i.getBinderAttributes():[],c=a.concat(l),u=n.staticUniforms?ae(n.staticUniforms):[],h=i?i.getBinderUniforms():[],d=u.concat(h),p=[];for(const x of d)p.indexOf(x)<0&&p.push(x);const f=i?i.defines():[];s&&f.push("#define OVERDRAW_INSPECTOR;");const m=f.concat(re.prelude.fragmentSource,n.fragmentSource).join("\n"),g=f.concat(re.prelude.vertexSource,n.vertexSource).join("\n"),y=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())return void(this.failedToCreate=!0);o.shaderSource(y,m),o.compileShader(y),o.attachShader(this.program,y);const _=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())return void(this.failedToCreate=!0);o.shaderSource(_,g),o.compileShader(_),o.attachShader(this.program,_),this.attributes={};const v={};this.numAttributes=c.length;for(let x=0;x<this.numAttributes;x++)c[x]&&(o.bindAttribLocation(this.program,x,c[x]),this.attributes[c[x]]=x);o.linkProgram(this.program),o.deleteShader(_),o.deleteShader(y);for(let x=0;x<p.length;x++){const t=p[x];if(t&&!v[t]){const e=o.getUniformLocation(this.program,t);e&&(v[t]=e)}}this.fixedUniforms=r(t,v),this.binderUniforms=i?i.getUniforms(t,v):[]}draw(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){const g=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(i),t.setColorMode(r),t.setCullFace(s);for(const _ in this.fixedUniforms)this.fixedUniforms[_].set(o[_]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:d});const y={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[e];for(const _ of u.get()){const n=_.vaos||(_.vaos={});(n[a]||(n[a]=new oe)).bind(t,this,l,p?p.getPaintVertexBuffers():[],c,_.vertexOffset,f,m),g.drawElements(e,_.primitiveLength*y,g.UNSIGNED_SHORT,_.primitiveOffset*y*2)}}}function ce(t,e,n){const i=1/Tt(n,1,e.transform.tileZoom),r=Math.pow(2,n.tileID.overscaledZ),s=n.tileSize*Math.pow(2,e.transform.tileZoom)/r,o=s*(n.tileID.canonical.x+n.tileID.wrap*r),a=s*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[i,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[o>>16,a>>16],u_pixel_coord_lower:[65535&o,65535&a]}}const ue=(e,n,i,r)=>{const s=n.style.light,o=s.properties.get("position"),a=[o.x,o.y,o.z],l=function(){var e=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();"viewport"===s.properties.get("anchor")&&function(t,e){var n=Math.sin(e),i=Math.cos(e);t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(l,-n.transform.angle),function(t,e,n){var i=e[0],r=e[1],s=e[2];t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8]}(a,a,l);const c=s.properties.get("color");return{u_matrix:e,u_lightpos:a,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+i,u_opacity:r}},he=(e,n,i,r,s,o,a)=>t.extend(ue(e,n,i,r),ce(o,n,a),{u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8}),de=t=>({u_matrix:t}),pe=(e,n,i,r)=>t.extend(de(e),ce(i,n,r)),fe=(t,e)=>({u_matrix:t,u_world:e}),me=(e,n,i,r,s)=>t.extend(pe(e,n,i,r),{u_world:s}),ge=(t,e,n,i)=>{const r=t.transform;let s,o;if("map"===i.paint.get("circle-pitch-alignment")){const t=Tt(n,1,r.zoom);s=!0,o=[t,t]}else s=!1,o=r.pixelsToGLUnits;return{u_camera_to_center_distance:r.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,n,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+s,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:o}},ye=(t,e,n)=>{const i=Tt(n,1,e.zoom),r=Math.pow(2,e.zoom-n.tileID.overscaledZ),s=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:i,u_extrude_scale:[e.pixelsToGLUnits[0]/(i*r),e.pixelsToGLUnits[1]/(i*r)],u_overscale_factor:s}},_e=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),ve=t=>({u_matrix:t}),xe=(t,e,n,i)=>({u_matrix:t,u_extrude_scale:Tt(e,1,n),u_intensity:i});function be(e,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new t.MercatorCoordinate(0,r/i).toLngLat().lat,new t.MercatorCoordinate(0,(r+1)/i).toLngLat().lat]}const we=(t,e,n)=>{const i=t.transform;return{u_matrix:ke(t,e,n),u_ratio:1/Tt(e,1,i.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Se=(e,n,i,r)=>t.extend(we(e,n,i),{u_image:0,u_image_height:r}),Ee=(t,e,n,i)=>{const r=t.transform,s=Ae(e,r);return{u_matrix:ke(t,e,n),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Tt(e,1,r.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[s,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},Te=(e,n,i,r,s)=>{const o=e.lineAtlas,a=Ae(n,e.transform),l="round"===i.layout.get("line-cap"),c=o.getDash(r.from,l),u=o.getDash(r.to,l),h=c.width*s.fromScale,d=u.width*s.toScale;return t.extend(we(e,n,i),{u_patternscale_a:[a/h,-c.height/2],u_patternscale_b:[a/d,-u.height/2],u_sdfgamma:o.width/(256*Math.min(h,d)*e.pixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:u.y,u_mix:s.t})};function Ae(t,e){return 1/Tt(t,1,e.tileZoom)}function ke(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Pe=(t,e,n,i,r)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(o=r.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(s=r.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Ie(r.paint.get("raster-hue-rotate"))};var s,o};function Ie(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Ce=(t,e,n,i,r,s,o,a,l,c)=>{const u=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:u.width/u.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:o,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_texture:0}},Me=(e,n,i,r,s,o,a,l,c,u,h)=>{const d=s.transform;return t.extend(Ce(e,n,i,r,s,o,a,l,c,u),{u_gamma_scale:r?Math.cos(d._pitch)*d.cameraToCenterDistance:1,u_device_pixel_ratio:s.pixelRatio,u_is_halo:+h})},ze=(e,n,i,r,s,o,a,l,c,u)=>t.extend(Me(e,n,i,r,s,o,a,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),Le=(t,e,n)=>({u_matrix:t,u_opacity:e,u_color:n}),De=(e,n,i,r,s,o)=>t.extend(function(t,e,n,i){const r=n.imageManager.getPattern(t.from.toString()),s=n.imageManager.getPattern(t.to.toString()),{width:o,height:a}=n.imageManager.getPixelSize(),l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(i.tileID.canonical.x+i.tileID.wrap*l),h=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:s.tl,u_pattern_br_b:s.br,u_texsize:[o,a],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:s.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/Tt(i,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,o,i,s),{u_matrix:e,u_opacity:n}),Re={fillExtrusion:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}),fillExtrusionPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}),fill:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),fillPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),fillOutline:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}),fillOutlinePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),circle:(e,n)=>({u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),collisionBox:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}),collisionCircle:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}),clippingMask:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),heatmap:(e,n)=>({u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),heatmapTexture:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}),hillshade:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}),hillshadePrepare:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}),line:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}),lineGradient:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}),linePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),lineSDF:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}),raster:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),background:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}),backgroundPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)})};class Be{constructor(t,e,n){this.context=t;const i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fe{constructor(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let n=0;n<this.attributes.length;n++){const i=e.attributes[this.attributes[n].name];void 0!==i&&t.enableVertexAttribArray(i)}}setVertexAttribPointers(t,e,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],s=e.attributes[r.name];void 0!==s&&t.vertexAttribPointer(s,r.components,t[Oe[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ve{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ne extends Ve{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ue extends Ve{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class je extends Ve{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ge extends Ve{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class qe extends Ve{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class $e extends Ve{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class We extends Ve{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ze extends Ve{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class He extends Ve{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class Xe extends Ve{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ye extends Ve{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ke extends Ve{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Je extends Ve{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class Qe extends Ve{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class tn extends Ve{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class en extends Ve{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class nn extends Ve{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class rn extends Ve{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class sn extends Ve{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class on extends Ve{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class an extends Ve{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ln extends Ve{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cn extends Ve{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class un extends Ve{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class hn extends Ve{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class dn extends Ve{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class pn extends Ve{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class fn extends Ve{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class mn extends Ve{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class gn extends Ve{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class yn extends Ve{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class _n extends Ve{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class vn extends _n{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class xn extends _n{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class bn{constructor(t,e,n,i){this.context=t,this.width=e,this.height=n;const r=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new vn(t,r),i&&(this.depthAttachment=new xn(t,r))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class wn{constructor(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n}}wn.Replace=[1,0],wn.disabled=new wn(wn.Replace,t.Color.transparent,[!1,!1,!1,!1]),wn.unblended=new wn(wn.Replace,t.Color.transparent,[!0,!0,!0,!0]),wn.alphaBlended=new wn([1,771],t.Color.transparent,[!0,!0,!0,!0]);class Sn{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ne(this),this.clearDepth=new Ue(this),this.clearStencil=new je(this),this.colorMask=new Ge(this),this.depthMask=new qe(this),this.stencilMask=new $e(this),this.stencilFunc=new We(this),this.stencilOp=new Ze(this),this.stencilTest=new He(this),this.depthRange=new Xe(this),this.depthTest=new Ye(this),this.depthFunc=new Ke(this),this.blend=new Je(this),this.blendFunc=new Qe(this),this.blendColor=new tn(this),this.blendEquation=new en(this),this.cullFace=new nn(this),this.cullFaceSide=new rn(this),this.frontFace=new sn(this),this.program=new on(this),this.activeTexture=new an(this),this.viewport=new ln(this),this.bindFramebuffer=new cn(this),this.bindRenderbuffer=new un(this),this.bindTexture=new hn(this),this.bindVertexBuffer=new dn(this),this.bindElementBuffer=new pn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new fn(this),this.pixelStoreUnpack=new mn(this),this.pixelStoreUnpackPremultiplyAlpha=new gn(this),this.pixelStoreUnpackFlipY=new yn(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new Be(this,t,e)}createVertexBuffer(t,e,n){return new Fe(this,t,e,n)}createRenderbuffer(t,e,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,n){return new bn(this,t,e,n)}clear({color:t,depth:e}){const n=this.gl;let i=0;t&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),n.clear(i)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r(t.blendFunction,wn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class En{constructor(t,e,n){this.func=t,this.mask=e,this.range=n}}En.ReadOnly=!1,En.ReadWrite=!0,En.disabled=new En(519,En.ReadOnly,[0,1]);const Tn=7680;class An{constructor(t,e,n,i,r,s){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=s}}An.disabled=new An({func:519,mask:0},0,0,Tn,Tn,Tn);class kn{constructor(t,e,n){this.enable=t,this.mode=e,this.frontFace=n}}let Pn;function In(e,n,i,r,s,o,a){const l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[];let d=0,p=0;for(let x=0;x<r.length;x++){const f=r[x],m=n.getTile(f),g=m.getBucket(i);if(!g)continue;let y=f.posMatrix;0===s[0]&&0===s[1]||(y=e.translatePosMatrix(f.posMatrix,m,s,o));const _=a?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){const n=t.create(),i=y;t.mul(n,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(n,n,g.placementViewportMatrix),h.push({circleArray:v,circleOffset:p,transform:i,invTransform:n}),d+=v.length/4,p=d}_&&u.draw(l,c.LINES,En.disabled,An.disabled,e.colorModeForRenderPass(),kn.disabled,ye(y,e.transform,m),i.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}if(!a||!h.length)return;const f=e.useProgram("collisionCircle"),m=new t.CollisionCircleLayoutArray;m.resize(4*d),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const n=4*e,i=t.circleArray[n+0],r=t.circleArray[n+1],s=t.circleArray[n+2],o=t.circleArray[n+3];m.emplace(g++,i,r,s,o,0),m.emplace(g++,i,r,s,o,1),m.emplace(g++,i,r,s,o,2),m.emplace(g++,i,r,s,o,3)}(!Pn||Pn.length<2*d)&&(Pn=function(e){const n=2*e,i=new t.QuadTriangleArray;i.resize(n),i._trim();for(let t=0;t<n;t++){const e=6*t;i.uint16[e+0]=4*t+0,i.uint16[e+1]=4*t+1,i.uint16[e+2]=4*t+2,i.uint16[e+3]=4*t+2,i.uint16[e+4]=4*t+3,i.uint16[e+5]=4*t+0}return i}(d));const y=l.createIndexBuffer(Pn,!0),_=l.createVertexBuffer(m,t.collisionCircleLayout.members,!0);for(const x of h){const n={u_matrix:x.transform,u_inv_matrix:x.invTransform,u_camera_to_center_distance:(v=e.transform).cameraToCenterDistance,u_viewport_size:[v.width,v.height]};f.draw(l,c.TRIANGLES,En.disabled,An.disabled,e.colorModeForRenderPass(),kn.disabled,n,i.id,_,y,t.SegmentVector.simpleSegment(0,2*x.circleOffset,x.circleArray.length,x.circleArray.length/2),null,e.transform.zoom,null,null,null)}var v;_.destroy(),y.destroy()}kn.disabled=new kn(!1,1029,2305),kn.backCCW=new kn(!0,1029,2305);const Cn=t.identity(new Float32Array(16));function Mn(e,n,i,r,s,o){const{horizontalAlign:a,verticalAlign:l}=t.getAnchorAlignment(e),c=-(a-.5)*n,u=-(l-.5)*i,h=t.evaluateVariableOffset(e,r);return new t.pointGeometry((c/s+h[0])*o,(u/s+h[1])*o)}function zn(e,n,i,r,s,o,a,l,c,u){const h=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,p=e.icon.dynamicLayoutVertexArray,f={};d.clear();for(let m=0;m<h.length;m++){const p=h.get(m),g=e.allowVerticalPlacement&&!p.placedOrientation,y=p.hidden||!p.crossTileID||g?null:r[p.crossTileID];if(y){const r=new t.pointGeometry(p.anchorX,p.anchorY),h=ht(r,i?a:o),m=dt(s.cameraToCenterDistance,h.signedDistanceFromCamera);let g=t.evaluateSizeForFeature(e.textSizeData,c,p)*m/t.ONE_EM;i&&(g*=e.tilePixelRatio/l);const{width:_,height:v,anchor:x,textOffset:b,textBoxScale:w}=y,S=Mn(x,_,v,b,w,g),E=i?ht(r.add(S),o).point:h.point.add(n?S.rotate(-s.angle):S),T=e.allowVerticalPlacement&&p.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<p.numGlyphs;e++)t.addDynamicAttributes(d,E,T);u&&p.associatedIconIndex>=0&&(f[p.associatedIconIndex]={shiftedAnchor:E,angle:T})}else bt(p.numGlyphs,d)}if(u){p.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const i=n.get(e);if(i.hidden)bt(i.numGlyphs,p);else{const n=f[e];if(n)for(let e=0;e<i.numGlyphs;e++)t.addDynamicAttributes(p,n.shiftedAnchor,n.angle);else bt(i.numGlyphs,p)}}e.icon.dynamicLayoutVertexBuffer.updateData(p)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function Ln(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Dn(e,n,i,r,s,o,a,l,c,u,h,d){const p=e.context,f=p.gl,m=e.transform,g="map"===l,y="map"===c,_="viewport"!==l&&"point"!==i.layout.get("symbol-placement"),v=g&&!y&&!_,x=!i.layout.get("symbol-sort-key").isConstant();let b=!1;const w=e.depthModeForSublayer(0,En.ReadOnly),S=i.layout.get("text-variable-anchor"),E=[];for(const T of r){const r=n.getTile(T),l=r.getBucket(i);if(!l)continue;const c=s?l.text:l.icon;if(!c||!c.segments.get().length)continue;const h=c.programConfigurations.get(i.id),d=s||l.sdfIcons,p=s?l.textSizeData:l.iconSizeData,w=y||0!==m.pitch,A=e.useProgram(Ln(d,s,l),h),k=t.evaluateSizeForZoom(p,m.zoom);let P,I,C,M,z=[0,0],L=null;if(s){if(I=r.glyphAtlasTexture,C=f.LINEAR,P=r.glyphAtlasTexture.size,l.iconsInText){z=r.imageAtlasTexture.size,L=r.imageAtlasTexture;const t="composite"===p.kind||"camera"===p.kind;M=w||e.options.rotating||e.options.zooming||t?f.LINEAR:f.NEAREST}}else{const t=1!==i.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;I=r.imageAtlasTexture,C=d||e.options.rotating||e.options.zooming||t||w?f.LINEAR:f.NEAREST,P=r.imageAtlasTexture.size}const D=Tt(r,1,e.transform.zoom),R=ct(T.posMatrix,y,g,e.transform,D),B=ut(T.posMatrix,y,g,e.transform,D),O=S&&l.hasTextData(),F="none"!==i.layout.get("icon-text-fit")&&O&&l.hasIconData();if(_){const t="map"===i.layout.get("text-rotation-alignment");ft(l,T.posMatrix,e,s,R,B,y,u,t)}const V=e.translatePosMatrix(T.posMatrix,r,o,a),N=_||s&&S||F?Cn:R,U=e.translatePosMatrix(B,r,o,a,!0),j=d&&0!==i.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1);let G;G=d?l.iconsInText?ze(p.kind,k,v,y,e,V,N,U,P,z):Me(p.kind,k,v,y,e,V,N,U,s,P,!0):Ce(p.kind,k,v,y,e,V,N,U,s,P);const q={program:A,buffers:c,uniformValues:G,atlasTexture:I,atlasTextureIcon:L,atlasInterpolation:C,atlasInterpolationIcon:M,isSDF:d,hasHalo:j};if(x&&l.canOverlap){b=!0;const e=c.segments.get();for(const n of e)E.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:q})}else E.push({segments:c.segments,sortKey:0,state:q})}b&&E.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of E){const n=t.state;if(p.activeTexture.set(f.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,f.CLAMP_TO_EDGE),n.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,Rn(n.buffers,t.segments,i,e,n.program,w,h,d,r)),r.u_is_halo=0}Rn(n.buffers,t.segments,i,e,n.program,w,h,d,n.uniformValues)}}function Rn(t,e,n,i,r,s,o,a,l){const c=i.context;r.draw(c,c.gl.TRIANGLES,s,o,a,kn.disabled,l,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Bn(t,e,n,i,r,s,o){const a=t.context.gl,l=n.paint.get("fill-pattern"),c=l&&l.constantOr(1),u=n.getCrossfadeParameters();let h,d,p,f,m;o?(d=c&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=a.LINES):(d=c?"fillPattern":"fill",h=a.TRIANGLES);for(const g of i){const i=e.getTile(g);if(c&&!i.patternsLoaded())continue;const y=i.getBucket(n);if(!y)continue;const _=y.programConfigurations.get(n.id),v=t.useProgram(d,_);c&&(t.context.activeTexture.set(a.TEXTURE0),i.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_.updatePaintBuffers(u));const x=l.constantOr(null);if(x&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[x.to.toString()],n=t.patternPositions[x.from.toString()];e&&n&&_.setConstantPatternPositions(e,n)}const b=t.translatePosMatrix(g.posMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(o){f=y.indexBuffer2,m=y.segments2;const e=[a.drawingBufferWidth,a.drawingBufferHeight];p="fillOutlinePattern"===d&&c?me(b,t,u,i,e):fe(b,e)}else f=y.indexBuffer,m=y.segments,p=c?pe(b,t,u,i):de(b);v.draw(t.context,h,r,t.stencilModeForClipping(g),s,kn.disabled,p,n.id,y.layoutVertexBuffer,f,m,n.paint,t.transform.zoom,_)}}function On(t,e,n,i,r,s,o){const a=t.context,l=a.gl,c=n.paint.get("fill-extrusion-pattern"),u=c.constantOr(1),h=n.getCrossfadeParameters(),d=n.paint.get("fill-extrusion-opacity");for(const p of i){const i=e.getTile(p),f=i.getBucket(n);if(!f)continue;const m=f.programConfigurations.get(n.id),g=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",m);u&&(t.context.activeTexture.set(l.TEXTURE0),i.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),m.updatePaintBuffers(h));const y=c.constantOr(null);if(y&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[y.to.toString()],n=t.patternPositions[y.from.toString()];e&&n&&m.setConstantPatternPositions(e,n)}const _=t.translatePosMatrix(p.posMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),v=n.paint.get("fill-extrusion-vertical-gradient"),x=u?he(_,t,v,d,p,h,i):ue(_,t,v,d);g.draw(a,a.gl.TRIANGLES,r,s,o,kn.backCCW,x,n.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,n.paint,t.transform.zoom,m)}}function Fn(t,e,n,i,r,s){const o=t.context,a=o.gl,l=e.fbo;if(!l)return;const c=t.useProgram("hillshade");o.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,l.colorAttachment.get());const u=((t,e,n)=>{const i=n.paint.get("hillshade-shadow-color"),r=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color");let o=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(o-=t.transform.angle);const a=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),a),u_image:0,u_latrange:be(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),o],u_shadow:i,u_highlight:r,u_accent:s}})(t,e,n);c.draw(o,a.TRIANGLES,i,r,s,kn.disabled,u,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function Vn(e,n,i,r,s,o){const a=e.context,l=a.gl,c=n.dem;if(c&&c.data){const u=c.dim,h=c.stride,p=c.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){const t=n.demTexture;t.update(p,{premultiply:!1}),t.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else n.demTexture=new d(a,p,l.RGBA,{premultiply:!1}),n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let f=n.fbo;if(!f){const t=new d(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),f=n.fbo=a.createFramebuffer(u,u,!0),f.colorAttachment.set(t.texture)}a.bindFramebuffer.set(f.framebuffer),a.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,s,o,kn.disabled,((e,n)=>{const i=n.stride,r=t.create();return t.ortho(r,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(r,r,[0,-t.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}})(n.tileID,c),i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function Nn(e,n,i,r,s){const o=r.paint.get("raster-fade-duration");if(o>0){const r=t.exported.now(),a=(r-e.timeAdded)/o,l=n?(r-n.timeAdded)/o:-1,c=i.getSource(),u=s.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=h&&e.refreshedUponExpiration?1:t.clamp(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}const Un=new t.Color(1,0,0,1),jn=new t.Color(0,1,0,1),Gn=new t.Color(0,0,1,1),qn=new t.Color(1,0,1,1),$n=new t.Color(0,1,1,1);function Wn(t,e,n,i){Hn(t,0,e+n/2,t.transform.width,n,i)}function Zn(t,e,n,i){Hn(t,e-n/2,0,n,t.transform.height,i)}function Hn(t,e,n,i,r,s){const o=t.context,a=o.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*t.pixelRatio,n*t.pixelRatio,i*t.pixelRatio,r*t.pixelRatio),o.clear({color:s}),a.disable(a.SCISSOR_TEST)}function Xn(e,n,i){const r=e.context,s=r.gl,o=i.posMatrix,a=e.useProgram("debug"),l=En.disabled,c=An.disabled,u=e.colorModeForRenderPass(),h="$debug";r.activeTexture.set(s.TEXTURE0),e.emptyTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a.draw(r,s.LINE_STRIP,l,c,u,kn.disabled,_e(o,t.Color.red),h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);const d=n.getTileByID(i.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=n.getTile(i).tileSize,m=512/Math.min(f,512)*(i.overscaledZ/e.transform.zoom)*.5;let g=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(g+=` => ${i.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const n=t.debugOverlayCanvas,i=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,`${g} ${p}kb`),a.draw(r,s.TRIANGLES,l,c,wn.alphaBlended,kn.disabled,_e(o,t.Color.transparent,m),h,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}const Yn={symbol:function(e,n,i,r,s){if("translucent"!==e.renderPass)return;const o=An.disabled,a=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(e,n,i,r,s,o,a){const l=n.transform,c="map"===s,u="map"===o;for(const h of e){const e=r.getTile(h),s=e.getBucket(i);if(!s||!s.text||!s.text.segments.get().length)continue;const o=t.evaluateSizeForZoom(s.textSizeData,l.zoom),d=Tt(e,1,n.transform.zoom),p=ct(h.posMatrix,u,c,n.transform,d),f="none"!==i.layout.get("icon-text-fit")&&s.hasIconData();if(o){const t=Math.pow(2,l.zoom-e.tileID.overscaledZ);zn(s,c,u,a,l,p,h.posMatrix,t,o,f)}}}(r,e,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),s),0!==i.paint.get("icon-opacity").constantOr(1)&&Dn(e,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),o,a),0!==i.paint.get("text-opacity").constantOr(1)&&Dn(e,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),o,a),n.map.showCollisionBoxes&&(In(e,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),In(e,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(e,n,i,r){if("translucent"!==e.renderPass)return;const s=i.paint.get("circle-opacity"),o=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),l=!i.layout.get("circle-sort-key").isConstant();if(0===s.constantOr(1)&&(0===o.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.depthModeForSublayer(0,En.ReadOnly),d=An.disabled,p=e.colorModeForRenderPass(),f=[];for(let m=0;m<r.length;m++){const s=r[m],o=n.getTile(s),a=o.getBucket(i);if(!a)continue;const c=a.programConfigurations.get(i.id),u={programConfiguration:c,program:e.useProgram("circle",c),layoutVertexBuffer:a.layoutVertexBuffer,indexBuffer:a.indexBuffer,uniformValues:ge(e,s,o,i)};if(l){const e=a.segments.get();for(const n of e)f.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:u})}else f.push({segments:a.segments,sortKey:0,state:u})}l&&f.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of f){const{programConfiguration:n,program:r,layoutVertexBuffer:s,indexBuffer:o,uniformValues:a}=t.state;r.draw(c,u.TRIANGLES,h,d,p,kn.disabled,a,i.id,s,o,t.segments,i.paint,e.transform.zoom,n)}},heatmap:function(e,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const s=e.context,o=s.gl,a=An.disabled,l=new wn([o.ONE,o.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){const i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{const s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,i){const r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width/4,e.height/4,0,r.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(t,e,s,r)}}(s,e,i),s.clear({color:t.Color.transparent});for(let t=0;t<r.length;t++){const c=r[t];if(n.hasRenderableParent(c))continue;const u=n.getTile(c),h=u.getBucket(i);if(!h)continue;const d=h.programConfigurations.get(i.id),p=e.useProgram("heatmap",d),{zoom:f}=e.transform;p.draw(s,o.TRIANGLES,En.disabled,a,l,kn.disabled,xe(c.posMatrix,u,f,i.paint.get("heatmap-intensity")),i.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,i.paint,e.transform.zoom,d)}s.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){const i=e.context,r=i.gl,s=n.heatmapFbo;if(!s)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let o=n.colorRampTexture;o||(o=n.colorRampTexture=new d(i,n.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,r.TRIANGLES,En.disabled,An.disabled,e.colorModeForRenderPass(),kn.disabled,((e,n,i,r)=>{const s=t.create();t.ortho(s,0,e.width,e.height,0,0,1);const o=e.context.gl;return{u_matrix:s,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}})(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}(e,i))},line:function(e,n,i,r){if("translucent"!==e.renderPass)return;const s=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0===s.constantOr(1)||0===o.constantOr(1))return;const a=e.depthModeForSublayer(0,En.ReadOnly),l=e.colorModeForRenderPass(),c=i.paint.get("line-dasharray"),u=i.paint.get("line-pattern"),h=u.constantOr(1),p=i.paint.get("line-gradient"),f=i.getCrossfadeParameters(),m=h?"linePattern":c?"lineSDF":p?"lineGradient":"line",g=e.context,y=g.gl;let _=!0;for(const v of r){const r=n.getTile(v);if(h&&!r.patternsLoaded())continue;const s=r.getBucket(i);if(!s)continue;const o=s.programConfigurations.get(i.id),x=e.context.program.get(),b=e.useProgram(m,o),w=_||b.program!==x,S=u.constantOr(null);if(S&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[S.to.toString()],n=t.patternPositions[S.from.toString()];e&&n&&o.setConstantPatternPositions(e,n)}const E=h?Ee(e,r,i,f):c?Te(e,r,i,c,f):p?Se(e,r,i,s.lineClipsArray.length):we(e,r,i);if(h)g.activeTexture.set(y.TEXTURE0),r.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),o.updatePaintBuffers(f);else if(c&&(w||e.lineAtlas.dirty))g.activeTexture.set(y.TEXTURE0),e.lineAtlas.bind(g);else if(p){const r=s.gradients[i.id];let o=r.texture;if(i.gradientVersion!==r.version){let a=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=v.canonical.z===i?Math.ceil(1<<e.transform.maxZoom-v.canonical.z):1;a=t.clamp(t.nextPowerOfTwo(s.maxLineLength/t.EXTENT*1024*r),256,g.maxTextureSize)}r.gradient=t.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new d(g,r.gradient,y.RGBA),r.version=i.gradientVersion,o=r.texture}g.activeTexture.set(y.TEXTURE0),o.bind(i.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}b.draw(g,y.TRIANGLES,a,e.stencilModeForClipping(v),l,kn.disabled,E,i.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,i.paint,e.transform.zoom,o,s.layoutVertexBuffer2),_=!1}},fill:function(e,n,i,r){const s=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0===o.constantOr(1))return;const a=e.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===s.constantOr(t.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const t=e.depthModeForSublayer(1,"opaque"===e.renderPass?En.ReadWrite:En.ReadOnly);Bn(e,n,i,r,t,a,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){const t=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,En.ReadOnly);Bn(e,n,i,r,t,a,!0)}},"fill-extrusion":function(t,e,n,i){const r=n.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){const s=new En(t.context.gl.LEQUAL,En.ReadWrite,t.depthRangeFor3D);if(1!==r||n.paint.get("fill-extrusion-pattern").constantOr(1))On(t,e,n,i,s,An.disabled,wn.disabled),On(t,e,n,i,s,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const r=t.colorModeForRenderPass();On(t,e,n,i,s,An.disabled,r)}}},hillshade:function(t,e,n,i){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const r=t.context,s=t.depthModeForSublayer(0,En.ReadOnly),o=t.colorModeForRenderPass(),[a,l]="translucent"===t.renderPass?t.stencilConfigForOverlap(i):[{},i];for(const c of l){const i=e.getTile(c);i.needsHillshadePrepare&&"offscreen"===t.renderPass?Vn(t,i,n,s,An.disabled,o):"translucent"===t.renderPass&&Fn(t,i,n,s,a[c.overscaledZ],o)}r.viewport.set([0,0,t.width,t.height])},raster:function(t,e,n,i){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!i.length)return;const r=t.context,s=r.gl,o=e.getSource(),a=t.useProgram("raster"),l=t.colorModeForRenderPass(),[c,u]=o instanceof z?[{},i]:t.stencilConfigForOverlap(i),h=u[u.length-1].overscaledZ,d=!t.options.moving;for(const p of u){const i=t.depthModeForSublayer(p.overscaledZ-h,1===n.paint.get("raster-opacity")?En.ReadWrite:En.ReadOnly,s.LESS),u=e.getTile(p),f=t.transform.calculatePosMatrix(p.toUnwrapped(),d);u.registerFadeDuration(n.paint.get("raster-fade-duration"));const m=e.findLoadedParent(p,0),g=Nn(u,m,e,n,t.transform);let y,_;const v="nearest"===n.paint.get("raster-resampling")?s.NEAREST:s.LINEAR;r.activeTexture.set(s.TEXTURE0),u.texture.bind(v,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(s.TEXTURE1),m?(m.texture.bind(v,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),y=Math.pow(2,m.tileID.overscaledZ-u.tileID.overscaledZ),_=[u.tileID.canonical.x*y%1,u.tileID.canonical.y*y%1]):u.texture.bind(v,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const x=Pe(f,_||[0,0],y||1,g,n);o instanceof z?a.draw(r,s.TRIANGLES,i,An.disabled,l,kn.disabled,x,n.id,o.boundsBuffer,t.quadTriangleIndexBuffer,o.boundsSegments):a.draw(r,s.TRIANGLES,i,c[p.overscaledZ],l,kn.disabled,x,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){const i=n.paint.get("background-color"),r=n.paint.get("background-opacity");if(0===r)return;const s=t.context,o=s.gl,a=t.transform,l=a.tileSize,c=n.paint.get("background-pattern");if(t.isPatternMissing(c))return;const u=!c&&1===i.a&&1===r&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==u)return;const h=An.disabled,d=t.depthModeForSublayer(0,"opaque"===u?En.ReadWrite:En.ReadOnly),p=t.colorModeForRenderPass(),f=t.useProgram(c?"backgroundPattern":"background"),m=a.coveringTiles({tileSize:l});c&&(s.activeTexture.set(o.TEXTURE0),t.imageManager.bind(t.context));const g=n.getCrossfadeParameters();for(const y of m){const e=t.transform.calculatePosMatrix(y.toUnwrapped()),a=c?De(e,r,t,c,{tileID:y,tileSize:l},g):Le(e,r,i);f.draw(s,o.TRIANGLES,d,h,p,kn.disabled,a,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}},debug:function(t,e,n){for(let i=0;i<n.length;i++)Xn(t,e,n[i])},custom:function(t,e,n){const i=t.context,r=n.implementation;if("offscreen"===t.renderPass){const e=r.prerender;e&&(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),e.call(r,i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(An.disabled);const e="3d"===r.renderingMode?new En(t.context.gl.LEQUAL,En.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,En.ReadOnly);i.setDepthMode(e),r.render(i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}};class Kn{constructor(t,e){this.context=new Sn(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=j.maxUnderzooming+j.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Kt,this.gpuTimers={}}resize(t,e,n){if(this.width=t*n,this.height=e*n,this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const i of this.style._order)this.style._layers[i].resize()}setup(){const e=this.context,n=new t.PosArray;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,ie.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const i=new t.PosArray;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(i,ie.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const r=new t.RasterBoundsArray;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,M.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const s=new t.PosArray;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,ie.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.LineStripIndexArray;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);const a=new t.TriangleIndexArray;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new d(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);const l=this.context.gl;this.stencilClearMode=new An({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const i=t.create();t.ortho(i,0,this.width,this.height,0,0,1),t.scale(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,En.disabled,this.stencilClearMode,wn.disabled,kn.disabled,ve(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source;const n=this.context,i=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(wn.disabled),n.setDepthMode(En.disabled);const r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of e){const t=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;r.draw(n,i.TRIANGLES,En.disabled,new An({func:i.ALWAYS,mask:0},t,255,i.KEEP,i.KEEP,i.REPLACE),wn.disabled,kn.disabled,ve(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new An({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new An({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,n=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const t={};for(let n=0;n<r;n++)t[n+i]=new An({func:e.GEQUAL,mask:255},n+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=r,[t,n]}return[{[i]:An.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new wn([e.CONSTANT_COLOR,e.ONE],new t.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?wn.unblended:wn.alphaBlended}depthModeForSublayer(t,e,n){if(!this.opaquePassEnabledForLayer())return En.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new En(n||this.context.gl.LEQUAL,e,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const i=this.style._order,r=this.style.sourceCaches;for(const t in r){const e=r[t];e.used&&e.prepare(this.context)}const s={},o={},a={};for(const t in r){const e=r[t];s[t]=e.getVisibleCoordinates(),o[t]=s[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<i.length;t++)if(this.style._layers[i[t]].is3D()){this.opaquePassCutoff=t;break}this.renderPass="offscreen";for(const t of i){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const n=o[e.source];("custom"===e.type||n.length)&&this.renderLayer(this,r[e.source],e,n)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[i[this.currentLayer]],e=r[t.source],n=s[t.source];this._renderTileClippingMasks(t,n),this.renderLayer(this,e,t,n)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const t=this.style._layers[i[this.currentLayer]],e=r[t.source],n=("symbol"===t.type?a:o)[t.source];this._renderTileClippingMasks(t,s[t.source]),this.renderLayer(this,e,t,n)}if(this.options.showTileBoundaries){let t,e;Object.values(this.style._layers).forEach((n=>{n.source&&!n.isHidden(this.transform.zoom)&&(n.source!==(e&&e.id)&&(e=this.style.sourceCaches[n.source]),(!t||t.getSource().maxzoom<e.getSource().maxzoom)&&(t=e))})),t&&Yn.debug(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;Wn(t,t.transform.height-(e.top||0),3,Un),Wn(t,e.bottom||0,3,jn),Zn(t,e.left||0,3,Gn),Zn(t,t.transform.width-(e.right||0),3,qn);const n=t.transform.centerPoint;!function(t,e,n,i){Hn(t,e-1,n-10,2,20,i),Hn(t,e-10,n-1,20,2,i)}(t,n.x,t.transform.height-n.y,$n)}(this),this.context.setDefault()}renderLayer(t,e,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||i.length)&&(this.id=n.id,this.gpuTimingStart(n),Yn[n.type](t,e,n,i,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const e={};for(const n in t){const i=t[n],r=this.context.extTimerQuery,s=r.getQueryObjectEXT(i.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i.query),e[n]=s}return e}translatePosMatrix(e,n,i,r,s){if(!i[0]&&!i[1])return e;const o=s?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){const t=Math.sin(o),e=Math.cos(o);i=[i[0]*e-i[1]*t,i[0]*t+i[1]*e]}const a=[s?i[0]:Tt(n,i[0],this.transform.zoom),s?i[1]:Tt(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n}useProgram(t,e){this.cache=this.cache||{};const n=`${t}${e?e.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[n]||(this.cache[n]=new le(this.context,t,re[t],e,Re[t],this._showOverdrawInspector)),this.cache[n]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Jn{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(e,n,i){const r=Math.pow(2,i),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>t.transformMat4([],n,e))).map((e=>t.scale$1([],e,1/e[3]/n*r))),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=function(t,e){var n=e[0],i=e[1],r=e[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}([],function(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}([],u([],s[t[0]],s[t[1]]),u([],s[t[2]],s[t[1]]))),n=-((i=e)[0]*(r=s[t[1]])[0]+i[1]*r[1]+i[2]*r[2]);var i,r;return e.concat(n)}));return new Jn(s,o)}}class Qn{constructor(t,e){this.min=t,this.max=e,this.center=function(t,e,n){return t[0]=.5*e[0],t[1]=.5*e[1],t[2]=.5*e[2],t}([],function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}([],this.min,this.max))}quadrant(t){const e=[t%2==0,t<2],n=l(this.min),i=l(this.max);for(let r=0;r<e.length;r++)n[r]=e[r]?this.min[r]:this.center[r],i[r]=e[r]?this.center[r]:this.max[r];return i[2]=this.max[2],new Qn(n,i)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(e){const n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let i=!0;for(let r=0;r<e.planes.length;r++){const s=e.planes[r];let o=0;for(let e=0;e<n.length;e++)t.dot(s,n[e])>=0&&o++;if(0===o)return 0;o!==n.length&&(i=!1)}if(i)return 2;for(let t=0;t<3;t++){let n=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let r=0;r<e.points.length;r++){const s=e.points[r][t]-this.min[t];n=Math.min(n,s),i=Math.max(i,s)}if(i<0||n>this.max[t]-this.min[t])return 0}return 1}}class ti{constructor(t=0,e=0,n=0,i=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=i}interpolate(e,n,i){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,i)),this}getCenter(e,n){const i=t.clamp((this.left+e-this.right)/2,0,e),r=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.pointGeometry(i,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ti(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ei{constructor(e,n,i,r,s){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===s||!!s,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ti,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new ei(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var e=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}(),function(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);t[0]=i*l+s*a,t[1]=r*l+o*a,t[2]=i*-a+s*l,t[3]=r*-a+o*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const i=this.pointCoordinate(new t.pointGeometry(0,0)),r=this.pointCoordinate(new t.pointGeometry(this.width,0)),s=this.pointCoordinate(new t.pointGeometry(this.width,this.height)),o=this.pointCoordinate(new t.pointGeometry(0,this.height)),a=Math.floor(Math.min(i.x,r.x,s.x,o.x)),l=Math.floor(Math.max(i.x,r.x,s.x,o.x)),c=1;for(let u=a-c;u<=l+c;u++)0!==u&&n.push(new t.UnwrappedTileID(u,e))}return n}coveringTiles(e){let n=this.coveringZoomLevel(e);const i=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const r=t.MercatorCoordinate.fromLngLat(this.center),s=Math.pow(2,n),o=[s*r.x,s*r.y,0],a=Jn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n);let l=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(l=n);const c=t=>({aabb:new Qn([t*s,0,0],[(t+1)*s,s,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),u=[],d=[],p=n,f=e.reparseOverscaled?i:n;if(this._renderWorldCopies)for(let t=1;t<=3;t++)u.push(c(-t)),u.push(c(t));for(u.push(c(0));u.length>0;){const e=u.pop(),n=e.x,i=e.y;let r=e.fullyVisible;if(!r){const t=e.aabb.intersects(a);if(0===t)continue;r=2===t}const s=e.aabb.distanceX(o),c=e.aabb.distanceY(o),m=Math.max(Math.abs(s),Math.abs(c)),g=3+(1<<p-e.zoom)-2;if(e.zoom===p||m>g&&e.zoom>=l)d.push({tileID:new t.OverscaledTileID(e.zoom===p?f:e.zoom,e.wrap,e.zoom,n,i),distanceSq:h([o[0]-.5-n,o[1]-.5-i])});else for(let t=0;t<4;t++){const s=(n<<1)+t%2,o=(i<<1)+(t>>1);u.push({aabb:e.aabb.quadrant(t),zoom:e.zoom+1,x:s,y:o,wrap:e.wrap,fullyVisible:r})}}return d.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.pointGeometry(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)}unproject(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(e,n){const i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),s=this.locationCoordinate(e),o=new t.MercatorCoordinate(s.x-(i.x-r.x),s.y-(i.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}locationCoordinate(e){return t.MercatorCoordinate.fromLngLat(e)}coordinateLocation(t){return t.toLngLat()}pointCoordinate(e){const n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(i,i,this.pixelMatrixInverse);const r=n[3],s=i[3],o=n[1]/r,a=i[1]/s,l=n[2]/r,c=i[2]/s,u=l===c?0:(0-l)/(c-l);return new t.MercatorCoordinate(t.number(n[0]/r,i[0]/s,u)/this.worldSize,t.number(o,a,u)/this.worldSize)}coordinatePoint(e){const n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.pointGeometry(n[0]/n[3],n[1]/n[3])}getBounds(){return(new t.LngLatBounds).extend(this.pointLocation(new t.pointGeometry(0,0))).extend(this.pointLocation(new t.pointGeometry(this.width,0))).extend(this.pointLocation(new t.pointGeometry(this.width,this.height))).extend(this.pointLocation(new t.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,n=!1){const i=e.key,r=n?this._alignedPosMatrixCache:this._posMatrixCache;if(r[i])return r[i];const s=e.canonical,o=this.worldSize/this.zoomScale(s.z),a=s.x+Math.pow(2,s.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[a*o,s.y*o,0]),t.scale(l,l,[o/t.EXTENT,o/t.EXTENT,1]),t.multiply(l,n?this.alignedProjMatrix:this.projMatrix,l),r[i]=new Float32Array(l),r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,n,i,r,s=-90,o=90,a=-180,l=180;const c=this.size,u=this._unmodified;if(this.latRange){const n=this.latRange;s=t.mercatorYfromLat(n[1])*this.worldSize,o=t.mercatorYfromLat(n[0])*this.worldSize,e=o-s<c.y?c.y/(o-s):0}if(this.lngRange){const e=this.lngRange;a=t.mercatorXfromLng(e[0])*this.worldSize,l=t.mercatorXfromLng(e[1])*this.worldSize,n=l-a<c.x?c.x/(l-a):0}const h=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.pointGeometry(n?(l+a)/2:h.x,e?(o+s)/2:h.y)),this.zoom+=this.scaleZoom(d),this._unmodified=u,void(this._constraining=!1);if(this.latRange){const t=h.y,e=c.y/2;t-e<s&&(r=s+e),t+e>o&&(r=o-e)}if(this.lngRange){const t=h.x,e=c.x/2;t-e<a&&(i=a+e),t+e>l&&(i=l-e)}void 0===i&&void 0===r||(this.center=this.unproject(new t.pointGeometry(void 0!==i?i:h.x,void 0!==r?r:h.y))),this._unmodified=u,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const n=Math.PI/2+this._pitch,i=this._fov*(.5+e.y/this.height),r=Math.sin(i)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-n-i,.01,Math.PI-.01)),s=this.point,o=s.x,a=s.y,l=1.01*(Math.cos(Math.PI/2-this._pitch)*r+this.cameraToCenterDistance),c=this.height/50;let u=new Float64Array(16);t.perspective(u,this._fov,this.width/this.height,c,l),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,t.scale(u,u,[1,-1,1]),t.translate(u,u,[0,0,-this.cameraToCenterDistance]),t.rotateX(u,u,this._pitch),t.rotateZ(u,u,this.angle),t.translate(u,u,[-o,-a,0]),this.mercatorMatrix=t.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),t.scale(u,u,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=u,this.invProjMatrix=t.invert([],this.projMatrix);const h=this.width%2/2,d=this.height%2/2,p=Math.cos(this.angle),f=Math.sin(this.angle),m=o-Math.round(o)+p*h+f*d,g=a-Math.round(a)+p*d+f*h,y=new Float64Array(u);if(t.translate(y,y,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=y,u=t.create(),t.scale(u,u,[this.width/2,-this.height/2,1]),t.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.create(),t.scale(u,u,[1,-1,1]),t.translate(u,u,[-1,-1,0]),t.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),u=t.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new t.pointGeometry(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.pointGeometry(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(1===e.length)return[e[0],n];{let i=n.x,r=n.y,s=n.x,o=n.y;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),s=Math.max(s,t.x),o=Math.max(o,t.y);return[new t.pointGeometry(i,r),new t.pointGeometry(s,r),new t.pointGeometry(s,o),new t.pointGeometry(i,o),new t.pointGeometry(i,r)]}}}class ni{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(t,e){let n=!1,i=null;const r=()=>{i=null,n&&(t(),i=setTimeout(r,300),n=!1)};return()=>(n=!0,i||r(),i)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const e=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),s=Math.round(e.lng*r)/r,o=Math.round(e.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?`/${s}/${o}/${n}`:`${n}/${o}/${s}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const t=this._hashName;let e=!1;const n=window.location.hash.slice(1).split("&").map((n=>{const i=n.split("=")[0];return i===t?(e=!0,`${i}=${c}`):n})).filter((t=>t));return e||n.push(`${t}=${c}`),`#${n.join("&")}`}return`#${c}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some((t=>isNaN(t)))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch(t){}}}const ii={linearity:.3,easing:t.bezier(0,0,.3,1)},ri=t.extend({deceleration:2500,maxSpeed:1400},ii),si=t.extend({deceleration:20,maxSpeed:1400},ii),oi=t.extend({deceleration:1e3,maxSpeed:360},ii),ai=t.extend({deceleration:1e3,maxSpeed:90},ii);class li{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=t.exported.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new t.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)n.zoom+=t.zoomDelta||0,n.bearing+=t.bearingDelta||0,n.pitch+=t.pitchDelta||0,t.panDelta&&n.pan._add(t.panDelta),t.around&&(n.around=t.around),t.pinchAround&&(n.pinchAround=t.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const s=ui(n.pan.mag(),i,t.extend({},ri,e||{}));r.offset=n.pan.mult(s.amount/n.pan.mag()),r.center=this._map.transform.center,ci(r,s)}if(n.zoom){const t=ui(n.zoom,i,si);r.zoom=this._map.transform.zoom+t.amount,ci(r,t)}if(n.bearing){const e=ui(n.bearing,i,oi);r.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),ci(r,e)}if(n.pitch){const t=ui(n.pitch,i,ai);r.pitch=this._map.transform.pitch+t.amount,ci(r,t)}if(r.zoom||r.bearing){const t=void 0===n.pinchAround?n.around:n.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),t.extend(r,{noMoveStart:!0})}}function ci(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function ui(e,n,i){const{maxSpeed:r,linearity:s,deceleration:o}=i,a=t.clamp(e*s/(n/1e3),-r,r),l=Math.abs(a)/(o*s);return{easing:i.easing,duration:1e3*l,amount:a*(l/2)}}class hi extends t.Event{constructor(e,n,i,r={}){const o=s.mousePos(n.getCanvasContainer(),i),a=n.unproject(o);super(e,t.extend({point:o,lngLat:a,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class di extends t.Event{constructor(e,n,i){const r="touchend"===e?i.changedTouches:i.touches,o=s.touchPos(n.getCanvasContainer(),r),a=o.map((t=>n.unproject(t))),l=o.reduce(((t,e,n,i)=>t.add(e.div(i.length))),new t.pointGeometry(0,0));super(e,{points:o,point:l,lngLats:a,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class pi extends t.Event{constructor(t,e,n){super(t,{originalEvent:n}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class fi{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new pi(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new hi(t.type,this._map,t))}mouseup(t){this._map.fire(new hi(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new hi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new hi(t.type,this._map,t))}mouseover(t){this._map.fire(new hi(t.type,this._map,t))}mouseout(t){this._map.fire(new hi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new di(t.type,this._map,t))}touchmove(t){this._map.fire(new di(t.type,this._map,t))}touchend(t){this._map.fire(new di(t.type,this._map,t))}touchcancel(t){this._map.fire(new di(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new hi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new hi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gi{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(s.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const n=e;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=s.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(i.x,n.x),o=Math.max(i.x,n.x),a=Math.min(i.y,n.y),l=Math.max(i.y,n.y);s.setTransform(this._box,`translate(${r}px,${a}px)`),this._box.style.width=o-r+"px",this._box.style.height=l-a+"px"}mouseupWindow(e,n){if(!this._active)return;if(0!==e.button)return;const i=this._startPos,r=n;if(this.reset(),s.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))}}function yi(t,e){const n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class _i{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){const n=new t.pointGeometry(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=yi(i,n)))}touchmove(t,e,n){if(this.aborted||!this.centroid)return;const i=yi(n,e);for(const r in this.touches){const t=this.touches[r],e=i[r];(!e||e.dist(t)>30)&&(this.aborted=!0)}}touchend(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class vi{constructor(t){this.singleTap=new _i(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,n){this.singleTap.touchstart(t,e,n)}touchmove(t,e,n){this.singleTap.touchmove(t,e,n)}touchend(t,e,n){const i=this.singleTap.touchend(t,e,n);if(i){const e=t.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(e&&n||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class xi{constructor(){this._zoomIn=new vi({numTouches:1,numTaps:2}),this._zoomOut=new vi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)}touchmove(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)}touchend(t,e,n){const i=this._zoomIn.touchend(t,e,n),r=this._zoomOut.touchend(t,e,n);return i?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const bi={0:1,2:2};class wi{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const n=s.mouseButton(t);this._correctButton(t,n)&&(this._lastPoint=e,this._eventButton=n)}mousemoveWindow(t,e){const n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){const n=bi[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)}mouseupWindow(t){this._lastPoint&&s.mouseButton(t)===this._eventButton&&(this._moved&&s.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Si extends wi{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class Ei extends wi{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(t){t.preventDefault()}}class Ti extends wi{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(t){t.preventDefault()}}class Ai{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.pointGeometry(0,0)}touchstart(t,e,n){return this._calculateTransform(t,e,n)}touchmove(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)}touchend(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);const r=yi(i,n),s=new t.pointGeometry(0,0),o=new t.pointGeometry(0,0);let a=0;for(const t in r){const e=r[t],n=this._touches[t];n&&(s._add(e),o._add(e.sub(n)),a++,r[t]=e)}if(this._touches=r,a<this._minTouches||!o.mag())return;const l=o.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ki{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,e,n){return{}}touchstart(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,n){if(!this._firstTwoTouches)return;t.preventDefault();const[i,r]=this._firstTwoTouches,s=Pi(n,e,i),o=Pi(n,e,r);if(!s||!o)return;const a=this._aroundCenter?null:s.add(o).div(2);return this._move([s,o],a,t)}touchend(t,e,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=Pi(n,e,i),a=Pi(n,e,r);o&&a||(this._active&&s.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pi(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function Ii(t,e){return Math.log(t/e)/Math.LN2}class Ci extends ki{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ii(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ii(this._distance,n),pinchAround:e}}}function Mi(t,e){return 180*t.angleWith(e)/Math.PI}class zi extends ki{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mi(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,n=Mi(t,this._startVector);return Math.abs(n)<e}}function Li(t){return Math.abs(t.y)>Math.abs(t.x)}class Di extends ki{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,Li(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,n){const i=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}}gestureBeginsVertically(t,e,n){if(void 0!==this._valid)return this._valid;const i=t.mag()>=2,r=e.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const s=t.y>0==e.y>0;return Li(t)&&Li(e)&&s}}const Ri={panStep:100,bearingStep:15,pitchStep:10};class Bi{constructor(){const t=Ri;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,n=0,i=0,r=0,s=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),s=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:o=>{const a=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:Oi,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:o.getBearing()+n*this._bearingStep,pitch:o.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-s*this._panStep],center:o.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Oi(t){return t*(2-t)}const Fi=4.000244140625;class Vi{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=t.exported.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%Fi==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=s.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>Fi?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const i="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:e.zoom,i=this._startZoom,r=this._easing;let s,o=!1;if("wheel"===this._type&&i&&r){const e=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),a=r(e);s=t.number(i,n,a),e<1?this._frameId||(this._frameId=!0):o=!0}else s=n,o=!0;return this._active=!0,o&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!o,zoomDelta:s-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.ease;if(this._prevEase){const e=this._prevEase,i=(t.exported.now()-e.start)/e.duration,r=e.easing(i+.01)-e.easing(i),s=.27/Math.sqrt(r*r+1e-4)*.01,o=Math.sqrt(.0729-s*s);n=t.bezier(s,o,.25,1)}return this._prevEase={start:t.exported.now(),duration:e,easing:n},n}reset(){this._active=!1}}class Ni{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ui{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ji{constructor(){this._tap=new vi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))}touchmove(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=e[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,n)}touchend(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gi{constructor(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qi{constructor(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $i{constructor(t,e,n,i){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Wi=t=>t.zoom||t.drag||t.pitch||t.rotate;class Zi extends t.Event{}function Hi(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class Xi{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new li(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),t.bindAll(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,r,o]of this._listeners)s.addEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,o)}destroy(){for(const[t,e,n]of this._listeners)s.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){const e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new fi(e,t));const i=e.boxZoom=new gi(e,t);this._add("boxZoom",i);const r=new xi,s=new Ui;e.doubleClickZoom=new Ni(s,r),this._add("tapZoom",r),this._add("clickZoom",s);const o=new ji;this._add("tapDragZoom",o);const a=e.touchPitch=new Di;this._add("touchPitch",a);const l=new Ei(t),c=new Ti(t);e.dragRotate=new qi(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Si(t),h=new Ai(t);e.dragPan=new Gi(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new zi,p=new Ci;e.touchZoomRotate=new $i(n,p,d,o),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]);const f=e.scrollZoom=new Vi(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new Bi;this._add("keyboard",m),this._add("blockableMapEvent",new mi(e));for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&e[g].enable(t[g])}_add(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Wi(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,n){for(const i in t)if(i!==n&&(!e||e.indexOf(i)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const n of t)this._el.contains(n.target)&&e.push(n);return e}handleEvent(t,e){if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const n="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},r={},o={},a=t.touches,l=a?this._getMapTouches(a):void 0,c=l?s.touchPos(this._el,l):s.mousePos(this._el,t);for(const{handlerName:s,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let a;this._blockedByActive(o,p,s)?d.reset():d[e||t.type]&&(a=d[e||t.type](t,c,l),this.mergeHandlerResult(i,r,a,s,n),a&&a.needsRenderFrame&&this._triggerRenderFrame()),(a||d.isActive())&&(o[s]=d)}const u={};for(const s in this._previousActiveHandlers)o[s]||(u[s]=n);this._previousActiveHandlers=o,(Object.keys(u).length||Hi(i))&&(this._changes.push([i,r,u]),this._triggerRenderFrame()),(Object.keys(o).length||Hi(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=i;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(e,n,i,r,s){if(!i)return;t.extend(e,i);const o={handlerName:r,originalEvent:i.originalEvent||s};void 0!==i.zoomDelta&&(n.zoom=o),void 0!==i.panDelta&&(n.drag=o),void 0!==i.pitchDelta&&(n.pitch=o),void 0!==i.bearingDelta&&(n.rotate=o)}_applyChanges(){const e={},n={},i={};for(const[r,s,o]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new t.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),t.extend(n,s),t.extend(i,o);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(t,e,n){const i=this._map,r=i.transform;if(!Hi(t))return this._fireEvents(e,n,!0);let{panDelta:s,zoomDelta:o,bearingDelta:a,pitchDelta:l,around:c,pinchAround:u}=t;void 0!==u&&(c=u),i._stop(!0),c=c||i.transform.centerPoint;const h=r.pointLocation(s?c.sub(s):c);a&&(r.bearing+=a),l&&(r.pitch+=l),o&&(r.zoom+=o),r.setLocationAtPoint(h,c),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)}_fireEvents(e,n,i){const r=Wi(this._eventsInProgress),s=Wi(e),o={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(o[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!r&&s&&this._fireEvent("movestart",s.originalEvent);for(const t in o)this._fireEvent(t,o[t]);s&&this._fireEvent("move",s.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:i}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=n[e]||i,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=Wi(this._eventsInProgress);if(i&&(r||s)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(n(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.Event("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Zi("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Yi={extend:(e,...n)=>t.extend(e,...n),run(t){t()},logToElement(t,e=!1,n="log"){const i=window.document.getElementById(n);i&&(e&&(i.innerHTML=""),i.innerHTML+=`<br>${t}`)}};class Ki extends t.Evented{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,n,i){return e=t.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),i)}panTo(e,n,i){return this.easeTo(t.extend({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,n,i){return this.easeTo(t.extend({zoom:e},n),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,n,i){return this.easeTo(t.extend({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,n){e=t.LngLatBounds.convert(e);const i=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),i,n)}_cameraForBoxAndBearing(e,n,i,r){const s={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=t.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const t=r.padding;r.padding={top:t,bottom:t,right:t,left:t}}r.padding=t.extend(s,r.padding);const o=this.transform,a=o.padding,l=o.project(t.LngLat.convert(e)),c=o.project(t.LngLat.convert(n)),u=l.rotate(-i*Math.PI/180),h=c.rotate(-i*Math.PI/180),d=new t.pointGeometry(Math.max(u.x,h.x),Math.max(u.y,h.y)),p=new t.pointGeometry(Math.min(u.x,h.x),Math.min(u.y,h.y)),f=d.sub(p),m=(o.width-(a.left+a.right+r.padding.left+r.padding.right))/f.x,g=(o.height-(a.top+a.bottom+r.padding.top+r.padding.bottom))/f.y;if(g<0||m<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const y=Math.min(o.scaleZoom(o.scale*Math.min(m,g)),r.maxZoom),_=t.pointGeometry.convert(r.offset),v=new t.pointGeometry((r.padding.left-r.padding.right)/2,(r.padding.top-r.padding.bottom)/2).rotate(i*Math.PI/180),x=_.add(v).mult(o.scale/o.zoomScale(y));return{center:o.unproject(l.add(c).div(2).sub(x)),zoom:y,bearing:i}}fitBounds(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)}fitScreenCoordinates(e,n,i,r,s){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.pointGeometry.convert(e)),this.transform.pointLocation(t.pointGeometry.convert(n)),i,r),r,s)}_fitInternal(e,n,i){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();const i=this.transform;let r=!1,s=!1,o=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.LngLat.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(s=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(o=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),r&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),s&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),o&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.exported.prefersReducedMotion)&&(e.duration=0);const i=this.transform,r=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:r,c="bearing"in e?this._normalizeBearing(e.bearing,s):s,u="pitch"in e?+e.pitch:o,h="padding"in e?e.padding:i.padding,d=t.pointGeometry.convert(e.offset);let p=i.centerPoint.add(d);const f=i.pointLocation(p),m=t.LngLat.convert(e.center||f);this._normalizeCenter(m);const g=i.project(f),y=i.project(m).sub(g),_=i.zoomScale(l-r);let v,x;e.around&&(v=t.LngLat.convert(e.around),x=i.locationPoint(v));const b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==r,this._rotating=this._rotating||s!==c,this._pitching=this._pitching||u!==o,this._padding=!i.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,b),this._ease((e=>{if(this._zooming&&(i.zoom=t.number(r,l,e)),this._rotating&&(i.bearing=t.number(s,c,e)),this._pitching&&(i.pitch=t.number(o,u,e)),this._padding&&(i.interpolatePadding(a,h,e),p=i.centerPoint.add(d)),v)i.setLocationAtPoint(v,x);else{const t=i.zoomScale(i.zoom-r),n=l>r?Math.min(2,_):Math.max(.5,_),s=Math.pow(n,1-e),o=i.unproject(g.add(y.mult(e*s)).mult(t));i.setLocationAtPoint(i.renderWorldCopies?o.wrap():o,p)}this._fireMoveEvents(n)}),(t=>{this._afterEase(n,t)}),e),this}_prepareEase(e,n,i={}){this._moving=!0,n||i.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!i.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const i=this._zooming,r=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new t.Event("zoomend",e)),r&&this.fire(new t.Event("rotateend",e)),s&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,n){if(!e.essential&&t.exported.prefersReducedMotion){const i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const i=this.transform,r=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,i.minZoom,i.maxZoom):r,c="bearing"in e?this._normalizeBearing(e.bearing,s):s,u="pitch"in e?+e.pitch:o,h="padding"in e?e.padding:i.padding,d=i.zoomScale(l-r),p=t.pointGeometry.convert(e.offset);let f=i.centerPoint.add(p);const m=i.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);const y=i.project(m),_=i.project(g).sub(y);let v=e.curve;const x=Math.max(i.width,i.height),b=x/d,w=_.mag();if("minZoom"in e){const n=t.clamp(Math.min(e.minZoom,r,l),i.minZoom,i.maxZoom),s=x/i.zoomScale(n-r);v=Math.sqrt(s/w*2)}const S=v*v;function E(t){const e=(b*b-x*x+(t?-1:1)*S*S*w*w)/(2*(t?b:x)*S*w);return Math.log(Math.sqrt(e*e+1)-e)}function T(t){return(Math.exp(t)-Math.exp(-t))/2}function A(t){return(Math.exp(t)+Math.exp(-t))/2}const k=E(0);let P=function(t){return A(k)/A(k+v*t)},I=function(t){return x*((A(k)*(T(e=k+v*t)/A(e))-T(k))/S)/w;var e},C=(E(1)-k)/v;if(Math.abs(w)<1e-6||!isFinite(C)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,n);const t=b<x?-1:1;C=Math.abs(Math.log(b/x))/v,I=function(){return 0},P=function(e){return Math.exp(t*v*e)}}return e.duration="duration"in e?+e.duration:1e3*C/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==c,this._pitching=u!==o,this._padding=!i.isPaddingEqual(h),this._prepareEase(n,!1),this._ease((e=>{const d=e*C,m=1/P(d);i.zoom=1===e?l:r+i.scaleZoom(m),this._rotating&&(i.bearing=t.number(s,c,e)),this._pitching&&(i.pitch=t.number(o,u,e)),this._padding&&(i.interpolatePadding(a,h,e),f=i.centerPoint.add(p));const v=1===e?g:i.unproject(y.add(_.mult(I(d))).mult(m));i.setLocationAtPoint(i.renderWorldCopies?v.wrap():v,f),this._fireMoveEvents(n)}),(()=>this._afterEase(n)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=t.exported.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=t.wrap(e,-180,180);const i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}class Ji{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=s.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=s.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const n=this._map._getUIString(`AttributionControl.${e}`);t.title=n,t.setAttribute("aria-label",n)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((t=>"string"!=typeof t?"":t))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const n=e[i];if(n.used){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter((t=>String(t).trim())),t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,n)=>{for(let i=n+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0}));const n=t.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Qi{constructor(e={}){this.options=e,t.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=s.create("div","maplibregl-ctrl mapboxgl-ctrl");const e=s.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){s.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact","mapboxgl-compact"):e.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class tr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,n=e?this._queue.concat(e):this._queue;for(const i of n)if(i.id===t)return void(i.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const n of e)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const er={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},nr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},ir={showCompass:!0,showZoom:!0,visualizePitch:!1};class rr{constructor(e,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Ei({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Ti({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener(n,"mousedown",this.mousedown),s.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),s.addEventListener(n,"touchmove",this.touchmove),s.addEventListener(n,"touchend",this.touchend),s.addEventListener(n,"touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),s.disableDrag()}move(t,e){const n=this.map,i=this.mouseRotate.mousemoveWindow(t,e);if(i&&i.bearingDelta&&n.setBearing(n.getBearing()+i.bearingDelta),this.mousePitch){const i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}}off(){const t=this.element;s.removeEventListener(t,"mousedown",this.mousedown),s.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),s.removeEventListener(t,"touchmove",this.touchmove),s.removeEventListener(t,"touchend",this.touchend),s.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){s.enableDrag(),s.removeEventListener(window,"mousemove",this.mousemove),s.removeEventListener(window,"mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),s.mousePos(this.element,e)),s.addEventListener(window,"mousemove",this.mousemove),s.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,s.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function sr(e,n,i){if(e=new t.LngLat(e.lng,e.lat),n){const r=new t.LngLat(e.lng-360,e.lat),s=new t.LngLat(e.lng+360,e.lat),o=i.locationPoint(e).distSqr(n);i.locationPoint(r).distSqr(n)<o?e=r:i.locationPoint(s).distSqr(n)<o&&(e=s)}for(;Math.abs(e.lng-i.center.lng)>180;){const t=i.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=i.width&&t.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}const or={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ar(t,e,n){const i=t.classList;for(const r in or)i.remove(`maplibregl-${n}-anchor-${r}`,`mapboxgl-${n}-anchor-${r}`);i.add(`maplibregl-${n}-anchor-${e}`,`mapboxgl-${n}-anchor-${e}`)}class lr extends t.Evented{constructor(e,n){if(super(),(e instanceof HTMLElement||n)&&(e=t.extend({element:e},n)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=t.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div"),this._element.setAttribute("aria-label","Map marker");const n=s.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${i}px`),n.setAttributeNS(null,"width",`${r}px`),n.setAttributeNS(null,"viewBox",`0 0 ${r} ${i}`);const o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const a=s.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=s.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=s.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=s.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=s.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=s.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=s.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=s.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(f),a.appendChild(m),n.appendChild(a),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=t.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()})),ar(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),s.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[i,-1*(e-n+i)],"bottom-right":[-i,-1*(e-n+i)],left:[n,-1*(e-n)],right:[-n,-1*(e-n)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=sr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(e=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),s.setTransform(this._element,`${or[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${e}`)}getOffset(){return this._offset}setOffset(e){return this._offset=t.pointGeometry.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const cr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ur,hr=0,dr=!1;const pr={maxWidth:100,unit:"metric"};function fr(t,e,n){const i=n&&n.maxWidth||100,r=t._container.clientHeight/2,s=t.unproject([0,r]),o=t.unproject([i,r]),a=s.distanceTo(o);if(n&&"imperial"===n.unit){const n=3.2808*a;n>5280?mr(e,i,n/5280,t._getUIString("ScaleControl.Miles")):mr(e,i,n,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?mr(e,i,a/1852,t._getUIString("ScaleControl.NauticalMiles")):a>=1e3?mr(e,i,a/1e3,t._getUIString("ScaleControl.Kilometers")):mr(e,i,a,t._getUIString("ScaleControl.Meters"))}function mr(t,e,n,i){const r=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(n),e*n}(n);t.style.width=e*(r/n)+"px",t.innerHTML=`${r}&nbsp;${i}`}const gr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},yr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _r(e){if(e){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new t.pointGeometry(0,0),top:new t.pointGeometry(0,e),"top-left":new t.pointGeometry(n,n),"top-right":new t.pointGeometry(-n,n),bottom:new t.pointGeometry(0,-e),"bottom-left":new t.pointGeometry(n,-n),"bottom-right":new t.pointGeometry(-n,-n),left:new t.pointGeometry(e,0),right:new t.pointGeometry(-e,0)}}if(e instanceof t.pointGeometry||Array.isArray(e)){const n=t.pointGeometry.convert(e);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.pointGeometry.convert(e.center||[0,0]),top:t.pointGeometry.convert(e.top||[0,0]),"top-left":t.pointGeometry.convert(e["top-left"]||[0,0]),"top-right":t.pointGeometry.convert(e["top-right"]||[0,0]),bottom:t.pointGeometry.convert(e.bottom||[0,0]),"bottom-left":t.pointGeometry.convert(e["bottom-left"]||[0,0]),"bottom-right":t.pointGeometry.convert(e["bottom-right"]||[0,0]),left:t.pointGeometry.convert(e.left||[0,0]),right:t.pointGeometry.convert(e.right||[0,0])}}return _r(new t.pointGeometry(0,0))}const vr={supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends Ki{constructor(e){var n;if(t.PerformanceUtils.mark(t.PerformanceMarkers.create),null!=(e=t.extend({},nr,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ei(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new tr,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},er,e.locale),this._clickTolerance=e.clickTolerance,this._pixelRatio=null!==(n=e.pixelRatio)&&void 0!==n?n:devicePixelRatio,this._requestManager=new o(e.transformRequest),"string"==typeof e.container){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),"undefined"!=typeof window&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Xi(this,e),this._hash=e.hash&&new ni("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Ji({customAttribution:e.customAttribution})),e.maplibreLogo&&this.addControl(new Qi,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.Event(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.Event(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new t.Event("sourcedataabort",e))}))}_getMapId(){return this._mapId}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}resize(e){const n=this._containerDimensions(),i=n[0],r=n[1];this._resizeCanvas(i,r,this.getPixelRatio()),this.transform.resize(i,r),this.painter.resize(i,r,this.getPixelRatio());const s=!this._moving;return s&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),s&&this.fire(new t.Event("moveend",e)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(t){const[e,n]=this._containerDimensions();this._pixelRatio=t,this._resizeCanvas(e,n,t),this.painter.resize(e,n,t)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(e){return this.transform.locationPoint(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation(t.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let i=!1;const r=r=>{const s=this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[];s.length?i||(i=!0,n.call(this,new hi(t,this,r.originalEvent,{features:s}))):i=!1};return{layer:e,listener:n,delegates:{mousemove:r,mouseout:()=>{i=!1}}}}if("mouseleave"===t||"mouseout"===t){let i=!1;const r=r=>{(this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?i=!0:i&&(i=!1,n.call(this,new hi(t,this,r.originalEvent)))},s=e=>{i&&(i=!1,n.call(this,new hi(t,this,e.originalEvent)))};return{layer:e,listener:n,delegates:{mousemove:r,mouseout:s}}}{const i=t=>{const i=this.getLayer(e)?this.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,n.call(this,t),delete t.features)};return{layer:e,listener:n,delegates:{[t]:i}}}}on(t,e,n){if(void 0===n)return super.on(t,e);const i=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(t,e,n){if(void 0===n)return super.once(t,e);const i=this._createDelegatedListener(t,e,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(t,e,n){return void 0===n?super.off(t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&(i=>{const r=this._delegatedListeners[t];for(let t=0;t<r.length;t++){const i=r[t];if(i.layer===e&&i.listener===n){for(const t in i.delegates)this.off(t,i.delegates[t]);return r.splice(t,1),this}}})(),this)}queryRenderedFeatures(e,n){if(!this.style)return[];let i;if(void 0!==n||void 0===e||e instanceof t.pointGeometry||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.pointGeometry||"number"==typeof e[0])i=[t.pointGeometry.convert(e)];else{const n=t.pointGeometry.convert(e[0]),r=t.pointGeometry.convert(e[1]);i=[n,new t.pointGeometry(r.x,n.y),r,new t.pointGeometry(n.x,r.y),n]}return this.style.queryRenderedFeatures(i,n,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new ne(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ne(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const i=this._requestManager.transformRequest(e,t.ResourceType.Style);t.getJSON(i,((e,i)=>{e?this.fire(new t.ErrorEvent(e)):i&&this._updateDiff(i,n)}))}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e)&&this._update(!0)}catch(i){t.warnOnce(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(e){const n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`)))}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const n=t[e]._tiles;for(const t in n){const e=n[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,n,{pixelRatio:i=1,sdf:r=!1,stretchX:s,stretchY:o,content:a}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||t.isImageBitmap(n)){const{width:l,height:c,data:u}=t.exported.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},u),pixelRatio:i,stretchX:s,stretchY:o,content:a,sdf:r,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:u}=n,h=n;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},new Uint8Array(u)),pixelRatio:i,stretchX:s,stretchY:o,content:a,sdf:r,version:0,userImage:h}),h.onAdd&&h.onAdd(this,e)}}}updateImage(e,n){const i=this.style.getImage(e);if(!i)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof HTMLImageElement||t.isImageBitmap(n)?t.exported.getImageData(n):n,{width:s,height:o,data:a}=r;if(void 0===s||void 0===o)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==i.data.width||o!==i.data.height)return this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const l=!(n instanceof HTMLImageElement||t.isImageBitmap(n));i.data.replace(a,l),this.style.updateImage(e,i)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)}setFilter(t,e,n={}){return this.style.setFilter(t,e,n),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,n,i={}){return this.style.setPaintProperty(t,e,n,i),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,n,i={}){return this.style.setLayoutProperty(t,e,n,i),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map","mapboxgl-map");const e=this._canvasContainer=s.create("div","maplibregl-canvas-container mapboxgl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=s.create("canvas","maplibregl-canvas mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1],this.getPixelRatio());const i=this._controlContainer=s.create("div","maplibregl-control-container mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{r[t]=s.create("div",`maplibregl-ctrl-${t} mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e,n){this._canvas.width=n*t,this._canvas.height=n*e,this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);i?(this.painter=new Kn(i,this.transform),t.exported$1.testSupport(i)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(e){let n,i=0;const r=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,n),i=t.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=t.exported.now();this.style.zoomHistory.update(e,n);const i=new t.EvaluationParameters(e,{now:n,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(s=!0,this._crossFadingFactor=r),this.style.update(i)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.PerformanceUtils.mark(t.PerformanceMarkers.load),this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const e=t.exported.now()-i;r.endQueryEXT(r.TIME_ELAPSED_EXT,n),setTimeout((()=>{const i=r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:i}))}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const n=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:n}))}),50)}const o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,t.PerformanceUtils.mark(t.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),s.remove(this._canvasContainer),s.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),t.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=t.exported.frame((e=>{t.PerformanceUtils.frame(e),this._frame=null,this._render(e)})))}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(e,n){t.setCacheLimits(e,n)}},NavigationControl:class{constructor(e){this.options=t.extend({},ir,e),this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),s.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),s.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=s.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){s.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const n=s.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){const n=this._map._getUIString(`NavigationControl.${e}`);t.title=n,t.setAttribute("aria-label",n)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({},cr,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(t){var e;return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),e=this._setupUI,void 0!==ur?e(ur):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then((t=>{ur="denied"!==t.state,e(ur)})):(ur=!!window.navigator.geolocation,e(ur)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),s.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,hr=0,dr=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=this._map.getBearing(),s=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),s,{geolocateSource:!0})}_updateMarker(e){if(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),i=e.distanceTo(n),r=Math.ceil(2*this._accuracy/i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&dr)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=s.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),s.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new lr(this._dotElement),this._circleElement=s.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))}))}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":hr--,dr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),hr++,hr>1?(t={maximumAge:6e5,timeout:0},dr=!0):(t=this.options.positionOptions,dr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ji,LogoControl:Qi,ScaleControl:class{constructor(e){this.options=t.extend({},pr,e),t.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){fr(this._map,this._container,this.options)}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(t){this.options.unit=t,fr(this._map,this._container,this.options)}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=s.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){s.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=s.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);s.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(gr),e),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=t;i=n.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=s.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){this._container&&this._container.classList.add(t)}removeClassName(t){this._container&&this._container.classList.remove(t)}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}_createCloseButton(){this.options.closeButton&&(this._closeButton=s.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(t){this._update(t.point)}_onMouseMove(t){this._update(t.point)}_onDrag(t){this._update(t.point)}_update(t){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(this._container||(this._container=s.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=s.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((t=>this._container.classList.add(t))),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sr(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const e=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let n=this.options.anchor;const i=_r(this.options.offset);if(!n){const t=this._container.offsetWidth,r=this._container.offsetHeight;let s;s=e.y+i.bottom.y<r?["top"]:e.y>this._map.transform.height-r?["bottom"]:[],e.x<t/2?s.push("left"):e.x>this._map.transform.width-t/2&&s.push("right"),n=0===s.length?"bottom":s.join("-")}const r=e.add(i[n]).round();s.setTransform(this._container,`${or[n]} translate(${r.x}px,${r.y}px)`),ar(this._container,n,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(yr);t&&t.focus()}_onClose(){this.remove()}},Marker:lr,Style:ne,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.pointGeometry,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,AJAXError:t.AJAXError,config:t.config,CanvasSource:D,GeoJSONSource:C,ImageSource:z,RasterDEMTileSource:I,RasterTileSource:k,VectorTileSource:A,VideoSource:L,prewarm:function(){X().acquire($)},clearPrewarmedResources:function(){const t=H;t&&(t.isPreloaded()&&1===t.numActive()?(t.release($),H=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return W.workerCount},set workerCount(t){W.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",addProtocol(e,n){t.config.REGISTERED_PROTOCOLS[e]=n},removeProtocol(e){delete t.config.REGISTERED_PROTOCOLS[e]}};return Yi.extend(vr,{isSafari:t.isSafari,getPerformanceMetrics:t.PerformanceUtils.getPerformanceMetrics}),vr})),n}()}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,n),s.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var s=Object.create(null);n.r(s);var o={};t=t||[null,e({}),e([]),e(e)];for(var a=2&r&&i;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>i[t]));return o.default=()=>i,n.d(s,o),s}})(),n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce(((e,i)=>(n.f[i](t,e),e)),[])),n.u=t=>"static/js/"+t+"."+{636:"e0371486",787:"df7b3600"}[t]+".chunk.js",n.miniCssF=t=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={},e="bird-tracking-map:";n.l=(i,r,s,o)=>{if(t[i])t[i].push(r);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==e+s){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+s),a.src=i),t[i]=[r];var d=(e,n)=>{a.onerror=a.onload=null,clearTimeout(p);var r=t[i];if(delete t[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((t=>t(n))),e)return e(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="./",(()=>{var t={179:0};n.f.j=(e,i)=>{var r=n.o(t,e)?t[e]:void 0;if(0!==r)if(r)i.push(r[2]);else{var s=new Promise(((n,i)=>r=t[e]=[n,i]));i.push(r[2]=s);var o=n.p+n.u(e),a=new Error;n.l(o,(i=>{if(n.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var s=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,r[1](a)}}),"chunk-"+e,e)}};var e=(e,i)=>{var r,s,o=i[0],a=i[1],l=i[2],c=0;if(o.some((e=>0!==t[e]))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(l)l(n)}for(e&&e(i);c<o.length;c++)s=o[c],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0},i=self.webpackChunkbird_tracking_map=self.webpackChunkbird_tracking_map||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),(()=>{"use strict";var t=n(791),e=n(250);const i=n(399).R(10,{lum:50,sat:75,rgb:!0}).map((t=>t.replace("rgb(","").replace(")","").split(",").map((t=>Number(t))))),r=[{name:"Aegypius monachus",name_en:"Cinereous vulture",name_fr:"Vautour moine",type:"raptor"},{name:"Aquila clanga",name_en:"Greater spotted eagle",name_fr:"Aigle criard",type:"raptor"},{name:"Aquila pomarina",name_en:"Lesser spotted eagle",name_fr:"Aigle Pomarin",type:"raptor"},{name:"Botaurus stellaris",name_en:"Eurasian bittern",name_fr:"Butor \xe9toil\xe9",type:"other"},{name:"Buteo buteo",name_en:"Common buzzard",name_fr:"Buse variable",type:"raptor"},{name:"Ciconia ciconia",name_en:"White stork",name_fr:"Cigogne blanche",type:"other"},{name:"Ciconia nigra",name_en:"Black stork",name_fr:"Cigogne noire",type:"other"},{name:"Grus grus",name_en:"Common crane",name_fr:"Grue cendr\xe9e",type:"other"},{name:"Haliaeetus albicilla",name_en:"White-tailed eagle",name_fr:"Pygargue \xe0 queue blanche",type:"raptor"},{name:"Pandion haliaetus",name_en:"Osprey",name_fr:"Balbuzard p\xeacheur",type:"raptor"}].map(((t,e)=>({...t,color:i[e]}))),s=r.reduce(((t,e)=>({...t,[e.name]:{...e}})),{});var o=n(184);const a=(0,t.createContext)(),l=e=>{let{children:n,initial:i={}}=e;const[r,s]=(0,t.useState)(i);return(0,o.jsx)(a.Provider,{value:{settings:r,setSettings:s},children:n})},c=(e,n)=>{const{settings:i,setSettings:r}=(0,t.useContext)(a);return[i[e]||n,t=>{r({...i,[e]:t})}]},u=t=>{let{species:{name:e,name_en:n,color:i},isActive:r,setActive:s=(()=>{}),setHighlighted:a}=t;return(0,o.jsxs)("label",{style:{"--speciesColor":`rgb(${i})`},className:"speciesToggle "+(r?"active":""),onMouseEnter:()=>a(e),onMouseLeave:()=>a(null),children:[(0,o.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{s(!r)}}),(0,o.jsx)("div",{className:"speciesPic u-mobileHidden",style:{backgroundImage:`url(imgs/species/${e.replace(" ","_").toLocaleLowerCase()}.jpg)`}}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"speciesCommonName",children:n}),(0,o.jsx)("div",{className:"speciesLatinName u-mobileHidden",children:e})]})]})},h=()=>{const[,t]=c("highlightedSpecies"),[e,n]=c("activeSpeciesList",[]),i=i=>(0,o.jsx)(u,{species:i,setHighlighted:t,isActive:e.includes(i.name),setActive:t=>{n(t?[...e,i.name]:e.filter((t=>t!==i.name)))}},i.name);return(0,o.jsxs)("div",{className:"birdControls",children:[(0,o.jsxs)("div",{className:"birdType",children:[(0,o.jsx)("h2",{className:"u-mobileHidden",children:"Raptors"}),(0,o.jsx)("div",{className:"birdToggles",children:r.filter((t=>"raptor"===t.type)).map(i)})]}),(0,o.jsxs)("div",{className:"birdType",children:[(0,o.jsx)("h2",{className:"u-mobileHidden",children:'"Long legs"'}),(0,o.jsx)("div",{className:"birdToggles",children:r.filter((t=>"raptor"!==t.type)).map(i)})]})]})};function d(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function p(t){return d(1,arguments),t instanceof Date||"object"===typeof t&&"[object Date]"===Object.prototype.toString.call(t)}function f(t){d(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||"object"===typeof t&&"[object Date]"===e?new Date(t.getTime()):"number"===typeof t||"[object Number]"===e?new Date(t):("string"!==typeof t&&"[object String]"!==e||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function m(t){if(d(1,arguments),!p(t)&&"number"!==typeof t)return!1;var e=f(t);return!isNaN(Number(e))}var g={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const y=function(t,e,n){var i,r=g[t];return i="string"===typeof r?r:1===e?r.one:r.other.replace("{{count}}",e.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+i:i+" ago":i};function _(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width?String(e.width):t.defaultWidth,i=t.formats[n]||t.formats[t.defaultWidth];return i}}var v={date:_({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:_({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:_({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var x={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function b(t){return function(e,n){var i,r=n||{};if("formatting"===(r.context?String(r.context):"standalone")&&t.formattingValues){var s=t.defaultFormattingWidth||t.defaultWidth,o=r.width?String(r.width):s;i=t.formattingValues[o]||t.formattingValues[s]}else{var a=t.defaultWidth,l=r.width?String(r.width):t.defaultWidth;i=t.values[l]||t.values[a]}return i[t.argumentCallback?t.argumentCallback(e):e]}}function w(t){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.width,r=i&&t.matchPatterns[i]||t.matchPatterns[t.defaultMatchWidth],s=e.match(r);if(!s)return null;var o,a=s[0],l=i&&t.parsePatterns[i]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?E(l,(function(t){return t.test(a)})):S(l,(function(t){return t.test(a)}));o=t.valueCallback?t.valueCallback(c):c,o=n.valueCallback?n.valueCallback(o):o;var u=e.slice(a.length);return{value:o,rest:u}}}function S(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(t[n]))return n}function E(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return n}var T;const A={code:"en-US",formatDistance:y,formatLong:v,formatRelative:function(t,e,n,i){return x[t]},localize:{ordinalNumber:function(t,e){var n=Number(t),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:b({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:b({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:b({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:b({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:b({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(T={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(t){return parseInt(t,10)}},function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.match(T.matchPattern);if(!n)return null;var i=n[0],r=t.match(T.parsePattern);if(!r)return null;var s=T.valueCallback?T.valueCallback(r[0]):r[0];s=e.valueCallback?e.valueCallback(s):s;var o=t.slice(i.length);return{value:s,rest:o}}),era:w({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:w({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:w({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:w({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:w({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function k(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function P(t,e){d(2,arguments);var n=f(t).getTime(),i=k(e);return new Date(n+i)}function I(t,e){d(2,arguments);var n=k(e);return P(t,-n)}var C=864e5;function M(t){d(1,arguments);var e=1,n=f(t),i=n.getUTCDay(),r=(i<e?7:0)+i-e;return n.setUTCDate(n.getUTCDate()-r),n.setUTCHours(0,0,0,0),n}function z(t){d(1,arguments);var e=f(t),n=e.getUTCFullYear(),i=new Date(0);i.setUTCFullYear(n+1,0,4),i.setUTCHours(0,0,0,0);var r=M(i),s=new Date(0);s.setUTCFullYear(n,0,4),s.setUTCHours(0,0,0,0);var o=M(s);return e.getTime()>=r.getTime()?n+1:e.getTime()>=o.getTime()?n:n-1}function L(t){d(1,arguments);var e=z(t),n=new Date(0);n.setUTCFullYear(e,0,4),n.setUTCHours(0,0,0,0);var i=M(n);return i}var D=6048e5;function R(t,e){d(1,arguments);var n=e||{},i=n.locale,r=i&&i.options&&i.options.weekStartsOn,s=null==r?0:k(r),o=null==n.weekStartsOn?s:k(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var a=f(t),l=a.getUTCDay(),c=(l<o?7:0)+l-o;return a.setUTCDate(a.getUTCDate()-c),a.setUTCHours(0,0,0,0),a}function B(t,e){d(1,arguments);var n=f(t),i=n.getUTCFullYear(),r=e||{},s=r.locale,o=s&&s.options&&s.options.firstWeekContainsDate,a=null==o?1:k(o),l=null==r.firstWeekContainsDate?a:k(r.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var c=new Date(0);c.setUTCFullYear(i+1,0,l),c.setUTCHours(0,0,0,0);var u=R(c,e),h=new Date(0);h.setUTCFullYear(i,0,l),h.setUTCHours(0,0,0,0);var p=R(h,e);return n.getTime()>=u.getTime()?i+1:n.getTime()>=p.getTime()?i:i-1}function O(t,e){d(1,arguments);var n=e||{},i=n.locale,r=i&&i.options&&i.options.firstWeekContainsDate,s=null==r?1:k(r),o=null==n.firstWeekContainsDate?s:k(n.firstWeekContainsDate),a=B(t,e),l=new Date(0);l.setUTCFullYear(a,0,o),l.setUTCHours(0,0,0,0);var c=R(l,e);return c}var F=6048e5;function V(t,e){for(var n=t<0?"-":"",i=Math.abs(t).toString();i.length<e;)i="0"+i;return n+i}const N={y:function(t,e){var n=t.getUTCFullYear(),i=n>0?n:1-n;return V("yy"===e?i%100:i,e.length)},M:function(t,e){var n=t.getUTCMonth();return"M"===e?String(n+1):V(n+1,2)},d:function(t,e){return V(t.getUTCDate(),e.length)},a:function(t,e){var n=t.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(t,e){return V(t.getUTCHours()%12||12,e.length)},H:function(t,e){return V(t.getUTCHours(),e.length)},m:function(t,e){return V(t.getUTCMinutes(),e.length)},s:function(t,e){return V(t.getUTCSeconds(),e.length)},S:function(t,e){var n=e.length,i=t.getUTCMilliseconds();return V(Math.floor(i*Math.pow(10,n-3)),e.length)}};var U="midnight",j="noon",G="morning",q="afternoon",$="evening",W="night",Z={G:function(t,e,n){var i=t.getUTCFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(i,{width:"abbreviated"});case"GGGGG":return n.era(i,{width:"narrow"});default:return n.era(i,{width:"wide"})}},y:function(t,e,n){if("yo"===e){var i=t.getUTCFullYear(),r=i>0?i:1-i;return n.ordinalNumber(r,{unit:"year"})}return N.y(t,e)},Y:function(t,e,n,i){var r=B(t,i),s=r>0?r:1-r;return"YY"===e?V(s%100,2):"Yo"===e?n.ordinalNumber(s,{unit:"year"}):V(s,e.length)},R:function(t,e){return V(z(t),e.length)},u:function(t,e){return V(t.getUTCFullYear(),e.length)},Q:function(t,e,n){var i=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"Q":return String(i);case"QQ":return V(i,2);case"Qo":return n.ordinalNumber(i,{unit:"quarter"});case"QQQ":return n.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(i,{width:"narrow",context:"formatting"});default:return n.quarter(i,{width:"wide",context:"formatting"})}},q:function(t,e,n){var i=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"q":return String(i);case"qq":return V(i,2);case"qo":return n.ordinalNumber(i,{unit:"quarter"});case"qqq":return n.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(i,{width:"narrow",context:"standalone"});default:return n.quarter(i,{width:"wide",context:"standalone"})}},M:function(t,e,n){var i=t.getUTCMonth();switch(e){case"M":case"MM":return N.M(t,e);case"Mo":return n.ordinalNumber(i+1,{unit:"month"});case"MMM":return n.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(i,{width:"narrow",context:"formatting"});default:return n.month(i,{width:"wide",context:"formatting"})}},L:function(t,e,n){var i=t.getUTCMonth();switch(e){case"L":return String(i+1);case"LL":return V(i+1,2);case"Lo":return n.ordinalNumber(i+1,{unit:"month"});case"LLL":return n.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(i,{width:"narrow",context:"standalone"});default:return n.month(i,{width:"wide",context:"standalone"})}},w:function(t,e,n,i){var r=function(t,e){d(1,arguments);var n=f(t),i=R(n,e).getTime()-O(n,e).getTime();return Math.round(i/F)+1}(t,i);return"wo"===e?n.ordinalNumber(r,{unit:"week"}):V(r,e.length)},I:function(t,e,n){var i=function(t){d(1,arguments);var e=f(t),n=M(e).getTime()-L(e).getTime();return Math.round(n/D)+1}(t);return"Io"===e?n.ordinalNumber(i,{unit:"week"}):V(i,e.length)},d:function(t,e,n){return"do"===e?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):N.d(t,e)},D:function(t,e,n){var i=function(t){d(1,arguments);var e=f(t),n=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var i=e.getTime(),r=n-i;return Math.floor(r/C)+1}(t);return"Do"===e?n.ordinalNumber(i,{unit:"dayOfYear"}):V(i,e.length)},E:function(t,e,n){var i=t.getUTCDay();switch(e){case"E":case"EE":case"EEE":return n.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},e:function(t,e,n,i){var r=t.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(e){case"e":return String(s);case"ee":return V(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},c:function(t,e,n,i){var r=t.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(e){case"c":return String(s);case"cc":return V(s,e.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"});default:return n.day(r,{width:"wide",context:"standalone"})}},i:function(t,e,n){var i=t.getUTCDay(),r=0===i?7:i;switch(e){case"i":return String(r);case"ii":return V(r,e.length);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return n.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},a:function(t,e,n){var i=t.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,e,n){var i,r=t.getUTCHours();switch(i=12===r?j:0===r?U:r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,e,n){var i,r=t.getUTCHours();switch(i=r>=17?$:r>=12?q:r>=4?G:W,e){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,e,n){if("ho"===e){var i=t.getUTCHours()%12;return 0===i&&(i=12),n.ordinalNumber(i,{unit:"hour"})}return N.h(t,e)},H:function(t,e,n){return"Ho"===e?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):N.H(t,e)},K:function(t,e,n){var i=t.getUTCHours()%12;return"Ko"===e?n.ordinalNumber(i,{unit:"hour"}):V(i,e.length)},k:function(t,e,n){var i=t.getUTCHours();return 0===i&&(i=24),"ko"===e?n.ordinalNumber(i,{unit:"hour"}):V(i,e.length)},m:function(t,e,n){return"mo"===e?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):N.m(t,e)},s:function(t,e,n){return"so"===e?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):N.s(t,e)},S:function(t,e){return N.S(t,e)},X:function(t,e,n,i){var r=(i._originalDate||t).getTimezoneOffset();if(0===r)return"Z";switch(e){case"X":return X(r);case"XXXX":case"XX":return Y(r);default:return Y(r,":")}},x:function(t,e,n,i){var r=(i._originalDate||t).getTimezoneOffset();switch(e){case"x":return X(r);case"xxxx":case"xx":return Y(r);default:return Y(r,":")}},O:function(t,e,n,i){var r=(i._originalDate||t).getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+H(r,":");default:return"GMT"+Y(r,":")}},z:function(t,e,n,i){var r=(i._originalDate||t).getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+H(r,":");default:return"GMT"+Y(r,":")}},t:function(t,e,n,i){var r=i._originalDate||t;return V(Math.floor(r.getTime()/1e3),e.length)},T:function(t,e,n,i){return V((i._originalDate||t).getTime(),e.length)}};function H(t,e){var n=t>0?"-":"+",i=Math.abs(t),r=Math.floor(i/60),s=i%60;if(0===s)return n+String(r);var o=e||"";return n+String(r)+o+V(s,2)}function X(t,e){return t%60===0?(t>0?"-":"+")+V(Math.abs(t)/60,2):Y(t,e)}function Y(t,e){var n=e||"",i=t>0?"-":"+",r=Math.abs(t);return i+V(Math.floor(r/60),2)+n+V(r%60,2)}const K=Z;function J(t,e){switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}}function Q(t,e){switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}}var tt={p:Q,P:function(t,e){var n,i=t.match(/(P+)(p+)?/)||[],r=i[1],s=i[2];if(!s)return J(t,e);switch(r){case"P":n=e.dateTime({width:"short"});break;case"PP":n=e.dateTime({width:"medium"});break;case"PPP":n=e.dateTime({width:"long"});break;default:n=e.dateTime({width:"full"})}return n.replace("{{date}}",J(r,e)).replace("{{time}}",Q(s,e))}};const et=tt;function nt(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}var it=["D","DD"],rt=["YY","YYYY"];function st(t){return-1!==it.indexOf(t)}function ot(t){return-1!==rt.indexOf(t)}function at(t,e,n){if("YYYY"===t)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("YY"===t)throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("D"===t)throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("DD"===t)throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(n,"`; see: https://git.io/fxCyr"))}var lt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ct=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ut=/^'([^]*?)'?$/,ht=/''/g,dt=/[a-zA-Z]/;function pt(t,e,n){d(2,arguments);var i=String(e),r=n||{},s=r.locale||A,o=s.options&&s.options.firstWeekContainsDate,a=null==o?1:k(o),l=null==r.firstWeekContainsDate?a:k(r.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var c=s.options&&s.options.weekStartsOn,u=null==c?0:k(c),h=null==r.weekStartsOn?u:k(r.weekStartsOn);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!s.localize)throw new RangeError("locale must contain localize property");if(!s.formatLong)throw new RangeError("locale must contain formatLong property");var p=f(t);if(!m(p))throw new RangeError("Invalid time value");var g=nt(p),y=I(p,g),_={firstWeekContainsDate:l,weekStartsOn:h,locale:s,_originalDate:p},v=i.match(ct).map((function(t){var e=t[0];return"p"===e||"P"===e?(0,et[e])(t,s.formatLong,_):t})).join("").match(lt).map((function(n){if("''"===n)return"'";var i=n[0];if("'"===i)return ft(n);var o=K[i];if(o)return!r.useAdditionalWeekYearTokens&&ot(n)&&at(n,e,t),!r.useAdditionalDayOfYearTokens&&st(n)&&at(n,e,t),o(y,n,s.localize,_);if(i.match(dt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return n})).join("");return v}function ft(t){return t.match(ut)[1].replace(ht,"'")}const mt=t=>{let{isTimeRunning:e,setIsTimeRunning:n,time:i,timeRange:r,setTime:s}=t;const[a,l]=c("sameYear",!1),[u,h]=c("speed");return(0,o.jsxs)("div",{className:"timeControl",children:[(0,o.jsx)("div",{className:"time",children:pt(new Date(1e3*i),a?"dd MMMM":"dd MMM yyyy")}),(0,o.jsxs)("div",{className:"timePlayer",children:[(0,o.jsx)("button",{className:"playPauseButton "+(e?"pause":"play"),"aria-label":e?"Pause":"Play",onClick:()=>n(!e)}),(0,o.jsx)("input",{className:"timeScale",type:"range",step:86400,min:r[0],max:r[1],value:i,onChange:t=>s(Number(t.target.value))})]}),(0,o.jsxs)("div",{className:"u-flex",children:[(0,o.jsxs)("label",{className:"sameYear",children:[(0,o.jsx)("input",{type:"checkbox",checked:a,onChange:()=>l(!a)}),"Merge observations in a single year"]}),(0,o.jsxs)("div",{className:"u-flex",children:[(0,o.jsx)("button",{onClick:()=>h(u>=5?1:u+2),children:"Speed"}),(0,o.jsx)("div",{className:"speedIndicator",style:{"--level":Math.floor(100*u/5)+"%"}})]})]})]})},gt=()=>{const[e,n]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{document.body.classList.toggle("creditsOpen",e)}),[e]),(0,o.jsxs)("div",{className:"creditsWrapper",children:[(0,o.jsxs)("div",{className:"creditsHeader u-desktopHidden",children:[(0,o.jsx)("h1",{children:"Flying paths of some birds"}),(0,o.jsx)("button",{className:"toggleCredits",type:"button",onClick:()=>n(!e),children:e?"Close":"?"})]}),(0,o.jsxs)("div",{className:"credits",children:[(0,o.jsx)("h2",{className:"u-mobileHidden",children:"Credits"}),(0,o.jsxs)("p",{children:["Data source: ",(0,o.jsx)("a",{href:"https://gbif.org",children:"GBIF.org"}),": BirdMap Data -"," ",(0,o.jsx)("a",{href:"https://www.gbif.org/dataset/712dba38-74cc-4704-87c0-63d1bf8484bc",children:"GPS tracking of Storks, Cranes and birds of prey, breeding in Northern and Eastern Europe"})," ","(",(0,o.jsx)("a",{href:"https://doi.org/10.15468/dl.fufxjs",children:"09 May 2022"}),")"]}),(0,o.jsxs)("p",{className:"u-mobileHidden",children:["Bird pictures: ",(0,o.jsx)("a",{href:"https://commons.wikimedia.org",children:"WikiMedia Commons"})]}),(0,o.jsxs)("p",{children:["Map background: \xa9 ",(0,o.jsx)("a",{href:"https://carto.com/about-carto/",children:"CARTO"})," \xa9"," ",(0,o.jsx)("a",{href:"http://www.openstreetmap.org/about/",children:"OpenStreetMap"})," contributors"]}),(0,o.jsxs)("p",{children:["Built with ",(0,o.jsx)("a",{href:"https://deck.gl/",children:"deck.gl"})," and"," ",(0,o.jsx)("a",{href:"https://maplibre.org/projects/maplibre-gl-js/",children:"MapLibre-GL"}),"."," ",(0,o.jsx)("a",{href:"https://github.com/bbecquet/bird-tracking",children:"Source code"})]}),(0,o.jsxs)("p",{children:["Author: ",(0,o.jsx)("a",{href:"https://bbecquet.net/",children:"Benjamin Becquet"}),"."]})]})]})},yt=t=>{let{time:e,timeRange:n,setTime:i,isTimeRunning:r,setIsTimeRunning:s}=t;return(0,o.jsxs)("div",{id:"panel",children:[(0,o.jsx)("h1",{className:"u-mobileHidden",children:"Flying paths of some birds"}),(0,o.jsx)(mt,{time:e,timeRange:n,setTime:i,isTimeRunning:r,setIsTimeRunning:s}),(0,o.jsx)(h,{}),(0,o.jsx)(gt,{})]})};function _t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let vt=1,xt=1;class bt{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=t,s=vt++,o={time:0,delay:e,duration:n,rate:i,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}getTime(t){if(void 0===t)return this.time;const e=this.channels.get(t);return void 0===e?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const i of e)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:t,channel:e}=i;t.setTime(this.getTime(e))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=xt++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay;n>=t.duration*t.repeat?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}const wt="Awaiting state",St="Matched. State transferred from previous layer",Et="Initialized",Tt="Discarded. Awaiting garbage collection",At="No longer matched. Awaiting garbage collection",kt="Finalized! Awaiting garbage collection",Pt=Symbol.for("component"),It=Symbol.for("asyncPropDefaults"),Ct=Symbol.for("asyncPropOriginal"),Mt=Symbol.for("asyncPropResolved");function zt(t){if("undefined"!==typeof window&&"object"===typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!==typeof process&&"object"===typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"===typeof navigator&&"string"===typeof navigator.userAgent&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Lt(){return!("object"===typeof process&&"[object process]"===String(process)&&!process.browser)||zt()}const Dt="undefined"!==typeof __VERSION__?__VERSION__:"untranspiled source";Lt();class Rt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";_t(this,"storage",void 0),_t(this,"id",void 0),_t(this,"config",{}),this.storage=function(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(e){return null}}(n),this.id=t,this.config={},Object.assign(this.config,e),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){return this.config={},this.updateConfiguration(t)}updateConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Bt(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Ot;function Ft(t){return"string"===typeof t?Ot[t.toUpperCase()]||Ot.WHITE:t}function Vt(t,e){if(!t)throw new Error(e||"Assertion failed")}!function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Ot||(Ot={}));const Nt={self:"undefined"!==typeof self&&self,window:"undefined"!==typeof window&&window,global:"undefined"!==typeof n.g&&n.g,document:"undefined"!==typeof document&&document,process:"object"===typeof process&&process},Ut=(globalThis,Nt.window||Nt.self||Nt.global),jt=Nt.process||{};console;function Gt(){let t;var e,n;if(Lt&&"performance"in Ut)t=null===Ut||void 0===Ut||null===(e=Ut.performance)||void 0===e||null===(n=e.now)||void 0===n?void 0:n.call(e);else if("hrtime"in jt){var i;const e=null===jt||void 0===jt||null===(i=jt.hrtime)||void 0===i?void 0:i.call(jt);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var qt=n(249);const $t={debug:Lt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Wt={enabled:!0,level:0};function Zt(){}const Ht={},Xt={once:!0};class Yt{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};_t(this,"id",void 0),_t(this,"VERSION",Dt),_t(this,"_startTs",Gt()),_t(this,"_deltaTs",Gt()),_t(this,"_storage",void 0),_t(this,"userData",{}),_t(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this._storage=new Rt("__probe-".concat(this.id,"__"),Wt),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)"function"===typeof t[r]&&(e.find((t=>r===t))||(t[r]=t[r].bind(t)))}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Gt()-this._startTs).toPrecision(10))}getDelta(){return Number((Gt()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}setLevel(t){return this._storage.updateConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.updateConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){Vt(t,e)}warn(t){return this._getLogFunction(0,t,$t.warn,arguments,Xt)}error(t){return this._getLogFunction(0,t,$t.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,$t.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,$t.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction(t,e,$t.debug||$t.info,arguments,Xt)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||Zt,n&&[n],{tag:Qt(e)}):Zt}image(t){let{logLevel:e,priority:n,image:i,message:r="",scale:s=1}=t;return this._shouldLog(e||n)?Lt?function(t){let{image:e,message:n="",scale:i=1}=t;if("string"===typeof e){const t=new Image;return t.onload=()=>{const e=Bt(t,n,i);console.log(...e)},t.src=e,Zt}const r=e.nodeName||"";if("img"===r.toLowerCase())return console.log(...Bt(e,n,i)),Zt;if("canvas"===r.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...Bt(t,n,i)),t.src=e.toDataURL(),Zt}return Zt}({image:i,message:r,scale:s}):function(t){let{image:e,message:n="",scale:i=1}=t;return qt.nodeAsciifyImage({image:e,message:n,scale:i}),Zt}({image:i,message:r,scale:s}):Zt}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Zt)}group(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=Jt({logLevel:t,message:e,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Zt)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Kt(t)}_getLogFunction(t,e,n,i,r){if(this._shouldLog(t)){r=Jt({logLevel:t,message:e,args:i,opts:r}),Vt(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Gt();const s=r.tag||r.message;if(r.once){if(Ht[s])return Zt;Ht[s]=Gt()}return e=function(t,e,n){if("string"===typeof e){const o=n.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(n.total)):"";e=n.time?"".concat(t,": ").concat(o,"  ").concat(e):"".concat(t,": ").concat(e),i=e,r=n.color,s=n.background,Lt||"string"!==typeof i||(r&&(r=Ft(r),i="\x1b[".concat(r,"m").concat(i,"\x1b[39m")),s&&(r=Ft(s),i="\x1b[".concat(s+10,"m").concat(i,"\x1b[49m"))),e=i}var i,r,s;return e}(this.id,r.message,r),n.bind(console,e,...r.args)}return Zt}}function Kt(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Vt(Number.isFinite(e)&&e>=0),e}function Jt(t){const{logLevel:e,message:n}=t;t.logLevel=Kt(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":void 0!==n&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e)}"function"===typeof t.message&&(t.message=t.message());const r=typeof t.message;return Vt("string"===r||"object"===r),Object.assign(t,{args:i},t.opts)}function Qt(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}_t(Yt,"VERSION",Dt);const te=new Yt({id:"deck"});let ee={};function ne(t,e,n,i){te.level>0&&ee[t]&&ee[t].call(null,e,n,i)}function ie(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;return Array.isArray(t)?re(t,e,[]):e(t)?[t]:[]}function re(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?re(r,e,n):e(r)&&n.push(r)}return n}function se(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return e}function oe(){let t;if("undefined"!==typeof window&&window.performance)t=window.performance.now();else if("undefined"!==typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}class ae{constructor(t,e){_t(this,"name",void 0),_t(this,"type",void 0),_t(this,"sampleSize",1),_t(this,"time",void 0),_t(this,"count",void 0),_t(this,"samples",void 0),_t(this,"lastTiming",void 0),_t(this,"lastSampleTime",void 0),_t(this,"lastSampleCount",void 0),_t(this,"_count",0),_t(this,"_time",0),_t(this,"_samples",0),_t(this,"_startTime",0),_t(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=oe(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(oe()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class le{constructor(t){_t(this,"id",void 0),_t(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(this.stats[e]=t instanceof ae?t:new ae(e,n)),this.stats[e]}}const ce=t=>"boolean"===typeof t,ue=t=>"function"===typeof t,he=t=>null!==t&&"object"===typeof t,de=t=>he(t)&&t.constructor==={}.constructor,pe=t=>"undefined"!==typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,fe=t=>"undefined"!==typeof Blob&&t instanceof Blob,me=t=>(t=>"undefined"!==typeof ReadableStream&&t instanceof ReadableStream||he(t)&&ue(t.tee)&&ue(t.cancel)&&ue(t.getReader))(t)||(t=>he(t)&&ue(t.read)&&ue(t.pipe)&&ce(t.readable))(t);function ge(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function ye(t){var e;if(!t)return!1;Array.isArray(t)&&(t=t[0]);return Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions)}function _e(t){var e,n;let i;return ge(t,"null loader"),ge(ye(t),"invalid loader"),Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(n=t)&&void 0!==n&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}let ve="";const xe={};const be=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,we=/^([-\w.]+\/[-\w.+]+)/;function Se(t){const e=we.exec(t);return e?e[1]:t}function Ee(t){const e=be.exec(t);return e?e[1]:""}const Te=/\?.*/;function Ae(t){if(pe(t)){const e=ke(t.url||"");return{url:e,type:Se(t.headers.get("content-type")||"")||Ee(e)}}return fe(t)?{url:ke(t.name||""),type:t.type||""}:"string"===typeof t?{url:ke(t),type:Ee(t)}:{url:"",type:""}}function ke(t){return t.replace(Te,"")}async function Pe(t){if(pe(t))return t;const e={},n=function(t){return pe(t)?t.headers["content-length"]||-1:fe(t)?t.size:"string"===typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:r}=Ae(t);r&&(e["content-type"]=r);const s=await async function(t){const e=5;if("string"===typeof t)return"data:,".concat(t.slice(0,e));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const n=new FileReader;n.onload=e=>{var n;return t(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e)}))}if(t instanceof ArrayBuffer){const n=function(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}(t.slice(0,e));return"data:base64,".concat(n)}return null}(t);s&&(e["x-first-bytes"]=s),"string"===typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function Ie(t,e){if("string"===typeof t){t=function(t){for(const e in xe)if(t.startsWith(e)){const n=xe[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(ve).concat(t)),t}(t);let n=e;return null!==e&&void 0!==e&&e.fetch&&"function"!==typeof(null===e||void 0===e?void 0:e.fetch)&&(n=e.fetch),await fetch(t,n)}return await Pe(t)}const Ce=new Yt({id:"loaders.gl"});class Me{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}"undefined"!==typeof self&&self,"undefined"!==typeof window&&window,"undefined"!==typeof n.g&&n.g,"undefined"!==typeof document&&document;const ze=Boolean("object"!==typeof process||"[object process]"!==String(process)||process.browser),Le="undefined"!==typeof process&&process.version&&/v([0-9]*)/.exec(process.version),De=(Le&&parseFloat(Le[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){_t(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ze,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),Re={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Be(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Oe=()=>{const t=Be();return t.globalOptions=t.globalOptions||{...De},t.globalOptions};function Fe(t,e,n,i){return n=n||[],function(t,e){Ne(t,null,De,Re,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Ne(i,n.id,r,s,e)}}(t,n=Array.isArray(n)?n:[n]),je(e,t,i)}function Ve(t,e){const n=Oe(),i=t||n;return"function"===typeof i.fetch?i.fetch:he(i.fetch)?t=>Ie(t,i):null!==e&&void 0!==e&&e.fetch?null===e||void 0===e?void 0:e.fetch:Ie}function Ne(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&he(t[a]),c="baseUri"===a&&!e,u="workerUrl"===a&&e;if(!(a in n)&&!c&&!u)if(a in i)Ce.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const t=Ue(a,r);Ce.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(t))()}}}function Ue(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const e in r.options){if(t===e)return"Did you mean '".concat(r.id,".").concat(e,"'?");const s=e.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(e,"'?"))}return i}function je(t,e,n){const i={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(i,n),null===i.log&&(i.log=new Me),Ge(i,Oe()),Ge(i,e),i}function Ge(t,e){for(const n in e)if(n in e){const i=e[n];de(i)&&de(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function qe(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const $e="3.2.9";"undefined"!==typeof self&&self,"undefined"!==typeof window&&window,"undefined"!==typeof n.g&&n.g,"undefined"!==typeof document&&document;const We="object"!==typeof process||"[object process]"!==String(process)||process.browser,Ze="undefined"!==typeof window&&"undefined"!==typeof window.orientation,He="undefined"!==typeof process&&process.version&&/v([0-9]*)/.exec(process.version);He&&parseFloat(He[1]);class Xe{}const Ye=new Map;function Ke(t){qe(t.source&&!t.url||!t.source&&t.url);let e=Ye.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Je((e=t,"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var e}(t.url),Ye.set(t.url,e)),t.source&&(e=Je(t.source),Ye.set(t.source,e))),qe(e),e}function Je(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Qe(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(tn(t))i.add(t);else if(tn(t.buffer))i.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"===typeof t)for(const r in t)Qe(t[r],e,i)}else;return void 0===n?Array.from(i):[]}function tn(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!==typeof MessagePort&&t instanceof MessagePort||("undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}const en=()=>{};class nn{static isSupported(){return"undefined"!==typeof Worker&&We||"undefined"!==typeof Xe&&!We}constructor(t){_t(this,"name",void 0),_t(this,"source",void 0),_t(this,"url",void 0),_t(this,"terminated",!1),_t(this,"worker",void 0),_t(this,"onMessage",void 0),_t(this,"onError",void 0),_t(this,"_loadableURL","");const{name:e,source:n,url:i}=t;qe(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=en,this.onError=t=>console.log(t),this.worker=We?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=en,this.onError=en,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||Qe(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=Ke({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new Xe(e,{eval:!1})}else{if(!this.source)throw new Error("no worker");t=new Xe(this.source,{eval:!0})}return t.on("message",(t=>{this.onMessage(t)})),t.on("error",(t=>{this.onError(t)})),t.on("exit",(t=>{})),t}}class rn{constructor(t,e){_t(this,"name",void 0),_t(this,"workerThread",void 0),_t(this,"isRunning",!0),_t(this,"result",void 0),_t(this,"_resolve",(()=>{})),_t(this,"_reject",(()=>{})),this.name=t,this.workerThread=e,this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){qe(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){qe(this.isRunning),this.isRunning=!1,this._reject(t)}}class sn{static isSupported(){return nn.isSupported()}constructor(t){_t(this,"name","unnamed"),_t(this,"source",void 0),_t(this,"url",void 0),_t(this,"maxConcurrency",1),_t(this,"maxMobileConcurrency",1),_t(this,"onDebug",(()=>{})),_t(this,"reuseWorkers",!0),_t(this,"props",{}),_t(this,"jobQueue",[]),_t(this,"idleQueue",[]),_t(this,"count",0),_t(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e,n)=>t.done(n),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(t,e)=>t.error(e);const i=new Promise((i=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new rn(e.name,t);t.onMessage=t=>e.onMessage(n,t.type,t.payload),t.onError=t=>e.onError(n,t),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new nn({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Ze?this.maxMobileConcurrency:this.maxConcurrency}}const on={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class an{static isSupported(){return nn.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return an._workerFarm=an._workerFarm||new an({}),an._workerFarm.setProps(t),an._workerFarm}constructor(t){_t(this,"props",void 0),_t(this,"workerPools",new Map),this.props={...on},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let r=this.workerPools.get(e);return r||(r=new sn({name:e,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}_t(an,"_workerFarm",void 0);const ln="latest";async function cn(t,e,n,i,r){const s=t.id,o=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(r||"compression"!==t.id||(r=e.workerUrl),"test"===e._workerType&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let e=t.version;"latest"===e&&(e=ln);const n=e?"@".concat(e):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(n,"/dist/").concat(i)}return qe(r),r}(t,n),a=an.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",un.bind(null,r));l.postMessage("process",{input:e,options:n,context:i});const c=await l.result;return await c.result}async function un(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:o,options:a}=i;try{const n=await t(o,a);e.postMessage("done",{id:s,result:n})}catch(r){const t=r instanceof Error?r.message:"unknown error";e.postMessage("error",{id:s,error:t})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}n(521);function hn(t){return t&&"object"===typeof t&&t.isBuffer}function dn(t){if(hn(t))return function(t){if(hn(t))return new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer;return t}(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"===typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"===typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}async function pn(t){const e=[];for await(const n of t)e.push(n);return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),r=i.reduce(((t,e)=>t+e.byteLength),0),s=new Uint8Array(r);let o=0;for(const a of i)s.set(a,o),o+=a.byteLength;return s.buffer}(...e)}const fn=262144;function mn(t,e){return ze?async function*(t,e){const n=t.getReader();let i;try{for(;;){const t=i||n.read();null!==e&&void 0!==e&&e._streamReadAhead&&(i=n.read());const{done:r,value:s}=await t;if(r)return;yield dn(s)}}catch(r){n.releaseLock()}}(t,e):async function*(t,e){for await(const n of t)yield dn(n)}(t)}function gn(t,e){if("string"===typeof t)return function*(t,e){const n=(null===e||void 0===e?void 0:e.chunkSize)||262144;let i=0;const r=new TextEncoder;for(;i<t.length;){const e=Math.min(t.length-i,n),s=t.slice(i,i+e);i+=e,yield r.encode(s)}}(t,e);if(t instanceof ArrayBuffer)return function*(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{chunkSize:n=fn}=e;let i=0;for(;i<t.byteLength;){const e=Math.min(t.byteLength-i,n),r=new ArrayBuffer(e),s=new Uint8Array(t,i,e);new Uint8Array(r).set(s),i+=e,yield r}}(t,e);if(fe(t))return async function*(t,e){const n=(null===e||void 0===e?void 0:e.chunkSize)||1048576;let i=0;for(;i<t.size;){const e=i+n,r=await t.slice(i,e).arrayBuffer();i=e,yield r}}(t,e);if(me(t))return mn(t,e);if(pe(t)){return mn(t.body,e)}throw new Error("makeIterator")}const yn="Cannot convert supplied data type";async function _n(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"===typeof t||i)return function(t,e,n){if(e.text&&"string"===typeof t)return t;var i;if((i=t)&&"object"===typeof i&&i.isBuffer&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return 0===t.byteOffset&&i===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(yn)}(t,e);if(fe(t)&&(t=await Pe(t)),pe(t)){const n=t;return await async function(t){if(!t.ok){const e=await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch(n){}return e}(t);throw new Error(e)}}(n),e.binary?await n.arrayBuffer():await n.text()}if(me(t)&&(t=gn(t,n)),(r=t)&&"function"===typeof r[Symbol.iterator]||(t=>t&&"function"===typeof t[Symbol.asyncIterator])(t))return pn(t);var r;throw new Error(yn)}const vn=new Yt({id:"loaders.gl"}),xn=()=>{const t=Be();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function bn(){return xn()}const wn=/\.([^.]+)$/;function Sn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!Tn(t))return null;if(e&&!Array.isArray(e))return _e(e);let r=[];e&&(r=r.concat(e)),null!==n&&void 0!==n&&n.ignoreRegisteredLoaders||r.push(...bn()),kn(r);const s=En(t,r,n,i);if(!s&&(null===n||void 0===n||!n.nothrow))throw new Error(An(t));return s}function En(t,e,n,i){const{url:r,type:s}=Ae(t),o=r||(null===i||void 0===i?void 0:i.url);let a=null,l="";var c;(null!==n&&void 0!==n&&n.mimeType&&(a=Pn(e,null===n||void 0===n?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(null===n||void 0===n?void 0:n.mimeType)),a=a||function(t,e){const n=e&&wn.exec(e),i=n&&n[1];return i?function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,i):null}(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Pn(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||function(t,e){if(!e)return null;for(const n of t)if("string"===typeof e){if(In(e,n))return n}else if(ArrayBuffer.isView(e)){if(Cn(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer){if(Cn(e,0,n))return n}return null}(e,t),l=l||(a?"matched initial data ".concat(Mn(t)):""),a=a||Pn(e,null===n||void 0===n?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l)&&vn.log(1,"selectLoader selected ".concat(null===(c=a)||void 0===c?void 0:c.name,": ").concat(l,"."));return a}function Tn(t){return!(t instanceof Response&&204===t.status)}function An(t){const{url:e,type:n}=Ae(t);let i="No valid loader found (";i+=e?"".concat(function(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?Mn(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function kn(t){for(const e of t)_e(e)}function Pn(t,e){for(const n of t){if(n.mimeTypes&&n.mimeTypes.includes(e))return n;if(e==="application/x.".concat(n.id))return n}return null}function In(t,e){if(e.testText)return e.testText(t);return(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function Cn(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((i=>function(t,e,n,i){if(i instanceof ArrayBuffer)return function(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":return i===zn(t,e,i.length);default:return!1}}(t,e,n,i)))}function Mn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"===typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return zn(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return zn(t,0,e)}return""}function zn(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}async function Ln(t,e,n,i){qe(!i||"object"===typeof i),!e||Array.isArray(e)||ye(e)||(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:r}=Ae(t),s=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:null}(e,i),o=await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!Tn(t))return null;let r=Sn(t,e,{...n,nothrow:!0},i);if(r)return r;if(fe(t)&&(r=Sn(t=await t.slice(0,10).arrayBuffer(),e,n,i)),!r&&(null===n||void 0===n||!n.nothrow))throw new Error(An(t));return r}(t,s,n);return o?(i=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n)return n;const i={fetch:Ve(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}({url:r,parse:Ln,loaders:s},n=Fe(n,o,s,r),i),await async function(t,e,n,i){if(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$e;qe(t,"no worker provided");const n=t.version}(t),pe(e)){const t=e,{ok:n,redirected:r,status:s,statusText:o,type:a,url:l}=t,c=Object.fromEntries(t.headers.entries());i.response={headers:c,ok:n,redirected:r,status:s,statusText:o,type:a,url:l}}if(e=await _n(e,t,n),t.parseTextSync&&"string"===typeof e)return n.dataType="text",t.parseTextSync(e,n,i,t);if(function(t,e){return!!an.isSupported()&&!!(We||null!==e&&void 0!==e&&e._nodeWorkers)&&t.worker&&(null===e||void 0===e?void 0:e.worker)}(t,n))return await cn(t,e,n,i,Ln);if(t.parseText&&"string"===typeof e)return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw qe(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}(o,t,n,i)):null}async function Dn(t,e,n,i){Array.isArray(e)||ye(e)||(void 0,n=e,e=void 0);const r=Ve(n);let s=t;return"string"===typeof t&&(s=await r(t)),fe(t)&&(s=await r(t)),await Ln(s,e,n)}class Rn{constructor(t,e,n){_t(this,"id",void 0),_t(this,"context",void 0),_t(this,"isLoaded",void 0),_t(this,"persistent",void 0),_t(this,"_loadCount",0),_t(this,"_subscribers",new Set),_t(this,"_data",void 0),_t(this,"_loader",void 0),_t(this,"_error",void 0),_t(this,"_content",void 0),this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let i=t;"string"===typeof t&&(i=Dn(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((t=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=t)})).catch((t=>{this._loadCount===n&&(this.isLoaded=!0,this._error=t||!0)}))):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const r of this._subscribers)r.onChange(this.getData())}}class Bn{constructor(t){let{gl:e,protocol:n}=t;_t(this,"protocol",void 0),_t(this,"_context",void 0),_t(this,"_resources",void 0),_t(this,"_consumers",void 0),_t(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return!!t.startsWith(this.protocol)||t in this._resources}add(t){let{resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}=t,s=this._resources[e];s?s.setData(n,i):(s=new Rn(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const n=this._consumers[e];if(n){for(const t in n){const e=n[t],i=this._resources[e.resourceId];i&&i.unsubscribe(e)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:n,consumerId:i,requestId:r="default"}=t;const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,i){const r=this._consumers,s=r[t]=r[t]||{},o=s[e]||{},a=o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),n&&(s[e]=o,o.onChange=i,o.resourceId=n.id,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];e.persistent||e.inUse()||(e.delete(),delete this._resources[t])}}}const On=new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_t(this,"_pool",[]),_t(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,n){let{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}=n;const c=r||t&&t.constructor||Float32Array,u=e*i+s;if(ArrayBuffer.isView(t)){if(u<=t.length)return t;if(u*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new c(t.buffer,0,u)}let h=1/0;l&&(h=l*i+s);const d=this._allocate(c,u,a,h);return t&&o?d.set(t):a||d.fill(0,0,4),this._release(t),d}release(t){this._release(t)}_allocate(t,e,n,i){let r=Math.max(Math.ceil(e*this.opts.overAlloc),1);r>i&&(r=i);const s=this._pool,o=t.BYTES_PER_ELEMENT*r,a=s.findIndex((t=>t.byteLength>=o));if(a>=0){const e=new t(s.splice(a,1)[0],0,r);return n&&e.fill(0),e}return new t(r)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,r=e.findIndex((t=>t.byteLength>=i));r<0?e.push(n):(r>0||e.length<this.opts.poolSize)&&e.splice(r,0,n),e.length>this.opts.poolSize&&e.shift()}},Fn=(Math.PI,Math.PI,{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0});function Vn(t){let{precision:e=Fn.precision}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=qn(t),"".concat(parseFloat(t.toPrecision(e)))}function Nn(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Un(t,e,n){return $n(t,(t=>Math.max(e,Math.min(n,t))))}function jn(t,e,n){return Nn(t)?t.map(((t,i)=>jn(t,e[i],n))):n*e+(1-n)*t}function Gn(t,e,n){const i=Fn.EPSILON;n&&(Fn.EPSILON=n);try{if(t===e)return!0;if(Nn(t)&&Nn(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Gn(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):"number"===typeof t&&"number"===typeof e&&Math.abs(t-e)<=Fn.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{Fn.EPSILON=i}}function qn(t){return Math.round(t/Fn.EPSILON)*Fn.EPSILON}function $n(t,e,n){if(Nn(t)){const i=t;n=n||function(t){return t.clone?t.clone():new Array(t.length)}(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}class Wn extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Nn(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Fn)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Vn(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Gn(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(void 0===n)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const r=t[i];this[i]=r+n*(e[i]-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let t=0;t<this.ELEMENTS;++t)this[t]+=i[t];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let t=0;t<this.ELEMENTS;++t)this[t]-=i[t];return this.check()}scale(t){if("number"===typeof t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(Fn.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function Zn(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Hn(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Xn(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(Fn.debug&&!Zn(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}function Yn(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}class Kn extends Wn{get x(){return this[0]}set x(t){this[0]=Hn(t)}get y(){return this[1]}set y(t){this[1]=Hn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-t[n];e+=i*i}return Hn(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Hn(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=i[t];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=i[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Yn(t>=0&&t<this.ELEMENTS,"index is out of range"),Hn(this[t])}setComponent(t,e){return Yn(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var Jn=1e-6,Qn="undefined"!==typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function ti(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ei=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t};!function(){var t=function(){var t=new Qn(3);return Qn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();function ni(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}const ii=[0,0,0];let ri;class si extends Kn{static get ZERO(){return ri||(ri=new si(0,0,0),Object.freeze(ri)),ri}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(-0,-0,-0),1===arguments.length&&Nn(t)?this.copy(t):(Fn.debug&&(Hn(t),Hn(e),Hn(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Fn.debug&&(Hn(t.x),Hn(t.y),Hn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Hn(t)}angle(t){return function(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(s*s+o*o+a*a),c=l&&function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,t)}cross(t){return function(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o}(this,this,t),this.check()}rotateX(t){let{radians:e,origin:n=ii}=t;return function(t,e,n,i){var r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,n,e),this.check()}rotateY(t){let{radians:e,origin:n=ii}=t;return function(t,e,n,i){var r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,n,e),this.check()}rotateZ(t){let{radians:e,origin:n=ii}=t;return function(t,e,n,i){var r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,n,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return ti(this,this,t),this.check()}transformAsVector(t){return ni(this,this,t),this.check()}transformByMatrix3(t){return function(t,e,n){var i=e[0],r=e[1],s=e[2];t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const i=e[0],r=e[1];t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return function(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=r*c-s*l,h=s*a-i*c,d=i*l-r*a,p=r*d-s*h,f=s*u-i*d,m=i*h-r*u,g=2*o;u*=g,h*=g,d*=g,p*=2,f*=2,m*=2,t[0]=a+u+p,t[1]=l+h+f,t[2]=c+d+m}(this,this,t),this.check()}}const oi=new si;function ai(t,e,n,i){oi.set(t,e,n);const r=oi.len();return{distance:i/r,normal:new si(-t/r,-e/r,-n/r)}}let li;function ci(t,e){const{size:n=1,startIndex:i=0}=e,r=void 0!==e.endIndex?e.endIndex:t.length,s=(r-i)/n;li=On.allocate(li,s,{type:Float32Array,size:2*n});let o=i,a=0;for(;o<r;){for(let e=0;e<n;e++){const i=t[o++];li[a+e]=i,li[a+e+n]=(l=i)-Math.fround(l)}a+=2*n}var l;return li.subarray(0,s*n*2)}class ui extends Wn{toString(){let t="[";if(Fn.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=Hn(n),this}getColumn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0);const n=t*this.RANK;for(let i=0;i<this.RANK;++i)e[i]=this[n+i];return e}setColumn(t,e){const n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=e[i];return this}}function hi(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=n*a-i*o,v=n*l-r*o,x=n*c-s*o,b=i*l-r*a,w=i*c-s*a,S=r*c-s*l,E=u*m-h*f,T=u*g-d*f,A=u*y-p*f,k=h*g-d*m,P=h*y-p*m,I=d*y-p*g,C=_*I-v*P+x*k+b*A-w*T+S*E;return C?(C=1/C,t[0]=(a*I-l*P+c*k)*C,t[1]=(r*P-i*I-s*k)*C,t[2]=(m*S-g*w+y*b)*C,t[3]=(d*w-h*S-p*b)*C,t[4]=(l*A-o*I-c*T)*C,t[5]=(n*I-r*A+s*T)*C,t[6]=(g*x-f*S-y*v)*C,t[7]=(u*S-d*x+p*v)*C,t[8]=(o*P-a*A+c*E)*C,t[9]=(i*A-n*P-s*E)*C,t[10]=(f*w-m*x+y*_)*C,t[11]=(h*x-u*w-p*_)*C,t[12]=(a*T-o*k-l*E)*C,t[13]=(n*k-i*T+r*E)*C,t[14]=(m*v-f*b-g*_)*C,t[15]=(u*b-h*v+d*_)*C,t):null}function di(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=n[0],x=n[1],b=n[2],w=n[3];return t[0]=v*i+x*a+b*h+w*m,t[1]=v*r+x*l+b*d+w*g,t[2]=v*s+x*c+b*p+w*y,t[3]=v*o+x*u+b*f+w*_,v=n[4],x=n[5],b=n[6],w=n[7],t[4]=v*i+x*a+b*h+w*m,t[5]=v*r+x*l+b*d+w*g,t[6]=v*s+x*c+b*p+w*y,t[7]=v*o+x*u+b*f+w*_,v=n[8],x=n[9],b=n[10],w=n[11],t[8]=v*i+x*a+b*h+w*m,t[9]=v*r+x*l+b*d+w*g,t[10]=v*s+x*c+b*p+w*y,t[11]=v*o+x*u+b*f+w*_,v=n[12],x=n[13],b=n[14],w=n[15],t[12]=v*i+x*a+b*h+w*m,t[13]=v*r+x*l+b*d+w*g,t[14]=v*s+x*c+b*p+w*y,t[15]=v*o+x*u+b*f+w*_,t}function pi(t,e,n){var i,r,s,o,a,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=i*m+a*g+h*y+e[12],t[13]=r*m+l*g+d*y+e[13],t[14]=s*m+c*g+p*y+e[14],t[15]=o*m+u*g+f*y+e[15]),t}function fi(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mi(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+h*i,t[7]=l*r+d*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=h*r-a*i,t[11]=d*r-l*i,t}function gi(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+h*i,t[3]=l*r+d*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=h*r-a*i,t[7]=d*r-l*i,t}var yi=function(t,e,n,i,r){var s,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(i-r),t[10]=(r+i)*s,t[14]=2*r*i*s):(t[10]=-1,t[14]=-2*i),t};var _i=function(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t};function vi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function xi(t,e){return t[0]=-e[0],t[1]=-e[1],t}function bi(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}!function(){var t=function(){var t=new Qn(2);return Qn!=Float32Array&&(t[0]=0,t[1]=0),t}()}();function wi(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}var Si;!function(){var t=function(){var t=new Qn(4);return Qn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();!function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"}(Si||(Si={}));const Ei=45*Math.PI/180,Ti=1,Ai=.1,ki=500,Pi=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ii extends ui{static get IDENTITY(){return function(){Mi||(Mi=new Ii,Object.freeze(Mi));return Mi}()}static get ZERO(){return function(){Ci||(Ci=new Ii([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ci));return Ci}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Si}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=p,this[14]=f,this[15]=m,this.check()}setRowMajor(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){return this[0]=t,this[1]=r,this[2]=l,this[3]=d,this[4]=e,this[5]=s,this[6]=c,this[7]=p,this[8]=n,this[9]=o,this[10]=u,this[11]=f,this[12]=i,this[13]=a,this[14]=h,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Pi)}fromObject(t){return this.check()}fromQuaternion(t){return function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,y=s*l;t[0]=1-h-f,t[1]=u+y,t[2]=d-g,t[3]=0,t[4]=u-y,t[5]=1-c-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:i,top:r,near:s=Ai,far:o=ki}=t;return o===1/0?function(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-1,h=-1,d=-2*s;t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=d,t[15]=0}(this,e,n,i,r,s):function(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),c=1/(s-o);t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0}(this,e,n,i,r,s,o),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:i=[0,1,0]}=t;return function(t,e,n,i){var r,s,o,a,l,c,u,h,d,p,f=e[0],m=e[1],g=e[2],y=i[0],_=i[1],v=i[2],x=n[0],b=n[1],w=n[2];Math.abs(f-x)<Jn&&Math.abs(m-b)<Jn&&Math.abs(g-w)<Jn?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(u=f-x,h=m-b,d=g-w,r=_*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),s=v*(u*=p)-y*d,o=y*h-_*u,(p=Math.hypot(r,s,o))?(r*=p=1/p,s*=p,o*=p):(r=0,s=0,o=0),a=h*o-d*s,l=d*r-u*o,c=u*s-h*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=h,t[7]=0,t[8]=o,t[9]=c,t[10]=d,t[11]=0,t[12]=-(r*f+s*m+o*g),t[13]=-(a*f+l*m+c*g),t[14]=-(u*f+h*m+d*g),t[15]=1)}(this,e,n,i),this.check()}ortho(t){const{left:e,right:n,bottom:i,top:r,near:s=Ai,far:o=ki}=t;return _i(this,e,n,i,r,s,o),this.check()}orthographic(t){const{fovy:e=Ei,aspect:n=Ti,focalDistance:i=1,near:r=Ai,far:s=ki}=t;zi(e);const o=e/2,a=i*Math.tan(o),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:s})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=t;return zi(e),yi(this,e,n,i,r),this.check()}determinant(){return function(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15];return(e*o-n*s)*(h*g-d*m)-(e*a-i*s)*(u*g-d*f)+(e*l-r*s)*(u*m-h*f)+(n*a-i*o)*(c*g-d*p)-(n*l-r*o)*(c*m-h*p)+(i*l-r*a)*(c*f-u*p)}(this)}getScale(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],r=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*r,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*r,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],r=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*s,t[3]=this[4]*i,t[4]=this[5]*r,t[5]=this[6]*s,t[6]=this[8]*i,t[7]=this[9]*r,t[8]=this[10]*s,t}transpose(){return function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return hi(this,this),this.check()}multiplyLeft(t){return di(this,t,this),this.check()}multiplyRight(t){return di(this,this,t),this.check()}rotateX(t){return mi(this,this,t),this.check()}rotateY(t){return function(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-h*i,t[3]=l*r-d*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+h*r,t[11]=l*i+d*r}(this,this,t),this.check()}rotateZ(t){return gi(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return function(t,e,n,i){var r,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,E,T,A,k,P=i[0],I=i[1],C=i[2],M=Math.hypot(P,I,C);M<Jn||(P*=M=1/M,I*=M,C*=M,r=Math.sin(n),o=1-(s=Math.cos(n)),a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],d=e[5],p=e[6],f=e[7],m=e[8],g=e[9],y=e[10],_=e[11],v=P*P*o+s,x=I*P*o+C*r,b=C*P*o-I*r,w=P*I*o-C*r,S=I*I*o+s,E=C*I*o+P*r,T=P*C*o+I*r,A=I*C*o-P*r,k=C*C*o+s,t[0]=a*v+h*x+m*b,t[1]=l*v+d*x+g*b,t[2]=c*v+p*x+y*b,t[3]=u*v+f*x+_*b,t[4]=a*w+h*S+m*E,t[5]=l*w+d*S+g*E,t[6]=c*w+p*S+y*E,t[7]=u*w+f*S+_*E,t[8]=a*T+h*A+m*k,t[9]=l*T+d*A+g*k,t[10]=c*T+p*A+y*k,t[11]=u*T+f*A+_*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return fi(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return pi(this,this,t),this.check()}transform(t,e){return 4===t.length?(Xn(e=wi(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let i;switch(n){case 2:i=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(e||[-0,-0],t,this);break;case 3:i=ti(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Xn(i,t.length),i}transformAsVector(t,e){let n;switch(t.length){case 2:n=function(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}(e||[-0,-0],t,this);break;case 3:n=ni(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Xn(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let Ci,Mi;function zi(t){if(t>2*Math.PI)throw Error("expected radians")}function Li(t,e){const n=wi([],e,t);var i,r,s;return i=n,r=n,s=1/n[3],i[0]=r[0]*s,i[1]=r[1]*s,i[2]=r[2]*s,i[3]=r[3]*s,n}function Di(t,e){const n=t%e;return n<0?e+n:n}function Ri(t,e,n){return t<e?e:t>n?n:t}const Bi=Math.log2||function(t){return Math.log(t)*Math.LOG2E};function Oi(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Fi=Math.PI,Vi=Fi/4,Ni=Fi/180,Ui=180/Fi,ji=512,Gi=4003e4,qi=85.051129,$i=1.5;function Wi(t){const[e,n]=t;Oi(Number.isFinite(e)),Oi(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*Ni;return[ji*(e*Ni+Fi)/(2*Fi),ji*(Fi+Math.log(Math.tan(Vi+.5*i)))/(2*Fi)]}function Zi(t){const[e,n]=t,i=e/ji*(2*Fi)-Fi,r=2*(Math.atan(Math.exp(n/ji*(2*Fi)-Fi))-Vi);return[i*Ui,r*Ui]}function Hi(t){const{latitude:e}=t;Oi(Number.isFinite(e));const n=Math.cos(e*Ni);return function(t){return Bi(t)}(Gi*n)-9}function Xi(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Oi(Number.isFinite(e)&&Number.isFinite(n));const r=Math.cos(e*Ni),s=512/360,o=s/r,a=12790407194604047e-21/r,l={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[s,o,a],degreesPerUnit:[.703125,1/o,1/a]};if(i){const t=Ni*Math.tan(e*Ni)/r,n=s*t/2,i=12790407194604047e-21*t,c=i/o*a;l.unitsPerDegree2=[0,n,i],l.unitsPerMeter2=[c,0,c]}return l}function Yi(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Xi({longitude:n,latitude:i,highPrecision:!0}),u=Wi(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=Zi(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function Ki(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Ji($i)}=t;void 0!==i&&(u=Ji(i));const h=u*Ni,d=r*Ni,p=Qi(u);let f=p;o&&(f+=o[2]*a/Math.cos(d)/n);const m=h*(.5+(s?s[1]:0)/n),g=Math.sin(m)*f/Math.sin(Ri(Math.PI/2-d-m,.01,Math.PI-.01)),y=Math.sin(d)*g+f,_=10*f;return{fov:h,aspect:e/n,focalDistance:p,near:l,far:Math.min(y*c,_)}}function Ji(t){return 2*Math.atan(.5/t)*Ui}function Qi(t){return.5/Math.tan(.5*t*Ni)}function tr(t,e){const[n,i,r=0]=t;return Oi(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Li(e,[n,i,r,1])}function er(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const[i,r,s]=t;if(Oi(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s)){return Li(e,[i,r,s,1])}const o=Li(e,[i,r,0,1]),a=Li(e,[i,r,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return bi([],o,a,u)}function nr(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,h=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"===typeof t)return{top:t,bottom:t,left:t,right:t};return Oi(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t}(t.padding),d=Wi([a,Ri(u,-85.051129,qi)]),p=Wi([c,Ri(l,-85.051129,qi)]),f=[Math.max(Math.abs(p[0]-d[0]),r),Math.max(Math.abs(p[1]-d[1]),r)],m=[e-h.left-h.right-2*Math.abs(o[0]),n-h.top-h.bottom-2*Math.abs(o[1])];Oi(m[0]>0&&m[1]>0);const g=m[0]/f[0],y=m[1]/f[1],_=(h.right-h.left)/2/g,v=(h.top-h.bottom)/2/y,x=Zi([(p[0]+d[0])/2+_,(p[1]+d[1])/2+v]),b=Math.min(s,Bi(Math.abs(Math.min(g,y))));return Oi(Number.isFinite(b)),{longitude:x[0],latitude:x[1],zoom:b}}const ir=Math.PI/180;function rr(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=Li(i,[e,0,1,1]),s=Li(i,[e,t.height,1,1]),o=Zi(bi([],r,s,(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2])));return o.push(n),o}const sr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(sr,"IDENTITY",{get:()=>(te.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const or={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ar={common:0,meters:1,pixels:2},lr={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},cr="draw",ur="mask",hr=Math.PI/180,dr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],pr=[0,0,0],fr={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class mr{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_t(this,"id",void 0),_t(this,"x",void 0),_t(this,"y",void 0),_t(this,"width",void 0),_t(this,"height",void 0),_t(this,"isGeospatial",void 0),_t(this,"zoom",void 0),_t(this,"focalDistance",void 0),_t(this,"position",void 0),_t(this,"modelMatrix",void 0),_t(this,"distanceScales",void 0),_t(this,"scale",void 0),_t(this,"center",void 0),_t(this,"cameraPosition",void 0),_t(this,"projectionMatrix",void 0),_t(this,"viewMatrix",void 0),_t(this,"viewMatrixUncentered",void 0),_t(this,"viewMatrixInverse",void 0),_t(this,"viewProjectionMatrix",void 0),_t(this,"pixelProjectionMatrix",void 0),_t(this,"pixelUnprojectionMatrix",void 0),_t(this,"resolution",void 0),_t(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.distanceScales=t.distanceScales||fr,this.focalDistance=t.focalDistance||1,this.position=t.position||pr,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?or.WEB_MERCATOR:or.WEB_MERCATOR_AUTO_OFFSET:or.IDENTITY}equals(t){return t instanceof mr&&(this===t||t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Gn(t.projectionMatrix,this.projectionMatrix)&&Gn(t.viewMatrix,this.viewMatrix))}project(t){let{topLeft:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=tr(this.projectPosition(t),this.pixelProjectionMatrix),[i,r]=n,s=e?r:this.height-r;return 2===t.length?[i,s]:[i,s,n[2]]}unproject(t){let{topLeft:e=!0,targetZ:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[i,r,s]=t,o=e?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=er([i,o,s],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(s)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(t){const[e,n]=this.projectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(t){if(this.isGeospatial){const e=Wi(t);return e[1]=Un(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?Zi(t):t}getBounds(){const t={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},e=this.unproject([0,0],t),n=this.unproject([this.width,0],t),i=this.unproject([0,this.height],t),r=this.unproject([this.width,this.height],t);return[Math.min(e[0],n[0],i[0],r[0]),Math.min(e[1],n[1],i[1],r[1]),Math.max(e[0],n[0],i[0],r[0]),Math.max(e[1],n[1],i[1],r[1])]}getDistanceScales(t){return t?Xi({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:n,width:i=1,height:r=1}=t;return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:ai((t=this.viewProjectionMatrix)[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ai(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ai(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ai(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ai(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ai(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}),this._frustumPlanes;var t}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=Hi({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Xi({latitude:n,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:s}=t;let o=pr;if(r&&(o=s?new Ii(s).transformAsVector(r,[]):r),this.isGeospatial){const t=this.projectPosition([e,n,0]);this.center=new si(o).scale(this.distanceScales.unitsPerMeter).add(t)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:e=dr,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:r,fovy:s=75,near:o=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=(new Ii).multiplyRight(e).translate(new si(this.center).negate()),this.projectionMatrix=n||function(t){let{width:e,height:n,orthographic:i,fovyRadians:r,focalDistance:s,padding:o,near:a,far:l}=t;const c=e/n,u=i?(new Ii).orthographic({fovy:r,aspect:c,focalDistance:s,near:a,far:l}):(new Ii).perspective({fovy:r,aspect:c,near:a,far:l});if(o){const{left:t=0,right:i=0,top:r=0,bottom:s=0}=o,a=Un((t+e-i)/2,0,e)-e/2,l=Un((r+n-s)/2,0,n)-n/2;u[8]-=2*a/e,u[9]+=2*l/n}return u}({width:this.width,height:this.height,orthographic:i,fovyRadians:r||s*hr,focalDistance:c,padding:l,near:o,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;di(u,u,this.projectionMatrix),di(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=hi([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];fi(d,d,[this.width/2,-this.height/2,1]),pi(d,d,[1,-1,0]),di(p,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=hi([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||te.warn("Pixel project matrix not invertible")()}}_t(mr,"displayName","Viewport");const gr="vs",yr="fs";function _r(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const vr={number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},array:{validate:(t,e)=>Array.isArray(t)||ArrayBuffer.isView(t)}};function xr(t){let e=br(t);return"object"===e?t?"type"in t?Object.assign({},t,vr[t.type]):"value"in t?(e=br(t.value),Object.assign({type:e},t,vr[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},vr[e])}function br(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}class wr{constructor(t){let{name:e,vs:n,fs:i,dependencies:r=[],uniforms:s,getUniforms:o,deprecations:a=[],defines:l={},inject:c={},vertexShader:u,fragmentShader:h}=t;_r("string"===typeof e),this.name=e,this.vs=n||u,this.fs=i||h,this.getModuleUniforms=o,this.dependencies=r,this.deprecations=this._parseDeprecationDefinitions(a),this.defines=l,this.injections=function(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);"string"===typeof i&&(i={order:0,injection:i}),e[r][n]=i}return e}(c),s&&(this.uniforms=function(t){const e={};for(const n in t){const i=xr(t[n]);e[n]=i}return e}(s))}getModuleSource(t){let e;switch(t){case"vs":e=this.vs||"";break;case"fs":e=this.fs||"";break;default:_r(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(e,"// END MODULE_").concat(this.name,"\n\n")}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach((n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(t){return t.forEach((t=>{if("function"===t.type)t.regex=new RegExp("\\b".concat(t.old,"\\("));else t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))})),t}_defaultGetUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={},n=this.uniforms;for(const i in n){const r=n[i];i in t&&!r.private?(r.validate&&_r(r.validate(t[i],r),"".concat(this.name,": invalid ").concat(i)),e[i]=t[i]):e[i]=r.value}return e}}function Sr(t){return Er(Ar(t))}function Er(t){const e={},n={};return Tr({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort(((t,e)=>n[e]-n[t])).map((t=>e[t]))}function Tr(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(void 0===r[s.name]||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&Tr({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function Ar(t,e){return t.map((t=>(t instanceof wr||(_r("string"!==typeof t,"Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),_r(t.name,"shader module has no name"),(t=new wr(t)).dependencies=Ar(t.dependencies)),t)))}function kr(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e="undefined"!==typeof window&&window.navigator||{},n=t.userAgent||e.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}const Pr={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Ir={};Object.keys(Pr).forEach((t=>{Ir[t]=t}));const Cr={};function Mr(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=Pr[e];if(_r(i,e),!kr(n))return!0;if(e in Cr)return Cr[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,"\nvoid main(void) {}"),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),Cr[e]=l,l}function zr(t,e){const n=Pr[e];_r(n,e);const i=function(t){return"undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}(t)&&n[1]||n[0],r="string"===typeof i?Boolean(t.getExtension(i)):i;return _r(!1===r||!0===r),r}function Lr(t,e){return(e=Array.isArray(e)?e:[e]).every((e=>zr(t,e)))}const Dr={[gr]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[yr]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Rr="__LUMA_INJECT_DECLARATIONS__",Br=/void\s+main\s*\([^)]*\)\s*\{\n?/,Or=/}\n?[^{}]*$/,Fr=[];function Vr(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e===gr;for(const s in n){const e=n[s];e.sort(((t,e)=>t.order-e.order)),Fr.length=e.length;for(let t=0,n=e.length;t<n;++t)Fr[t]=e[t].injection;const i="".concat(Fr.join("\n"),"\n");switch(s){case"vs:#decl":r&&(t=t.replace(Rr,i));break;case"vs:#main-start":r&&(t=t.replace(Br,(t=>t+i)));break;case"vs:#main-end":r&&(t=t.replace(Or,(t=>i+t)));break;case"fs:#decl":r||(t=t.replace(Rr,i));break;case"fs:#main-start":r||(t=t.replace(Br,(t=>t+i)));break;case"fs:#main-end":r||(t=t.replace(Or,(t=>i+t)));break;default:t=t.replace(s,(t=>t+i))}}return t=t.replace(Rr,""),i&&(t=t.replace(/\}\s*$/,(t=>t+Dr[e]))),t}function Nr(t){const e={};return _r(Array.isArray(t)&&t.length>1),t.forEach((t=>{for(const n in t)e[n]=e[n]?"".concat(e[n],"\n").concat(t[n]):t[n]})),e}function Ur(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const jr=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Gr=[...jr,[Ur("attribute"),"in $1"],[Ur("varying"),"out $1"]],qr=[...jr,[Ur("varying"),"in $1"]],$r=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],Wr=[...$r,[Ur("in"),"attribute $1"],[Ur("out"),"varying $1"]],Zr=[...$r,[Ur("in"),"varying $1"]],Hr="gl_FragColor",Xr=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,Yr=/void\s+main\s*\([^)]*\)\s*\{\n?/;function Kr(t,e,n){switch(e){case 300:return n?Jr(t,Gr):function(t){const e=(t=Jr(t,qr)).match(Xr);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Hr,"\\b"),"g"),n)}else{const e="fragmentColor";t=t.replace(Yr,(t=>"out vec4 ".concat(e,";\n").concat(t))).replace(new RegExp("\\b".concat(Hr,"\\b"),"g"),e)}return t}(t);case 100:return n?Jr(t,Wr):function(t){const e=(t=Jr(t,Zr)).match(Xr);if(e){const n=e[1];t=t.replace(Xr,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Hr)}return t}(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Jr(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}const Qr="\n\n".concat(Rr,"\n\n"),ts={[gr]:"vertex",[yr]:"fragment"};function es(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:c=!1,prologue:u=!0,log:h}=e;_r("string"===typeof i,"shader source must be a string");const d=r===gr,p=i.split("\n");let f=100,m="",g=i;0===p[0].indexOf("#version ")?(f=300,m=p[0],g=p.slice(1).join("\n")):m="#version ".concat(f);const y={};s.forEach((t=>{Object.assign(y,t.getDefines())})),Object.assign(y,o);let _=u?"".concat(m,"\n").concat(function(t){let{id:e,source:n,type:i}=t;return e&&"string"===typeof e&&-1===n.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(ts[i],"\n\n"):""}({id:n,source:i,type:r}),"\n").concat(function(t){let{type:e}=t;return"\n#define SHADER_TYPE_".concat(ts[e].toUpperCase(),"\n")}({type:r}),"\n").concat(function(t){const e=function(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||7936),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||7937),r=function(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,i);return{gpuVendor:r,vendor:n,renderer:i,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t);switch(e.gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(t),"\n").concat(function(t,e,n){let i="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return Lr(t,Ir.GLSL_FRAG_DEPTH)&&(i+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),Lr(t,Ir.GLSL_DERIVATIVES)&&Mr(t,Ir.GLSL_DERIVATIVES)&&(i+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),Lr(t,Ir.GLSL_FRAG_DATA)&&Mr(t,Ir.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),Lr(t,Ir.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),i}(t),"\n").concat(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,n="";for(const i in t){0===e&&(n+="\n// APPLICATION DEFINES\n"),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],"\n"))}0===e&&(n+="\n");return n}(y),"\n").concat(d?"":"precision highp float;\n\n","\n"):"".concat(m,"\n");const v=function(t){const e={vs:{},fs:{}};return t.forEach((t=>{let n;"string"!==typeof t?(n=t,t=n.hook):n={},t=t.trim();const[i,r]=t.split(":"),s=t.replace(/\(.+/,"");e[i][s]=Object.assign(n,{signature:r})})),e}(a),x={},b={},w={};for(const S in l){const t="string"===typeof l[S]?{injection:l[S],order:0}:l[S],e=S.match(/^(v|f)s:(#)?([\w-]+)$/);if(e){const n=e[2],i=e[3];n?"decl"===i?b[S]=[t]:w[S]=[t]:x[S]=[t]}else w[S]=[t]}for(const S of s){h&&S.checkDeprecations(g,h);_+=S.getModuleSource(r,f);const t=S.injections[r];for(const e in t){const n=e.match(/^(v|f)s:#([\w-]+)$/);if(n){const i="decl"===n[2]?b:w;i[e]=i[e]||[],i[e].push(t[e])}else x[e]=x[e]||[],x[e].push(t[e])}}return _+=Qr,_=Vr(_,r,b),_+=function(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature," {\n"),r.header&&(n+="  ".concat(r.header)),e[i]){const t=e[i];t.sort(((t,e)=>t.order-e.order));for(const e of t)n+="  ".concat(e.injection,"\n")}r.footer&&(n+="  ".concat(r.footer)),n+="}\n"}return n}(v[r],x),_+=g,_=Vr(_,r,w),_=Kr(_,c?100:f,d),_}function ns(t){return function(e){const n={};for(const i of t){const t=i.getUniforms(e,n);Object.assign(n,t)}return n}}const is=new Yt({id:"luma.gl"});function rs(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const ss="Invalid WebGLRenderingContext";function os(t){return"undefined"!==typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||("undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&Number.isFinite(t._version)))}function as(t){return"undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function ls(t){return rs(os(t),ss),t}function cs(t){return rs(as(t),"Requires WebGL2"),t}const us={};function hs(t,e){var n;us[t]=!0,void 0!==e&&(n=e,globalThis.console&&globalThis.console.error&&globalThis.console.error(n))}const ds=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const e=new t.VertexAttrib(n);this.attribs[i]=e}this.maxAttrib=0};(ds.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const ps=function(t){const e=this;this.gl=t,function(t){const e=t.getError;t.getError=function(){let n;do{n=e.apply(t),0!==n&&(us[n]=!0)}while(0!==n);for(n in us)if(us[n])return delete us[n],parseInt(n,10);return 0}}(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(t){return t===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(t){const i=e.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,t);const r=i.attribs[t];return r.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(t){const i=e.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,t);const r=i.attribs[t];return r.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(t,i){switch(t){case 34962:e.currentArrayBuffer=i;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=i}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(t,i){const r=e.currentVertexArrayObject,s=r.attribs[t];switch(i){case 34975:return s.buffer;case 34338:return s.enabled;case 34339:return s.size;case 34340:return s.stride;case 34341:return s.type;case 34922:return s.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(t,i,r,s,o,a){const l=e.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,t);const c=l.attribs[t];return c.buffer=e.currentArrayBuffer,c.size=i,c.type=r,c.normalized=s,c.stride=o,c.offset=a,c.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",(()=>{var t;t="OESVertexArrayObject emulation library context restored",globalThis.console&&globalThis.console.log&&globalThis.console.log(t),e.reset_()}),!0),this.reset_()};ps.prototype.VERTEX_ARRAY_BINDING_OES=34229,ps.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new ds(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},ps.prototype.createVertexArrayOES=function(){const t=new ds(this);return this.vertexArrayObjects.push(t),t},ps.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},ps.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof ds&&t.hasBeenBound&&t.ext===this)},ps.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive)return void hs(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const r=this.currentVertexArrayObject;if(i===r)return;i&&r.elementArrayBuffer===i.elementArrayBuffer||n.bindBuffer.call(e,34963,r.elementArrayBuffer);let s=this.currentArrayBuffer;const o=Math.max(i?i.maxAttrib:0,r.maxAttrib);for(let a=0;a<=o;a++){const t=r.attribs[a],o=i?i.attribs[a]:null;if(i&&t.enabled===o.enabled||(t.enabled?n.enableVertexAttribArray.call(e,a):n.disableVertexAttribArray.call(e,a)),t.enabled){let r=!1;i&&t.buffer===o.buffer||(s!==t.buffer&&(n.bindBuffer.call(e,34962,t.buffer),s=t.buffer),r=!0),(r||t.cached!==o.cached)&&n.vertexAttribPointer.call(e,a,t.size,t.type,t.normalized,t.stride,t.offset)}}this.currentArrayBuffer!==s&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)};const fs="OES_element_index",ms="WEBGL_draw_buffers",gs="WEBGL_debug_renderer_info",ys=t=>as(t)?void 0:0,_s={3074:t=>as(t)?void 0:36064,35723:t=>as(t)?void 0:4352,35977:ys,32937:ys,36795:(t,e)=>{const n=as(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},37445:(t,e)=>{const n=t.getExtension(gs);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},37446:(t,e)=>{const n=t.getExtension(gs);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},34047:(t,e)=>{const n=t.luma.extensions.EXT_texture_filter_anisotropic;return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:ys,35071:ys,37447:ys,36063:(t,e)=>{if(!as(t)){const n=t.getExtension(ms);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:ys,35374:ys,35377:ys,34852:t=>{if(!as(t)){const e=t.getExtension(ms);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(fs)?2147483647:65535,33001:t=>t.getExtension(fs)?16777216:65535,33e3:t=>16777216,37157:ys,35373:ys,35657:ys,36183:ys,37137:ys,34045:ys,35978:ys,35979:ys,35968:ys,35376:ys,35375:ys,35659:ys,37154:ys,35371:ys,35658:ys,35076:ys,35077:ys,35380:ys};const vs="ANGLE_instanced_arrays";const xs={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{rs(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[vs]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){rs(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{rs(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{rs(!1)},deleteQuery:()=>{rs(!1)},beginQuery:()=>{rs(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},bs={readBuffer:(t,e,n)=>{as(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=function(t,e){return{webgl2:as(t),ext:t.getExtension(e)}}(t,vs);let o;switch(i){case 35069:o=!!r&&void 0;break;case 35070:o=r||s?void 0:0}return void 0!==o?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!as(t))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>as(t)||32937!==r?t.getInternalformatParameter(n,i,r):new Int32Array([0]),getTexParameter(t,e,n,i){if(34046===i){const{extensions:e}=t.luma,n=e.EXT_texture_filter_anisotropic;i=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(n,i)},getParameter:function(t,e,n){const i=_s[n],r="function"===typeof i?i(t,e,n):i;return void 0!==r?r:e(n)},hint:(t,e,n,i)=>e(n,i)};function ws(t,e){let{extension:n,target:i,target2:r}=e;const s=xs[n];rs(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const c of Object.keys(s)){const e="".concat(c).concat(a);let n=null;"meta"===c||"function"===typeof t[c]||(l&&"function"===typeof l[e]?n=function(){return l[e](...arguments)}:"function"===typeof s[c]&&(n=s[c].bind(i))),n&&(i[c]=n,r[c]=n)}}globalThis.polyfillContext=function(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(!function(t){if("function"===typeof t.createVertexArray)return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};const n=t.getExtension;t.getExtension=function(e){return n.call(this,e)||("OES_vertex_array_object"!==e?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new ps(this)),this.__OESVertexArrayObject))}}(t),function(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}(t),function(t,e){for(const n of Object.getOwnPropertyNames(e))"overrides"!==n&&ws(t,{extension:n,target:t.luma,target2:t})}(t,xs),function(t,e){let{target:n,target2:i}=e;Object.keys(bs).forEach((e=>{if("function"===typeof bs[e]){const r=t[e]?t[e].bind(t):()=>{},s=bs[e].bind(null,t,r);n[e]=s,i[e]=s}}))}(t,{target:e,target2:t}),e.polyfilled=!0),t};const Ss={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Es=(t,e,n)=>e?t.enable(n):t.disable(n),Ts=(t,e,n)=>t.hint(n,e),As=(t,e,n)=>t.pixelStorei(n,e);function ks(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Ps={3042:Es,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Es,2885:(t,e)=>t.cullFace(e),2929:Es,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Es,35723:Ts,36006:(t,e)=>{const n=as(t)?36009:36160;return t.bindFramebuffer(n,e)},2886:(t,e)=>t.frontFace(e),33170:Ts,2849:(t,e)=>t.lineWidth(e),32823:Es,32824:"polygonOffset",10752:"polygonOffset",35977:Es,32938:"sampleCoverage",32939:"sampleCoverage",3089:Es,3088:(t,e)=>t.scissor(...e),2960:Es,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:As,3317:As,37440:As,37441:As,37443:As,3330:As,3332:As,3331:As,36010:(t,e)=>t.bindFramebuffer(36008,e),3314:As,32878:As,3316:As,3315:As,32877:As,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=ks(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=ks(e)&&2===e.length?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=ks(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=ks(e)&&3===e.length?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=ks(e)&&3===e.length?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Is(t,e,n){return void 0!==e[t]?e[t]:n[t]}const Cs={blendEquation:(t,e,n)=>t.blendEquationSeparate(Is(32777,e,n),Is(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Is(32969,e,n),Is(32968,e,n),Is(32971,e,n),Is(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Is(32824,e,n),Is(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Is(32938,e,n),Is(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Is(2962,e,n),Is(2967,e,n),Is(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Is(34816,e,n),Is(36003,e,n),Is(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Is(2964,e,n),Is(2965,e,n),Is(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Is(34817,e,n),Is(34818,e,n),Is(34819,e,n))},Ms={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[1028===e?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[1028===e?2962:34816]:n,[1028===e?2967:36003]:i,[1028===e?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[1028===e?2964:34817]:n,[1028===e?2965:34818]:i,[1028===e?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},zs=(t,e)=>t.isEnabled(e),Ls={3042:zs,2884:zs,2929:zs,3024:zs,32823:zs,32926:zs,32928:zs,3089:zs,2960:zs,35977:zs};function Ds(t){for(const e in t)return!1;return!0}function Rs(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}function Bs(t,e){const n=t[e].bind(t);t[e]=function(){const e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache&&t.state.enable?t.state.cache[e]:n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function Os(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const{valueChanged:o,oldValue:a}=n(t.state._updateCache,...r);return o&&i(...r),a},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function Fs(t){const e=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(e(n),t.state.program=n)}}class Vs{constructor(t){let{copyState:e=!1,log:n=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?function(t,e){if("number"===typeof(e=e||Ss)){const n=e,i=Ls[n];return i?i(t,n):t.getParameter(n)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const e=Ls[r];i[r]=e?e(t,Number(r)):t.getParameter(Number(r))}return i}(t):Object.assign({},Ss),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){rs(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];js(this.gl,t),this.stateStack.pop()}_updateCache(t){let e,n=!1;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const r in t){rs(void 0!==r);const s=t[r],o=this.cache[r];Rs(s,o)||(n=!0,e=o,i&&!(r in i)&&(i[r]=o),this.cache[r]=s)}return{valueChanged:n,oldValue:e}}}function Ns(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(rs(void 0!==i),!t.state){const{polyfillContext:e}=globalThis;e&&e(t),t.state=new Vs(t,{copyState:i}),Fs(t);for(const n in Ms){Os(t,n,Ms[n])}Bs(t,"getParameter"),Bs(t,"isEnabled")}return t.state.enable=n,t}function Us(t){rs(t.state),t.state.pop()}function js(t,e){if(rs(os(t),"setParameters requires a WebGL context"),Ds(e))return;const n={};for(const r in e){const i=Number(r),s=Ps[r];s&&("string"===typeof s?n[s]=!0:s(t,e[r],i))}const i=t.state&&t.state.cache;if(i)for(const r in n){(0,Cs[r])(t,e,i)}}function Gs(t,e,n){if(Ds(e))return n(t);const{nocatch:i=!0}=e;let r;if(function(t){t.state||Ns(t,{copyState:!1}),t.state.push()}(t),js(t,e),i)r=n(t),Us(t);else try{r=n(t)}finally{Us(t)}return r}function qs(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function $s(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=qs(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return Zs(e,i,r,s,n)}function Ws(t){const e="undefined"===typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function Zs(t,e,n,i,r){const s=Hs(t[0],e,n);let o=Xs(t[1],e,i,r),a=Hs(t[0]+1,e,n);const l=a===n-1?a:a-1;let c;return a=Xs(t[1]+1,e,i,r),r?(a=0===a?a:a+1,c=o,o=a):c=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}function Hs(t,e,n){return Math.min(Math.round(t*e),n-1)}function Xs(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Ys=Lt(),Ks=Ys&&"undefined"!==typeof document,Js={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Qs(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};rs(Ys,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),t=Object.assign({},Js,t);const{width:e,height:n}=t;function i(e){if(t.throwOnError)throw new Error(e);return console.error(e),null}let r;t.onError=i;const{canvas:s}=t,o=no({canvas:s,width:e,height:n,onError:i});return r=eo(o,t),r?(r=to(r,t),io(r),r):null}function to(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||ro(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Js,e);const{manageState:n,debug:i}=e;return n&&Ns(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return is.log(1,...e)()}}),Ys&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),is.level=Math.max(is.level,1)):is.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function eo(t,e){const{onError:n}=e;let i=null;const r=t=>i=t.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function no(t){let e,{canvas:n,width:i=800,height:r=600,onError:s}=t;if("string"===typeof n){Ks&&"complete"===document.readyState||s("createGLContext called on canvas '".concat(n,"' before page was loaded")),e=document.getElementById(n)}else n?e=n:(e=document.createElement("canvas"),e.id="lumagl-canvas",e.style.width=Number.isFinite(i)?"".concat(i,"px"):"100%",e.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(e,document.body.firstChild));return e}function io(t){const e=as(t)?"WebGL2":"WebGL1",n=function(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info");return{vendor:i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937)||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";is.info(1,"".concat(e).concat(r," context ").concat(i))()}function ro(t){return"undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?2:1}function so(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;i&&r||(is.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let n=e;const s=Math.floor(i*n),o=Math.floor(r*n);t.canvas.width=s,t.canvas.height=o,t.drawingBufferWidth===s&&t.drawingBufferHeight===o||(is.warn("Device pixel ratio clamped")(),n=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*n),t.canvas.height=Math.floor(r*n)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const oo="8.5.16";class ao{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new le({id:t})),this.stats.get(t)}}const lo=new ao;if(globalThis.luma&&globalThis.luma.VERSION!==oo)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(oo));globalThis.luma||(Lt()&&is.log(1,"luma.gl ".concat(oo," - ").concat("set luma.log.level=1 (or higher) to trace rendering"))(),globalThis.luma=globalThis.luma||{VERSION:oo,version:oo,log:is,stats:lo,globals:{modules:{},nodeIO:{}}});globalThis.luma;function co(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function uo(t,e){if("string"!==typeof e)return e;const n=Number(e);if(!isNaN(n))return n;const i=t[e=e.replace(/^.*\./,"")];return co(void 0!==i,"Accessing undefined constant GL.".concat(e)),i}function ho(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const po={};function fo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";po[t]=po[t]||1;const e=po[t]++;return"".concat(t,"-").concat(e)}function mo(t){return co("number"===typeof t,"Input must be a number"),t&&0===(t&t-1)}function go(t){let e=!0;for(const n in t){e=!1;break}return e}function yo(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach((t=>{s.methodName||(s[t]=()=>{throw is.removed("Calling removed method ".concat(e,".").concat(t,": "),r)(),new Error(t)})}))}const _o="Resource subclass must define virtual methods";class vo{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ls(t);const{id:n,userData:i={}}=e;this.gl=t,this.gl2=t,this.id=n||fo(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=e.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach((t=>t.delete())),this}bind(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!==typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};co(t=uo(this.gl,t));const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=as(this.gl);if(!((!("webgl2"in n)||t)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const e=n.webgl1,i="webgl2"in n?n.webgl2:n.webgl1;return t?i:e}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{parameters:e,keys:n}=t,i=this.constructor.PARAMETERS||{},r=as(this.gl),s={},o=e||Object.keys(i);for(const a of o){const e=i[a];if(e&&(!("webgl2"in e)||r)&&(!("extension"in e)||this.gl.getExtension(e.extension))){const i=n?ho(this.gl,a):a;s[i]=this.getParameter(a,t),n&&"GLenum"===e.type&&(s[i]=ho(this.gl,s[i]))}}return s}setParameter(t,e){co(t=uo(this.gl,t));const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=as(this.gl);if(!((!("webgl2"in n)||t)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(e=uo(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return yo(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(_o)}_deleteHandle(){throw new Error(_o)}_bindHandle(t){throw new Error(_o)}_getOptsFromHandle(){throw new Error(_o)}_getParameter(t,e){throw new Error(_o)}_setParameter(t,e){throw new Error(_o)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_initStats(){this.gl.stats=this.gl.stats||new ao}_addStats(){const t=this[Symbol.toStringTag],e=lo.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];lo.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(t,e),this._doTrackAllocatedMemory(t,e,this.gl.stats.get("Memory Usage"))}_doTrackAllocatedMemory(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lo.get("Memory Usage");n.get("GPU Memory").addCount(t),n.get("".concat(e," Memory")).addCount(t),this.byteLength=t}_trackDeallocatedMemory(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(t),this._doTrackDeallocatedMemory(t,this.gl.stats.get("Memory Usage"))}_doTrackDeallocatedMemory(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lo.get("Memory Usage");e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(t," Memory")).subtractCount(this.byteLength),this.byteLength=0}}function xo(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}function bo(t){let{clamped:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function wo(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const t=a*o,n=(i-a-1)*o;s.set(e.subarray(t,t+o)),e.copyWithin(t,n,n+o),e.set(s,n)}}function So(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let t=0;t<r;t++)for(let i=0;i<4;i++)o[4*(a*r+t)+i]=e[4*(2*a*n+2*t)+i];return{data:o,width:r,height:s}}function Eo(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const e=i[a]?"".concat(t,".").concat(i[a]):"N/A";is.removed("".concat(t,".").concat(a),e)()}for(const a in r)if(a in e){const e=r[a];is.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(e))()}let o=null;for(const a in s)if(a in e){const n=s[a];is.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(n))(),o=o||Object.assign({},e),o[n]=e[a],delete o[a]}return o||e}const To={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Ao={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ko{static getBytesPerElement(t){return bo(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){co(t.size);return bo(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new ko(...[To,...e])}constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((t=>this._assign(t))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ko.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ko.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=Eo("Accessor",t,Ao),void 0!==t.type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"===typeof t.index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}}const Po={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Io={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Po},Co={removedProps:Po};class Mo extends vo{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/ko.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/ko.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=Eo("Buffer",t,Io),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return"accessor"in(t=Eo("Buffer",t,Co))&&this.setAccessor(t.accessor),this}setAccessor(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new ko(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:i=0}=t,r=t.byteLength||t.length;co(e);const s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),0!==i||void 0!==r?(cs(this.gl),this.gl.bufferSubData(this.target,n,e,i,r)):this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:r}=t;const{gl:s}=this;return cs(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,n,i,r),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cs(this.gl);const r=bo(this.accessor.type||5126,{clamped:!1}),s=this._getAvailableElementCount(e),o=n;let a,l;t?(l=t.length,a=l-o):(a=Math.min(s,i||s),l=o+a);const c=Math.min(s,a);return i=i||c,co(i<=c),t=t||new r(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,i),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===t||35982===t?void 0!==i?this.gl.bindBufferRange(t,e,this.handle,n,i):(co(0===n),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===t||35982===t?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength+e;co(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,e,t),this.gl.bindBuffer(i,null),this.debugData=t.slice(0,10),this.bytesUsed=n,this._trackAllocatedMemory(n);const r=xo(t);return co(r),this.setAccessor(new ko(this.accessor,{type:r})),this}_setByteLength(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;co(t>=0),this._trackDeallocatedMemory();let n=t;0===t&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=t/bo(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(t){this.accessor.type||this.setAccessor(new ko(this.accessor,{type:xo(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return is.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return is.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return is.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return is.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ko(this.accessor,t),this}}const zo={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},Lo={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},Do={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};const Ro=[9729,9728],Bo=globalThis.WebGLBuffer||function(){};class Oo extends vo{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{format:n,linearFiltering:i}=e;let r=!0;return n&&(r=r&&function(t,e){const n=zo[e];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;const i=as(t)&&n.gl2||n.gl1;return"string"===typeof i?t.getExtension(i):i}(t,n),r=r&&(!i||function(t,e){const n=zo[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}(t,n))),r}constructor(t,e){const{id:n=fo("texture"),handle:i,target:r}=e;super(t,{id:n,handle:i}),this.target=r,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then((e=>this.initialize(Object.assign({},t,{pixels:e,data:e})))),this;const n="undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",(()=>this.initialize(t))),this;const{pixels:i=null,format:r=6408,border:s=0,recreate:o=!1,parameters:a={},pixelStore:l={},textureUnit:c}=t;e||(e=i);let{width:u,height:h,dataFormat:d,type:p,compressed:f=!1,mipmaps:m=!0}=t;const{depth:g=0}=t;return({width:u,height:h,compressed:f,dataFormat:d,type:p}=this._deduceParameters({format:r,type:p,dataFormat:d,compressed:f,data:e,width:u,height:h})),this.width=u,this.height=h,this.depth=g,this.format=r,this.type=p,this.dataFormat=d,this.border=s,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),m&&this._isNPOT()&&(is.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),m=!1,this._updateForNPOT(a)),this.mipmaps=m,this.setImageData({data:e,width:u,height:h,depth:g,format:r,type:p,dataFormat:d,border:s,mipmaps:m,parameters:l,compressed:f}),m&&this.generateMipmap(),this.setParameters(a),o&&(this.data=e),n&&(this._video={video:e,parameters:a,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:n,mipmaps:i=!1}=t;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?(is.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Gs(this.gl,t,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:i=0,format:r=this.format,border:s=this.border,offset:o=0,parameters:a={}}=t;let{data:l=null,type:c=this.type,width:u=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=t;l||(l=n),({type:c,dataFormat:d,compressed:p,width:u,height:h}=this._deduceParameters({format:r,type:c,dataFormat:d,compressed:p,data:l,width:u,height:h}));const{gl:f}=this;f.bindTexture(this.target,this.handle);let m,g=null;({data:l,dataType:g}=this._getDataType({data:l,compressed:p}));let y=0;if(Gs(this.gl,a,(()=>{switch(g){case"null":f.texImage2D(e,i,r,u,h,s,d,c,l);break;case"typed-array":f.texImage2D(e,i,r,u,h,s,d,c,l,o);break;case"buffer":m=cs(f),m.bindBuffer(35052,l.handle||l),m.texImage2D(e,i,r,u,h,s,d,c,o),m.bindBuffer(35052,null);break;case"browser-object":as(f)?f.texImage2D(e,i,r,u,h,s,d,c,l):f.texImage2D(e,i,r,d,c,l);break;case"compressed":for(const[t,n]of l.entries())f.compressedTexImage2D(e,t,n.format,n.width,n.height,s,n.data),y+=n.levelSize;break;default:co(!1,"Unknown image data type")}})),"compressed"===g)this._trackAllocatedMemory(y,"Texture");else if(l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const t=Lo[this.dataFormat]||4,e=Do[this.type]||1;this._trackAllocatedMemory(this.width*this.height*t*e,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:n=null,data:i=null,x:r=0,y:s=0,width:o=this.width,height:a=this.height,level:l=0,format:c=this.format,type:u=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:p=0,border:f=this.border,parameters:m={}}=t;if(({type:u,dataFormat:h,compressed:d,width:o,height:a}=this._deduceParameters({format:c,type:u,dataFormat:h,compressed:d,data:i,width:o,height:a})),co(0===this.depth,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const t=i;i=t.data,o=t.shape[0],a=t.shape[1]}i instanceof Mo&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Gs(this.gl,m,(()=>{if(d)this.gl.compressedTexSubImage2D(e,l,r,s,o,a,c,i);else if(null===i)this.gl.texSubImage2D(e,l,r,s,o,a,h,u,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,l,r,s,o,a,h,u,i,p);else if(i instanceof Bo){const t=cs(this.gl);t.bindBuffer(35052,i),t.texSubImage2D(e,l,r,s,o,a,h,u,p),t.bindBuffer(35052,null)}else if(as(this.gl)){cs(this.gl).texSubImage2D(e,l,r,s,o,a,h,u,i)}else this.gl.texSubImage2D(e,l,r,s,h,u,i)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return is.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:n=!1}=t;return n?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Mo?{data:e.handle,dataType:"buffer"}:e instanceof Bo?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:i,height:r,dataFormat:s,type:o,compressed:a}=t;const l=zo[e];return s=s||l&&l.dataFormat,o=o||l&&l.types[0],a=a||l&&l.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:s,type:o,compressed:a,width:i,height:r,format:e,data:n}}_deduceImageSize(t,e,n){let i;return i="undefined"!==typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!==typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:n}:{width:e>=0?e:1,height:n>=0?n:1},co(i,"Could not deduced texture size"),co(void 0===e||i.width===e,"Deduced texture width does not match supplied width"),co(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:co(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!as(this.gl)&&(!(!this.width||!this.height)&&(!mo(this.width)||!mo(this.height)))}_updateForNPOT(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:-1===Ro.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}let Fo="";class Vo extends Oo{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return Oo.isSupported(t,e)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,i;ls(t),(e instanceof Promise||"string"===typeof e)&&(e={data:e}),"string"===typeof e.data&&(e=Object.assign({},e,{data:(n=e.data,co("string"===typeof n),n=Fo+n,new Promise(((t,e)=>{try{const r=new Image;r.onload=()=>t(r),r.onerror=()=>e(new Error("Could not load image ".concat(n,"."))),r.crossOrigin=i&&i.crossOrigin||"anonymous",r.src=n}catch(r){e(r)}})))})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const No="EXT_color_buffer_float",Uo={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:No,bpp:2},33327:{gl2:No,bpp:4},34842:{gl2:No,bpp:8},33326:{gl2:No,bpp:4},33328:{gl2:No,bpp:8},34836:{gl2:No,bpp:16},35898:{gl2:No,bpp:4}};class jo extends vo{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:null};return!e||function(t,e,n){const i=n[e];if(!i)return!1;const r=as(t)&&i.gl2||i.gl1;return"string"===typeof r?t.getExtension(r):r}(t,e,Uo)}static getSamplesForFormat(t,e){let{format:n}=e;return t.getInternalformatParameter(36161,n,32937)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:n=1,height:i=1,samples:r=0}=t;return co(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==r&&as(this.gl)?this.gl.renderbufferStorageMultisample(36161,r,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=r,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Uo[this.format].bpp),this}resize(t){let{width:e,height:n}=t;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){this.gl.bindRenderbuffer(36161,this.handle);return this.gl.getRenderbufferParameter(36161,t)}}const Go=6144,qo=6145,$o=6146,Wo=34041,Zo="clear: bad arguments";function Ho(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=16384,!0!==n&&(s.clearColor=n)),i&&(o|=256,!0!==i&&(s.clearDepth=i)),r&&(o|=1024,!0!==i&&(s.clearStencil=i)),co(0!==o,Zo),Gs(t,s,(()=>{t.clear(o)}))}const Xo=[34069,34070,34071,34072,34073,34074];class Yo extends Oo{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ls(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then((()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)})),this}subImage(t){let{face:e,data:n,x:i=0,y:r=0,mipmapLevel:s=0}=t;return this._subImage({target:e,data:n,x:i,y:r,mipmapLevel:s})}async setCubeMapImageData(t){let{width:e,height:n,pixels:i,data:r,border:s=0,format:o=6408,type:a=5121}=t;const{gl:l}=this,c=i||r,u=await Promise.all(Xo.map((t=>{const e=c[t];return Promise.all(Array.isArray(e)?e:[e])})));this.bind(),Xo.forEach(((t,i)=>{u[i].length>1&&!1!==this.opts.mipmaps&&is.warn("".concat(this.id," has mipmap and multiple LODs."))(),u[i].forEach(((i,r)=>{e&&n?l.texImage2D(t,r,o,e,n,s,o,a,i):l.texImage2D(t,r,o,o,a,i)}))})),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=t,{gl:c}=this,u=r||s;return this.bind(),u instanceof Promise?u.then((n=>this.setImageDataForFace(Object.assign({},t,{face:e,data:n,pixels:n})))):this.width||this.height?c.texImage2D(e,0,a,n,i,o,a,l,u):c.texImage2D(e,0,a,a,l,u),this}}Yo.FACES=Xo;class Ko extends Oo{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return as(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};cs(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:n=6408,width:i,height:r,depth:s=1,border:o=0,format:a,type:l=5121,offset:c=0,data:u,parameters:h={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Gs(this.gl,h,(()=>{ArrayBuffer.isView(u)&&this.gl.texImage3D(this.target,e,n,i,r,s,o,a,l,u),u instanceof Mo&&(this.gl.bindBuffer(35052,u.handle),this.gl.texImage3D(this.target,e,n,i,r,s,o,a,l,c))})),u&&u.byteLength)this._trackAllocatedMemory(u.byteLength,"Texture");else{const t=Lo[this.dataFormat]||4,e=Do[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*t*e,"Texture")}return this.loaded=!0,this}}function Jo(t,e){const{gl:n,width:i,height:r,id:s}=t;return new ca(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{36064:t}}))}function Qo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:h}=ea(t);co(u);const{gl:d,handle:p,attachments:f}=u;a=a||u.width,l=l||u.height,36064===s&&null===p&&(s=1028),co(f[s]),c=c||f[s].type,o=na(o,c,r,a,l),c=c||xo(o);const m=d.bindFramebuffer(36160,p);return d.readPixels(n,i,a,l,r,c,o),d.bindFramebuffer(36160,m||null),h&&u.delete(),o}function ta(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Qo(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=So({data:i,width:r,height:s}));wo({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function ea(t){return t instanceof ca?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Jo(t),deleteFramebuffer:!0}}function na(t,e,n,i,r){if(t)return t;const s=bo(e=e||5121,{clamped:!1}),o=function(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return co(!1),0}}(n);return new s(i*r*o)}const ia="TIMER_QUERY",ra="ELEMENT_INDEX_UINT32";const sa={["WEBGL2"]:[!1,!0],["VERTEX_ARRAY_OBJECT"]:["OES_vertex_array_object",!0],[ia]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],["INSTANCED_RENDERING"]:["ANGLE_instanced_arrays",!0],["MULTIPLE_RENDER_TARGETS"]:["WEBGL_draw_buffers",!0],[ra]:["OES_element_index_uint",!0],["BLEND_EQUATION_MINMAX"]:["EXT_blend_minmax",!0],["FLOAT_BLEND"]:["EXT_float_blend"],["COLOR_ENCODING_SRGB"]:["EXT_sRGB",!0],["TEXTURE_DEPTH"]:["WEBGL_depth_texture",!0],["TEXTURE_FLOAT"]:["OES_texture_float",!0],["TEXTURE_HALF_FLOAT"]:["OES_texture_half_float",!0],["TEXTURE_FILTER_LINEAR_FLOAT"]:["OES_texture_float_linear"],["TEXTURE_FILTER_LINEAR_HALF_FLOAT"]:["OES_texture_half_float_linear"],["TEXTURE_FILTER_ANISOTROPIC"]:["EXT_texture_filter_anisotropic"],["COLOR_ATTACHMENT_RGBA32F"]:[function(t){const e=new Vo(t,{format:6408,type:5126,dataFormat:6408}),n=new ca(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),36053===i},"EXT_color_buffer_float"],["COLOR_ATTACHMENT_FLOAT"]:[!1,"EXT_color_buffer_float"],["COLOR_ATTACHMENT_HALF_FLOAT"]:["EXT_color_buffer_half_float"],["GLSL_FRAG_DATA"]:["WEBGL_draw_buffers",!0],["GLSL_FRAG_DEPTH"]:["EXT_frag_depth",!0],["GLSL_DERIVATIVES"]:["OES_standard_derivatives",!0],["GLSL_TEXTURE_LOD"]:["EXT_shader_texture_lod",!0]};function oa(t,e){return(e=Array.isArray(e)?e:[e]).every((e=>aa(t,e)))}function aa(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},void 0===t.luma.caps[e]&&(t.luma.caps[e]=function(t,e){const n=sa[e];let i;co(n,e);const r=as(t)&&n[1]||n[0];if("function"===typeof r)i=r(t);else if(Array.isArray(r)){i=!0;for(const e of r)i=i&&Boolean(t.getExtension(e))}else"string"===typeof r?i=Boolean(t.getExtension(r)):"boolean"===typeof r?i=r:co(!1);return i}(t,e)),t.luma.caps[e]||is.log(2,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}const la="Multiple render targets not supported";class ca extends vo{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{colorBufferFloat:n,colorBufferHalfFloat:i}=e;let r=!0;return n&&(r=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(r=r&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),r}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new ca(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=cs(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=cs(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:n=1,attachments:i=null,color:r=!0,depth:s=!0,stencil:o=!1,check:a=!0,readBuffer:l,drawBuffers:c}=t;if(co(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const u in i){const t=i[u];(Array.isArray(t)?t[0]:t).resize({width:e,height:n})}else i=this._createDefaultAttachments(r,s,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:l,drawBuffers:c}),i&&a&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:r=!1,resizeAttachments:s=!0}=t;this.attach(e,{clearAttachments:r,resizeAttachments:s});const{gl:o}=this,a=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,a||null),this}resize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{width:e,height:n}=t;if(null===this.handle)return co(void 0===e&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&is.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const i in this.attachments)this.attachments[i].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i={};e&&Object.keys(this.attachments).forEach((t=>{i[t]=null})),Object.assign(i,t);const r=this.gl.bindFramebuffer(36160,this.handle);for(const s in i){co(void 0!==s,"Misspelled framebuffer binding point?");const t=Number(s),e=i[t];let r=e;if(r)if(r instanceof jo)this._attachRenderbuffer({attachment:t,renderbuffer:r});else if(Array.isArray(e)){const[n,i=0,s=0]=e;r=n,this._attachTexture({attachment:t,texture:n,layer:i,level:s})}else this._attachTexture({attachment:t,texture:r,layer:0,level:0});else this._unattach(t);n&&r&&r.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,r||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter((t=>!this.attachments[t])).forEach((t=>{delete this.attachments[t]}))}checkStatus(){const{gl:t}=this,e=this.getStatus();if(36053!==e)throw new Error(function(t){return(ca.STATUS||{})[t]||"Framebuffer error ".concat(t)}(e));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:e,depth:n,stencil:i,drawBuffers:r=[]}=t,s=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&Ho(this.gl,{color:e,depth:n,stencil:i}),r.forEach(((t,e)=>{!function(t){let{framebuffer:e=null,buffer:n=Go,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};cs(t),Gs(t,{framebuffer:e},(()=>{switch(n){case Go:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case qo:t.clearBufferfv(qo,0,[r]);break;case $o:t.clearBufferiv($o,0,[r]);break;case Wo:const[e,s]=r;t.clearBufferfi(Wo,0,e,s);break;default:co(!1,Zo)}}))}(this.gl,{drawBuffer:e,value:t})})),this.gl.bindFramebuffer(36160,s||null),this}readPixels(){return is.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return is.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return is.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return is.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return is.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return is.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:n=0,y:i=0,width:r,height:s}=t;const o=cs(this.gl),a=o.bindFramebuffer(36008,this.handle);return 0===n&&0===i&&void 0===r&&void 0===s?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,r,s),o.bindFramebuffer(36008,a),this}getAttachmentParameter(t,e,n){let i=this._getAttachmentParameterFallback(e);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=ho(this.gl,i)),i}getAttachmentParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const r of n){i[e?ho(this.gl,r):r]=this.getAttachmentParameter(t,r,e)}return i}getParameters(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=Object.keys(this.attachments),n={};for(const i of e){const e=Number(i);n[t?ho(this.gl,e):e]=this.getAttachmentParameters(e,t)}return n}show(){return"undefined"!==typeof window&&window.open(ta(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>is.level||"undefined"===typeof window)return this;e=e||"Framebuffer ".concat(this.id);const n=ta(this,{targetMaxHeight:100});return is.image({logLevel:t,message:e,image:n},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,i,r){let s=null;return t&&(s=s||{},s[36064]=new Vo(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:r,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(s[36064])),e&&n?(s=s||{},s[33306]=new jo(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(s[33306])):e?(s=s||{},s[36096]=new jo(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:r}),this.ownResources.push(s[36096])):n&&co(!1),s}_unattach(t){const e=this.attachments[t];e&&(e instanceof jo?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:n}=t;const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture(t){let{attachment:e=36064,texture:n,layer:i,level:r}=t;const{gl:s}=this;switch(s.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:cs(s).framebufferTextureLayer(36160,e,n.target,r,i);break;case 34067:const t=function(t){return t<34069?t+34069:t}(i);s.framebufferTexture2D(36160,e,t,n.handle,r);break;case 3553:s.framebufferTexture2D(36160,e,3553,n.handle,r);break;default:co(!1,"Illegal texture type")}s.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(t){const e=as(n=this.gl)?n:null;var n;e?e.readBuffer(t):co(36064===t||1029===t,la),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=cs(e);if(n)n.drawBuffers(t);else{const n=e.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):co(1===t.length&&(36064===t[0]||1029===t[0]),la)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=function(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in sa)void 0===t.luma.caps[e]&&(t.luma.caps[e]=aa(t,e));return t.luma.caps}(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return e.WEBGL2||e.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}ca.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];const ua={5126:Ea.bind(null,"uniform1fv",ga,1,Ta),35664:Ea.bind(null,"uniform2fv",ga,2,Ta),35665:Ea.bind(null,"uniform3fv",ga,3,Ta),35666:Ea.bind(null,"uniform4fv",ga,4,Ta),5124:Ea.bind(null,"uniform1iv",ya,1,Ta),35667:Ea.bind(null,"uniform2iv",ya,2,Ta),35668:Ea.bind(null,"uniform3iv",ya,3,Ta),35669:Ea.bind(null,"uniform4iv",ya,4,Ta),35670:Ea.bind(null,"uniform1iv",ya,1,Ta),35671:Ea.bind(null,"uniform2iv",ya,2,Ta),35672:Ea.bind(null,"uniform3iv",ya,3,Ta),35673:Ea.bind(null,"uniform4iv",ya,4,Ta),35674:Ea.bind(null,"uniformMatrix2fv",ga,4,Aa),35675:Ea.bind(null,"uniformMatrix3fv",ga,9,Aa),35676:Ea.bind(null,"uniformMatrix4fv",ga,16,Aa),35678:Sa,35680:Sa,5125:Ea.bind(null,"uniform1uiv",_a,1,Ta),36294:Ea.bind(null,"uniform2uiv",_a,2,Ta),36295:Ea.bind(null,"uniform3uiv",_a,3,Ta),36296:Ea.bind(null,"uniform4uiv",_a,4,Ta),35685:Ea.bind(null,"uniformMatrix2x3fv",ga,6,Aa),35686:Ea.bind(null,"uniformMatrix2x4fv",ga,8,Aa),35687:Ea.bind(null,"uniformMatrix3x2fv",ga,6,Aa),35688:Ea.bind(null,"uniformMatrix3x4fv",ga,12,Aa),35689:Ea.bind(null,"uniformMatrix4x2fv",ga,8,Aa),35690:Ea.bind(null,"uniformMatrix4x3fv",ga,12,Aa),35678:Sa,35680:Sa,35679:Sa,35682:Sa,36289:Sa,36292:Sa,36293:Sa,36298:Sa,36299:Sa,36300:Sa,36303:Sa,36306:Sa,36307:Sa,36308:Sa,36311:Sa},ha={},da={},pa={},fa=[0];function ma(t,e,n,i){1===e&&"boolean"===typeof t&&(t=t?1:0),Number.isFinite(t)&&(fa[0]=t,t=fa);const r=t.length;if(r%e&&is.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function ga(t,e){return ma(t,e,Float32Array,ha)}function ya(t,e){return ma(t,e,Int32Array,da)}function _a(t,e){return ma(t,e,Uint32Array,pa)}function va(t,e,n){const i=ua[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function xa(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};const e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function ba(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t):!!isFinite(t)||(!0===t||!1===t||(t instanceof Oo||(t instanceof jo||t instanceof ca&&Boolean(t.texture))))}function wa(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let t=0,e=n.length;t<e;++t)i[t]=n[t]}else t[e]=n.slice();else t[e]=n}function Sa(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function Ea(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let h=!1;if(null===r)r=new Float32Array(u),s=u,h=!0;else{co(s===u,"Uniform length cannot change.");for(let t=0;t<u;++t)if(c[t]!==r[t]){h=!0;break}}return h&&(i(o,t,a,c),r.set(c)),h}}function Ta(t,e,n,i){t[e](n,i)}function Aa(t,e,n,i){t[e](n,!1,i)}function ka(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}function Pa(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||ka(e)||"(unnamed)",l="".concat(function(t){switch(t){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(n)," shader ").concat(a);for(let u=0;u<r.length;u++){const e=r[u];if(e.length<=1)continue;const n=e.split(":"),i=n[0],a=parseInt(n[2],10);if(isNaN(a))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));"WARNING"!==i?s[a]=e:o[a]=e}const c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map(((t,i)=>{const s=String(i+e),o=s.length;return Ca(s,r-o)+n+t}))}(e);return{shaderName:l,errors:Ia(s,c),warnings:Ia(o,c)}}function Ia(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if((t[i+3]||t[i+2]||t[i+1])&&(n+="".concat(r,"\n"),t[i+1])){const e=t[i+1],r=e.split(":",3),s=r[0],o=parseInt(r[1],10)||0,a=e.substring(r.join(":").length+1).trim();n+=Ca("^^^ ".concat(s,": ").concat(a,"\n\n"),o)}}return n}function Ca(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}class Ma extends vo{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return co(!1),"unknown"}}constructor(t,e){ls(t),co("string"===typeof e.source,"Shader: GLSL source code must be a JavaScript string");super(t,{id:ka(e.source,null)||e.id||fo("unnamed ".concat(Ma.getTypeName(e.shaderType)))}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const n=ka(e,null);n&&(this.id=fo(n)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(Ma.getTypeName(this.shaderType),":").concat(this.id)}getName(){return ka(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;t.startsWith("#version ")||(t="#version 100\n".concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);if(!this.getParameter(35713)){const t=this.gl.getShaderInfoLog(this.handle),{shaderName:e,errors:n,warnings:i}=Pa(t,this.source,this.shaderType,this.id);throw is.error("GLSL compilation errors in ".concat(e,"\n").concat(n))(),is.warn("GLSL compilation warnings in ".concat(e,"\n").concat(i))(),new Error("GLSL compilation errors in ".concat(e))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class za extends Ma{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){"string"===typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class La extends Ma{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){"string"===typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Da=5126,Ra=5124,Ba=5125,Oa={[Da]:[Da,1,"float"],35664:[Da,2,"vec2"],35665:[Da,3,"vec3"],35666:[Da,4,"vec4"],[Ra]:[Ra,1,"int"],35667:[Ra,2,"ivec2"],35668:[Ra,3,"ivec3"],35669:[Ra,4,"ivec4"],[Ba]:[Ba,1,"uint"],36294:[Ba,2,"uvec2"],36295:[Ba,3,"uvec3"],36296:[Ba,4,"uvec4"],35670:[Da,1,"bool"],35671:[Da,2,"bvec2"],35672:[Da,3,"bvec3"],35673:[Da,4,"bvec4"],35674:[Da,8,"mat2"],35685:[Da,8,"mat2x3"],35686:[Da,8,"mat2x4"],35675:[Da,12,"mat3"],35687:[Da,12,"mat3x2"],35688:[Da,12,"mat3x4"],35676:[Da,16,"mat4"],35689:[Da,16,"mat4x2"],35690:[Da,16,"mat4x3"]};function Fa(t){switch(t){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return co(!1),0}}function Va(t){const e=Oa[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function Na(t,e){switch(t){case 5120:case 5121:case 5122:case 5123:t=Da}for(const n in Oa){const[i,r,s]=Oa[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class Ua{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let i=0;i<n;i++){const{name:n,type:r,size:s}=e.getActiveAttrib(t.handle,i),o=e.getAttribLocation(t.handle,n);o>=0&&this._addAttribute(o,n,r,s)}this.attributeInfos.sort(((t,e)=>t.location-e.location))}_readVaryingsFromProgram(t){const{gl:e}=t;if(!as(e))return;const n=e.getProgramParameter(t.handle,35971);for(let i=0;i<n;i++){const{name:n,type:r,size:s}=e.getTransformFeedbackVarying(t.handle,i);this._addVarying(i,n,r,s)}this.varyingInfos.sort(((t,e)=>t.location-e.location))}_addAttribute(t,e,n,i){const{type:r,components:s}=Va(n),o={type:r,size:i*s};this._inferProperties(t,e,o);const a={location:t,name:e,accessor:new ko(o)};this.attributeInfos.push(a),this.attributeInfosByLocation[t]=a,this.attributeInfosByName[a.name]=a}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,i){const{type:r,components:s}=Va(n),o={location:t,name:e,accessor:new ko({type:r,size:i*s})};this.varyingInfos.push(o),this.varyingInfosByName[o.name]=o}}const ja=35981,Ga=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class qa extends vo{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",Ga),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{hash:e,vs:n,fs:i,varyings:r,bufferMode:s=ja}=t;return this.hash=e||"",this.vs="string"===typeof n?new za(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs="string"===typeof i?new La(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,co(this.vs instanceof za),co(this.fs instanceof La),this.uniforms={},this._textureUniforms={},r&&r.length>0&&(cs(this.gl),this.varyings=r,this.gl2.transformFeedbackVaryings(this.handle,r,s)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Ua(this),this.setProps(t)}delete(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:n=4,vertexCount:i,offset:r=0,start:s,end:o,isIndexed:a=!1,indexType:l=5123,instanceCount:c=0,isInstanced:u=c>0,vertexArray:h=null,transformFeedback:d,framebuffer:p,parameters:f={},uniforms:m,samplers:g}=t;if((m||g)&&(is.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(m||{})),is.priority>=e){const t=p?p.id:"default",r="mode=".concat(ho(this.gl,n)," verts=").concat(i," ")+"instances=".concat(c," indexType=").concat(ho(this.gl,l)," ")+"isInstanced=".concat(u," isIndexed=").concat(a," ")+"Framebuffer=".concat(t);is.log(e,r)()}return co(h),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===i||u&&0===c)&&(h.bindForDraw(i,c,(()=>{if(void 0!==p&&(f=Object.assign({},f,{framebuffer:p})),d){const t=Fa(n);d.begin(t)}this._bindTextures(),Gs(this.gl,f,(()=>{a&&u?this.gl2.drawElementsInstanced(n,i,l,r,c):a&&as(this.gl)&&!isNaN(s)&&!isNaN(o)?this.gl2.drawRangeElements(n,s,o,i,l,r):a?this.gl.drawElements(n,i,l,r):u?this.gl2.drawArraysInstanced(n,r,i,c):this.gl.drawArrays(n,r,i)})),d&&d.end()})),!0)}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};is.priority>=2&&function(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!ba(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}}(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],i=this._uniformSetters[e];if(i){let t=n,r=!1;if(t instanceof ca&&(t=t.texture),t instanceof Oo)if(r=this.uniforms[e]!==n,r){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);const n=t,{textureIndex:r}=i;n.bind(r),t=r,this._textureUniforms[e]=n}else t=i.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(i(t)||r)&&wa(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const i of e){switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new za({handle:i});break;case 35632:n.fs=new La({handle:i})}}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const t=this._getName();this.id=fo(t)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),is.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),is.timeEnd(4,"linkProgram for ".concat(this._getName()))(),t.debug||is.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));t.validateProgram(this.handle);if(!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:i}=xa(n.name);let r=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=va(t,r,n),n.size>1)for(let e=0;e<n.size;e++)r=t.getUniformLocation(this.handle,"".concat(i,"[").concat(e,"]")),this._uniformSetters["".concat(i,"[").concat(e,"]")]=va(t,r,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}class $a{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new $a(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find((e=>e.name===t.name))||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e="string"===typeof t?t:t.name;this._defaultModules=this._defaultModules.filter((t=>t.name!==e)),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{vs:e="",fs:n="",defines:i={},inject:r={},varyings:s=[],bufferMode:o=35981,transpileToGLSL100:a=!1}=t,l=this._getModuleList(t.modules),c=this._getHash(e),u=this._getHash(n),h=l.map((t=>this._getHash(t.name))).sort(),d=s.map((t=>this._getHash(t))),p=Object.keys(i).sort(),f=Object.keys(r).sort(),m=[],g=[];for(const _ of p)m.push(this._getHash(_)),m.push(this._getHash(i[_]));for(const _ of f)g.push(this._getHash(_)),g.push(this._getHash(r[_]));const y="".concat(c,"/").concat(u,"D").concat(m.join("/"),"M").concat(h.join("/"),"I").concat(g.join("/"),"V").concat(d.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(a?"T":"");if(!this._programCache[y]){const t=function(t,e){const{vs:n,fs:i}=e,r=Sr(e.modules||[]);return{gl:t,vs:es(t,Object.assign({},e,{source:n,type:gr,modules:r})),fs:es(t,Object.assign({},e,{source:i,type:yr,modules:r})),getUniforms:ns(r)}}(this.gl,{vs:e,fs:n,modules:l,inject:r,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:a});this._programCache[y]=new qa(this.gl,{hash:y,vs:t.vs,fs:t.fs,varyings:s,bufferMode:o}),this._getUniforms[y]=t.getUniforms||(t=>{}),this._useCounts[y]=0}return this._useCounts[y]++,this._programCache[y]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return void 0===this._hashes[t]&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),n={};let i=0;for(let r=0,s=this._defaultModules.length;r<s;++r){const t=this._defaultModules[r],s=t.name;e[i++]=t,n[s]=!0}for(let r=0,s=t.length;r<s;++r){const s=t[r],o=s.name;n[o]||(e[i++]=s,n[o]=!0)}return e.length=i,e}}const Wa={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null},Za="#define SMOOTH_EDGE_RADIUS 0.5",Ha={name:"geometry",vs:"\n".concat(Za,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),fs:"\n".concat(Za,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n")},Xa=Object.keys(sr).map((t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(sr[t],";"))).join(""),Ya=Object.keys(or).map((t=>"const int PROJECTION_MODE_".concat(t," = ").concat(or[t],";"))).join(""),Ka=Object.keys(ar).map((t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(ar[t],";"))).join(""),Ja="".concat(Xa,"\n").concat(Ya,"\n").concat(Ka,'\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0; // meters\nconst float GLOBE_RADIUS = 256.0;\n\n// returns an adjustment factor for uCommonUnitsPerMeter\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n\n    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear\n    // Adjust by 1 / cos(latitude)\n    // If geometry.position (vertex in common space) is populated, use it\n    // Otherwise use geometry.worldPosition (anchor in world space)\n    \n    if (geometry.position.w == 0.0) {\n      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);\n      return 1.0 / cos(radians(y));\n    }\n\n    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)\n    // Taylor series of 1 / cos(latitude)\n    // Max error < 0.003\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n//\n// Scaling offsets - scales meters to "world distance"\n// Note the scalar version of project_size is for scaling the z component only\n//\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\n\n// Get rotation matrix that aligns the z axis with the given up vector\n// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  // Tangent on XY plane\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n\n//\n// Projecting normal - transform deltas from current coordinate system to\n// normals in the worldspace\n//\nvec3 project_normal(vec3 vector) {\n  // Apply model matrix\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n  mat3 rotation;\n  if (project_needs_rotation(geometry.position.xyz, rotation)) {\n    n = rotation * n;\n  }\n  return n;\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n//\n// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]\n//\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n//\n// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)\n//\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        // Too far from the projection center for offset mode to be accurate\n        // Only use high parts\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n\n  // Translation is already added to the high parts\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\n\n//\n// Projects from common space coordinates to clip space.\n// Uses project_uViewProjectionMatrix\n//\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\n\n// Returns a clip space offset that corresponds to a given number of screen pixels\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  // UNIT_PIXELS\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n');function Qa(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function tl(t){let e,n={};return i=>{for(const r in i)if(!Qa(i[r],n[r])){e=t(i),n=i;break}return e}}const el=[0,0,0,0],nl=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],il=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rl=[0,0,0],sl=[0,0,0],ol=tl((function(t){let{viewport:e,devicePixelRatio:n,coordinateSystem:i,coordinateOrigin:r}=t;const{projectionCenter:s,viewProjectionMatrix:o,originCommon:a,cameraPosCommon:l,shaderCoordinateOrigin:c,geospatialOrigin:u}=function(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=el,l=el,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=al(t,e,n);d&&(l=t.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=wi([],l,o),s=i||s,o=di([],r,s),o=di([],o,nl));return{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,i,r),h=e.getDistanceScales(),d=[e.width*n,e.height*n],p=wi([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,f={project_uCoordinateSystem:i,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:a.slice(0,3),project_uCenter:s,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:d,project_uDevicePixelRatio:n,project_uFocalDistance:p,project_uCommonUnitsPerMeter:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:rl,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:il,project_uCameraPosition:l};if(u){const t=e.getDistanceScales(u);switch(i){case sr.METER_OFFSETS:f.project_uCommonUnitsPerWorldUnit=t.unitsPerMeter,f.project_uCommonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case sr.LNGLAT:case sr.LNGLAT_OFFSETS:e._pseudoMeters||(f.project_uCommonUnitsPerMeter=t.unitsPerMeter),f.project_uCommonUnitsPerWorldUnit=t.unitsPerDegree,f.project_uCommonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case sr.CARTESIAN:f.project_uCommonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.project_uCommonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f}));function al(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sl;n.length<3&&(n=[n[0],n[1],0]);let i,r=n,s=!0;switch(i=e===sr.LNGLAT_OFFSETS||e===sr.METER_OFFSETS?n:t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case or.WEB_MERCATOR:e!==sr.LNGLAT&&e!==sr.CARTESIAN||(i=[0,0,0],s=!1);break;case or.WEB_MERCATOR_AUTO_OFFSET:e===sr.LNGLAT?r=i:e===sr.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case or.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case or.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function ll(t){let{viewport:e,devicePixelRatio:n=1,modelMatrix:i=null,coordinateSystem:r=sr.DEFAULT,coordinateOrigin:s=sl,autoWrapLongitude:o=!1}=t;r===sr.DEFAULT&&(r=e.isGeospatial?sr.LNGLAT:sr.CARTESIAN);const a=ol({viewport:e,devicePixelRatio:n,coordinateSystem:r,coordinateOrigin:s});return a.project_uWrapLongitude=o,a.project_uModelMatrix=i||il,a}const cl={};const ul={name:"project",dependencies:[Wa,Ha],vs:Ja,getUniforms:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cl;return"viewport"in t?ll(t):{}}},hl=[ul],dl=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function pl(t){const e=$a.getDefaultProgramManager(t);for(const n of hl)e.addDefaultModule(n);for(const n of dl)e.addShaderHook(n);return e}class fl{constructor(t){let{deck:e,stats:n,viewport:i,timeline:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_t(this,"layers",void 0),_t(this,"context",void 0),_t(this,"resourceManager",void 0),_t(this,"_lastRenderedLayers",[]),_t(this,"_needsRedraw",!1),_t(this,"_needsUpdate",!1),_t(this,"_nextLayers",null),_t(this,"_debug",!1),_t(this,"activateViewport",(t=>{ne("layerManager.activateViewport",this,t),t&&(this.context.viewport=t)})),this.layers=[],this.resourceManager=new Bn({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&pl(t),stats:n||new le({id:"deck.gl"}),viewport:i||new mr({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:r||new bt,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t?this.layers.filter((e=>t.find((t=>0===e.id.indexOf(t))))):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){ne("layerManager.setLayers",this,e,t),this._lastRenderedLayers=t;const n=ie(t,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,n){n.raiseError(e,"".concat(t," of ").concat(n))}_updateLayers(t,e){const n={};for(const s of t)n[s.id]?te.warn("Multiple old layers with same id ".concat(s.id))():n[s.id]=s;const i=[];this._updateSublayersRecursively(e,n,i),this._finalizeOldLayers(n);let r=!1;for(const s of i)if(s.hasUniformTransition()){r="Uniform transition in ".concat(s);break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(t,e,n){for(const r of t){r.context=this.context;const t=e[r.id];null===t&&te.warn("Multiple new layers with same id ".concat(r.id))(),e[r.id]=null;let s=null;try{this._debug&&t!==r&&r.validateProps(),t?(this._transferLayerState(t,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),s=r.isComposite?r.getSubLayers():null}catch(i){this._handleError("matching",i,r)}s&&this._updateSublayersRecursively(s,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Et}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=St,e!==t&&(t.lifecycle=Tt)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=At;try{t._finalize(),t.lifecycle=kt}catch(e){this._handleError("finalization",e,t)}}}function ml(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],r=e[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&ml(i,r)))return!1}return!0}class gl{constructor(t){_t(this,"width",void 0),_t(this,"height",void 0),_t(this,"views",void 0),_t(this,"viewState",void 0),_t(this,"controllers",void 0),_t(this,"timeline",void 0),_t(this,"_viewports",void 0),_t(this,"_viewportMap",void 0),_t(this,"_isUpdating",void 0),_t(this,"_needsRedraw",void 0),_t(this,"_needsUpdate",void 0),_t(this,"_eventManager",void 0),_t(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter((e=>e.containsPixel(t))):this._viewports}getViews(){const t={};return this.views.forEach((e=>{t[e.id]=e})),t}getView(t){return this.views.find((e=>e.id===t))}getViewState(t){const e="string"===typeof t?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),i={x:t[0],y:t[1]};for(let r=n.length-1;r>=0;--r){const s=n[r];if(s.containsPixel(i)){const n=t.slice();return n[0]-=s.x,n[1]-=s.y,s.unproject(n,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=ie(t,Boolean);this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){if(t){!ml(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t}else te.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){return new(0,e.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:e=>{var n;return null===(n=this.getView(t.id))||void 0===n?void 0:n.makeViewport({viewState:e,width:this.width,height:this.height})}})}_updateController(t,e,n,i){const r=t.controller;if(r){const s={...e,...r,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return i||(i=this._createController(t,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){const r=t[i],s=this.getViewState(r),o=r.makeViewport({viewState:s,width:this.width,height:this.height});let a=e[r.id];const l=Boolean(r.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,s,o,a),this._viewports.unshift(o)}for(const i in e){const t=e[i];t&&!this.controllers[i]&&t.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)}))}_diffViews(t,e){return t.length!==e.length||t.some(((n,i)=>!t[i].equals(e[i])))}}const yl=/([0-9]+\.?[0-9]*)(%|px)/;function _l(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=yl.exec(t);if(e&&e.length>=3){const t="%"===e[2],n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error("Could not parse position string ".concat(t))}}function vl(t,e){return t.relative?Math.round(t.position*e):t.position}function xl(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class bl{constructor(t){_t(this,"id",void 0),_t(this,"viewportInstance",void 0),_t(this,"_x",void 0),_t(this,"_y",void 0),_t(this,"_width",void 0),_t(this,"_height",void 0),_t(this,"_padding",void 0),_t(this,"props",void 0);const{id:e,x:n=0,y:i=0,width:r="100%",height:s="100%",padding:o=null,viewportInstance:a}=t||{};xl(!a||a instanceof mr),this.viewportInstance=a,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=_l(n),this._y=_l(i),this._width=_l(r),this._height=_l(s),this._padding=o&&{left:_l(o.left||0),right:_l(o.right||0),top:_l(o.top||0),bottom:_l(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t||(this.viewportInstance?!!t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):this.ViewportType===t.ViewportType&&ml(this.props,t.props))}makeViewport(t){let{width:e,height:n,viewState:i}=t;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:t}=this.props;return"string"===typeof t?t:(null===t||void 0===t?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&"object"===typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const t in this.props.viewState)"id"!==t&&(e[t]=this.props.viewState[t]);return e}return t}getDimensions(t){let{width:e,height:n}=t;const i={x:vl(this._x,e),y:vl(this._y,n),width:vl(this._width,e),height:vl(this._height,n)};return this._padding&&(i.padding={left:vl(this._padding.left,e),top:vl(this._padding.top,n),right:vl(this._padding.right,e),bottom:vl(this._padding.bottom,n)}),i}get controller(){const t=this.props.controller;return t?!0===t?{type:this.ControllerType}:"function"===typeof t?{type:t}:{type:this.ControllerType,...t}:null}}const wl=Math.PI/180;function Sl(t){return 512/4003e4/Math.cos(t*wl)}class El extends mr{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{latitude:e=0,longitude:n=0,zoom:i=0,pitch:r=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,orthographic:l=!1,projectionMatrix:c,repeat:u=!1,worldOffset:h=0,legacyMeterSizes:d=!1}=t;let{width:p,height:f,altitude:m=1.5}=t;const g=Math.pow(2,i);let y;p=p||1,f=f||1;let _=null;c?(m=c[5]/2,y=Ji(m)):(t.fovy?(y=t.fovy,m=Qi(y)):y=Ji(m),_=Ki({width:p,height:f,pitch:r,fovy:y,nearZMultiplier:o,farZMultiplier:a}));let v=function(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];pi(a,a,[0,0,-r]),mi(a,a,-n*Ni),gi(a,a,i*Ni);const l=s/e;var c,u;return fi(a,a,[l,l,l]),o&&pi(a,a,((c=[])[0]=-(u=o)[0],c[1]=-u[1],c[2]=-u[2],c)),a}({height:f,pitch:r,bearing:s,scale:g,altitude:m});if(h){v=(new Ii).translate([512*h,0,0]).multiplyLeft(v)}super({...t,width:p,height:f,viewMatrix:v,longitude:n,latitude:e,zoom:i,..._,fovy:y,focalDistance:m}),_t(this,"longitude",void 0),_t(this,"latitude",void 0),_t(this,"pitch",void 0),_t(this,"bearing",void 0),_t(this,"altitude",void 0),_t(this,"fovy",void 0),_t(this,"orthographic",void 0),_t(this,"_subViewports",void 0),_t(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=s,this.altitude=m,this.fovy=y,this.orthographic=l,this._subViewports=u?[]:null,this._pseudoMeters=d,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=e;i<=n;i++){const t=i?new El({...this,worldOffset:i}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t);return[e,n,(t[2]||0)*Sl(t[1])]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t);return[e,n,(t[2]||0)/Sl(n)]}addMetersToLngLat(t,e){return Yi(t,e)}panByPosition(t,e){const n=er(e,this.pixelUnprojectionMatrix),i=vi([],this.projectFlat(t),xi([],n)),r=vi([],this.center,i),[s,o]=this.unprojectFlat(r);return{longitude:s,latitude:o}}getBounds(){const t=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;const u=t.fovy?.5*t.fovy*ir:Math.atan(.5/t.altitude),h=(90-t.pitch)*ir;return u>h-.01?(l=rr(t,0,e),c=rr(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}(this,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{width:n,height:i}=this,{longitude:r,latitude:s,zoom:o}=nr({width:n,height:i,bounds:t,...e});return new El({width:n,height:i,longitude:r,latitude:s,zoom:o})}}_t(El,"displayName","WebMercatorViewport");class Tl{constructor(t){_t(this,"_inProgress",void 0),_t(this,"_handle",void 0),_t(this,"_timeline",void 0),_t(this,"time",void 0),_t(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,n;this.cancel(),this.settings=t,this._inProgress=!0,null===(e=(n=this.settings).onStart)||void 0===e||e.call(n,this)}end(){var t,e;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null===(t=(e=this.settings).onEnd)||void 0===t||t.call(e,this))}cancel(){var t,e;this._inProgress&&(null===(t=(e=this.settings).onInterrupt)||void 0===t||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,e;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null===(t=(e=this.settings).onUpdate)||void 0===t||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Al=()=>{},kl=2,Pl=3,Il=t=>t,Cl=1;class Ml{constructor(t){_t(this,"getControllerState",void 0),_t(this,"props",void 0),_t(this,"propsInTransition",void 0),_t(this,"transition",void 0),_t(this,"onViewStateChange",void 0),_t(this,"onStateChange",void 0),_t(this,"_onTransitionUpdate",(t=>{const{time:e,settings:{interpolator:n,startProps:i,endProps:r,duration:s,easing:o}}=t,a=o(e/s),l=n.interpolateProps(i,r,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})})),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Tl(t.timeline),this.onViewStateChange=t.onViewStateChange||Al,this.onStateChange=t.onStateChange||Al}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){const{interruption:t,endProps:e}=this.transition.settings;i={...n,...t===kl?e:this.propsInTransition||n}}this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||"auto"===e)&&Boolean(n)}_isUpdateDueToCurrentTransition(t){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition)}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===Pl||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}_triggerTransition(t,e){const n=this.getControllerState(t),i=this.getControllerState(e).shortestPathFrom(n),r=e.transitionInterpolator,s=r.getDuration?r.getDuration(t,e):e.transitionDuration;if(0===s)return;const o=r.initializeProps(t,i);this.propsInTransition={};const a={duration:s,easing:e.transitionEasing||Il,interpolator:r,interruption:e.transitionInterruption||Cl,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null===t||void 0===t||t(e)}}}const zl=["longitude","latitude","zoom","bearing","pitch"],Ll=["longitude","latitude","zoom"];class Dl extends class{constructor(t){_t(this,"_propsToCompare",void 0),_t(this,"_propsToExtract",void 0),_t(this,"_requiredProps",void 0);const{compare:e,extract:n,required:i}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!Gn(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},i={};for(const r of this._propsToExtract)(r in t||r in e)&&(n[r]=t[r],i[r]=e[r]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach((e=>{const n=t[e];xl(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))}))}}{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:zl,required:Ll},super(n.transitionProps),_t(this,"opts",void 0),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:i,around:r}=this.opts;if(i&&r){const s=i(t),o=i(e),a=s.unproject(r);n.start.around=r,Object.assign(n.end,{around:o.project(a),aroundPosition:a,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const i={};for(const r of this._propsToExtract)i[r]=jn(t[r]||0,e[r]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...e,...i});Object.assign(i,r.panByPosition(e.aroundPosition,jn(t.around,e.around,n)))}return i}}const Rl={transitionDuration:0},Bl=t=>1-(1-t)*(1-t),Ol=["wheel"],Fl=["panstart","panmove","panend"],Vl=["pinchstart","pinchmove","pinchend"],Nl=["tripanstart","tripanmove","tripanend"],Ul=["doubletap"],jl=["keydown"],Gl={};class ql{constructor(t){_t(this,"props",void 0),_t(this,"state",{}),_t(this,"transitionManager",void 0),_t(this,"eventManager",void 0),_t(this,"onViewStateChange",void 0),_t(this,"onStateChange",void 0),_t(this,"makeViewport",void 0),_t(this,"_controllerState",void 0),_t(this,"_events",{}),_t(this,"_interactionState",{isDragging:!1}),_t(this,"_customEvents",[]),_t(this,"_eventStartBlocked",null),_t(this,"_panMove",!1),_t(this,"invertPan",!1),_t(this,"dragMode","rotate"),_t(this,"inertia",0),_t(this,"scrollZoom",!0),_t(this,"dragPan",!0),_t(this,"dragRotate",!0),_t(this,"doubleClickZoom",!0),_t(this,"touchZoom",!0),_t(this,"touchRotate",!1),_t(this,"keyboard",!0),this.transitionManager=new Ml({...t,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events){var t;if(this._events[e])null===(t=this.eventManager)||void 0===t||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return!e&&this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return!e&&this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return!e&&this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:i}=t;return[i.x-e,i.y-n]}isPointInBounds(t,e){const{width:n,height:i}=this.props;if(e&&e.handled)return!1;const r=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return r&&e&&e.stopPropagation(),r}isFunctionKeyPressed(t){const{srcEvent:e}=t;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout((()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)}),t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:!0===e?300:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=t,c=Boolean(this.onViewStateChange);this.toggleEvents(Ol,c&&n),this.toggleEvents(Fl,c&&(i||r)),this.toggleEvents(Vl,c&&(o||a)),this.toggleEvents(Nl,c&&a),this.toggleEvents(Ul,c&&s),this.toggleEvents(jl,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach((t=>{this._events[t]!==e&&(this._events[t]=e,e?this.eventManager.on(t,this.handleEvent):this.eventManager.off(t,this.handleEvent))}))}updateViewport(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i={...t.getViewportProps(),...e},r=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),r){const t=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:t})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(i,Rl,{isDragging:!0}),!0}_onPan(t){return!!this.isDragging()&&(this._panMove?this._onPanMove(t):this._onPanRotate(t))}_onPanEnd(t){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t))}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,Rl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Bl},{isDragging:!1,isPanning:!0})}else{const t=this.controllerState.panEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,Rl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Bl},{isDragging:!1,isRotating:!0})}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;t.srcEvent.preventDefault();const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const{speed:n=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=t;let s=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==s&&(s=1/s);const o=this.controllerState.zoom({pos:e,scale:s});return this.updateViewport(o,{...this._getTransitionProps({around:e}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,Rl,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,Rl,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*e/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Bl},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return Gl._startPinchRotation=t.rotation,Gl._lastPinchEvent=t,this.updateViewport(n,Rl,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:Gl._startPinchRotation-n})}return this.updateViewport(e,Rl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Gl._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=Gl;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const i=this.getCenter(t);let r=this.controllerState.rotateEnd();const s=Math.log2(t.scale),o=(s-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),a=Math.pow(2,s+o*e/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:e,transitionEasing:Bl},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const t=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Gl._startPinchRotation=null,Gl._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:s}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this;let a;const l={};switch(t.srcEvent.code){case"Minus":a=e?o.zoomOut(n).zoomOut(n):o.zoomOut(n),l.isZooming=!0;break;case"Equal":a=e?o.zoomIn(n).zoomIn(n):o.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":e?(a=o.rotateLeft(r),l.isRotating=!0):(a=o.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":e?(a=o.rotateRight(r),l.isRotating=!0):(a=o.moveRight(i),l.isPanning=!0);break;case"ArrowUp":e?(a=o.rotateUp(s),l.isRotating=!0):(a=o.moveUp(i),l.isPanning=!0);break;case"ArrowDown":e?(a=o.rotateDown(s),l.isRotating=!0):(a=o.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(t){const{transition:e}=this;return e&&e.transitionInterpolator?t?{...e,transitionInterpolator:new Dl({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e:Rl}}class $l{constructor(t,e){_t(this,"_viewportProps",void 0),_t(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}class Wl extends $l{constructor(t){const{width:e,height:n,latitude:i,longitude:r,zoom:s,bearing:o=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:f,startZoomLngLat:m,startRotatePos:g,startBearing:y,startPitch:_,startZoom:v,normalize:x=!0}=t;xl(Number.isFinite(r)),xl(Number.isFinite(i)),xl(Number.isFinite(s)),super({width:e,height:n,latitude:i,longitude:r,zoom:s,bearing:o,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:p,normalize:x,position:c},{startPanLngLat:f,startZoomLngLat:m,startRotatePos:g,startBearing:y,startPitch:_,startZoom:v}),_t(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:n}=t;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:n=0,deltaAngleY:i=0}=t;const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||void 0===s||void 0===o)return this;let a;return a=e?this._getNewRotation(e,r,o,s):{bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:n,scale:i}=t,{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=Un(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:r}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-e.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i}=t;t.zoom=Un(i,n,e);const{maxPitch:r,minPitch:s,pitch:o}=t;t.pitch=Un(o,s,r);const{normalize:a=!0}=t;return a&&Object.assign(t,function(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=Di(r+180,360)-180),(a<-180||a>180)&&(a=Di(a+180,360)-180);const l=Bi(n/512);if(o<=l)o=l,s=0;else{const t=n/2/Math.pow(2,o),e=Zi([0,t])[1];if(s<e)s=e;else{const e=Zi([0,512-t])[1];s>e&&(s=e)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,i){const r=t[0]-e[0],s=t[1]-e[1],o=t[1],a=e[1],{width:l,height:c}=this.getViewportProps(),u=r/l;let h=0;s>0?Math.abs(c-a)>5&&(h=s/(a-c)*1.2):s<0&&a>5&&(h=1-o/a),h=Un(h,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps();let f=n;return h>0?f=n+h*(p-n):h<0&&(f=n-h*(d-n)),{pitch:f,bearing:i+180*u}}}class Zl extends ql{constructor(){super(...arguments),_t(this,"ControllerState",Wl),_t(this,"transition",{transitionDuration:300,transitionInterpolator:new Dl({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),_t(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t);(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class Hl extends bl{get ViewportType(){return El}get ControllerType(){return Zl}}_t(Hl,"displayName","MapView");const Xl=[255,255,255],Yl=1;let Kl=0;class Jl{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_t(this,"id",void 0),_t(this,"color",void 0),_t(this,"intensity",void 0),_t(this,"type","ambient");const{color:e=Xl}=t,{intensity:n=Yl}=t;this.id=t.id||"ambient-".concat(Kl++),this.color=e,this.intensity=n}}const Ql=[255,255,255],tc=1,ec=[0,0,-1];let nc=0;class ic{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_t(this,"id",void 0),_t(this,"color",void 0),_t(this,"intensity",void 0),_t(this,"type","directional"),_t(this,"direction",void 0),_t(this,"shadow",void 0);const{color:e=Ql}=t,{intensity:n=tc}=t,{direction:i=ec}=t,{_shadow:r=!1}=t;this.id=t.id||"directional-".concat(nc++),this.color=e,this.intensity=n,this.type="directional",this.direction=new si(i).normalize().toArray(),this.shadow=r}getProjectedLight(t){return this}}class rc extends class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:"pass"};_t(this,"id",void 0),_t(this,"gl",void 0),_t(this,"props",void 0);const{id:n}=e;this.id=n,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}{constructor(){super(...arguments),_t(this,"_lastRenderIndex",-1)}render(t){return js(this.gl,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:n,viewports:i,views:r,onViewportActive:s,clearStack:o=!0,clearCanvas:a=!0}=t;t.pass=t.pass||"unknown";const l=this.gl;a&&function(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;js(t,{viewport:[0,0,e,n]}),t.clear(16640)}(l),o&&(this._lastRenderIndex=-1);const c=[];for(const u of i){const i=r&&r[u.id];s(u);const o=this._getDrawLayerParams(u,t),a=u.subViewports||[u];for(const r of a){const s=this._drawLayersInViewport(l,{target:e,moduleParameters:n,viewport:r,view:i,pass:t.pass,layers:t.layers},o);c.push(s)}}return c}_getDrawLayerParams(t,e){let{layers:n,pass:i,layerFilter:r,cullRect:s,effects:o,moduleParameters:a}=e;const l=[],c=sc(this._lastRenderIndex+1),u={layer:n[0],viewport:t,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},h={};for(let d=0;d<n.length;d++){const e=n[d],s=this._shouldDrawLayer(e,u,r,h),p={shouldDrawLayer:s};s&&(p.layerRenderIndex=c(e,s),p.moduleParameters=this._getModuleParameters(e,o,i,a),p.layerParameters=this.getLayerParameters(e,d,t)),l[d]=p}return l}_drawLayersInViewport(t,e,n){let{layers:i,moduleParameters:r,pass:s,target:o,viewport:a,view:l}=e;const c=function(t,e){let{moduleParameters:n,target:i,viewport:r}=e;const s=i&&"default-framebuffer"!==i.id,o=n&&n.devicePixelRatio||qs(t),a=s?i.height:t.drawingBufferHeight,l=r;return[l.x*o,a-(l.y+l.height)*o,l.width*o,l.height*o]}(t,{moduleParameters:r,target:o,viewport:a});if(l&&l.props.clear){const e=!0===l.props.clear?{color:!0,depth:!0}:l.props.clear;Gs(t,{scissorTest:!0,scissor:c},(()=>Ho(t,e)))}const u={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};js(t,{viewport:c});for(let d=0;d<i.length;d++){const t=i[d],{shouldDrawLayer:e,layerRenderIndex:r,moduleParameters:o,layerParameters:l}=n[d];if(e&&t.props.pickable&&u.pickableCount++,t.isComposite)u.compositeCount++;else if(e){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,r),o.viewport=a;try{t._drawLayer({moduleParameters:o,uniforms:{layerIndex:r},parameters:l})}catch(h){t.raiseError(h,"drawing ".concat(t," to ").concat(s))}}}return u}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let r=t.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(e))return!1;e.layer=r,r=r.parent}if(n){const t=e.layer.id;if(t in i||(i[t]=n(e)),!i[t])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,n,i){var r;const s=Object.assign(Object.create((null===(r=t.internalState)||void 0===r?void 0:r.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:qs(this.gl)});if(e)for(const a of e){var o;Object.assign(s,null===(o=a.getModuleParameters)||void 0===o?void 0:o.call(a,t))}return Object.assign(s,this.getModuleParameters(t,e),i)}}function sc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const t=n[l]=n[l]||sc(e[l],e);c=t(r,s),n[a]=t}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}class oc extends rc{constructor(t,e){super(t,e),_t(this,"shadowMap",void 0),_t(this,"depthBuffer",void 0),_t(this,"fbo",void 0),this.shadowMap=new Vo(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new jo(t,{format:33189,width:1,height:1}),this.fbo=new ca(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;Gs(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(()=>{const n=t.viewports[0],i=qs(this.gl),r=n.width*i,s=n.height*i;r===e.width&&s===e.height||e.resize({width:r,height:s}),super.render({...t,target:e,pass:"shadow"})}))}shouldDrawLayer(t){return!1!==t.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const ac=tl((function(t){let{viewport:e,center:n}=t;return new Ii(e.viewProjectionMatrix).invert().transform(n)})),lc=tl((function(t){let{viewport:e,shadowMatrices:n}=t;const i=[],r=e.pixelUnprojectionMatrix,s=e.isGeospatial?void 0:1,o=[[0,0,s],[e.width,0,s],[0,e.height,s],[e.width,e.height,s],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map((t=>function(t,e){const[n,i,r]=t,s=er([n,i,r],e);if(Number.isFinite(r))return s;return[s[0],s[1],0]}(t,r)));for(const a of n){const t=a.clone().translate(new si(e.center).negate()),n=o.map((e=>t.transform(e))),r=(new Ii).ortho({left:Math.min(...n.map((t=>t[0]))),right:Math.max(...n.map((t=>t[0]))),bottom:Math.min(...n.map((t=>t[1]))),top:Math.max(...n.map((t=>t[1]))),near:Math.min(...n.map((t=>-t[2]))),far:Math.max(...n.map((t=>-t[2])))});i.push(r.multiplyRight(a))}return i})),cc=[0,0,0,1],uc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function hc(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&t.shadowMaps.length>0,shadow_uColor:t.shadowColor||cc,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=ac({viewport:t.viewport,center:e.project_uCenter}),s=[],o=lc({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const n=o[a],i=n.clone().translate(new si(t.viewport.center).negate());e.project_uCoordinateSystem===sr.LNGLAT&&e.project_uProjectionMode===or.WEB_MERCATOR?(o[a]=i,s[a]=r):(o[a]=n.clone().multiplyRight(uc),s[a]=i.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}const dc={name:"shadow",dependencies:[ul],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?hc(t,e):{}}},pc={color:[255,255,255],intensity:1},fc=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],mc=[0,0,0,200/255];class gc{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_t(this,"id","lighting-effect"),_t(this,"props",null),_t(this,"shadowColor",mc),_t(this,"shadow",void 0),_t(this,"ambientLight",null),_t(this,"directionalLights",[]),_t(this,"pointLights",[]),_t(this,"shadowPasses",[]),_t(this,"shadowMaps",[]),_t(this,"dummyShadowMap",null),_t(this,"programManager",void 0),_t(this,"shadowMatrices",void 0);for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((t=>t.shadow))}preRender(t,e){let{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=$a.getDefaultProgramManager(t),dc&&this.programManager.addDefaultModule(dc)),this.dummyShadowMap||(this.dummyShadowMap=new Vo(t,{width:1,height:1}));for(let t=0;t<this.shadowPasses.length;t++){this.shadowPasses[t].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:t,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((e=>e.getProjectedLight({layer:t}))),pointLights:this.pointLights.map((e=>e.getProjectedLight({layer:t})))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(dc),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=(new Ii).lookAt({eye:new si(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new oc(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;t||0!==e.length||0!==n.length||(this.ambientLight=new Jl(pc),this.directionalLights.push(new ic(fc[0]),new ic(fc[1])))}}class yc extends rc{constructor(t,e){super(t,e),_t(this,"maskMap",void 0),_t(this,"fbo",void 0);const{mapSize:n=2048}=e;this.maskMap=new Vo(t,{width:n,height:n,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.fbo=new ca(t,{id:"maskmap",width:n,height:n,attachments:{36064:this.maskMap}})}render(t){const e=this.gl,n=[!1,!1,!1,!1];return n[t.channel]=!0,Gs(e,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:n,depthTest:!1},(()=>super.render({...t,target:this.fbo,pass:"mask"})))}shouldDrawLayer(t){return t.props.operation===ur}delete(){this.fbo.delete(),this.maskMap.delete()}}const _c=(new Ii).lookAt({eye:[0,0,1]});function vc(t){let{width:e,height:n,near:i,far:r,padding:s}=t,o=-e/2,a=e/2,l=-n/2,c=n/2;if(s){const{left:t=0,right:i=0,top:r=0,bottom:u=0}=s,h=Un((t+e-i)/2,0,e)-e/2,d=Un((r+n-u)/2,0,n)-n/2;o-=h,a-=h,l+=d,c+=d}return(new Ii).ortho({left:o,right:a,bottom:l,top:c,near:i,far:r})}class xc extends mr{constructor(t){const{width:e,height:n,near:i=.1,far:r=1e3,zoom:s=0,target:o=[0,0,0],padding:a=null,flipY:l=!0}=t,c=Array.isArray(s)?s[0]:s,u=Array.isArray(s)?s[1]:s,h=Math.min(c,u),d=Math.pow(2,h);let p;if(c!==u){const t=Math.pow(2,c),e=Math.pow(2,u);p={unitsPerMeter:[t/d,e/d,1],metersPerUnit:[d/t,d/e,1]}}super({...t,longitude:void 0,position:o,viewMatrix:_c.clone().scale([d,d*(l?-1:1),d]),projectionMatrix:vc({width:e||1,height:n||1,padding:a,near:i,far:r}),zoom:h,distanceScales:p})}projectFlat(t){let[e,n]=t;const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],n*i[1]]}unprojectFlat(t){let[e,n]=t;const{metersPerUnit:i}=this.distanceScales;return[e*i[0],n*i[1]]}panByPosition(t,e){const n=er(e,this.pixelUnprojectionMatrix),i=vi([],this.projectFlat(t),xi([],n)),r=vi([],this.center,i);return{target:this.unprojectFlat(r)}}}class bc extends $l{constructor(t){const{width:e,height:n,rotationX:i=0,rotationOrbit:r=0,target:s=[0,0,0],zoom:o=0,minRotationX:a=-90,maxRotationX:l=90,minZoom:c=-1/0,maxZoom:u=1/0,startPanPosition:h,startRotatePos:d,startRotationX:p,startRotationOrbit:f,startZoomPosition:m,startZoom:g}=t;super({width:e,height:n,rotationX:i,rotationOrbit:r,target:s,zoom:o,minRotationX:a,maxRotationX:l,minZoom:c,maxZoom:u},{startPanPosition:h,startRotatePos:d,startRotationX:p,startRotationOrbit:f,startZoomPosition:m,startZoom:g}),_t(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan(t){let{pos:e,startPosition:n}=t;const i=this.getState().startPanPosition||n;if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate(t){let{pos:e,deltaAngleX:n=0,deltaAngleY:i=0}=t;const{startRotatePos:r,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!r||void 0===s||void 0===o)return this;let c;if(e){let t=(e[0]-r[0])/a;const n=(e[1]-r[1])/l;(s<-90||s>90)&&(t*=-1),c={rotationX:s+180*n,rotationOrbit:o+180*t}}else c={rotationX:s+i,rotationOrbit:o+n};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{rotationOrbit:i}=n;return Math.abs(i-e.rotationOrbit)>180&&(n.rotationOrbit=i<0?i+360:i-360),n}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:n,scale:i}=t,{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:t})})}zoomOut(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/t})})}moveLeft(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this._panFromCenter([-t,0])}moveRight(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this._panFromCenter([t,0])}moveUp(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this._panFromCenter([0,-t])}moveDown(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this._panFromCenter([0,t])}rotateLeft(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-t})}rotateRight(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+t})}rotateUp(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-t})}rotateDown(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_calculateNewZoom(t){let{scale:e,startZoom:n}=t;const{maxZoom:i,minZoom:r}=this.getViewportProps();void 0===n&&(n=this.getViewportProps().zoom);return Un(n+Math.log2(e),r,i)}_panFromCenter(t){const{width:e,height:n,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i,maxRotationX:r,minRotationX:s,rotationOrbit:o}=t;return t.zoom=Array.isArray(i)?[Un(i[0],n,e),Un(i[1],n,e)]:Un(i,n,e),t.rotationX=Un(t.rotationX,s,r),(o<-180||o>180)&&(t.rotationOrbit=function(t,e){const n=t%e;return n<0?e+n:n}(o+180,360)-180),t}}class wc extends bc{constructor(t){super(t),_t(this,"zoomAxis",void 0),this.zoomAxis=t.zoomAxis||"all"}_calculateNewZoom(t){let{scale:e,startZoom:n}=t;const{maxZoom:i,minZoom:r}=this.getViewportProps();void 0===n&&(n=this.getViewportProps().zoom);let s=Math.log2(e);if(Array.isArray(n)){let[t,e]=n;switch(this.zoomAxis){case"X":t=Un(t+s,r,i);break;case"Y":e=Un(e+s,r,i);break;default:let n=Math.min(t+s,e+s);n<r&&(s+=r-n),n=Math.max(t+s,e+s),n>i&&(s+=i-n),t+=s,e+=s}return[t,e]}return Un(n+s,r,i)}}class Sc extends ql{constructor(){super(...arguments),_t(this,"ControllerState",wc),_t(this,"transition",{transitionDuration:300,transitionInterpolator:new Dl(["target","zoom"])}),_t(this,"dragMode","pan")}_onPanRotate(){return!1}}class Ec extends bl{get ViewportType(){return xc}get ControllerType(){return Sc}}_t(Ec,"displayName","OrthographicView");class Tc{constructor(){_t(this,"id","mask-effect"),_t(this,"props",null),_t(this,"useInPicking",!0),_t(this,"dummyMaskMap",void 0),_t(this,"channels",[]),_t(this,"masks",null),_t(this,"maskPass",void 0),_t(this,"maskMap",void 0),_t(this,"lastViewport",void 0)}preRender(t,e){let{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}=e;this.dummyMaskMap||(this.dummyMaskMap=new Vo(t,{width:1,height:1}));const a=n.filter((t=>t.props.visible&&t.props.operation===ur));if(0===a.length)return this.masks=null,void(this.channels.length=0);this.masks={},this.maskPass||(this.maskPass=new yc(t,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const l=this._sortMaskChannels(a),c=r[0],u=!this.lastViewport||!this.lastViewport.equals(c);for(const h in l)this._renderChannel(l[h],{layerFilter:i,onViewportActive:s,views:o,viewport:c,viewportChanged:u})}_renderChannel(t,e){let{layerFilter:n,onViewportActive:i,views:r,viewport:s,viewportChanged:o}=e;const a=this.channels[t.index];if(!a)return;const l=t===a||a.layers.length!==t.layers.length||t.layerBounds.some(((t,e)=>t!==a.layerBounds[e]));if(t.bounds=a.bounds,t.maskBounds=a.maskBounds,this.channels[t.index]=t,(l||o)&&(this.lastViewport=s,t.bounds=function(t){let{layers:e,viewport:n}=t,i=null;for(const o of e){const t=o.getBounds();t&&(i?(i[0]=Math.min(i[0],t[0][0]),i[1]=Math.min(i[1],t[0][1]),i[2]=Math.max(i[2],t[1][0]),i[3]=Math.max(i[3],t[1][1])):i=[t[0][0],t[0][1],t[1][0],t[1][1]])}const r=n.getBounds();if(!i)return r;const s=function(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}(r);return i[2]-i[0]<s[2]-s[0]||i[3]-i[1]<s[3]-s[1]||(i[0]=Math.max(i[0],s[0]),i[1]=Math.max(i[1],s[1]),i[2]=Math.min(i[2],s[2]),i[3]=Math.min(i[3],s[3])),i}({layers:t.layers,viewport:s}),l||!Gn(t.bounds,a.bounds))){const{maskPass:e,maskMap:o}=this,a=function(t){let{bounds:e,viewport:n,width:i,height:r}=t;if(e[2]<=e[0]||e[3]<=e[1])return null;if(i-=2,r-=2,n instanceof El){const{longitude:t,latitude:n,zoom:s}=nr({width:i,height:r,bounds:[[e[0],e[1]],[e[2],e[3]]],maxZoom:20});return new El({longitude:t,latitude:n,zoom:s,x:1,y:1,width:i,height:r})}const s=[(e[0]+e[2])/2,(e[1]+e[3])/2,0],o=Math.min(20,i/(e[2]-e[0]),r/(e[3]-e[1]));return new Ec({x:1,y:1}).makeViewport({width:i,height:r,viewState:{target:s,zoom:Math.log2(o)}})}({bounds:t.bounds,viewport:s,width:o.width,height:o.height});t.maskBounds=a?a.getBounds():[0,0,1,1],e.render({pass:"mask",channel:t.index,layers:t.layers,layerFilter:n,viewports:a?[a]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[t.id]={index:t.index,bounds:t.maskBounds,coordinateOrigin:t.coordinateOrigin,coordinateSystem:t.coordinateSystem}}_sortMaskChannels(t){const e={};let n=0;for(const i of t){const{id:t}=i.root;let r=e[t];if(!r){if(++n>4){te.warn("Too many mask layers. The max supported is 4")();continue}r={id:t,index:this.channels.findIndex((e=>(null===e||void 0===e?void 0:e.id)===t)),layers:[],layerBounds:[],coordinateOrigin:i.root.props.coordinateOrigin,coordinateSystem:i.root.props.coordinateSystem},e[t]=r}r.layers.push(i),r.layerBounds.push(i.getBounds())}for(let i=0;i<4;i++){const t=this.channels[i];t&&t.id in e||(this.channels[i]=null)}for(const i in e){const t=e[i];t.index<0&&(t.index=this.channels.findIndex((t=>!t)),this.channels[t.index]=t)}return e}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const Ac=new gc;class kc{constructor(){_t(this,"effects",void 0),_t(this,"_internalEffects",void 0),_t(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(t){"effects"in t&&(t.effects.length===this.effects.length&&ml(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed"))}needsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.cleanup(),this.effects=t,this._internalEffects=t.slice(),this._internalEffects.push(new Tc),t.some((t=>t instanceof gc))||this._internalEffects.push(Ac)}cleanup(){for(const t of this.effects)t.cleanup();for(const t of this._internalEffects)t.cleanup();this.effects.length=0,this._internalEffects.length=0}}class Pc extends rc{shouldDrawLayer(t){return t.props.operation===cr}}const Ic={blendFunc:[1,0,32771,0],blendEquation:32774};class Cc extends rc{constructor(){super(...arguments),_t(this,"pickZ",void 0),_t(this,"_colors",null)}render(t){return t.pickingFBO?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:h,effects:d,pass:p="picking",pickZ:f}=t;const m=this.gl;this.pickZ=f;const g=f?null:{byLayer:new Map,byAlpha:[]};this._colors=g;const y=Gs(m,{scissorTest:!0,scissor:[a,l,c,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Ic,blend:!f},(()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:h,effects:null===d||void 0===d?void 0:d.filter((t=>t.useInPicking)),pass:p})));this._colors=null;return{decodePickingColor:g&&Mc.bind(null,g),stats:y}}shouldDrawLayer(t){return t.props.pickable&&t.props.operation===cr}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,n){const i={...t.props.parameters};return this._colors?(Object.assign(i,Ic),i.blend=!0,i.blendColor=function(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(te.warn("Too many pickable layers, only picking the first 255")(),s=0));return[0,0,0,s/255]}(this._colors,t,n)):i.blend=!1,i}}function Mc(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}class zc{constructor(t){this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Pc(t),this.pickLayersPass=new Cc(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;t.layerFilter=t.layerFilter||this.layerFilter,t.effects=t.effects||[],t.target=t.target||ca.getDefaultFramebuffer(this.gl),this._preRender(t.effects,t);const n=this.lastPostProcessEffect?this.renderBuffers[0]:t.target,i=e.render({...t,target:n});this._postRender(t.effects,t),this.renderCount++,ne("deckRenderer.renderLayers",this,i,t)}needsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){let n=null;for(const i of t)i.preRender(this.gl,e),i.postRender&&(n=i);n&&this._resizeRenderBuffers(),this.lastPostProcessEffect=n}_resizeRenderBuffers(){const{renderBuffers:t}=this;0===t.length&&t.push(new ca(this.gl),new ca(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:n}=this,i={inputBuffer:n[0],swapBuffer:n[1],target:null};for(const r of t)if(r.postRender){if(r===this.lastPostProcessEffect){i.target=e.target,r.postRender(this.gl,i);break}const t=r.postRender(this.gl,i);i.inputBuffer=t,i.swapBuffer=t===n[0]?n[1]:n[0]}}}const Lc={pickedColor:null,pickedObjectIndex:-1};function Dc(t){let{pickedColors:e,decodePickingColor:n,deviceX:i,deviceY:r,deviceRadius:s,deviceRect:o}=t;const{x:a,y:l,width:c,height:u}=o;let h=s*s,d=-1,p=0;for(let f=0;f<u;f++){const t=f+l-r,n=t*t;if(n>h)p+=4*c;else for(let r=0;r<c;r++){if(e[p+3]-1>=0){const t=r+a-i,e=t*t+n;e<=h&&(h=e,d=p)}p+=4}}if(d>=0){const t=e.slice(d,d+4),i=n(t);if(i){const e=Math.floor(d/4/c),n=d/4-e*c;return{...i,pickedColor:t,pickedX:a+n,pickedY:l+e}}te.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Lc}function Rc(t){let e,{pickInfo:n,viewports:i,pixelRatio:r,x:s,y:o,z:a}=t,l=i[0];if(i.length>1&&(l=function(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}((null===n||void 0===n?void 0:n.pickedViewports)||i,{x:s,y:o})),l){const t=[s-l.x,o-l.y];void 0!==a&&(t[2]=a),e=l.unproject(t)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:s,y:o,pixel:[s,o],coordinate:e,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:r}}function Bc(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if("hover"===i){const t=n.index,e=n.layerId,i=o?o.props.id:null;if(i!==e||a!==t){if(i!==e){const t=r.find((t=>t.props.id===e));t&&l.unshift(t)}n.layerId=i,n.index=a,n.info=null}}const c=Rc(t),u=new Map;return u.set(null,c),l.forEach((t=>{let e={...c};t===o&&(e.color=s,e.index=a,e.picked=!0),e=Oc({layer:t,info:e,mode:i});const r=e.layer;t===o&&"hover"===i&&(n.info=e),u.set(r.id,e),"hover"===i&&r.updateAutoHighlight(e)})),u}function Oc(t){let{layer:e,info:n,mode:i}=t;for(;e&&n;){const t=n.layer||null;n.sourceLayer=t,n.layer=e,n=e.getPickingInfo({info:n,mode:i,sourceLayer:t}),e=e.parent}return n}class Fc{constructor(t){_t(this,"gl",void 0),_t(this,"pickingFBO",void 0),_t(this,"depthFBO",void 0),_t(this,"pickLayersPass",void 0),_t(this,"layerFilter",void 0),_t(this,"lastPickedInfo",void 0),_t(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new Cc(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:n,layers:i,viewports:r}=t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info;const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find((t=>t.id===o)):null,c=a&&r.find((t=>t.id===a))||r[0],u=c&&c.unproject([e-c.x,n-c.y]),h={x:e,y:n,viewport:c,coordinate:u,layer:l};return{...s,...h}}_resizeBuffer(){var t,e;const{gl:n}=this;if(!this.pickingFBO&&(this.pickingFBO=new ca(n),ca.isSupported(n,{colorBufferFloat:!0}))){const t=new ca(n);t.attach({36064:new Vo(n,{format:as(n)?34836:6408,type:5126})}),this.depthFBO=t}null===(t=this.pickingFBO)||void 0===t||t.resize({width:n.canvas.width,height:n.canvas.height}),null===(e=this.depthFBO)||void 0===e||e.resize({width:n.canvas.width,height:n.canvas.height})}_getPickable(t){if(!1===this._pickable)return null;const e=t.filter((t=>t.isPickable()&&!t.isComposite));return e.length?e:null}_pickClosestObject(t){let{layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:h}=t;const d=this._getPickable(e),p=qs(this.gl);if(!d)return{result:[],emptyInfo:Rc({viewports:i,x:r,y:s,pixelRatio:p})};this._resizeBuffer();const f=$s(this.gl,[r,s],!0),m=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(o*p),{width:y,height:_}=this.pickingFBO,v=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceWidth:y,deviceHeight:_}),x={x:r-o,y:s-o,width:2*o+1,height:2*o+1};let b;const w=[],S=new Set;for(let E=0;E<a;E++){let t,e;if(v){t=Dc({...this._drawAndSample({layers:d,views:n,viewports:i,onViewportActive:u,deviceRect:v,cullRect:x,effects:h,pass:"picking:".concat(l)}),deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceRect:v})}else t={pickedColor:null,pickedObjectIndex:-1};if(t.pickedLayer&&c&&this.depthFBO){e=this._drawAndSample({layers:[t.pickedLayer],views:n,viewports:i,onViewportActive:u,deviceRect:{x:t.pickedX,y:t.pickedY,width:1,height:1},cullRect:x,effects:h,pass:"picking:".concat(l,":z")},!0).pickedColors[0]}t.pickedLayer&&E+1<a&&(S.add(t.pickedLayer),t.pickedLayer.disablePickingIndex(t.pickedObjectIndex)),b=Bc({pickInfo:t,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:i,x:r,y:s,z:e,pixelRatio:p});for(const n of b.values())n.layer&&w.push(n);if(!t.pickedColor)break}for(const E of S)E.restorePickingColors();return{result:w,emptyInfo:b.get(null)}}_pickVisibleObjects(t){let{layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:h}=t;const d=this._getPickable(e);if(!d)return[];this._resizeBuffer();const p=qs(this.gl),f=$s(this.gl,[r,s],!0),m=f.x,g=f.y+f.height,y=$s(this.gl,[r+o,s+a],!0),_=y.x+y.width,v=y.y,x={x:m,y:v,width:_-m,height:g-v},b=function(t){let{pickedColors:e,decodePickingColor:n}=t;const i=new Map;if(e)for(let r=0;r<e.length;r+=4)if(e[r+3]-1>=0){const t=e.slice(r,r+4),s=t.join(",");if(!i.has(s)){const e=n(t);e?i.set(s,{...e,color:t}):te.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(i.values())}(this._drawAndSample({layers:d,views:n,viewports:i,onViewportActive:u,deviceRect:x,cullRect:{x:r,y:s,width:o,height:a},effects:h,pass:"picking:".concat(l)})),w=new Map,S=Number.isFinite(c);for(let E=0;E<b.length&&!(S&&c&&w.size>=c);E++){const t=b[E];let e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:p};e=Oc({layer:t.pickedLayer,info:e,mode:l}),w.has(e.object)||w.set(e.object,e)}return Array.from(w.values())}_drawAndSample(t){let{layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l}=t,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=c?this.depthFBO:this.pickingFBO,{decodePickingColor:h}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c}),{x:d,y:p,width:f,height:m}=s,g=new(c?Float32Array:Uint8Array)(f*m*4);return Qo(u,{sourceX:d,sourceY:p,sourceWidth:f,sourceHeight:m,target:g}),{pickedColors:g,decodePickingColor:h}}_getPickingRect(t){let{deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}=t;const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,c=Math.min(s,n+i+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const Vc={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Nc{constructor(t){_t(this,"el",null),_t(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,Vc),e.appendChild(this.el))}setTooltip(t,e,n){const i=this.el;if(i){if("string"===typeof t)i.innerText=t;else{if(!t)return this.isVisible=!1,void(i.style.display="none");t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className),Object.assign(i.style,t.style)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}const{_parseImageNode:Uc}=globalThis,jc="undefined"!==typeof Image,Gc="undefined"!==typeof ImageBitmap,qc=Boolean(Uc),$c=!!ze||qc;function Wc(t){const e=Hc(t);if(!e)throw new Error("Not an image");return e}function Zc(t){switch(Wc(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Hc(t){return"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!==typeof Image&&t instanceof Image?"image":t&&"object"===typeof t&&t.data&&t.width&&t.height?"data":null}const Xc=/^data:image\/svg\+xml/,Yc=/\.svg((\?|#).*)?$/;function Kc(t){return t&&(Xc.test(t)||Yc.test(t))}function Jc(t,e){if(Kc(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Qc(t,e,n){const i=function(t,e){if(Kc(e)){let e=(new TextDecoder).decode(t);try{"function"===typeof unescape&&"function"===typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(n){throw new Error(n.message)}return"data:image/svg+xml;base64,".concat(btoa(e))}return Jc(t,e)}(t,n),r=self.URL||self.webkitURL,s="string"!==typeof i&&r.createObjectURL(i);try{return await async function(t,e){const n=new Image;if(n.src=t,e.image&&e.image.decode&&n.decode)return await n.decode(),n;return await new Promise(((e,i)=>{try{n.onload=()=>e(n),n.onerror=e=>i(new Error("Could not load image ".concat(t,": ").concat(e)))}catch(r){i(r)}}))}(s||i,e)}finally{s&&r.revokeObjectURL(s)}}const tu={};let eu=!0;async function nu(t,e,n){let i;if(Kc(n)){i=await Qc(t,e,n)}else i=Jc(t,n);const r=e&&e.imagebitmap;return await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!iu(e)&&eu||(e=null);if(e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),eu=!1}return await createImageBitmap(t)}(i,r)}function iu(t){for(const e in t||tu)return!1;return!0}const ru=!1,su=!0;function ou(t){const e=au(t);return function(t){const e=au(t);if(!(e.byteLength>=24&&2303741511===e.getUint32(0,ru)))return null;return{mimeType:"image/png",width:e.getUint32(16,ru),height:e.getUint32(20,ru)}}(e)||function(t){const e=au(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,ru)&&255===e.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:i}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let r=2;for(;r+9<e.byteLength;){const t=e.getUint16(r,ru);if(i.has(t))return{mimeType:"image/jpeg",height:e.getUint16(r+5,ru),width:e.getUint16(r+7,ru)};if(!n.has(t))return null;r+=2,r+=e.getUint16(r,ru)}return null}(e)||function(t){const e=au(t);if(!(e.byteLength>=10&&1195984440===e.getUint32(0,ru)))return null;return{mimeType:"image/gif",width:e.getUint16(6,su),height:e.getUint16(8,su)}}(e)||function(t){const e=au(t);if(!(e.byteLength>=14&&16973===e.getUint16(0,ru)&&e.getUint32(2,su)===e.byteLength))return null;return{mimeType:"image/bmp",width:e.getUint32(18,su),height:e.getUint32(22,su)}}(e)}function au(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}const lu={id:"image",module:"images",name:"Images",version:"3.2.9",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(t,e,n){const i=((e=e||{}).image||{}).type||"auto",{url:r}=n||{};let s;switch(function(t){switch(t){case"auto":case"data":return function(){if(Gc)return"imagebitmap";if(jc)return"image";if($c)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return Gc||jc||$c;case"imagebitmap":return Gc;case"image":return jc;case"data":return $c;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}(i)){case"imagebitmap":s=await nu(t,e,r);break;case"image":s=await Qc(t,e,r);break;case"data":s=await async function(t,e){const{mimeType:n}=ou(t)||{},i=globalThis._parseImageNode;return ge(i),await i(t,n)}(t);break;default:ge(!1)}return"data"===i&&(s=Zc(s)),s},tests:[t=>Boolean(ou(new DataView(t)))],options:{image:{type:"auto",decode:!0}}};const cu={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(t){const e=t[0],n=t[t.length-1];return"{"===e&&"}"===n||"["===e&&"]"===n},parseTextSync:JSON.parse},uu="8.8.11",hu=globalThis.deck&&globalThis.deck.VERSION;if(hu&&hu!==uu)throw new Error("deck.gl - multiple versions detected: ".concat(hu," vs ").concat(uu));hu||(te.log(1,"deck.gl ".concat(uu))(),globalThis.deck={...globalThis.deck,VERSION:uu,version:uu,log:te,_registerLoggers:function(t){ee=t}},function(t){const e=xn();t=Array.isArray(t)?t:[t];for(const n of t){const t=_e(n);e.find((e=>t===e))||e.unshift(t)}}([cu,[lu,{imagebitmap:{premultiplyAlpha:"none"}}]]));const du=globalThis.deck,pu=globalThis;function fu(t){if(!t&&!Lt())return"Node";if(zt(t))return"Electron";const e="undefined"!==typeof navigator?navigator:{},n=t||e.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r?"IE":pu.chrome?"Chrome":pu.safari?"Safari":pu.mozInnerScreenX?"Firefox":"Unknown"}class mu extends vo{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=as(t),i=oa(t,ia);let r=n||i;for(const s of e)switch(s){case"queries":r=r&&n;break;case"timers":r=r&&i;break;default:co(!1)}return r}constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.begin(t?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(t){return this._queryPending||(this.target=t,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise(((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)})),this._pollingPromise}_createHandle(){return mu.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}const gu=Lt()&&"undefined"!==typeof document;let yu=0;class _u{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{onCreateContext:e=(t=>Qs(t)),onAddHTML:n=null,onInitialize:i=(()=>{}),onRender:r=(()=>{}),onFinalize:s=(()=>{}),onError:o,gl:a=null,glOptions:l={},debug:c=!1,createFramebuffer:u=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:d=!0,stats:p=lo.get("animation-loop-".concat(yu++))}=t;let{useDevicePixels:f=!0}=t;"useDevicePixelRatio"in t&&(is.deprecated("useDevicePixelRatio","useDevicePixels")(),f=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:i,onRender:r,onFinalize:s,onError:o,gl:a,glOptions:l,debug:c,createFramebuffer:u},this.gl=a,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:d,useDevicePixels:f}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return co("string"===typeof t),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then((()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=mu.isSupported(this.gl,["timers"])?new mu(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps)))).then((t=>{this._running&&(this._addCallbackData(t||{}),!1!==t&&this._startLoop())}));return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((t=>{this._resolveNextFrame=t}))),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return is.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=gu?new Promise(((t,e)=>{gu&&"complete"===document.readyState?t(document):window.addEventListener("load",(()=>{t(document)}))})):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):(e=t,"undefined"!==typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e));var e}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):(e=t,"undefined"!==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60));var e}_renderFrame(){this.display?this.display._renderFrame(...arguments):this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();t===this.animationProps.width&&e===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){"object"===typeof t&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&"undefined"!==typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?to(this.props.gl,t):this.onCreateContext(t),!os(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");js(this.gl,Ss),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas)return void so(t,Ws(e.useDevicePixels),e);const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new ca(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}var vu=n(97);const xu={mousedown:1,mousemove:2,mouseup:4};!function(t){const e=t.prototype.handler;t.prototype.handler=function(t){const n=this.store;t.button>0&&"pointerdown"===t.type&&(function(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(n,(e=>e.pointerId===t.pointerId))||n.push(t)),e.call(this,t)}}(vu.PointerEventInput),vu.MouseInput.prototype.handler=function(t){let e=xu[t.type];1&e&&t.button>=0&&(this.pressed=!0),2&e&&0===t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))};const bu=vu.Manager,wu=vu;class Su{constructor(t,e,n){this.element=t,this.callback=e,this.options={enable:!0,...n}}}const Eu=wu?[[wu.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[wu.Rotate,{enable:!1}],[wu.Pinch,{enable:!1}],[wu.Swipe,{enable:!1}],[wu.Pan,{threshold:0,enable:!1}],[wu.Press,{enable:!1}],[wu.Tap,{event:"doubletap",taps:2,enable:!1}],[wu.Tap,{event:"anytap",enable:!1}],[wu.Tap,{enable:!1}]]:null,Tu={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Au={doubletap:["tap"]},ku={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Pu={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Iu={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Cu={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Mu="undefined"!==typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",zu="undefined"!==typeof window?window:n.g;"undefined"!==typeof n.g?n.g:window,"undefined"!==typeof document&&document;let Lu=!1;try{const t={get passive(){return Lu=!0,!0}};zu.addEventListener("test",null,t),zu.removeEventListener("test",null)}catch(bf){Lu=!1}const Du=-1!==Mu.indexOf("firefox"),{WHEEL_EVENTS:Ru}=Pu,Bu="wheel",Ou=4.000244140625;class Fu extends Su{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{if(!this.options.enable)return;let e=t.deltaY;zu.WheelEvent&&(Du&&t.deltaMode===zu.WheelEvent.DOM_DELTA_PIXEL&&(e/=zu.devicePixelRatio),t.deltaMode===zu.WheelEvent.DOM_DELTA_LINE&&(e*=40)),0!==e&&e%Ou===0&&(e=Math.floor(e/Ou)),t.shiftKey&&e&&(e*=.25),this.callback({type:Bu,center:{x:t.clientX,y:t.clientY},delta:-e,srcEvent:t,pointerType:"mouse",target:t.target})},this.events=(this.options.events||[]).concat(Ru),this.events.forEach((e=>t.addEventListener(e,this.handleEvent,!!Lu&&{passive:!1})))}destroy(){this.events.forEach((t=>this.element.removeEventListener(t,this.handleEvent)))}enableEventType(t,e){t===Bu&&(this.options.enable=e)}}const{MOUSE_EVENTS:Vu}=Pu,Nu="pointermove",Uu="pointerover",ju="pointerout",Gu="pointerenter",qu="pointerleave";class $u extends Su{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{this.handleOverEvent(t),this.handleOutEvent(t),this.handleEnterEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(Vu),this.events.forEach((e=>t.addEventListener(e,this.handleEvent)))}destroy(){this.events.forEach((t=>this.element.removeEventListener(t,this.handleEvent)))}enableEventType(t,e){t===Nu&&(this.enableMoveEvent=e),t===Uu&&(this.enableOverEvent=e),t===ju&&(this.enableOutEvent=e),t===Gu&&(this.enableEnterEvent=e),t===qu&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&"mouseover"===t.type&&this._emit(Uu,t)}handleOutEvent(t){this.enableOutEvent&&"mouseout"===t.type&&this._emit(ju,t)}handleEnterEvent(t){this.enableEnterEvent&&"mouseenter"===t.type&&this._emit(Gu,t)}handleLeaveEvent(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this._emit(qu,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this._emit(Nu,t);break;case"mouseup":this.pressed=!1}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:Wu}=Pu,Zu="keydown",Hu="keyup";class Xu extends Su{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{const e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:Zu,srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:Hu,srcEvent:t,key:t.key,target:t.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Wu),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach((e=>t.addEventListener(e,this.handleEvent)))}destroy(){this.events.forEach((t=>this.element.removeEventListener(t,this.handleEvent)))}enableEventType(t,e){t===Zu&&(this.enableDownEvent=e),t===Hu&&(this.enableUpEvent=e)}}const Yu="contextmenu";class Ku extends Su{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{this.options.enable&&this.callback({type:Yu,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===Yu&&(this.options.enable=e)}}const Ju={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function Qu(t){const e=Ju[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return 4===e||2===e&&!Number.isFinite(n)?(s=1===r,o=2===r,a=3===r):2===e?(s=Boolean(1&n),o=Boolean(4&n),a=Boolean(2&n)):1===e&&(s=0===i,o=1===i,a=2===i),{leftButton:s,middleButton:o,rightButton:a}}function th(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s}}}const eh={srcElement:"root",priority:0};class nh{constructor(t){this.handleEvent=t=>{if(this.isEmpty())return;const e=this._normalizeEvent(t);let n=t.srcEvent.target;for(;n&&n!==e.rootElement;){if(this._emit(e,n),e.handled)return;n=n.parentNode}this._emit(e,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{handlers:s,handlersByElement:o}=this;let a=eh;"string"===typeof n||n&&n.addEventListener?a={...eh,srcElement:n}:n&&(a={...eh,...n});let l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));const c={type:t,handler:e,srcElement:a.srcElement,priority:a.priority};i&&(c.once=!0),r&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(t,e){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const s=n[r];if(s.type===t&&s.handler===e){n.splice(r,1);const t=i.get(s.srcElement);t.splice(t.indexOf(s),1),0===t.length&&i.delete(s.srcElement)}}this._active=n.some((t=>!t.passive))}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let e=!1;const i=()=>{t.handled=!0},r=()=>{t.handled=!0,e=!0},s=[];for(let o=0;o<n.length;o++){const{type:a,handler:l,once:c}=n[o];if(l({...t,type:a,stopPropagation:i,stopImmediatePropagation:r}),c&&s.push(n[o]),e)break}for(let t=0;t<s.length;t++){const{type:e,handler:n}=s[t];this.remove(e,n)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...Qu(t),...th(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const ih={events:null,recognizers:null,recognizerOptions:{},Manager:bu,touchAction:"none",tabIndex:0};class rh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=t=>{const{srcEvent:e}=t,n=ku[e.type];n&&this.manager.emit(n,t)},this._onOtherEvent=t=>{this.manager.emit(t.type,t)},this.options={...ih,...e},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,n=e.Manager;this.manager=new n(t,{touchAction:e.touchAction,recognizers:e.recognizers||Eu}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(Tu).forEach((t=>{const e=this.manager.get(t);e&&Tu[t].forEach((t=>{e.recognizeWith(t)}))}));for(const i in e.recognizerOptions){const t=this.manager.get(i);if(t){const n=e.recognizerOptions[i];delete n.enable,t.set(n)}}this.wheelInput=new Fu(t,this._onOtherEvent,{enable:!1}),this.moveInput=new $u(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Xu(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new Ku(t,this._onOtherEvent,{enable:!1});for(const[i,r]of this.events)r.isEmpty()||(this._toggleRecognizer(r.recognizerName,!0),this.manager.on(i,r.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});const r=Au[t];r&&!this.options.recognizers&&r.forEach((r=>{const s=n.get(r);e?(s.requireFailure(t),i.dropRequireFailure(r)):s.dropRequireFailure(t)}))}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,n,i,r){if("string"!==typeof t){n=e;for(const e in t)this._addEventHandler(e,t[e],n,i,r);return}const{manager:s,events:o}=this,a=Cu[t]||t;let l=o.get(a);l||(l=new nh(this),o.set(a,l),l.recognizerName=Iu[a]||a,s&&s.on(a,l.handleEvent)),l.add(t,e,n,i,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,e){if("string"!==typeof t){for(const e in t)this._removeEventHandler(e,t[e]);return}const{events:n}=this,i=Cu[t]||t,r=n.get(i);if(r&&(r.remove(t,e),r.isEmpty())){const{recognizerName:t}=r;let e=!1;for(const i of n.values())if(i.recognizerName===t&&!i.isEmpty()){e=!0;break}e||this._toggleRecognizer(t,!1)}}}function sh(){}const oh={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:sh,onResize:sh,onViewStateChange:sh,onInteractionStateChange:sh,onBeforeRender:sh,onAfterRender:sh,onLoad:sh,onError:t=>te.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:t=>{let{isDragging:e}=t;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class ah{constructor(t){_t(this,"props",void 0),_t(this,"width",0),_t(this,"height",0),_t(this,"userData",{}),_t(this,"canvas",null),_t(this,"viewManager",null),_t(this,"layerManager",null),_t(this,"effectManager",null),_t(this,"deckRenderer",null),_t(this,"deckPicker",null),_t(this,"eventManager",null),_t(this,"tooltip",null),_t(this,"metrics",void 0),_t(this,"animationLoop",void 0),_t(this,"stats",void 0),_t(this,"viewState",void 0),_t(this,"cursorState",void 0),_t(this,"_needsRedraw",void 0),_t(this,"_pickRequest",void 0),_t(this,"_lastPointerDownInfo",null),_t(this,"_metricsCounter",void 0),_t(this,"_onPointerMove",(t=>{const{_pickRequest:e}=this;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;e.x=n.x,e.y=n.y,e.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.event=t})),_t(this,"_onEvent",(t=>{const e=lr[t.type],n=t.offsetCenter;if(!e||!n||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=r,o=s&&(s[e.handler]||s.props[e.handler]),a=this.props[e.handler];let l=!1;o&&(l=o.call(s,r,t)),!l&&a&&a(r,t)})),_t(this,"_onPointerDown",(t=>{const e=t.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:e.x,y:e.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo})),this.props={...oh,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&te.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===fu()&&te.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||"undefined"!==typeof document&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new le({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&On.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,n,i,r,s,o,a;(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,null===(t=this.layerManager)||void 0===t||t.finalize(),this.layerManager=null,null===(e=this.viewManager)||void 0===e||e.finalize(),this.viewManager=null,null===(n=this.effectManager)||void 0===n||n.finalize(),this.effectManager=null,null===(i=this.deckRenderer)||void 0===i||i.finalize(),this.deckRenderer=null,null===(r=this.deckPicker)||void 0===r||r.finalize(),this.deckPicker=null,null===(s=this.eventManager)||void 0===s||s.destroy(),this.eventManager=null,null===(o=this.tooltip)||void 0===o||o.remove(),this.tooltip=null,this.props.canvas||this.props.gl||!this.canvas)||(null===(a=this.canvas.parentElement)||void 0===a||a.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&te.removed("onLayerHover","onHover")(),"onLayerClick"in t&&te.removed("onLayerClick","onClick")(),t.initialViewState&&!ml(this.props.initialViewState,t.initialViewState)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return e=e||n||i||r||s,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return null!==this.viewManager}getViews(){return xl(this.viewManager),this.viewManager.views}getViewports(t){return xl(this.viewManager),this.viewManager.getViewports(t)}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_pick(t,e,n){xl(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const r=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(e).timeEnd(),r}_createCanvas(t){let e=t.canvas;if("string"===typeof e&&(e=document.getElementById(e),xl(e)),!e){e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay";(t.parent||document.body).appendChild(e)}return Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||0===e){const t=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=t}if(n||0===n){var i;const e=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.position=(null===(i=t.style)||void 0===i?void 0:i.position)||"absolute",this.canvas.style.height=e}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const e=t.clientWidth||t.width,n=t.clientHeight||t.height;var i;e===this.width&&n===this.height||(this.width=e,this.height=n,null===(i=this.viewManager)||void 0===i||i.setProps({width:e,height:n}),this.props.onResize({width:e,height:n}))}_createAnimationLoop(t){const{width:e,height:n,gl:i,glOptions:r,debug:s,onError:o,onBeforeRender:a,onAfterRender:l,useDevicePixels:c}=t;return new _u({width:e,height:n,useDevicePixels:c,autoResizeViewport:!1,gl:i,onCreateContext:t=>Qs({...r,...t,canvas:this.canvas,debug:s,onContextLost:()=>this._onContextLost()}),onInitialize:t=>this._setGLContext(t.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:a,onAfterRender:l,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new Hl({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=n.length>0;let r=i,s=!1;for(const o of n){var e;r=o,s=(null===(e=o.layer)||void 0===e?void 0:e.onHover(o,t.event))||s}if(!s&&this.props.onHover&&this.props.onHover(r,t.event),this.props.getTooltip&&this.tooltip){const t=this.props.getTooltip(r);this.tooltip.setTooltip(t,r.x,r.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,to(t,{enable:!0,copyState:!0})),this.tooltip=new Nc(this.canvas),js(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new bt;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new rh(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in lr)this.eventManager.on(i,this._onEvent);this.viewManager=new gl({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new fl(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new kc,this.deckRenderer=new zc(t),this.deckPicker=new Fc(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:n}=this.layerManager.context;js(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:n})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),te.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=lo.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}_t(ah,"defaultProps",oh),_t(ah,"VERSION",du.VERSION);const lh="undefined"!==typeof window?t.useLayoutEffect:t.useEffect;function ch(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}class uh{constructor(t,e){_t(this,"opts",void 0),_t(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let r=n;if(n&&n.length!==i){r=new Float32Array(i);const t=e.elementOffset||0;for(let e=0;e<i;++e)r[e]=n[t+e]}return r}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function hh(t){return t.stride||t.size*t.bytesPerElement}function dh(t,e){e.offset&&te.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=hh(t),i=(void 0!==e.vertexOffset?e.vertexOffset:t.vertexOffset||0)*n+(e.elementOffset||0)*t.bytesPerElement+(t.offset||0);return{...e,offset:i,stride:n}}const ph=[],fh=[];function mh(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,i=ph;const r={index:-1,data:t,target:[]};return t?"function"===typeof t[Symbol.iterator]?i=t:t.length>0&&(fh.length=t.length,i=fh):i=ph,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function gh(t){return t&&t[Symbol.asyncIterator]}function yh(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(e,i)=>{let{index:r,target:a}=i;if(!s){const e=r*l+c;for(let i=0;i<n;i++)a[i]=t[e+i];return a}const h=s[r],d=s[r+1]||u;let p;if(o){p=new Array(d-h);for(let e=h;e<d;e++){const i=e*l+c;a=new Array(n);for(let e=0;e<n;e++)a[e]=t[i+e];p[e-h]=a}}else if(l===n)p=t.subarray(h*n+c,d*n+c);else{p=new t.constructor((d-h)*n);let e=0;for(let i=h;i<d;i++){const r=i*l+c;for(let i=0;i<n;i++)p[e++]=t[r+i]}}return p}}const _h=[],vh=[[0,1/0]];function xh(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l)return void n.set(e.subarray(0,l),i);if(n.set(e,i),!s)return;let c=a;for(;c<l;){const t=s(c,e);for(let e=0;e<r;e++)n[i+c]=t[e]||0,c++}}const bh={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function wh(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...bh[n],...e,...t,type:n}}function Sh(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function Eh(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function Th(t){t.push(t.shift())}function Ah(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function kh(t){let{buffer:e,numInstances:n,attribute:i,fromLength:r,fromStartIndices:s,getData:o=(t=>t)}=t;const a=i.doublePrecision&&i.value instanceof Float64Array?2:1,l=i.size*a,c=i.byteOffset,u=i.startIndices,h=s&&u,d=Ah(i,n),p=i.isConstant;if(!h&&r>=d)return;const f=p?i.value:i.getBuffer().getData({srcByteOffset:c});if(i.settings.normalized&&!p){const t=o;o=(e,n)=>i.normalizeConstant(t(e,n))}const m=p?(t,e)=>o(f,e):(t,e)=>o(f.subarray(t,t+l),e),g=e.getData({length:r}),y=new Float32Array(d);!function(t){let{source:e,target:n,size:i,getData:r,sourceStartIndices:s,targetStartIndices:o}=t;if(!Array.isArray(o))return xh({source:e,target:n,size:i,getData:r}),n;let a=0,l=0;const c=r&&((t,e)=>r(t+l,e)),u=Math.min(s.length,o.length);for(let h=1;h<u;h++){const t=s[h]*i,r=o[h]*i;xh({source:e.subarray(a,t),target:n,start:l,end:r,size:i,getData:c}),a=t,l=r}l<n.length&&xh({source:[],target:n,start:l,size:i,getData:c})}({source:g,target:y,sourceStartIndices:s,targetStartIndices:u,size:l,getData:m}),e.byteLength<y.byteLength+c&&e.reallocate(y.byteLength+c),e.subData({data:y,offset:c})}class Ph extends class{constructor(t,e,n){_t(this,"gl",void 0),_t(this,"id",void 0),_t(this,"size",void 0),_t(this,"settings",void 0),_t(this,"value",void 0),_t(this,"doublePrecision",void 0),_t(this,"_buffer",void 0),_t(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const i=e.logicalType||e.type,r=5130===i;let s,{defaultValue:o}=e;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0),s=r?5126:!i&&e.isIndexed?t&&function(t,e){return oa(t,e)}(t,ra)?5125:5123:i||5126;let a=function(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(i||s||5126);this.doublePrecision=r,r&&!1===e.fp64&&(a=Float32Array),this.value=null,this.settings={...e,defaultType:a,defaultValue:o,logicalType:i,type:s,size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new Mo(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*hh(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),On.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,r=function(t,e){const n=dh(t,e);return{high:n,low:{...n,offset:n.offset+4*t.size}}}(this.getAccessor(),e||{});return n[t]=new uh(this,r.high),n["".concat(t,"64Low")]=i?new uh(this,r.low):new Float32Array(this.size),n}if(e){const n=dh(this.getAccessor(),e);return{[t]:new uh(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:i}=this,r=n*i;if(e&&r&&e.length>=r){const n=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let t=0;t<r;)for(let r=0;r<i;r++){const i=e[t++];i<n[r]&&(n[r]=i),i>s[r]&&(s[r]=i)}t=[n,s]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;n=ArrayBuffer.isView(t)?{value:t}:t instanceof Mo?{buffer:t}:t;const i={...this.settings,...n};if(e.bufferAccessor=i,e.bounds=null,n.constant){let t=n.value;t=this._normalizeValue(t,[],0),this.settings.normalized&&(t=this.normalizeConstant(t));if(!(!e.constant||!this._areValuesEqual(t,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=t}else if(n.buffer){const t=n.buffer;e.externalBuffer=t,e.constant=!1,this.value=n.value||null;const r=n.value instanceof Float64Array;i.type=n.type||t.accessor.type,i.bytesPerElement=t.accessor.BYTES_PER_ELEMENT*(r?2:1),i.stride=hh(i)}else if(n.value){this._checkExternalBuffer(n);let t=n.value;e.externalBuffer=null,e.constant=!1,this.value=t,i.bytesPerElement=t.BYTES_PER_ELEMENT,i.stride=hh(i);const{buffer:r,byteOffset:s}=this;this.doublePrecision&&t instanceof Float64Array&&(t=ci(t,i));const o=t.byteLength+s+2*i.stride;r.byteLength<o&&r.reallocate(o),r.setAccessor(null),r.subData({data:t,offset:s}),i.type=n.type||r.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?ci(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{state:n}=this,i=n.allocatedValue,r=On.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=r;const{buffer:s,byteOffset:o}=this;return s.byteLength<r.byteLength+o&&(s.reallocate(r.byteLength+o),e&&i&&s.subData({data:i instanceof Float64Array?ci(i,this):i,offset:o})),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof n||!this.settings.normalized||"normalized"in t||te.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map((t=>(t+128)/255*2-1));case 5122:return new Float32Array(t).map((t=>(t+32768)/65535*2-1));case 5121:return new Float32Array(t).map((t=>t/255));case 5123:return new Float32Array(t).map((t=>t/65535));default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t)return e[n]=i[0],e;switch(r){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let s=r;for(;--s>=0;)e[n+s]=Number.isFinite(t[s])?t[s]:i[s]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:vh}),_t(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat("function"!==typeof t&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition;return wh(Array.isArray(e)?t[e.find((e=>t[e]))]:t[e],n)}setNeedsUpdate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:t=0,endRow:n=1/0}=e;this.state.updateRanges=function(t,e){if(t===vh)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const i=t[s];i[1]<e[0]?(n.push(i),r=s+1):i[0]>e[1]?n.push(i):e=[Math.min(i[0],e[0]),Math.max(i[1],e[1])]}return n.splice(r,0,e),n}(this.state.updateRanges,[t,n])}else this.state.updateRanges=vh}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=_h}setNeedsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate(t,e.updateRanges!==vh),!0))}updateBuffer(t){let{numInstances:e,data:n,props:i,context:r}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[t,a]of s)o.call(r,this,{data:n,startRow:t,endRow:a,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of s){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(t){if(void 0===t||"function"===typeof t)return!1;return this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;n.binaryValue=t,this.setNeedsRedraw();if(i.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const r=t;xl(ArrayBuffer.isView(r.value),"invalid ".concat(i.accessor));const s=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=yh(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:e,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?e[t]:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,e){let{data:n,startRow:i,endRow:r,props:s,numInstances:o}=e;if(t.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=t,{accessor:d,transform:p}=a,f=l.binaryAccessor||("function"===typeof d?d:s[d]);xl("function"===typeof f,'accessor "'.concat(d,'" is not a function'));let m=t.getVertexOffset(i);const{iterable:g,objectInfo:y}=mh(n,i,r);for(const _ of g){y.index++;let e=f(_,y);if(p&&(e=p.call(this,e)),h){const n=(y.index<h.length-1?h[y.index+1]:o)-h[y.index];if(e&&Array.isArray(e[0])){let n=m;for(const i of e)t._normalizeValue(i,c,n),n+=u}else e&&e.length>u?c.set(e,m):(t._normalizeValue(e,y.target,0),se({target:c,source:y.target,start:m,count:n}));m+=n*u}else t._normalizeValue(e,c,m),m+=u}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||"function"===typeof t.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}const Ih="void main() {gl_FragColor = vec4(0);}",Ch="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",Mh="#version 300 es\n".concat(Ch);function zh(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;return{qualifier:i,type:r,name:s.split(";")[0]}}function Lh(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return 300===e?Mh:e>300?"#version ".concat(e,"\n").concat(Ch):Ih;const s=Dh(n,i);return e>=300?"#version ".concat(e," ").concat(300===e?"es":"","\nin ").concat(i," ").concat(n,";\nout vec4 ").concat(r,";\nvoid main() {\n  ").concat(r," = ").concat(s,";\n}"):"varying ".concat(i," ").concat(n,";\nvoid main() {\n  gl_FragColor = ").concat(s,";\n}")}function Dh(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return _r(!1),null}}class Rh extends vo{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return as(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};cs(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,go(this.buffers)||this.bind((()=>this._unbindBuffers())),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind((()=>{for(const e in t)this.setBuffer(e,t[e])})),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:i,byteSize:r,byteOffset:s}=this._getBufferParams(e);return n<0?(this.unused[t]=i,is.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,i,s,r),this)}begin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,i;return t instanceof Mo===!1?(i=t.buffer,n=t.byteSize,e=t.byteOffset):i=t,void 0===e&&void 0===n||(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const r=e&&e.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,t,r,n,i):this.gl.bindBufferBase(35982,t,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}class Bh{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof Mo?n:n.buffer:null}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&co(as(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const t=this.feedbackMap[i];i in e&&(n[t]=i)}Object.assign(n,t.feedbackBuffers);for(const i in n){const t=n[i];if("string"===typeof t){const r=e[t],{byteLength:s,usage:o,accessor:a}=r;n[i]=this._createNewBuffer(i,{byteLength:s,usage:o,accessor:a})}}return n}_setupBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,e){let{model:n}=e;const{program:i}=n;t.transformFeedback=new Rh(this.gl,{program:i,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:e}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:e})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const i in this.feedbackMap){const r=this.feedbackMap[i];e[i]=t.feedbackBuffers[r],n[r]=t.sourceBuffers[i],co(n[r]instanceof Mo)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new Mo(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}function Oh(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){const t=parseInt(n[1],10);Number.isFinite(t)&&(e=t)}return e}const Fh={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},Vh="transform_uSampler_",Nh="transform_uSize_",Uh="transform_position";function jh(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t;let s=Object.keys(n).length,o=null;const a={};let l=e,c={};if(s>0||i){const t=l.split("\n"),e=t.slice();if(t.forEach(((t,r,l)=>{if(s>0){const i=function(t,e){const n={},i=function(t){return zh(t,["attribute","in"])}(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const e="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:i,sizeName:o,uniformDeclerations:a}=function(t){const e="".concat(Vh).concat(t),n="".concat(Nh).concat(t),i="  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}(s),l=function(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return _r(!1),null}}(r),c="  ".concat(r," ").concat(s," = transform_getInput(").concat(i,", ").concat(o,").").concat(l,";\n");n[i]=s;return{updatedLine:e,inject:{"vs:#decl":a,"vs:#main-start":c},samplerTextureMap:n}}return null}(t,n);if(i){const{updatedLine:t,inject:n}=i;e[r]=t,c=Nr([c,n]),Object.assign(a,i.samplerTextureMap),s--}}i&&!o&&(o=function(t,e){const n=zh(t,["varying","out"]);if(!n)return null;return n.name===e?n.type:null}(t,i))})),i){co(r);const t="".concat(Nh).concat(i),e="uniform vec2 ".concat(t,";\n"),n="     vec2 ".concat(Uh," = transform_getPos(").concat(t,");\n     gl_Position = vec4(").concat(Uh,", 0, 1.);\n");c=Nr([c,{"vs:#decl":e,"vs:#main-start":n}])}l=e.join("\n")}return{vs:l,targetTextureType:o,inject:c,samplerTextureMap:a}}const Gh={10241:9728,10240:9728,10242:33071,10243:33071};class qh{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,sourceTextures:n,framebuffer:i,targetTexture:r}=this.bindings[this.currentIndex],s=Object.assign({},e,t.attributes),o=Object.assign({},t.uniforms),a=Object.assign({},t.parameters);let l=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){s.transform_elementID=this.elementIDBuffer;for(const e in this.samplerTextureMap){const t=this.samplerTextureMap[e];o[e]=n[t]}this._setSourceTextureParameters();const t=function(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&(({width:s,height:o}=i),r["".concat(Nh).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),r["".concat(Nh).concat(a)]=[s,o];return r}({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r});Object.assign(o,t)}return this.hasTargetTexture&&(l=!1,a.viewport=[0,0,i.width,i.height]),{attributes:s,framebuffer:i,uniforms:o,discard:l,parameters:a}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],n=Qo(e);if(!t)return n;const i=n.constructor,r=function(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return _r(!1),null}}(this.targetTextureType),s=new i(n.length*r/4);let o=0;for(let a=0;a<n.length;a+=4)for(let t=0;t<r;t++)s[o++]=n[a+t];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof Vo)return n;const i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:i}=t,r=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:r}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if("number"!==typeof t||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach(((t,e,n)=>{n[e]=e})),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new Mo(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:t,targetTexture:e}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:e})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:i,targetTexture:r}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,i),Object.assign(t.sourceBuffers,n),r){t.targetTexture=r;const{width:e,height:n}=r,{framebuffer:i}=t;i?(i.update({attachments:{36064:r},resizeAttachments:!1}),i.resize({width:e,height:n})):t.framebuffer=new ca(this.gl,{id:"transform-framebuffer",width:e,height:n,attachments:{36064:r}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const n in e)e[n].setParameters(Gh)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;return{sourceTextures:e,targetTexture:t.sourceTextures[this._swapTexture]}}_createNewTexture(t){const e=function(t,e){co(t instanceof Vo||t instanceof Yo||t instanceof Ko);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t;return new n(i,Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},e))}(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:r,targetTextureType:s,inject:o,samplerTextureMap:a}=jh({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),l=Nr([t.inject||{},o]);this.targetTextureType=s,this.samplerTextureMap=a;return{vs:i,fs:t._fs||Lh({version:Oh(i),input:this.targetTextureVarying,inputType:s,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[Fh].concat(t.modules||[]):t.modules,uniforms:r,inject:l}}}let $h=null;function Wh(t,e){var n;return new t((n=t.BYTES_PER_ELEMENT*e,(!$h||$h.byteLength<n)&&($h=new ArrayBuffer(n)),$h),0,e)}class Zh extends vo{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero||(as(t)||"Chrome"===fu())}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new Zh(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return Zh.MAX_ATTRIBUTES=Zh.MAX_ATTRIBUTES||t.getParameter(34921),Zh.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:Zh._setConstantFloatArray(t,e,n);break;case Int32Array:Zh._setConstantIntArray(t,e,n);break;case Uint32Array:Zh._setConstantUintArray(t,e,n);break;default:co(!1)}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Zh.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return co(!t||34963===t.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind((()=>{this.gl.bindBuffer(34963,t?t.handle:null)})),this}setBuffer(t,e,n){if(34963===e.target)return this.setElementBuffer(e,n);const{size:i,type:r,stride:s,offset:o,normalized:a,integer:l,divisor:c}=n,{gl:u,gl2:h}=this;return t=Number(t),this.bind((()=>{u.bindBuffer(34962,e.handle),l?(co(as(u)),h.vertexAttribIPointer(t,i,r,s,o)):u.vertexAttribPointer(t,i,r,a,s,o),u.enableVertexAttribArray(t),h.vertexAttribDivisor(t,c||0)})),this}enable(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!e&&0===t&&!Zh.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind((()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),i=n.byteLength*t,r=n.length*t;let s=!this.buffer;if(this.buffer=this.buffer||new Mo(this.gl,i),s=s||this.buffer.reallocate(i),s=s||!this._compareConstantArrayValues(n,this.bufferValue),s){const t=Wh(e.constructor,r);!function(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o)}({target:t,source:n,start:0,count:r}),this.buffer.subData(t),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:co(!1)}}static _setConstantIntArray(t,e,n){switch(co(as(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:co(!1)}}static _setConstantUintArray(t,e,n){switch(co(as(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:co(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:n}=e;return co(Number.isFinite(n)),this.bind((()=>34373===t?this.gl.getVertexAttribOffset(n,t):this.gl.getVertexAttrib(n,t)))}}const Hh=/^(.+)__LOCATION_([0-9]+)$/,Xh=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Yh{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Zh(t),yo(this,"VertexArray","v6.0",Xh),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind((()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)})),this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,n);const{location:i,accessor:r}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return i>=0&&(this.values[i]=e,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,r)),this}setConstant(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{location:i,accessor:r}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return i>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[i]=e,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Mo(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof Mo&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))})),this}bindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof Mo&&this.setBuffer(t,e)}})),this}bindForDraw(t,e,n){let i;return this.vertexArrayObject.bind((()=>{this._setConstantAttributes(t,e),i=n()})),i}_resolveLocationAndAccessor(t,e,n,i){const r={location:-1,accessor:null},{location:s,name:o}=this._getAttributeIndex(t);if(!Number.isFinite(s)||s<0)return this.unused[t]=e,is.once(3,(()=>"unused value ".concat(t," in ").concat(this.id)))(),r;const a=this._getAttributeInfo(o||s);if(!a)return r;const l=this.accessors[s]||{},c=ko.resolve(a.accessor,l,n,i),{size:u,type:h}=c;return co(Number.isFinite(u)&&Number.isFinite(h)),{location:s,accessor:c}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=Hh.exec(t),i=n?n[1]:t,r=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+r,name:i}:{location:-1}}_setAttribute(t,e){if(e instanceof Mo)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof Mo){const n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else{if(!(e.buffer instanceof Mo))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");{const n=e;this.setBuffer(t,n.buffer,n)}}}_setConstantAttributes(t,e){const n=Math.max(0|t,0|e);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let r=1;r<this.vertexArrayObject.MAX_ATTRIBUTES;r++)i=this.values[r],ArrayBuffer.isView(i)&&this._setConstantAttribute(r,i)}_setConstantAttributeZero(t,e){if(Zh.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,t);const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){Zh.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],i=this.accessors[e];if(!n)return;const{divisor:r}=i,s=r>0;if(t.isInstanced=t.isInstanced||s,n instanceof Mo){const e=n;if(s){const n=e.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,n)}else{const n=e.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,n)}}}setElements(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return is.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function Kh(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=Jh(t[o],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}function Jh(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return Kh(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2),s=r.indexOf(".0");return s===r.length-2?r.slice(0,-1):r}function Qh(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s,o,a,l="NOT PROVIDED",c=1,u=0,h=0;if(n&&(l=n.type,c=n.size,l=String(l).replace("Array",""),s=-1!==l.indexOf("nt")),e instanceof Mo){const t=e,{data:d,changed:p}=t.getDebugData();let f;if(o=p?"*":"",a=d,h=t.byteLength,u=h/d.BYTES_PER_ELEMENT/c,n){const t=n.divisor>0;f="".concat(t?"I ":"P "," ").concat(u," (x").concat(c,"=").concat(h," bytes ").concat(ho(r,l),")")}else s=!0,f="".concat(h," bytes");return{[i]:"".concat(o).concat(Jh(a,{size:c,isInteger:s})),"Format ":f}}return a=e,c=e.length,l=String(e.constructor.name).replace("Array",""),s=-1!==l.indexOf("nt"),{[i]:"".concat(Jh(a,{size:c,isInteger:s})," (constant)"),"Format ":"".concat(c,"x").concat(l," (constant)")}}function td(t,e){const{type:n,size:i}=e,r=Na(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function ed(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;co(n);const s=".*Matrix",o=n._uniformSetters,a={},l=Object.keys(o).sort();let c=0;for(const d of l)d.match(".*_.*")||d.match(s)||nd({table:a,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&c++;for(const d of l)d.match(s)&&nd({table:a,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&c++;for(const d of l)a[d]||nd({table:a,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&c++;let u=0;const h={};if(!r)for(const d in i){const t=i[d];a[d]||(u++,h[d]={Type:"NOT USED: ".concat(t),[e]:Jh(t)})}return{table:a,count:c,unusedTable:h,unusedCount:u}}function nd(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=function(t){return void 0!==t&&null!==t}(o);return(!s||!a)&&(e[r]={[n]:a?Jh(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0)}function id(t){const{type:e,size:n}=t.accessor,i=Na(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const rd={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function sd(t,e){const{attributeMap:n=rd}=e||{};return n&&n[t]||t}function od(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2}co(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const ad=()=>{},ld={};class cd{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:n=fo("model")}=e;co(os(t)),this.id=n,this.gl=t,this.id=e.id||fo("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||$a.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c}=t;this.programProps={program:e,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},co(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c}=t;this.programProps={program:e,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return co(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return co(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=sd(s,n);if("indices"===s)r=o;else if(o.constant)i[a]=o.value;else{const e=o.value,n={...o};delete n.value,i[a]=[new Mo(t,e),n],od(s,n)}}if(r){const e=r.value||r;co(e instanceof Uint16Array||e instanceof Uint32Array,'attribute array for "indices" must be of integer type');const n={size:1,isIndexed:void 0===r.isIndexed||r.isIndexed};i.indices=[new Mo(t,{data:e,target:34963}),n]}return i}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(go(t))return this;const e={};for(const n in t){const i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return Ho(this.program.gl,t),this}draw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:i={},attributes:r={},transformFeedback:s=this.transformFeedback,parameters:o={},vertexArray:a=this.vertexArray}=t;let l;this.setAttributes(r),this.updateModuleSettings(e),this.setUniforms(i),is.priority>=2&&(l=this._logDrawCallStart(2));const c=this.vertexArray.getDrawParams(),{isIndexed:u=c.isIndexed,indexType:h=c.indexType,indexOffset:d=c.indexOffset,vertexArrayInstanced:p=c.isInstanced}=this.props;p&&!this.isInstanced&&is.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:f,instanceCount:m}=this,{onBeforeRender:g=ad,onAfterRender:y=ad}=this.props;g(),this.program.setUniforms(this.uniforms);const _=this.program.draw(Object.assign(ld,t,{logPriority:l,uniforms:null,framebuffer:n,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:a,transformFeedback:s,isIndexed:u,indexType:h,isInstanced:f,instanceCount:m,offset:u?d:0}));return y(),is.priority>=2&&this._logDrawCallEnd(l,a,n),_}transform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{discard:e=!0,feedbackBuffers:n,unbindModels:i=[]}=t;let{parameters:r}=t;n&&this._setFeedbackBuffers(n),e&&(r=Object.assign({},r,{35977:e})),i.forEach((t=>t.vertexArray.unbindBuffers()));try{this.draw(Object.assign({},t,{parameters:r}))}finally{i.forEach((t=>t.vertexArray.bindBuffers()))}return this}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return is.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:n,modules:i,inject:r,defines:s,varyings:o,bufferMode:a,transpileToGLSL100:l}=this.programProps;t=this.programManager.get({vs:e,fs:n,modules:i,inject:r,defines:s,varyings:o,bufferMode:a,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}co(t instanceof qa,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Yh(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof Mo&&e.delete()}}_setAnimationProps(t){this.animated&&co(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(go(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new Rh(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:1e4;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),is.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:is.level<=2})(),t}_logDrawCallEnd(t,e,n,i){if(void 0===t)return;const r=function(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=Qh(e,e.elements,null,n));const r=e.values;for(const s in r){const t=e._getAttributeInfo(s);if(t){let o="".concat(s,": ").concat(t.name);const a=e.accessors[t.location];a&&(o="".concat(s,": ").concat(td(t.name,a))),i[o]=Qh(e,r[s],a,n)}}return i}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:s,unusedTable:o,unusedCount:a}=ed({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:l,count:c}=ed({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});c>0&&is.log("MISSING UNIFORMS",Object.keys(l))(),a>0&&is.log("UNUSED UNIFORMS",Object.keys(o))();const u=function(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const t=id(i);e["in ".concat(t)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const t=id(i);e["out ".concat(t)]={[n]:JSON.stringify(i.accessor)}}return e}(this.vertexArray.configuration);is.table(t,r)(),is.table(t,s)(),is.table(t+1,u)(),i&&i.log({logLevel:2,message:"Rendered to ".concat(i.id)}),is.groupEnd(2)()}}class ud{static isSupported(t){return as(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();co(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const e=n.getData(t);if(e)return e}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new cd(e,Object.assign({},t,{fs:t.fs||Lh({version:Oh(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=i.updateModelProps(e);return e}_buildResourceTransforms(t,e){(function(t){if(!go(t.feedbackBuffers)||!go(t.feedbackMap)||t.varyings&&t.varyings.length>0)return!0;return!1})(e)&&(this.bufferTransform=new Bh(t,e)),function(t){if(!go(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)return!0;return!1}(e)&&(this.textureTransform=new qh(t,e)),co(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=Object.assign(e,i.getDrawOptions(e));return e}}const hd="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";const dd={interpolation:class{constructor(t){let{gl:e,attribute:n,timeline:i}=t;_t(this,"gl",void 0),_t(this,"type","interpolation"),_t(this,"attributeInTransition",void 0),_t(this,"settings",void 0),_t(this,"attribute",void 0),_t(this,"transition",void 0),_t(this,"currentStartIndices",void 0),_t(this,"currentLength",void 0),_t(this,"transform",void 0),_t(this,"buffers",void 0),this.gl=e,this.transition=new Tl(i),this.attribute=n,this.attributeInTransition=new Ph(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=function(t,e){const n=Eh(e.size);return new ud(t,{vs:hd,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(e,n);const r={byteLength:0,usage:35050};this.buffers=[new Mo(e,r),new Mo(e,r)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0)return void this.transition.cancel();this.settings=t;const{gl:n,buffers:i,attribute:r}=this;Th(i);const s={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)kh({buffer:o,...s});this.currentStartIndices=r.startIndices,this.currentLength=Ah(r,e),this.attributeInTransition.setData({buffer:i[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:i[0],aTo:Sh(0,r)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{duration:t,easing:e}=this.settings,{time:n}=this.transition;let i=n/t;e&&(i=e(i)),this.transform.run({uniforms:{time:i}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}},spring:class{constructor(t){let{gl:e,attribute:n,timeline:i}=t;_t(this,"gl",void 0),_t(this,"type","spring"),_t(this,"attributeInTransition",void 0),_t(this,"settings",void 0),_t(this,"attribute",void 0),_t(this,"transition",void 0),_t(this,"currentStartIndices",void 0),_t(this,"currentLength",void 0),_t(this,"texture",void 0),_t(this,"framebuffer",void 0),_t(this,"transform",void 0),_t(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Tl(i),this.attribute=n,this.attributeInTransition=new Ph(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=function(t){return new Vo(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(e),this.framebuffer=function(t,e){return new ca(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}(e,this.texture),this.transform=function(t,e,n){const i=Eh(e.size);return new ud(t,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new Mo(e,r),new Mo(e,r),new Mo(e,r)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:r}=this,s={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)kh({buffer:o,...s});this.settings=t,this.currentStartIndices=r.startIndices,this.currentLength=Ah(r,e),this.attributeInTransition.setData({buffer:i[1],value:r.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aTo:Sh(0,r)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;if(!i.update())return!1;const r=this.settings;e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:r.stiffness,damping:r.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Th(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value});return Qo(n)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}};class pd{constructor(t,e){let{id:n,timeline:i}=e;_t(this,"id",void 0),_t(this,"isSupported",void 0),_t(this,"gl",void 0),_t(this,"timeline",void 0),_t(this,"transitions",void 0),_t(this,"needsRedraw",void 0),_t(this,"numInstances",void 0),this.id=n,this.gl=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ud.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:n,numInstances:i}=t;this.numInstances=i||1;for(const r in e){const t=e[r],i=t.getTransitionSetting(n);i&&this._updateAttribute(r,t,i)}for(const r in this.transitions){const t=e[r];t&&t.getTransitionSetting(n)||this._removeTransition(r)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const e in this.transitions){this.transitions[e].update()&&(this.needsRedraw=!0)}const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let r=!i||i.type!==n.type;if(r){if(!this.isSupported)return void te.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();i&&this._removeTransition(t);const s=dd[n.type];s?this.transitions[t]=new s({attribute:e,timeline:this.timeline,gl:this.gl}):(te.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const fd="attributeManager.invalidate";class md{constructor(t){let{id:e="attribute-manager",stats:n,timeline:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_t(this,"id",void 0),_t(this,"gl",void 0),_t(this,"attributes",void 0),_t(this,"updateTriggers",void 0),_t(this,"needsRedraw",void 0),_t(this,"userData",void 0),_t(this,"stats",void 0),_t(this,"attributeTransitionManager",void 0),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new pd(t,{id:"".concat(e,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)void 0!==this.attributes[e]&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);ne(fd,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);ne(fd,this,"all")}update(t){let{data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}=t,l=!1;ne("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const t=this.attributes[c],r=t.settings.accessor;t.startIndices=i,t.numInstances=n,s[c]&&te.removed("props.".concat(c),"data.attributes.".concat(c))(),t.setExternalBuffer(o[c])||t.setBinaryValue("string"===typeof r?o[r]:void 0,e.startIndices)||"string"===typeof r&&!o[r]&&t.setConstantValue(s[r])||t.needsUpdate()&&(l=!0,this._updateAttribute({attribute:t,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||t.needsRedraw()}l&&ne("attributeManager.updateEnd",this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getChangedAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in e){const s=e[r];s.needsRedraw(t)&&!n.hasAttribute(r)&&(i[r]=s)}return i}getShaderAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}_add(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(const n in t){const i=t[n];this.attributes[n]=this._createAttribute(n,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,size:(e.isIndexed?1:e.size)||1,divisor:n.instanced?1:e.divisor||0};return new Ph(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes){this.attributes[e].getUpdateTriggers().forEach((n=>{t[n]||(t[n]=[]),t[n].push(e)}))}this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,r=i[t];return r&&r.forEach((t=>{const i=n[t];i&&i.setNeedsUpdate(i.id,e)})),r}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(ne("attribute.updateStart",e),e.constant)return void e.setConstantValue(e.value);e.allocate(n)&&ne("attribute.allocate",e,n);e.updateBuffer(t)&&(this.needsRedraw=!0,ne("attribute.updateEnd",e,n))}}const gd=1e-5;function yd(t,e,n,i,r){const s=e-t;return(n-e)*r+-s*i+s+e}function _d(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}const vd={interpolation:class extends Tl{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:r}}=this,s=r(t/i);this._value=jn(e,n,s)}},spring:class extends Tl{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:r=t,_currValue:s=t}=this;let o=function(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=yd(t[o],e[o],n[o],i,r);return s}return yd(t,e,n,i,r)}(r,s,e,n,i);const a=_d(o,e),l=_d(o,s);a<gd&&l<gd&&(o=e,this.end()),this._prevValue=s,this._currValue=o}}};class xd{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:r}=this;if(r.has(t)){const n=r.get(t),{value:i=n.settings.fromValue}=n;e=i,this.remove(t)}if(!(i=wh(i)))return;const s=vd[i.type];if(!s)return void te.error("unsupported transition type '".concat(i.type,"'"))();const o=new s(this.timeline);o.start({...i,fromValue:e,toValue:n}),r.set(t,o)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function bd(t,e){const n=Sd({newProps:t,oldProps:e,propTypes:kd(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(t,e){if(null===e)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied");n&&r&&(n=r(t.data,e.data)||n);return n}(t,e);let r=!1;return i||(r=function(t,e){if(null===e)return{all:!0};if("all"in t.updateTriggers){if(Ad(t,e,"all"))return{all:!0}}const n={};let i=!1;for(const r in t.updateTriggers)if("all"!==r){Ad(t,e,r)&&(n[r]=!0,i=!0)}return!!i&&n}(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:Td(t,e),transitionsChanged:wd(t,e)}}function wd(t,e){if(!t.transitions)return!1;const n={},i=kd(t);let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&Ed(t[s],e[s],o)&&(n[s]=!0,r=!0)}return!!r&&n}function Sd(t){let{newProps:e,oldProps:n,ignoreProps:i={},propTypes:r={},triggerName:s="props"}=t;if(n===e)return!1;if("object"!==typeof e||null===e)return"".concat(s," changed shallowly");if("object"!==typeof n||null===n)return"".concat(s," changed shallowly");for(const o of Object.keys(e))if(!(o in i)){if(!(o in n))return"".concat(s,".").concat(o," added");const t=Ed(e[o],n[o],r[o]);if(t)return"".concat(s,".").concat(o," ").concat(t)}for(const o of Object.keys(n))if(!(o in i)){if(!(o in e))return"".concat(s,".").concat(o," dropped");if(!Object.hasOwnProperty.call(e,o)){const t=Ed(e[o],n[o],r[o]);if(t)return"".concat(s,".").concat(o," ").concat(t)}}return!1}function Ed(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)?"changed deeply":i||(i=t&&e&&t.equals,!i||i.call(t,e))?i||e===t?null:"changed shallowly":"changed deeply"}function Td(t,e){if(null===e)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function Ad(t,e,n){let i=t.updateTriggers[n];i=void 0===i||null===i?{}:i;let r=e.updateTriggers[n];r=void 0===r||null===r?{}:r;return Sd({oldProps:r,newProps:i,triggerName:n})}function kd(t){const e=t[Pt],n=e&&e.constructor;return n?n._propTypes:{}}function Pd(t){if(null===(e=t)||"object"!==typeof e)throw new Error("count(): argument not an object");var e;if("function"===typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===typeof t&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error("count(): argument not a container")}function Id(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some((t=>"project64"===t.name)))){const t=n.modules.findIndex((t=>"project32"===t.name));t>=0&&n.modules.splice(t,1)}if("inject"in e)if(t.inject){const i={...t.inject};for(const t in e.inject)i[t]=(i[t]||"")+e.inject[t];n.inject=i}else n.inject=e.inject;return n}function Cd(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.projectPosition(t);if(n&&e instanceof El){const[n,r,s=0]=t,o=e.getDistanceScales([n,r]);i[2]=s*o.unitsPerMeter[2]}return i}function Md(t,e){let{viewport:n,modelMatrix:i,coordinateSystem:r,coordinateOrigin:s,offsetMode:o}=e,[a,l,c=0]=t;switch(i&&([a,l,c]=wi([],[a,l,c,1],i)),r){case sr.LNGLAT:return Cd([a,l,c],n,o);case sr.LNGLAT_OFFSETS:return Cd([a+s[0],l+s[1],c+(s[2]||0)],n,o);case sr.METER_OFFSETS:return Cd(Yi(s,[a,l,c]),n,o);case sr.CARTESIAN:default:return n.isGeospatial?[a+s[0],l+s[1],c+s[2]]:n.projectPosition([a,l,c])}}function zd(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===sr.DEFAULT&&(r=e.isGeospatial?sr.LNGLAT:sr.CARTESIAN),void 0===s&&(s=r),void 0===o&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}(e),{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:u}=al(n,i,r),h=Md(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:u});if(u){const t=n.projectPosition(l||c);ei(h,h,t)}return h}const Ld={10241:9987,10240:9729,10242:33071,10243:33071},Dd={};const Rd={boolean:{validate:(t,e)=>!0,equal:(t,e,n)=>Boolean(t)===Boolean(e)},number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},color:{validate:(t,e)=>e.optional&&!t||Vd(t)&&(3===t.length||4===t.length),equal:(t,e,n)=>Bd(t,e)},accessor:{validate(t,e){const n=Nd(t);return"function"===n||n===Nd(e.value)},equal:(t,e,n)=>"function"===typeof e||Bd(t,e)},array:{validate:(t,e)=>e.optional&&!t||Vd(t),equal:(t,e,n)=>n.compare?Bd(t,e):t===e},object:{equal:(t,e,n)=>n.compare?ml(t,e):t===e},function:{validate:(t,e)=>e.optional&&!t||"function"===typeof t,equal:(t,e,n)=>!n.compare||t===e},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>function(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof Vo)return e;e.constructor&&"Object"!==e.constructor.name&&(e={data:e});let i=null;e.compressed&&(i={10241:e.data.length>1?9985:9729});const r=new Vo(n,{...e,parameters:{...Ld,...i,...t.props.textureParameters}});return Dd[r.id]=!0,r}(n,t),release:t=>{var e;(e=t)&&e instanceof Vo&&Dd[e.id]&&(e.delete(),delete Dd[e.id])}}};function Bd(t,e){if(t===e)return!0;if(!Vd(t)||!Vd(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Od(t,e){switch(Nd(e)){case"object":return Fd(t,e);case"array":return Fd(t,{type:"array",value:e,compare:!1});case"boolean":return Fd(t,{type:"boolean",value:e});case"number":return Fd(t,{type:"number",value:e});case"function":return Fd(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Fd(t,e){return"type"in e?{name:t,...Rd[e.type],...e}:"value"in e?{name:t,type:Nd(e.value),...e}:{name:t,type:"object",value:e}}function Vd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Nd(t){return Vd(t)?"array":null===t?"null":typeof t}function Ud(t){const e=qd(t,"_mergedDefaultProps");return e||(function(t){if(!t.prototype)return;const e=Object.getPrototypeOf(t),n=Ud(e),i=function(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const t=null===s||void 0===s?void 0:s.deprecatedFor;if(t)i[r]=Array.isArray(t)?t:[t];else{const t=Od(r,s);e[r]=t,n[r]=t.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}(qd(t,"defaultProps")||{}),r=function(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const r=function(t){const e=qd(t,"layerName")||qd(t,"componentName");e||te.once(0,"".concat(t.name,".componentName not specified"))();return e||t.name}(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}(i.defaultProps,n,t),s={...e._propTypes,...i.propTypes};!function(t,e){const n={},i={};for(const r in e){const t=e[r],{name:s,value:o}=t;t.async&&(n[s]=o,i[s]=jd(s))}t[It]=n,t[Ct]={},Object.defineProperties(t,i)}(r,s);const o={...e._deprecatedProps,...i.deprecatedProps};(function(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(t){const i="".concat(this.id,": ").concat(n);for(const r of e[n])Gd(this,r)||(this[r]=t);te.deprecated(i,e[n].join("/"))()}})})(r,o),t._mergedDefaultProps=r,t._propTypes=s,t._deprecatedProps=o}(t),t._mergedDefaultProps)}function jd(t){return{enumerable:!0,set(e){"string"===typeof e||e instanceof Promise||gh(e)?this[Ct][t]=e:this[Mt][t]=e},get(){if(this[Mt]){if(t in this[Mt]){return this[Mt][t]||this[It][t]}if(t in this[Ct]){const e=this[Pt]&&this[Pt].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[It][t]}}return this[It][t]}}}function Gd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function qd(t,e){return Gd(t,e)&&t[e]}let $d=0;class Wd{constructor(){_t(this,"id",void 0),_t(this,"props",void 0),_t(this,"count",void 0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.props=function(t,e){const n=Ud(t.constructor),i=Object.create(n);i[Pt]=t,i[Ct]={},i[Mt]={};for(let r=0;r<e.length;++r){const t=e[r];for(const e in t)i[e]=t[e]}return Object.freeze(i),i}(this,e),this.id=this.props.id,this.count=$d++}clone(t){const{props:e}=this,n={};for(const i in e[It])i in e[Mt]?n[i]=e[Mt][i]:i in e[Ct]&&(n[i]=e[Ct][i]);return new this.constructor({...e,...n,...t})}}_t(Wd,"componentName","Component"),_t(Wd,"defaultProps",{});const Zd=Object.freeze({});class Hd extends class{constructor(t){_t(this,"component",void 0),_t(this,"onAsyncPropUpdated",void 0),_t(this,"asyncProps",void 0),_t(this,"oldProps",void 0),_t(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||Zd}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){const e=t[Mt]||{},n=t[Ct]||t,i=t[It]||{};for(const r in e){const t=e[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,t),e[r]=this.getAsyncProp(r)}for(const r in n){const t=n[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,t)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){this._didAsyncInputValueChange(t,e)&&("string"===typeof e&&(e=this._fetch(t,e)),e instanceof Promise?this._watchPromise(t,e):gh(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e!==n.resolvedValue&&e!==n.lastValue&&(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&void 0!==e&&(this._freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;e.then((e=>{e=this._postProcessValue(n,e),this._setAsyncPropValue(t,e,i),this._onResolve(t,e)})).catch((e=>{this._onError(t,e)}))}}async _resolveAsyncIterable(t,e){if("data"!==t)return void this._setPropValue(t,e);const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],s=0;for await(const o of e){const{dataTransform:e}=this.component.props;r=e?e(o,r):r.concat(o),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:s,endRow:r.length}]}),s=r.length,this._setAsyncPropValue(t,r,i)}this._onResolve(t,r)}_postProcessValue(t,e){const n=t.type;return n&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const n=this.component&&this.component.constructor._propTypes;this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}{constructor(t){let{attributeManager:e,layer:n}=t;super(n),_t(this,"attributeManager",void 0),_t(this,"needsRedraw",void 0),_t(this,"needsUpdate",void 0),_t(this,"subLayers",void 0),_t(this,"usesPickingColorCache",void 0),_t(this,"changeFlags",void 0),_t(this,"viewport",void 0),_t(this,"uniformTransitions",void 0),_t(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(t){this.component=t}_fetch(t,e){const n=this.component.props.fetch;return n?n(e,{propName:t,layer:this.layer}):super._fetch(t,e)}_onResolve(t,e){const n=this.component.props.onDataLoad;"data"===t&&n&&n(e,{propName:t,layer:this.layer})}_onError(t,e){this.layer.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const Xd=2**24-1,Yd=Object.freeze([]),Kd=tl((t=>{let{oldViewport:e,viewport:n}=t;return e.equals(n)}));let Jd=new Uint8ClampedArray(0);const Qd={data:{type:"data",value:Yd,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,e)=>{let{propName:n,layer:i,loaders:r,loadOptions:s,signal:o}=e;const{resourceManager:a}=i.context;var l;(s=s||i.getLoadOptions(),r=r||i.props.loaders,o)&&(s={...s,fetch:{...null===(l=s)||void 0===l?void 0:l.fetch,signal:o}});let c=a.contains(t);return c||s||(a.add({resourceId:t,data:Dn(t,r),persistent:!1}),c=!0),c?a.subscribe({resourceId:t,onChange:t=>{var e;return null===(e=i.internalState)||void 0===e?void 0:e.reloadAsyncProp(n,t)},consumerId:i.id,requestId:n}):Dn(t,r,s)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:cr,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:sr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:t=>{let{layerIndex:e}=t;return[0,100*-e]},compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class tp extends Wd{constructor(){super(...arguments),_t(this,"internalState",null),_t(this,"lifecycle",wt),_t(this,"context",void 0),_t(this,"state",void 0),_t(this,"parent",null)}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){xl(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=Md(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,s]=tr(n,e.pixelProjectionMatrix);return 2===t.length?[i,r]:[i,r,s]}unproject(t){xl(this.internalState);return(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){xl(this.internalState);return zd(t,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===sr.DEFAULT||t===sr.LNGLAT||t===sr.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){xl(t instanceof Uint8Array);const[e,n,i]=t;return e+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Pd(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;const e=this.getAttributeManager();if(!e)return null;const{positions:n,instancePositions:i}=e.attributes;return null===(t=n||i)||void 0===t?void 0:t.getBounds()}getShaders(t){for(const e of this.props.extensions)t=Id(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const a of n)e.invalidateAll(a);else e.invalidateAll();const{props:i,oldProps:r}=t,s=Number.isInteger(r.highlightedObjectIndex)||r.pickable,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable;if(s!==o&&e){const{pickingColors:t,instancePickingColors:n}=e.attributes,i=t||n;i&&(o&&i.constant&&(i.constant=!1,e.invalidate(i.id)),i.value||o||(i.constant=!0,i.value=[0,0,0]))}}finalizeState(t){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:n,sourceLayer:i}=t;const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(t,e){var n,i,r,s;(e&&(t.message="".concat(e,": ").concat(t.message)),null!==(n=(i=this.props).onError)&&void 0!==n&&n.call(i,t))||(null===(r=this.context)||void 0===r||null===(s=r.onError)||void 0===s||s.call(r,t,this))}getNeedsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var t;return(null===(t=this.internalState)||void 0===t?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,e&&Kd({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";const e=this.getAttributeManager();e&&("all"===t?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const t in e)Object.defineProperty(n,t,{value:e[t]});return n}return this.props}calculateInstancePickingColors(t,e){let{numInstances:n}=e;if(t.constant)return;const i=Math.floor(Jd.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>Xd&&te.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Jd=On.allocate(Jd,n,{size:3,copy:!0,maxCount:Math.max(n,Xd)});const t=Math.floor(Jd.length/3),e=[];for(let n=i;n<t;n++)this.encodePickingColor(n,e),Jd[3*n+0]=e[0],Jd[3*n+1]=e[1],Jd[3*n+2]=e[2]}t.value=Jd.subarray(0,3*n)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},r=n.getShaderAttributes(e,i);t.setAttributes(r)}disablePickingIndex(t){this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;if(!i)return;const r=i.getVertexOffset(t),s=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(s-r),offset:r})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Jd.buffer&&(n.value=Jd.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){xl(!this.internalState),xl(Number.isFinite(this.props.coordinateSystem)),ne("layer.initialize",this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Hd({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(te.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.layer=this,this.internalState.uniformTransitions=new xd(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){ne("layer.matched",this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.internalState.layer=this,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(ne("layer.update",this,t),!t)return;const e=this.props,n=this.context,i=this.internalState,r=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||r,this.props=s;try{const t=this._getUpdateParams(),s=this.getModels();if(n.gl)this.updateState(t);else try{this.updateState(t)}catch(o){}for(const e of this.props.extensions)e.updateState.call(this,t,e);const a=this.getModels()[0]!==s[0];this._postUpdate(t,a)}finally{n.viewport=r,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){ne("layer.finalize",this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:n={},parameters:i={}}=t;this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:t}=this.props,o=t&&t(n)||[0,0];js(s.gl,{polygonOffset:o}),Gs(s.gl,i,(()=>{const t={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const e of this.props.extensions)e.draw.call(this,t,e);this.draw(t)}))}finally{this.props=r}}getChangeFlags(){var t;return null===(t=this.internalState)||void 0===t?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const i in t)if(t[i]){let n=!1;if("dataChanged"===i){const r=t[i],s=e[i];r&&Array.isArray(s)&&(e.dataChanged=Array.isArray(r)?s.concat(r):r,n=!0)}e[i]||(e[i]=t[i],n=!0),n&&ne("layer.changeFlag",this,i,t)}const n=Boolean(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=bd(t,e);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(r,e[r],t[r],null===(i=t.transitions)||void 0===i?void 0:i[r])}return this.setChangeFlags(n)}validateProps(){!function(t){const e=kd(t);for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&"function"===typeof n&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new md(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:r}=this.state;null===r||void 0===r||r.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:o,highlightColor:a}=n;if(e||i.autoHighlight!==s||i.highlightedObjectIndex!==o||i.highlightColor!==a){const t={};s||(t.pickingSelectedColor=null),Array.isArray(a)&&(t.pickingHighlightColor=a),Number.isInteger(o)&&(t.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(t)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(t);return e=e||i,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}_t(tp,"defaultProps",Qd),_t(tp,"layerName","Layer");const ep={position:"absolute",zIndex:-1};function np(e,n){if("function"===typeof e)return e(n);if(Array.isArray(e))return e.map((t=>np(t,n)));if(ip(e)){if(function(t){const e=t.type,n=e&&e.defaultProps;return n&&n.mapStyle}(e))return n.style=ep,(0,t.cloneElement)(e,n);if(function(t){const e=t.type;return e&&e.deckGLViewProps}(e))return(0,t.cloneElement)(e,n)}return e}function ip(t){return t&&"object"===typeof t&&"type"in t||!1}function rp(e){if("function"===typeof e)return(0,t.createElement)(bl,{},e);if(Array.isArray(e))return e.map(rp);if(ip(e)){if(e.type===t.Fragment)return rp(e.props.children);if(ch(e.type,bl))return e}return e}const sp={mixBlendMode:null};function op(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}const ap=(0,t.forwardRef)(((e,n)=>{const[i,r]=(0,t.useState)(0),s=(0,t.useRef)({control:null,version:i,forceUpdate:()=>r((t=>t+1))}).current,o=(0,t.useRef)(null),a=(0,t.useRef)(null),l=(0,t.useMemo)((()=>function(e){let{children:n,layers:i=[],views:r=null}=e;const s=[],o=[],a={};return t.Children.forEach(rp(n),(t=>{if(ip(t)){const e=t.type;if(ch(e,tp)){const n=function(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}(e,t.props);o.push(n)}else s.push(t);if(ch(e,bl)&&e!==bl&&t.props.id){const n=new e(t.props);a[n.id]=n}}else t&&s.push(t)})),Object.keys(a).length>0&&(Array.isArray(r)?r.forEach((t=>{a[t.id]=t})):r&&(a[r.id]=r),r=Object.values(a)),i=o.length>0?[...o,...i]:i,{layers:i,children:s,views:r}}(e)),[e.layers,e.views,e.children]);let c=!0;const u=t=>{var n;return c&&e.viewState?(s.viewStateUpdateRequested=t,null):(s.viewStateUpdateRequested=null,null===(n=e.onViewStateChange)||void 0===n?void 0:n.call(e,t))},h=t=>{var n;c?s.interactionStateUpdateRequested=t:(s.interactionStateUpdateRequested=null,null===(n=e.onInteractionStateChange)||void 0===n||n.call(e,t))},d=(0,t.useMemo)((()=>{const t={...e,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:h};return delete t._customRender,s.deck&&s.deck.setProps(t),t}),[e]);(0,t.useEffect)((()=>{const t=e.Deck||ah;return s.deck=function(t,e,n){const i=new e({...n,_customRender:e=>{t.redrawReason=e;const n=i.getViewports();t.lastRenderedViewports!==n?t.forceUpdate():op(t)}});return i}(s,t,{...d,parent:o.current,canvas:a.current}),()=>{var t;return null===(t=s.deck)||void 0===t?void 0:t.finalize()}}),[]),lh((()=>{op(s);const{viewStateUpdateRequested:t,interactionStateUpdateRequested:e}=s;t&&u(t),e&&h(e)})),(0,t.useImperativeHandle)(n,(()=>function(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}(s)),[]);const p=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:f,width:m,height:g,id:y,style:_}=e,{containerStyle:v,canvasStyle:x}=(0,t.useMemo)((()=>function(t){let{width:e,height:n,style:i}=t;const r={position:"absolute",zIndex:0,left:0,top:0,width:e,height:n},s={left:0,top:0};if(i)for(const o in i)o in sp?s[o]=i[o]:r[o]=i[o];return{containerStyle:r,canvasStyle:s}}({width:m,height:g,style:_})),[m,g,_]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===p||s.version!==i){s.lastRenderedViewports=p,s.version=i;const e=function(e){let{children:n,deck:i,ContextProvider:r}=e;const{viewManager:s}=i||{};if(!s||!s.views.length)return[];const o={},a=s.views[0].id;for(const t of n){let e=a,n=t;ip(t)&&ch(t.type,bl)&&(e=t.props.id||a,n=t.props.children);const i=s.getViewport(e),r=s.getViewState(e);if(i){const{x:t,y:s,width:a,height:l}=i;n=np(n,{x:t,y:s,width:a,height:l,viewport:i,viewState:r}),o[e]||(o[e]={viewport:i,children:[]}),o[e].children.push(n)}}return Object.keys(o).map((e=>{const{viewport:n,children:s}=o[e],{x:a,y:l,width:c,height:u}=n,h={position:"absolute",left:a,top:l,width:c,height:u},d="view-".concat(e),p=(0,t.createElement)("div",{key:d,id:d,style:h},...s);if(r){const s={viewport:n,container:i.canvas.offsetParent,eventManager:i.eventManager,onViewStateChange:t=>{t.viewId=e,i._onViewStateChange(t)}};return(0,t.createElement)(r,{key:d,value:s},p)}return p}))}({children:l.children,deck:s.deck,ContextProvider:f}),n=(0,t.createElement)("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:a,style:x});s.control=(0,t.createElement)("div",{id:"".concat(y||"deckgl","-wrapper"),ref:o,style:v},[n,e])}return c=!1,s.control}));ap.defaultProps=ah.defaultProps;const lp=ap,cp=t.createContext(null);function up(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function hp(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function dp(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const e=t.center;t.center=new e.constructor(n.longitude,n.latitude),i=i||e!==t.center}if("zoom"in n){const e=t.zoom;t.zoom=n.zoom,i=i||e!==t.zoom}if("bearing"in n){const e=t.bearing;t.bearing=n.bearing,i=i||e!==t.bearing}if("pitch"in n){const e=t.pitch;t.pitch=n.pitch,i=i||e!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const pp=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function fp(t){if(!t)return null;if("string"===typeof t)return t;if("toJS"in t&&(t=t.toJS()),!t.layers)return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map((t=>{const n=e[t.ref];let i=null;if("interactive"in t&&(i={...t},delete i.interactive),n){i=i||{...t},delete i.ref;for(const t of pp)t in n&&(i[t]=n[t])}return i||t}));return{...t,layers:n}}function mp(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!mp(t[n],e[n]))return!1;return!0}if(Array.isArray(e))return!1;if("object"===typeof t&&"object"===typeof e){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n){if(!e.hasOwnProperty(r))return!1;if(!mp(t[r],e[r]))return!1}return!0}return!1}const gp={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},yp={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},_p={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},vp=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],xp=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class bp{constructor(t,e,n){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=t=>{const e=this.props[_p[t.type]];e&&e(t)},this._onPointerEvent=t=>{"mousemove"!==t.type&&"mouseout"!==t.type||this._updateHover(t);const e=this.props[gp[t.type]];if(e){if(this.props.interactiveLayerIds&&"mouseover"!==t.type&&"mouseout"!==t.type){const e=this._hoveredFeatures||this._map.queryRenderedFeatures(t.point,{layers:this.props.interactiveLayerIds});if(!e.length)return;t.features=e}e(t),delete t.features}},this._onCameraEvent=t=>{if(!this._internalUpdate){const e=this.props[yp[t.type]];e&&e(t)}t.type in this._deferredEvents&&(this._deferredEvents[t.type]=!1)},this._MapClass=t,this.props=e,this._initialize(n)}get map(){return this._map}get transform(){return this._renderTransform}setProps(t){const e=this.props;this.props=t;const n=this._updateSettings(t,e);n&&(this._renderTransform=up(this._map.transform));const i=this._updateSize(t),r=this._updateViewState(t,!0);this._updateStyle(t,e),this._updateStyleComponents(t,e),this._updateHandlers(t,e),(n||i||r&&!this._map.isMoving())&&this.redraw()}static reuse(t,e){const n=bp.savedMaps.pop();if(!n)return null;const i=n.map,r=i.getContainer();for(e.className=r.className;r.childNodes.length>0;)e.appendChild(r.childNodes[0]);return i._container=e,t.initialViewState&&n._updateViewState(t.initialViewState,!1),i.resize(),n.setProps({...t,styleDiffing:!1}),i.isStyleLoaded()?i.fire("load"):i.once("styledata",(()=>i.fire("load"))),n}_initialize(t){const{props:e}=this,n={...e,...e.initialViewState,accessToken:e.mapboxAccessToken||wp()||null,container:t,style:fp(e.mapStyle)},i=n.initialViewState||n.viewState||n;if(Object.assign(n,{center:[i.longitude||0,i.latitude||0],zoom:i.zoom||0,pitch:i.pitch||0,bearing:i.bearing||0}),e.gl){const t=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=t,e.gl)}const r=new this._MapClass(n);i.padding&&r.setPadding(i.padding),e.cursor&&(r.getCanvas().style.cursor=e.cursor),this._renderTransform=up(r.transform);const s=r._render;r._render=t=>{this._inRender=!0,s.call(r,t),this._inRender=!1};const o=r._renderTaskQueue.run;r._renderTaskQueue.run=t=>{o.call(r._renderTaskQueue,t),this._onBeforeRepaint()},r.on("render",(()=>this._onAfterRepaint()));const a=r.fire;r.fire=this._fireEvent.bind(this,a),r.on("resize",(()=>{this._renderTransform.resize(r.transform.width,r.transform.height)})),r.on("styledata",(()=>this._updateStyleComponents(this.props,{}))),r.on("sourcedata",(()=>this._updateStyleComponents(this.props,{})));for(const l in gp)r.on(l,this._onPointerEvent);for(const l in yp)r.on(l,this._onCameraEvent);for(const l in _p)r.on(l,this._onEvent);this._map=r}recycle(){bp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_updateSize(t){const{viewState:e}=t;if(e){const t=this._map;if(e.width!==t.transform.width||e.height!==t.transform.height)return t.resize(),!0}return!1}_updateViewState(t,e){if(this._internalUpdate)return!1;const n=this._map,i=this._renderTransform,{zoom:r,pitch:s,bearing:o}=i,a=dp(i,{...hp(n.transform),...t});if(a&&e){const t=this._deferredEvents;t.move=!0,t.zoom||(t.zoom=r!==i.zoom),t.rotate||(t.rotate=o!==i.bearing),t.pitch||(t.pitch=s!==i.pitch)}return n.isMoving()||dp(n.transform,t),a}_updateSettings(t,e){const n=this._map;let i=!1;for(const r of vp)r in t&&!mp(t[r],e[r])&&(i=!0,n[`set${r[0].toUpperCase()}${r.slice(1)}`](t[r]));return i}_updateStyle(t,e){if(t.cursor!==e.cursor&&(this._map.getCanvas().style.cursor=t.cursor),t.mapStyle!==e.mapStyle){const e={diff:t.styleDiffing};return"localIdeographFontFamily"in t&&(e.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(fp(t.mapStyle),e),!0}return!1}_updateStyleComponents(t,e){const n=this._map;let i=!1;return n.style.loaded()&&("light"in t&&!mp(t.light,e.light)&&(i=!0,n.setLight(t.light)),"fog"in t&&!mp(t.fog,e.fog)&&(i=!0,n.setFog(t.fog)),"terrain"in t&&!mp(t.terrain,e.terrain)&&(t.terrain&&!n.getSource(t.terrain.source)||(i=!0,n.setTerrain(t.terrain)))),i}_updateHandlers(t,e){const n=this._map;let i=!1;for(const r of xp){const s=t[r];mp(s,e[r])||(i=!0,s?n[r].enable(s):n[r].disable())}return i}_updateHover(t){const{props:e}=this;if(e.interactiveLayerIds&&(e.onMouseMove||e.onMouseEnter||e.onMouseLeave)){var n;const i=t.type,r=(null===(n=this._hoveredFeatures)||void 0===n?void 0:n.length)>0;let s;if("mousemove"===i)try{s=this._map.queryRenderedFeatures(t.point,{layers:e.interactiveLayerIds})}catch{s=[]}else s=[];const o=s.length>0;!o&&r&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=s,o&&!r&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=i}else this._hoveredFeatures=null}_fireEvent(t,e,n){const i=this._map,r=i.transform,s="string"===typeof e?e:e.type;return"move"===s&&this._updateViewState(this.props,!1),s in yp&&("object"===typeof e&&(e.viewState=hp(r)),this._map.isMoving())?(i.transform=this._renderTransform,t.call(i,e,n),i.transform=r,i):(t.call(i,e,n),i)}_onBeforeRepaint(){const t=this._map;this._internalUpdate=!0;for(const n in this._deferredEvents)this._deferredEvents[n]&&t.fire(n);this._internalUpdate=!1;const e=this._map.transform;this._map.transform=this._renderTransform,this._map.painter.transform=this._renderTransform,this._onAfterRepaint=()=>{(e.elevation=this._renderTransform.elevation)&&e.updateElevation(!1),this._map.transform=e}}}function wp(){let t=null;if("undefined"!==typeof location){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.MapboxAccessToken}catch{}try{t=t||{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}bp.savedMaps=[];const Sp=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ep(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:n=>t.transform.locationPoint(e.LngLat.convert(n)),unproject:n=>t.transform.pointLocation(e.Point.convert(n))};for(const r of function(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))"_"!==i[0]&&"function"===typeof t[i]&&"fire"!==i&&"setEventedParent"!==i&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}(n))r in i||Sp.includes(r)||(i[r]=n[r].bind(n));return i}const Tp="undefined"!==typeof document?t.useLayoutEffect:t.useEffect,Ap=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];const kp=t.createContext(null),Pp={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Ip=(0,t.forwardRef)(((e,i)=>{const r=(0,t.useContext)(cp),[s,o]=(0,t.useState)(null),a=(0,t.useRef)(),{current:l}=(0,t.useRef)({mapLib:null,map:null});(0,t.useEffect)((()=>{const t=e.mapLib;let i,s=!0;return Promise.resolve(t||n.e(636).then(n.t.bind(n,636,19))).then((t=>{if(s){if(t.Map||(t=t.default),!t||!t.Map)throw new Error("Invalid mapLib");if(!t.supported(e))throw new Error("Map is not supported by this browser");!function(t,e){for(const n of Ap)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&"unavailable"===t.getRTLTextPluginStatus()&&t.setRTLTextPlugin(e.RTLTextPlugin,(t=>{t&&console.error(t)}),!1)}(t,e),e.reuseMaps&&(i=bp.reuse(e,a.current)),i||(i=new bp(t.Map,e,a.current)),l.map=Ep(i,t),l.mapLib=t,o(i),null===r||void 0===r||r.onMapMount(l.map,e.id)}})).catch((t=>{e.onError({type:"error",target:null,originalEvent:null,error:t})})),()=>{s=!1,i&&(null===r||void 0===r||r.onMapUnmount(e.id),e.reuseMaps?i.recycle():i.destroy())}}),[]),Tp((()=>{s&&s.setProps(e)})),(0,t.useImperativeHandle)(i,(()=>l.map),[s]);const c=(0,t.useMemo)((()=>({position:"relative",width:"100%",height:"100%",...e.style})),[e.style]);return t.createElement("div",{id:e.id,ref:a,style:c},s&&t.createElement(kp.Provider,{value:l},e.children))}));Ip.displayName="Map",Ip.defaultProps=Pp;const Cp=Ip;var Mp=n(164);const zp=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Lp(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const t=e[i];Number.isFinite(t)&&!zp.test(i)?n[i]=`${t}px`:n[i]=t}}function Dp(e){const{map:n,mapLib:i}=(0,t.useContext)(kp),r=(0,t.useRef)({props:e});r.current.props=e;const s=(0,t.useMemo)((()=>{let n=!1;t.Children.forEach(e.children,(t=>{t&&(n=!0)}));const o={...e,element:n?document.createElement("div"):null},a=new i.Marker(o).setLngLat([e.longitude,e.latitude]);return a.getElement().addEventListener("click",(t=>{var e,n;null===(e=(n=r.current.props).onClick)||void 0===e||e.call(n,{type:"click",target:a,originalEvent:t})})),a.on("dragstart",(t=>{var e,n;const i=t;i.lngLat=s.getLngLat(),null===(e=(n=r.current.props).onDragStart)||void 0===e||e.call(n,i)})),a.on("drag",(t=>{var e,n;const i=t;i.lngLat=s.getLngLat(),null===(e=(n=r.current.props).onDrag)||void 0===e||e.call(n,i)})),a.on("dragend",(t=>{var e,n;const i=t;i.lngLat=s.getLngLat(),null===(e=(n=r.current.props).onDragEnd)||void 0===e||e.call(n,i)})),a}),[]);return(0,t.useEffect)((()=>(s.addTo(n.getMap()),()=>{s.remove()})),[]),(0,t.useEffect)((()=>{Lp(s.getElement(),e.style)}),[e.style]),s.getLngLat().lng===e.longitude&&s.getLngLat().lat===e.latitude||s.setLngLat([e.longitude,e.latitude]),e.offset&&!function(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}(s.getOffset(),e.offset)&&s.setOffset(e.offset),s.isDraggable()!==e.draggable&&s.setDraggable(e.draggable),s.getRotation()!==e.rotation&&s.setRotation(e.rotation),s.getRotationAlignment()!==e.rotationAlignment&&s.setRotationAlignment(e.rotationAlignment),s.getPitchAlignment()!==e.pitchAlignment&&s.setPitchAlignment(e.pitchAlignment),s.getPopup()!==e.popup&&s.setPopup(e.popup),(0,Mp.createPortal)(e.children,s.getElement())}Dp.defaultProps={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};t.memo(Dp);function Rp(t){return new Set(t?t.trim().split(/\s+/):[])}t.memo((function(e){const{map:n,mapLib:i}=(0,t.useContext)(kp),r=(0,t.useMemo)((()=>document.createElement("div")),[]),s=(0,t.useRef)({props:e});s.current.props=e;const o=(0,t.useMemo)((()=>{const t={...e},n=new i.Popup(t).setLngLat([e.longitude,e.latitude]);return n.once("open",(t=>{var e,n;null===(e=(n=s.current.props).onOpen)||void 0===e||e.call(n,t)})),n}),[]);if((0,t.useEffect)((()=>{const t=t=>{var e,n;null===(e=(n=s.current.props).onClose)||void 0===e||e.call(n,t)};return o.on("close",t),o.setDOMContent(r).addTo(n.getMap()),()=>{o.off("close",t),o.isOpen()&&o.remove()}}),[]),(0,t.useEffect)((()=>{Lp(o.getElement(),e.style)}),[e.style]),o.isOpen()&&(o.getLngLat().lng===e.longitude&&o.getLngLat().lat===e.latitude||o.setLngLat([e.longitude,e.latitude]),e.offset&&!mp(o.options.offset,e.offset)&&o.setOffset(e.offset),o.options.anchor===e.anchor&&o.options.maxWidth===e.maxWidth||(o.options.anchor=e.anchor,o.setMaxWidth(e.maxWidth)),o.options.className!==e.className)){const t=Rp(o.options.className),n=Rp(e.className);for(const e of t)n.has(e)||o.removeClassName(e);for(const e of n)t.has(e)||o.addClassName(e);o.options.className=e.className}return(0,Mp.createPortal)(e.children,r)}));function Bp(e,n,i){const r=(0,t.useContext)(kp),s=(0,t.useMemo)((()=>e(r)),[]);return(0,t.useEffect)((()=>{const{map:t}=r;var e;t.hasControl(s)||t.addControl(s,null===(e=i||n)||void 0===e?void 0:e.position);return()=>{"function"===typeof n&&n(r),t.hasControl(s)&&t.removeControl(s)}}),[]),s}t.memo((function(e){const n=Bp((t=>{let{mapLib:n}=t;return new n.AttributionControl(e)}),{position:e.position});return(0,t.useEffect)((()=>{Lp(n._container,e.style)}),[e.style]),null}));t.memo((function(e){const n=Bp((t=>{let{mapLib:n}=t;return new n.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)})}),{position:e.position});return(0,t.useEffect)((()=>{Lp(n._controlContainer,e.style)}),[e.style]),null}));const Op=(0,t.forwardRef)(((e,n)=>{const i=(0,t.useRef)({props:e}),r=Bp((t=>{let{mapLib:n}=t;const r=new n.GeolocateControl(e),s=r._setupUI;return r._setupUI=t=>{r._container.hasChildNodes()||s(t)},r.on("geolocate",(t=>{var e,n;null===(e=(n=i.current.props).onGeolocate)||void 0===e||e.call(n,t)})),r.on("error",(t=>{var e,n;null===(e=(n=i.current.props).onError)||void 0===e||e.call(n,t)})),r.on("outofmaxbounds",(t=>{var e,n;null===(e=(n=i.current.props).onOutOfMaxBounds)||void 0===e||e.call(n,t)})),r.on("trackuserlocationstart",(t=>{var e,n;null===(e=(n=i.current.props).onTrackUserLocationStart)||void 0===e||e.call(n,t)})),r.on("trackuserlocationend",(t=>{var e,n;null===(e=(n=i.current.props).onTrackUserLocationEnd)||void 0===e||e.call(n,t)})),r}),{position:e.position});return i.current.props=e,(0,t.useImperativeHandle)(n,(()=>({trigger:()=>r.trigger()})),[]),(0,t.useEffect)((()=>{Lp(r._container,e.style)}),[e.style]),null}));Op.displayName="GeolocateControl";t.memo(Op);t.memo((function(e){const n=Bp((t=>{let{mapLib:n}=t;return new n.NavigationControl(e)}),{position:e.position});return(0,t.useEffect)((()=>{Lp(n._container,e.style)}),[e.style]),null}));function Fp(e){const n=Bp((t=>{let{mapLib:n}=t;return new n.ScaleControl(e)}),{position:e.position});return n.options.unit===e.unit&&n.options.maxWidth===e.maxWidth||(n.options.maxWidth=e.maxWidth,n.setUnit(e.unit)),(0,t.useEffect)((()=>{Lp(n._container,e.style)}),[e.style]),null}Fp.defaultProps={unit:"metric",maxWidth:100};t.memo(Fp);var Vp=n(307),Np=n.n(Vp);const Up={name:"project32",dependencies:[ul],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},jp={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};const Gp={inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...{name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jp;const e={};if(void 0!==t.pickingSelectedColor)if(t.pickingSelectedColor){const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}else e.picking_uSelectedColorValid=0;if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,(t=>t/255));Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return void 0!==t.pickingActive&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}}},qp={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class $p{static get DRAW_MODE(){return qp}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:e=fo("geometry"),drawMode:n=qp.TRIANGLES,attributes:i={},indices:r=null,vertexCount:s=null}=t;this.id=e,this.drawMode=0|n,this.attributes={},this.userData={},this._setAttributes(i,r),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const n in t){let e=t[n];e=ArrayBuffer.isView(e)?{value:e}:e,co(ArrayBuffer.isView(e.value),"".concat(this._print(n),": must be typed array or object with value as typed array")),"POSITION"!==n&&"positions"!==n||e.size||(e.size=3),"indices"===n?(co(!this.indices),this.indices=e):this.attributes[n]=e}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const i in t){const e=t[i],{value:r,size:s,constant:o}=e;!o&&r&&s>=1&&(n=Math.min(n,r.length/s))}return co(Number.isFinite(n)),n}}function Wp(t,e,n,i){let r,s,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(8&n)r=(i[3]-t[1])/(e[1]-t[1]),s=3;else if(4&n)r=(i[1]-t[1])/(e[1]-t[1]),s=1;else if(2&n)r=(i[2]-t[0])/(e[0]-t[0]),s=2;else{if(!(1&n))return null;r=(i[0]-t[0])/(e[0]-t[0]),s=0}for(let a=0;a<t.length;a++)o[a]=(1&s)===a?i[s]:r*(e[a]-t[a])+t[a];return o}function Zp(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function Hp(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Xp(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function Yp(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Kp(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],h=Yp(t,0,n,o);let d,p;const f=Jp(h,r,s,[]),m=[];Hp(c,h);for(let g=1;g<l;g++){for(d=Yp(t,g,n,o,d),p=Zp(d,f);p;){Wp(h,d,p,f,m);const t=Zp(m,f);t&&(Wp(h,m,t,f,m),p=t),Hp(c,m),Xp(h,m),Qp(f,r,p),i&&c.length>n&&(c=[],u.push(c),Hp(c,h)),p=Zp(d,f)}Hp(c,d),Xp(h,d)}return i?u:u[0]}function Jp(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function Qp(t,e,n){8&n?(t[1]+=e,t[3]+=e):4&n?(t[1]-=e,t[3]-=e):2&n?(t[0]+=e,t[2]+=e):1&n&&(t[0]-=e,t[2]-=e)}function tf(t,e,n,i){let r,s=t[0];for(let o=n;o<i;o+=e){r=t[o];const e=r-s;(e>180||e<-180)&&(r-=360*Math.round(e/360)),t[o]=s=r}}function ef(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=360*-Math.round(n/360);if(0!==r)for(let s=0;s<i;s++)t[s*e]+=r}function nf(t,e,n,i){let r;if(Array.isArray(t[0])){const n=t.length*e;r=new Array(n);for(let i=0;i<t.length;i++)for(let n=0;n<e;n++)r[i*e+n]=t[i][n]||0}else r=t;return n?Kp(r,{size:e,gridResolution:n}):i?function(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);tf(o,n,0,r-i);const a=Kp(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)ef(l,n);return a}(r,{size:e}):r}class rf extends class{constructor(t){_t(this,"opts",void 0),_t(this,"typedArrayManager",void 0),_t(this,"indexStarts",[0]),_t(this,"vertexStarts",[0]),_t(this,"vertexCount",0),_t(this,"instanceCount",0),_t(this,"attributes",void 0),_t(this,"_attributeDefs",void 0),_t(this,"data",void 0),_t(this,"getGeometry",void 0),_t(this,"geometryBuffer",void 0),_t(this,"buffers",void 0),_t(this,"positionSize",void 0),_t(this,"normalize",void 0);const{attributes:e={}}=t;this.typedArrayManager=On,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:s,dataChanged:o,normalize:a=!0}=this.opts;if(this.data=e,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===s?2:3),this.buffers=n,this.normalize=a,r&&(xl(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.positions=r)),this.geometryBuffer=n.positions,Array.isArray(o))for(const l of o)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry(t){let{startRow:e,endRow:n}=t;this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?yh(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:s}=this;for(const o in r)if(o in i)s.release(n[o]),n[o]=null;else{const i=r[o];i.copy=e,n[o]=s.allocate(n[o],t,i)}}_forEachGeometry(t,e,n){const{data:i,getGeometry:r}=this,{iterable:s,objectInfo:o}=mh(i,e,n);for(const a of s){o.index++;t(r?r(a,o):null,o.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:s}=this,{startRow:o=0,endRow:a=1/0}=t||{},l={};if(t||(e=[0],n=[0]),this.normalize||!s)this._forEachGeometry(((t,e)=>{const i=t&&this.normalizeGeometry(t);l[e]=i,n[e+1]=n[e]+(i?this.getGeometrySize(i):0)}),o,a),i=n[n.length-1];else if(n=r.startIndices,i=n[r.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof Mo){const t=s.accessor.stride||4*this.positionSize;i=i||s.byteLength/t}else if(s.buffer){const t=s.stride||4*this.positionSize;i=i||s.buffer.byteLength/t}else if(s.value){const t=s.value,e=s.stride/t.BYTES_PER_ELEMENT||this.positionSize;i=i||t.length/e}this._allocate(i,Boolean(t)),this.indexStarts=e,this.vertexStarts=n,this.instanceCount=i;const c={};this._forEachGeometry(((t,r)=>{const s=l[r]||t;c.vertexStart=n[r],c.indexStart=e[r];const o=r<n.length-1?n[r+1]:i;c.geometrySize=o-n[r],c.geometryIndex=r,this.updateGeometryAttributes(s,c)}),o,a),this.vertexCount=e[e.length-1]}}{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?nf(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(sf(t)){let e=0;for(const n of t)e+=this.getGeometrySize(n);return e}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(0!==e.geometrySize)if(t&&sf(t))for(const n of t){const t=this.getGeometrySize(n);e.geometrySize=t,this.updateGeometryAttributes(n,e),e.vertexStart+=t}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const n=this.attributes.segmentTypes,i=!!t&&this.isClosed(t),{vertexStart:r,geometrySize:s}=e;n.fill(0,r,r+s),i?(n[r]=4,n[r+s-2]=4):(n[r]+=1,n[r+s-2]+=2),n[r+s-1]=4}_updatePositions(t,e){const{positions:n}=this.attributes;if(!n||!t)return;const{vertexStart:i,geometrySize:r}=e,s=new Array(3);for(let o=i,a=0;a<r;o++,a++)this.getPointOnPath(t,a,s),n[3*o]=s[0],n[3*o+1]=s[1],n[3*o+2]=s[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const{positionSize:i}=this;e*i>=t.length&&(e+=1-t.length/i);const r=e*i;return n[0]=t[r],n[1]=t[r+1],n[2]=3===i&&t[r+2]||0,n}isClosed(t){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:e}=this,n=t.length-e;return t[0]===t[n]&&t[1]===t[n+1]&&(2===e||t[2]===t[n+2])}}function sf(t){return Array.isArray(t[0])}const of=[0,0,0,255],af={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:of},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},lf={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class cf extends tp{constructor(){super(...arguments),_t(this,"state",void 0)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\n// calculate line join positions\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  // side of the segment - -1: left, 0: center, 1: right\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // direction of the segment\n  vec2 dir = isEnd ? dirA : dirB;\n  // direction of the extrusion\n  vec2 perp = isEnd ? perpA : perpB;\n  // length of the segment\n  float L = isEnd ? lenA : lenB;\n\n  // A = angle of the corner\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  // -1: right, 1: left\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  // trim if inside corner extends further than the line segment\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n\n  // special treatment for start cap and end cap\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n\n  // extend out a triangle to envelope the round cap\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n\n  // Generate variables for fragment shader\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\n\n// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.pickingColor = instancePickingColors;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  geometry.worldPosition = currPosition;\n  vec2 widthPixels = vec2(clamp(\n    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  if (billboard) {\n    // Extrude in clipspace\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    // Extrude in commonspace\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\n/*\n * vPathPosition represents the relative coordinates of the current fragment on the path segment.\n * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.\n * vPathPosition.y - position along the length of the path, between [0, L / width].\n */\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    // if joint is rounded, test distance from the corner\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    // trim miter\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[Up,Gp]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:lf,accessor:"getPath",update:this.calculatePositions,noAlloc:true,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:true},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:lf,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:lf,defaultValue:of},instancePickingColors:{size:3,type:5121,accessor:(t,e)=>{let{index:n,target:i}=e;return this.encodePickingColor(t&&t.__source?t.__source.index:n,i)}}}),this.setState({pathTesselator:new rf({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:e,changeFlags:n}=t,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:t}=this.state,r=e.data.attributes||{};t.updateGeometry({data:e.data,geometryBuffer:r.getPath,buffers:r,normalize:!e._pathType,loop:"loop"===e._pathType,getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||i.invalidateAll()}if(n.extensionsChanged){var r;const{gl:t}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(t),i.invalidateAll()}}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,{data:i}=this.props;return i[0]&&i[0].__source&&(e.object=i.find((t=>t.__source.index===n))),e}disablePickingIndex(t){const{data:e}=this.props;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else this._disablePickingIndex(t)}draw(t){let{uniforms:e}=t;const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:ar[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(t){return new cd(t,{...this.getShaders(),id:this.props.id,geometry:new $p({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}_t(cf,"defaultProps",af),_t(cf,"layerName","PathLayer");class uf extends cf{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":"uniform float trailLength;\nattribute float instanceTimestamps;\nattribute float instanceNextTimestamps;\nvarying float vTime;\n","vs:#main-end":"vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform bool fadeTrail;\nuniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {\n  discard;\n}\n","fs:DECKGL_FILTER_COLOR":"if(fadeTrail) {\n  color.a *= 1.0 - (currentTime - vTime) / trailLength;\n}\n"},t}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){const{fadeTrail:e,trailLength:n,currentTime:i}=this.props;t.uniforms={...t.uniforms,fadeTrail:e,trailLength:n,currentTime:i},super.draw(t)}}_t(uf,"layerName","TripsLayer"),_t(uf,"defaultProps",{fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}});const hf=770,df=32771;var pf=n(609),ff=n.n(pf);Np().workerClass=ff();const mf={longitude:32.5,latitude:4.5,zoom:3,minZoom:0,maxZoom:20},gf=e=>{let{time:n,data:i,highlightedSpecies:r}=e;const[a,l]=(0,t.useState)(void 0),[c,u]=(0,t.useState)(null),h=(0,t.useRef)(null);return(0,t.useLayoutEffect)((()=>{if(!c){const t={width:h.current.clientWidth,height:h.current.clientHeight},{latitude:e,longitude:n,zoom:i}=new El(t).fitBounds([[-19,-37],[54,65]]);u({...mf,latitude:e,longitude:n,zoom:i})}}),[c]),(0,t.useEffect)((()=>{l(new uf({id:"birds",data:i,currentTime:n,getTimestamps:t=>t.properties.times,trailLength:27e5,getColor:t=>{let{properties:e}=t;return s[e.species].color},getPath:t=>t.geometry.coordinates,getWidth:t=>t.properties.species===r?8:2,jointRounded:!0,capRounded:!0,opacity:.75,widthUnits:"pixels",shadowEnabled:!1,parameters:{blend:!0,blendFunc:[hf,df]},updateTriggers:{getWidth:r}}))}),[i,n,r]),(0,o.jsx)("div",{id:"map",ref:h,children:c&&(0,o.jsx)(lp,{initialViewState:c,controller:!0,layers:a?[a]:[],children:(0,o.jsx)(Cp,{mapLib:Np(),attributionControl:!1,mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"})})})},yf=t=>new Date(1e3*t),_f=(t,e)=>{const n=t.flatMap((t=>t.properties.times));if(e){const t=n.reduce(((t,e)=>Math.min(t,yf(e).getFullYear())),[Number.MAX_SAFE_INTEGER]),e=(i=new Date(t,0,1),Math.round(i.getTime()/1e3));return[e,e+31536e3]}return n.reduce(((t,e)=>{let[n,i]=t;return[Math.min(n,e),Math.max(i,e)]}),[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]);var i};const vf=()=>{const[e,n]=(0,t.useState)([]),[i,r]=(0,t.useState)([]),[s,a]=(0,t.useState)(0),[l,u]=(0,t.useState)(!1),h=(0,t.useRef)(null),[d]=c("highlightedSpecies"),[p]=c("activeSpeciesList",[]),[f]=c("sameYear"),[m]=c("speed"),g=function(){const[e,n]=(0,t.useState)(!document.hidden);return(0,t.useEffect)((()=>{const t=()=>{n(!document.hidden)};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}),[]),e}();(0,t.useEffect)((()=>{document.body.classList.add("loading"),fetch("./birds.geojson").then((t=>t.json())).then((t=>t.features)).then((t=>{n(t),document.body.classList.remove("loading")}))}),[]),(0,t.useEffect)((()=>{if(e.length>0){const[t,n]=_f(e,f);r([t,n]),a(t),u(!0)}}),[f,e]),(0,t.useEffect)((()=>{const t=t=>{var n;" "!==t.key||0===e.length||["BUTTON","A","INPUT"].includes(null===(n=t.target)||void 0===n?void 0:n.tagName)||u((t=>!t))};return document.body.addEventListener("keypress",t),()=>{document.body.removeEventListener("keypress",t)}}),[e]),(0,t.useEffect)((()=>(g&&l&&!h.current&&(h.current=setInterval((()=>{a((t=>t+18e3*m))}),50)),()=>{h.current&&(clearInterval(h.current),h.current=null)})),[l,a,m,g]),(0,t.useEffect)((()=>{s>i[1]&&a(i[0])}),[s,i,a]);const y=(0,t.useMemo)((()=>{const t=e.filter((t=>p.includes(t.properties.species))),n=new Date(1e3*i[0]).getFullYear();return f&&n?t.map((t=>{const e=t.properties.times,i=(new Date(yf(e[0]).getFullYear(),0,1)-new Date(n,0,1))/1e3;return{...t,properties:{...t.properties,times:e.map((t=>t-i))}}})):t}),[e,p,f,i]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{id:"layout",children:[(0,o.jsx)(gf,{time:s,data:y,highlightedSpecies:d}),(0,o.jsx)(yt,{time:s,timeRange:i,setTime:a,isTimeRunning:l,setIsTimeRunning:u})]}),0===e.length&&(0,o.jsx)("div",{id:"loading",children:"Please wait for data to be fetched\u2026"})]})},xf=t=>{t&&t instanceof Function&&n.e(787).then(n.bind(n,787)).then((e=>{let{getCLS:n,getFID:i,getFCP:r,getLCP:s,getTTFB:o}=e;n(t),i(t),r(t),s(t),o(t)}))};e.createRoot(document.getElementById("root")).render((0,o.jsx)(t.StrictMode,{children:(0,o.jsx)(l,{initial:{highlightedSpecies:null,activeSpeciesList:r.map((t=>t.name)),sameYear:!0,speed:3},children:(0,o.jsx)(vf,{})})})),xf()})()})();
//# sourceMappingURL=main.6bff78fa.js.map